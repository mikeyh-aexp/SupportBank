/*! jQuery v1.7.2 jquery.com | jquery.org/license */
(function(a,b){function cy(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cu(a){if(!cj[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){ck||(ck=c.createElement("iframe"),ck.frameBorder=ck.width=ck.height=0),b.appendChild(ck);if(!cl||!ck.createElement)cl=(ck.contentWindow||ck.contentDocument).document,cl.write((f.support.boxModel?"<!doctype html>":"")+"<html><body>"),cl.close();d=cl.createElement(a),cl.body.appendChild(d),e=f.css(d,"display"),b.removeChild(ck)}cj[a]=e}return cj[a]}function ct(a,b){var c={};f.each(cp.concat.apply([],cp.slice(0,b)),function(){c[this]=a});return c}function cs(){cq=b}function cr(){setTimeout(cs,0);return cq=f.now()}function ci(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ch(){try{return new a.XMLHttpRequest}catch(b){}}function cb(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1)for(h in a.converters)typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h]);l=k,k=d[g];if(k==="*")k=l;else if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}return c}function ca(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function b_(a,b,c,d){if(f.isArray(b))f.each(b,function(b,e){c||bD.test(a)?d(a,e):b_(a+"["+(typeof e=="object"?b:"")+"]",e,c,d)});else if(!c&&f.type(b)==="object")for(var e in b)b_(a+"["+e+"]",b[e],c,d);else d(a,b)}function b$(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d]);e&&f.extend(!0,a,e)}function bZ(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bS,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=bZ(a,c,d,e,l,g)));(k||!l)&&!g["*"]&&(l=bZ(a,c,d,e,"*",g));return l}function bY(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bO),e=0,g=d.length,h,i,j;for(;e<g;e++)h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}function bB(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?1:0,g=4;if(d>0){if(c!=="border")for(;e<g;e+=2)c||(d-=parseFloat(f.css(a,"padding"+bx[e]))||0),c==="margin"?d+=parseFloat(f.css(a,c+bx[e]))||0:d-=parseFloat(f.css(a,"border"+bx[e]+"Width"))||0;return d+"px"}d=by(a,b);if(d<0||d==null)d=a.style[b];if(bt.test(d))return d;d=parseFloat(d)||0;if(c)for(;e<g;e+=2)d+=parseFloat(f.css(a,"padding"+bx[e]))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+bx[e]+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+bx[e]))||0);return d+"px"}function bo(a){var b=c.createElement("div");bh.appendChild(b),b.innerHTML=a.outerHTML;return b.firstChild}function bn(a){var b=(a.nodeName||"").toLowerCase();b==="input"?bm(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&f.grep(a.getElementsByTagName("input"),bm)}function bm(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function bl(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bk(a,b){var c;b.nodeType===1&&(b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),c==="object"?b.outerHTML=a.outerHTML:c!=="input"||a.type!=="checkbox"&&a.type!=="radio"?c==="option"?b.selected=a.defaultSelected:c==="input"||c==="textarea"?b.defaultValue=a.defaultValue:c==="script"&&b.text!==a.text&&(b.text=a.text):(a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value)),b.removeAttribute(f.expando),b.removeAttribute("_submit_attached"),b.removeAttribute("_change_attached"))}function bj(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c,d,e,g=f._data(a),h=f._data(b,g),i=g.events;if(i){delete h.handle,h.events={};for(c in i)for(d=0,e=i[c].length;d<e;d++)f.event.add(b,c,i[c][d])}h.data&&(h.data=f.extend({},h.data))}}function bi(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function U(a){var b=V.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function T(a,b,c){b=b||0;if(f.isFunction(b))return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return f.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(O.test(b))return f.filter(b,d,!c);b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function S(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function K(){return!0}function J(){return!1}function n(a,b,c){var d=b+"defer",e=b+"queue",g=b+"mark",h=f._data(a,d);h&&(c==="queue"||!f._data(a,e))&&(c==="mark"||!f._data(a,g))&&setTimeout(function(){!f._data(a,e)&&!f._data(a,g)&&(f.removeData(a,d,!0),h.fire())},0)}function m(a){for(var b in a){if(b==="data"&&f.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function l(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(k,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNumeric(d)?+d:j.test(d)?f.parseJSON(d):d}catch(g){}f.data(a,c,d)}else d=b}return d}function h(a){var b=g[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}var c=a.document,d=a.navigator,e=a.location,f=function(){function J(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(J,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=/-([a-z]|[0-9])/ig,w=/^-ms-/,x=function(a,b){return(b+"").toUpperCase()},y=d.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a)return this;if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=m.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2])return f.find(a);this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return!d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a))return f.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.7.2",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?E.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),A.add(a);return this},eq:function(a){a=+a;return a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:E,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){d=i[c],f=a[c];if(i===f)continue;l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body)return setTimeout(e.ready,1);e.isReady=!0;if(a!==!0&&--e.readyWait>0)return;A.fireWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").off("ready")}},bindReady:function(){if(!A){A=e.Callbacks("once memory");if(c.readyState==="complete")return setTimeout(e.ready,1);if(c.addEventListener)c.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",e.ready,!1);else if(c.attachEvent){c.attachEvent("onreadystatechange",B),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&J()}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a!=null&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):I[C.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a))return!1;try{if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||D.call(a,d)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=e.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(n.test(b.replace(o,"@").replace(p,"]").replace(q,"")))return(new Function("return "+b))();e.error("Invalid JSON: "+b)},parseXML:function(c){if(typeof c!="string"||!c)return null;var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(w,"ms-").replace(v,x)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a)if(c.apply(a[f],d)===!1)break}else for(;g<h;)if(c.apply(a[g++],d)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:G?function(a){return a==null?"":G.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?E.call(c,a):e.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(H)return H.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,d),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,d),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a))return b;var f=F.call(arguments,2),g=function(){return a.apply(c,f.concat(F.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h,i){var j,k=d==null,l=0,m=a.length;if(d&&typeof d=="object"){for(l in d)e.access(a,c,l,d[l],1,h,f);g=1}else if(f!==b){j=i===b&&e.isFunction(f),k&&(j?(j=c,c=function(a,b,c){return j.call(e(a),c)}):(c.call(a,f),c=null));if(c)for(;l<m;l++)c(a[l],d,j?f.call(a[l],l,c(a[l],d)):f,i);g=1}return g?a:k?c.call(a):m?c(a[0],d):h},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()}),z=e.uaMatch(y),z.browser&&(e.browser[z.browser]=!0,e.browser.version=z.version),e.browser.webkit&&(e.browser.safari=!0),j.test("Â ")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?B=function(){c.removeEventListener("DOMContentLoaded",B,!1),e.ready()}:c.attachEvent&&(B=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",B),e.ready())});return e}(),g={};f.Callbacks=function(a){a=a?g[a]||h(a):{};var c=[],d=[],e,i,j,k,l,m,n=function(b){var d,e,g,h,i;for(d=0,e=b.length;d<e;d++)g=b[d],h=f.type(g),h==="array"?n(g):h==="function"&&(!a.unique||!p.has(g))&&c.push(g)},o=function(b,f){f=f||[],e=!a.memory||[b,f],i=!0,j=!0,m=k||0,k=0,l=c.length;for(;c&&m<l;m++)if(c[m].apply(b,f)===!1&&a.stopOnFalse){e=!0;break}j=!1,c&&(a.once?e===!0?p.disable():c=[]:d&&d.length&&(e=d.shift(),p.fireWith(e[0],e[1])))},p={add:function(){if(c){var a=c.length;n(arguments),j?l=c.length:e&&e!==!0&&(k=a,o(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++)for(var f=0;f<c.length;f++)if(b[d]===c[f]){j&&f<=l&&(l--,f<=m&&m--),c.splice(f--,1);if(a.unique)break}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++)if(a===c[b])return!0}return!1},empty:function(){c=[];return this},disable:function(){c=d=e=b;return this},disabled:function(){return!c},lock:function(){d=b,(!e||e===!0)&&p.disable();return this},locked:function(){return!d},fireWith:function(b,c){d&&(j?a.once||d.push([b,c]):(!a.once||!e)&&o(b,c));return this},fire:function(){p.fireWith(this,arguments);return this},fired:function(){return!!i}};return p};var i=[].slice;f.extend({Deferred:function(a){var b=f.Callbacks("once memory"),c=f.Callbacks("once memory"),d=f.Callbacks("memory"),e="pending",g={resolve:b,reject:c,notify:d},h={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){i.done(a).fail(b).progress(c);return this},always:function(){i.done.apply(i,arguments).fail.apply(i,arguments);return this},pipe:function(a,b,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],g;f.isFunction(c)?i[a](function(){g=c.apply(this,arguments),g&&f.isFunction(g.promise)?g.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===i?d:this,[g])}):i[a](d[e])})}).promise()},promise:function(a){if(a==null)a=h;else for(var b in h)a[b]=h[b];return a}},i=h.promise({}),j;for(j in g)i[j]=g[j].fire,i[j+"With"]=g[j].fireWith;i.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(i,i);return i},when:function(a){function m(a){return function(b){e[a]=arguments.length>1?i.call(arguments,0):b,j.notifyWith(k,e)}}function l(a){return function(c){b[a]=arguments.length>1?i.call(arguments,0):c,--g||j.resolveWith(j,b)}}var b=i.call(arguments,0),c=0,d=b.length,e=Array(d),g=d,h=d,j=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred(),k=j.promise();if(d>1){for(;c<d;c++)b[c]&&b[c].promise&&f.isFunction(b[c].promise)?b[c].promise().then(l(c),j.reject,m(c)):--g;g||j.resolveWith(j,b)}else j!==a&&j.resolveWith(j,d?[a]:[]);return k}}),f.support=function(){var b,d,e,g,h,i,j,k,l,m,n,o,p=c.createElement("div"),q=c.documentElement;p.setAttribute("className","t"),p.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=p.getElementsByTagName("*"),e=p.getElementsByTagName("a")[0];if(!d||!d.length||!e)return{};g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=p.getElementsByTagName("input")[0],b={leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:p.className!=="t",enctype:!!c.createElement("form").enctype,html5Clone:c.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,pixelMargin:!0},f.boxModel=b.boxModel=c.compatMode==="CSS1Compat",i.checked=!0,b.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,b.optDisabled=!h.disabled;try{delete p.test}catch(r){b.deleteExpando=!1}!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",function(){b.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),b.radioValue=i.value==="t",i.setAttribute("checked","checked"),i.setAttribute("name","t"),p.appendChild(i),j=c.createDocumentFragment(),j.appendChild(p.lastChild),b.checkClone=j.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=i.checked,j.removeChild(i),j.appendChild(p);if(p.attachEvent)for(n in{submit:1,change:1,focusin:1})m="on"+n,o=m in p,o||(p.setAttribute(m,"return;"),o=typeof p[m]=="function"),b[n+"Bubbles"]=o;j.removeChild(p),j=g=h=p=i=null,f(function(){var d,e,g,h,i,j,l,m,n,q,r,s,t,u=c.getElementsByTagName("body")[0];!u||(m=1,t="padding:0;margin:0;border:",r="position:absolute;top:0;left:0;width:1px;height:1px;",s=t+"0;visibility:hidden;",n="style='"+r+t+"5px solid #000;",q="<div "+n+"display:block;'><div style='"+t+"0;display:block;overflow:hidden;'></div></div>"+"<table "+n+"' cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",d=c.createElement("div"),d.style.cssText=s+"width:0;height:0;position:static;top:0;margin-top:"+m+"px",u.insertBefore(d,u.firstChild),p=c.createElement("div"),d.appendChild(p),p.innerHTML="<table><tr><td style='"+t+"0;display:none'></td><td>t</td></tr></table>",k=p.getElementsByTagName("td"),o=k[0].offsetHeight===0,k[0].style.display="",k[1].style.display="none",b.reliableHiddenOffsets=o&&k[0].offsetHeight===0,a.getComputedStyle&&(p.innerHTML="",l=c.createElement("div"),l.style.width="0",l.style.marginRight="0",p.style.width="2px",p.appendChild(l),b.reliableMarginRight=(parseInt((a.getComputedStyle(l,null)||{marginRight:0}).marginRight,10)||0)===0),typeof p.style.zoom!="undefined"&&(p.innerHTML="",p.style.width=p.style.padding="1px",p.style.border=0,p.style.overflow="hidden",p.style.display="inline",p.style.zoom=1,b.inlineBlockNeedsLayout=p.offsetWidth===3,p.style.display="block",p.style.overflow="visible",p.innerHTML="<div style='width:5px;'></div>",b.shrinkWrapBlocks=p.offsetWidth!==3),p.style.cssText=r+s,p.innerHTML=q,e=p.firstChild,g=e.firstChild,i=e.nextSibling.firstChild.firstChild,j={doesNotAddBorder:g.offsetTop!==5,doesAddBorderForTableAndCells:i.offsetTop===5},g.style.position="fixed",g.style.top="20px",j.fixedPosition=g.offsetTop===20||g.offsetTop===15,g.style.position=g.style.top="",e.style.overflow="hidden",e.style.position="relative",j.subtractsBorderForOverflowNotVisible=g.offsetTop===-5,j.doesNotIncludeMarginInBodyOffset=u.offsetTop!==m,a.getComputedStyle&&(p.style.marginTop="1%",b.pixelMargin=(a.getComputedStyle(p,null)||{marginTop:0}).marginTop!=="1%"),typeof d.style.zoom!="undefined"&&(d.style.zoom=1),u.removeChild(d),l=p=d=null,f.extend(b,j))});return b}();var j=/^(?:\{.*\}|\[.*\])$/,k=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return!!a&&!m(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i,j=f.expando,k=typeof c=="string",l=a.nodeType,m=l?f.cache:a,n=l?a[j]:a[j]&&j,o=c==="events";if((!n||!m[n]||!o&&!e&&!m[n].data)&&k&&d===b)return;n||(l?a[j]=n=++f.uuid:n=j),m[n]||(m[n]={},l||(m[n].toJSON=f.noop));if(typeof c=="object"||typeof c=="function")e?m[n]=f.extend(m[n],c):m[n].data=f.extend(m[n].data,c);g=h=m[n],e||(h.data||(h.data={}),h=h.data),d!==b&&(h[f.camelCase(c)]=d);if(o&&!h[c])return g.events;k?(i=h[c],i==null&&(i=h[f.camelCase(c)])):i=h;return i}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e,g,h=f.expando,i=a.nodeType,j=i?f.cache:a,k=i?a[h]:h;if(!j[k])return;if(b){d=c?j[k]:j[k].data;if(d){f.isArray(b)||(b in d?b=[b]:(b=f.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,g=b.length;e<g;e++)delete d[b[e]];if(!(c?m:f.isEmptyObject)(d))return}}if(!c){delete j[k].data;if(!m(j[k]))return}f.support.deleteExpando||!j.setInterval?delete j[k]:j[k]=null,i&&(f.support.deleteExpando?delete a[h]:a.removeAttribute?a.removeAttribute(h):a[h]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),f.fn.extend({data:function(a,c){var d,e,g,h,i,j=this[0],k=0,m=null;if(a===b){if(this.length){m=f.data(j);if(j.nodeType===1&&!f._data(j,"parsedAttrs")){g=j.attributes;for(i=g.length;k<i;k++)h=g[k].name,h.indexOf("data-")===0&&(h=f.camelCase(h.substring(5)),l(j,h,m[h]));f._data(j,"parsedAttrs",!0)}}return m}if(typeof a=="object")return this.each(function(){f.data(this,a)});d=a.split(".",2),d[1]=d[1]?"."+d[1]:"",e=d[1]+"!";return f.access(this,function(c){if(c===b){m=this.triggerHandler("getData"+e,[d[0]]),m===b&&j&&(m=f.data(j,a),m=l(j,a,m));return m===b&&d[1]?this.data(d[0]):m}d[1]=c,this.each(function(){var b=f(this);b.triggerHandler("setData"+e,d),f.data(this,a,c),b.triggerHandler("changeData"+e,d)})},null,c,arguments.length>1,null,!1)},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",f._data(a,b,(f._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(f._data(b,d)||1)-1;e?f._data(b,d,e):(f.removeData(b,d,!0),n(b,c,"mark"))}},queue:function(a,b,c){var d;if(a){b=(b||"fx")+"queue",d=f._data(a,b),c&&(!d||f.isArray(c)?d=f._data(a,b,f.makeArray(c)):d.push(c));return d||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),f._data(a,b+".run",e),d.call(a,function(){f.dequeue(a,b)},e)),c.length||(f.removeData(a,b+"queue "+b+".run",!0),n(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){var d=2;typeof a!="string"&&(c=a,a="fx",d--);if(arguments.length<d)return f.queue(this[0],a);return c===b?this:this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f.Callbacks("once memory"),!0))h++,l.add(m);m();return d.promise(c)}});var o=/[\n\t\r]/g,p=/\s+/,q=/\r/g,r=/^(?:button|input)$/i,s=/^(?:button|input|object|select|textarea)$/i,t=/^a(?:rea)?$/i,u=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,v=f.support.getSetAttribute,w,x,y;f.fn.extend({attr:function(a,b){return f.access(this,f.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,f.prop,a,b,arguments.length>1)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a))return this.each(function(b){f(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(p);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++)~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ");e.className=f.trim(g)}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a))return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(p);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className)if(a){h=(" "+g.className+" ").replace(o," ");for(i=0,j=c.length;i<j;i++)h=h.replace(" "+c[i]+" "," ");g.className=f.trim(h)}else g.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a))return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)});return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(p);while(e=j[g++])i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(o," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e,g=this[0];{if(!!arguments.length){e=f.isFunction(a);return this.each(function(d){var g=f(this),h;if(this.nodeType===1){e?h=a.call(this,d,g.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.type]||f.valHooks[this.nodeName.toLowerCase()];if(!c||!("set"in c)||c.set(this,h,"value")===b)this.value=h}})}if(g){c=f.valHooks[g.type]||f.valHooks[g.nodeName.toLowerCase()];if(c&&"get"in c&&(d=c.get(g,"value"))!==b)return d;d=g.value;return typeof d=="string"?d.replace(q,""):d==null?"":d}}}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,g=a.selectedIndex,h=[],i=a.options,j=a.type==="select-one";if(g<0)return null;c=j?g:0,d=j?g+1:i.length;for(;c<d;c++){e=i[c];if(e.selected&&(f.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!f.nodeName(e.parentNode,"optgroup"))){b=f(e).val();if(j)return b;h.push(b)}}if(j&&!h.length&&i.length)return f(i[g]).val();return h},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var g,h,i,j=a.nodeType;if(!!a&&j!==3&&j!==8&&j!==2){if(e&&c in f.attrFn)return f(a)[c](d);if(typeof a.getAttribute=="undefined")return f.prop(a,c,d);i=j!==1||!f.isXMLDoc(a),i&&(c=c.toLowerCase(),h=f.attrHooks[c]||(u.test(c)?x:w));if(d!==b){if(d===null){f.removeAttr(a,c);return}if(h&&"set"in h&&i&&(g=h.set(a,d,c))!==b)return g;a.setAttribute(c,""+d);return d}if(h&&"get"in h&&i&&(g=h.get(a,c))!==null)return g;g=a.getAttribute(c);return g===null?b:g}},removeAttr:function(a,b){var c,d,e,g,h,i=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(p),g=d.length;for(;i<g;i++)e=d[i],e&&(c=f.propFix[e]||e,h=u.test(e),h||f.attr(a,e,""),a.removeAttribute(v?e:c),h&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(r.test(a.nodeName)&&a.parentNode)f.error("type property can't be changed");else if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}},value:{get:function(a,b){if(w&&f.nodeName(a,"button"))return w.get(a,b);return b in a?a.value:null},set:function(a,b,c){if(w&&f.nodeName(a,"button"))return w.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){h=i!==1||!f.isXMLDoc(a),h&&(c=f.propFix[c]||c,g=f.propHooks[c]);return d!==b?g&&"set"in g&&(e=g.set(a,d,c))!==b?e:a[c]=d:g&&"get"in g&&(e=g.get(a,c))!==null?e:a[c]}},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):s.test(a.nodeName)||t.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabindex=f.propHooks.tabIndex,x={get:function(a,c){var d,e=f.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},v||(y={name:!0,id:!0,coords:!0},w=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&(y[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.attrHooks.tabindex.set=w.set,f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})}),f.attrHooks.contenteditable={get:w.get,set:function(a,b,c){b===""&&(b="false"),w.set(a,b,c)}}),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.enctype||(f.propFix.enctype="encoding"),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b))return a.checked=f.inArray(f(a).val(),b)>=0}})});var z=/^(?:textarea|input|select)$/i,A=/^([^\.]*)?(?:\.(.+))?$/,B=/(?:^|\s)hover(\.\S+)?\b/,C=/^key/,D=/^(?:mouse|contextmenu)|click/,E=/^(?:focusinfocus|focusoutblur)$/,F=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,G=function(
a){var b=F.exec(a);b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)"));return b},H=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},I=function(a){return f.event.special.hover?a:a.replace(B,"mouseenter$1 mouseleave$1")};f.event={add:function(a,c,d,e,g){var h,i,j,k,l,m,n,o,p,q,r,s;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(h=f._data(a)))){d.handler&&(p=d,d=p.handler,g=p.selector),d.guid||(d.guid=f.guid++),j=h.events,j||(h.events=j={}),i=h.handle,i||(h.handle=i=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.dispatch.apply(i.elem,arguments):b},i.elem=a),c=f.trim(I(c)).split(" ");for(k=0;k<c.length;k++){l=A.exec(c[k])||[],m=l[1],n=(l[2]||"").split(".").sort(),s=f.event.special[m]||{},m=(g?s.delegateType:s.bindType)||m,s=f.event.special[m]||{},o=f.extend({type:m,origType:l[1],data:e,handler:d,guid:d.guid,selector:g,quick:g&&G(g),namespace:n.join(".")},p),r=j[m];if(!r){r=j[m]=[],r.delegateCount=0;if(!s.setup||s.setup.call(a,e,n,i)===!1)a.addEventListener?a.addEventListener(m,i,!1):a.attachEvent&&a.attachEvent("on"+m,i)}s.add&&(s.add.call(a,o),o.handler.guid||(o.handler.guid=d.guid)),g?r.splice(r.delegateCount++,0,o):r.push(o),f.event.global[m]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var g=f.hasData(a)&&f._data(a),h,i,j,k,l,m,n,o,p,q,r,s;if(!!g&&!!(o=g.events)){b=f.trim(I(b||"")).split(" ");for(h=0;h<b.length;h++){i=A.exec(b[h])||[],j=k=i[1],l=i[2];if(!j){for(j in o)f.event.remove(a,j+b[h],c,d,!0);continue}p=f.event.special[j]||{},j=(d?p.delegateType:p.bindType)||j,r=o[j]||[],m=r.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(n=0;n<r.length;n++)s=r[n],(e||k===s.origType)&&(!c||c.guid===s.guid)&&(!l||l.test(s.namespace))&&(!d||d===s.selector||d==="**"&&s.selector)&&(r.splice(n--,1),s.selector&&r.delegateCount--,p.remove&&p.remove.call(a,s));r.length===0&&m!==r.length&&((!p.teardown||p.teardown.call(a,l)===!1)&&f.removeEvent(a,j,g.handle),delete o[j])}f.isEmptyObject(o)&&(q=g.handle,q&&(q.elem=null),f.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){if(!e||e.nodeType!==3&&e.nodeType!==8){var h=c.type||c,i=[],j,k,l,m,n,o,p,q,r,s;if(E.test(h+f.event.triggered))return;h.indexOf("!")>=0&&(h=h.slice(0,-1),k=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if((!e||f.event.customEvent[h])&&!f.event.global[h])return;c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.isTrigger=!0,c.exclusive=k,c.namespace=i.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,o=h.indexOf(":")<0?"on"+h:"";if(!e){j=f.cache;for(l in j)j[l].events&&j[l].events[h]&&f.event.trigger(c,d,j[l].handle.elem,!0);return}c.result=b,c.target||(c.target=e),d=d!=null?f.makeArray(d):[],d.unshift(c),p=f.event.special[h]||{};if(p.trigger&&p.trigger.apply(e,d)===!1)return;r=[[e,p.bindType||h]];if(!g&&!p.noBubble&&!f.isWindow(e)){s=p.delegateType||h,m=E.test(s+h)?e:e.parentNode,n=null;for(;m;m=m.parentNode)r.push([m,s]),n=m;n&&n===e.ownerDocument&&r.push([n.defaultView||n.parentWindow||a,s])}for(l=0;l<r.length&&!c.isPropagationStopped();l++)m=r[l][0],c.type=r[l][1],q=(f._data(m,"events")||{})[c.type]&&f._data(m,"handle"),q&&q.apply(m,d),q=o&&m[o],q&&f.acceptData(m)&&q.apply(m,d)===!1&&c.preventDefault();c.type=h,!g&&!c.isDefaultPrevented()&&(!p._default||p._default.apply(e.ownerDocument,d)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)&&o&&e[h]&&(h!=="focus"&&h!=="blur"||c.target.offsetWidth!==0)&&!f.isWindow(e)&&(n=e[o],n&&(e[o]=null),f.event.triggered=h,e[h](),f.event.triggered=b,n&&(e[o]=n));return c.result}},dispatch:function(c){c=f.event.fix(c||a.event);var d=(f._data(this,"events")||{})[c.type]||[],e=d.delegateCount,g=[].slice.call(arguments,0),h=!c.exclusive&&!c.namespace,i=f.event.special[c.type]||{},j=[],k,l,m,n,o,p,q,r,s,t,u;g[0]=c,c.delegateTarget=this;if(!i.preDispatch||i.preDispatch.call(this,c)!==!1){if(e&&(!c.button||c.type!=="click")){n=f(this),n.context=this.ownerDocument||this;for(m=c.target;m!=this;m=m.parentNode||this)if(m.disabled!==!0){p={},r=[],n[0]=m;for(k=0;k<e;k++)s=d[k],t=s.selector,p[t]===b&&(p[t]=s.quick?H(m,s.quick):n.is(t)),p[t]&&r.push(s);r.length&&j.push({elem:m,matches:r})}}d.length>e&&j.push({elem:this,matches:d.slice(e)});for(k=0;k<j.length&&!c.isPropagationStopped();k++){q=j[k],c.currentTarget=q.elem;for(l=0;l<q.matches.length&&!c.isImmediatePropagationStopped();l++){s=q.matches[l];if(h||!c.namespace&&!s.namespace||c.namespace_re&&c.namespace_re.test(s.namespace))c.data=s.data,c.handleObj=s,o=((f.event.special[s.origType]||{}).handle||s.handler).apply(q.elem,g),o!==b&&(c.result=o,o===!1&&(c.preventDefault(),c.stopPropagation()))}}i.postDispatch&&i.postDispatch.call(this,c);return c.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,d){var e,f,g,h=d.button,i=d.fromElement;a.pageX==null&&d.clientX!=null&&(e=a.target.ownerDocument||c,f=e.documentElement,g=e.body,a.pageX=d.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=d.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?d.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0);return a}},fix:function(a){if(a[f.expando])return a;var d,e,g=a,h=f.event.fixHooks[a.type]||{},i=h.props?this.props.concat(h.props):this.props;a=f.Event(g);for(d=i.length;d;)e=i[--d],a[e]=g[e];a.target||(a.target=g.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey);return h.filter?h.filter(a,g):a},special:{ready:{setup:f.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=f.extend(new f.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?f.event.trigger(e,null,b):f.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},f.event.handle=f.event.dispatch,f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!(this instanceof f.Event))return new f.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?K:J):this.type=a,b&&f.extend(this,b),this.timeStamp=a&&a.timeStamp||f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=K;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=K;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()},isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J},f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,g=e.selector,h;if(!d||d!==c&&!f.contains(c,d))a.type=e.origType,h=e.handler.apply(this,arguments),a.type=b;return h}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(){if(f.nodeName(this,"form"))return!1;f.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=f.nodeName(c,"input")||f.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(f.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),d._submit_attached=!0)})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&f.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if(f.nodeName(this,"form"))return!1;f.event.remove(this,"._submit")}}),f.support.changeBubbles||(f.event.special.change={setup:function(){if(z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")f.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),f.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,f.event.simulate("change",this,a,!0))});return!1}f.event.add(this,"beforeactivate._change",function(a){var b=a.target;z.test(b.nodeName)&&!b._change_attached&&(f.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&f.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){f.event.remove(this,"._change");return z.test(this.nodeName)}}),f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){var d=0,e=function(a){f.event.simulate(b,a.target,f.event.fix(a),!0)};f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.fn.extend({on:function(a,c,d,e,g){var h,i;if(typeof a=="object"){typeof c!="string"&&(d=d||c,c=b);for(i in a)this.on(i,c,d,a[i],g);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=J;else if(!e)return this;g===1&&(h=e,e=function(a){f().off(a);return h.apply(this,arguments)},e.guid=h.guid||(h.guid=f.guid++));return this.each(function(){f.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;f(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler);return this}if(typeof a=="object"){for(var g in a)this.off(g,c,a[g]);return this}if(c===!1||typeof c=="function")d=c,c=b;d===!1&&(d=J);return this.each(function(){f.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){f(this.context).on(a,this.selector,b,c);return this},die:function(a,b){f(this.context).off(a,this.selector||"**",b);return this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return f.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f._data(this,"lastToggle"+a.guid)||0)%d;f._data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.on(b,null,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0),C.test(b)&&(f.event.fixHooks[b]=f.event.keyHooks),D.test(b)&&(f.event.fixHooks[b]=f.event.mouseHooks)}),function(){function x(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}if(j.nodeType===1){g||(j[d]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else if(m.filter(b,[j]).length>0){k=j;break}}j=j[a]}e[h]=k}}}function w(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}j.nodeType===1&&!g&&(j[d]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}e[h]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d="sizcache"+(Math.random()+"").replace(".",""),e=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){i=!1;return 0});var m=function(b,d,e,f){e=e||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9)return[];if(!b||typeof b!="string")return e;var i,j,k,l,n,q,r,t,u=!0,v=m.isXML(d),w=[],x=b;do{a.exec(""),i=a.exec(x);if(i){x=i[3],w.push(i[1]);if(i[2]){l=i[3];break}}}while(i);if(w.length>1&&p.exec(b))if(w.length===2&&o.relative[w[0]])j=y(w[0]+w[1],d,f);else{j=o.relative[w[0]]?[d]:m(w.shift(),d);while(w.length)b=w.shift(),o.relative[b]&&(b+=w.shift()),j=y(b,j,f)}else{!f&&w.length>1&&d.nodeType===9&&!v&&o.match.ID.test(w[0])&&!o.match.ID.test(w[w.length-1])&&(n=m.find(w.shift(),d,v),d=n.expr?m.filter(n.expr,n.set)[0]:n.set[0]);if(d){n=f?{expr:w.pop(),set:s(f)}:m.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&d.parentNode?d.parentNode:d,v),j=n.expr?m.filter(n.expr,n.set):n.set,w.length>0?k=s(j):u=!1;while(w.length)q=w.pop(),r=q,o.relative[q]?r=w.pop():q="",r==null&&(r=d),o.relative[q](k,r,v)}else k=w=[]}k||(k=j),k||m.error(q||b);if(g.call(k)==="[object Array]")if(!u)e.push.apply(e,k);else if(d&&d.nodeType===1)for(t=0;k[t]!=null;t++)k[t]&&(k[t]===!0||k[t].nodeType===1&&m.contains(d,k[t]))&&e.push(j[t]);else for(t=0;k[t]!=null;t++)k[t]&&k[t].nodeType===1&&e.push(j[t]);else s(k,e);l&&(m(l,h,e,f),m.uniqueSort(e));return e};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a)return[];for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter)if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\")continue;s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f)g=i=!0;else if(f===!0)continue}if(f)for(n=0;(j=s[n])!=null;n++)j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0));if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g)return[];break}}if(a===q)if(g==null)m.error(a);else break;q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9||d===11){if(typeof a.textContent=="string")return a.textContent;if(typeof a.innerText=="string")return a.innerText.replace(k,"");for(a=a.firstChild;a;a=a.nextSibling)e+=n(a)}else if(d===3||d===4)return a.nodeValue}else for(b=0;c=a[b];b++)c.nodeType!==8&&(e+=n(c));return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&m.filter(b,a,!0)}},"":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("parentNode",b,f,a,d,c)},"~":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("previousSibling",b,f,a,d,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&m.error(a[0]);a[0]=e++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not")if((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=m(b[3],null,null,c);else{var g=m.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return!1}else if(o.match.POS.test(b[0])||o.match.CHILD.test(b[0]))return!0;return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}m.error(e)},CHILD:function(a,b){var c,e,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling)if(l.nodeType===1)return!1;if(k==="first")return!0;l=a;case"last":while(l=l.nextSibling)if(l.nodeType===1)return!1;return!0;case"nth":c=b[2],e=b[3];if(c===1&&e===0)return!0;f=b[0],g=a.parentNode;if(g&&(g[d]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling)l.nodeType===1&&(l.nodeIndex=++i);g[d]=f}j=a.nodeIndex-e;return c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f)return f(a,c,b,d)}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match)o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q));o.match.globalPOS=p;var s=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var u,v;c.documentElement.compareDocumentPosition?u=function(a,b){if(a===b){h=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition)return a.compareDocumentPosition?-1:1;return a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b){h=!0;return 0}if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i)return v(a,b);if(!g)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return v(e[k],f[k]);return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=m,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,e,f,g){e=e||c;if(!g&&!m.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1])return s(e.getElementsByTagName(b),f);if(h[2]&&o.find.CLASS&&e.getElementsByClassName)return s(e.getElementsByClassName(h[2]),f)}if(e.nodeType===9){if(b==="body"&&e.body)return s([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return s([],f);if(i.id===h[3])return s([i],f)}try{return s(e.querySelectorAll(b),f)}catch(j){}}else if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var k=e,l=e.getAttribute("id"),n=l||d,p=e.parentNode,q=/^\s*[+~]/.test(b);l?n=n.replace(/'/g,"\\$&"):e.setAttribute("id",n),q&&p&&(e=e.parentNode);try{if(!q||p)return s(e.querySelectorAll("[id='"+n+"'] "+b),f)}catch(r){}finally{l||k.removeAttribute("id")}}}return a(b,e,f,g)};for(var e in a)m[e]=a[e];b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}m.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a))try{if(e||!o.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11)return f}}catch(g){}return m(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),c.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?m.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return!1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var y=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a))f+=d[0],a=a.replace(o.match.PSEUDO,"");a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++)m(a,g[h],e,c);return m.filter(f,e)};m.attr=f.attr,m.selectors.attrMap={},f.find=m,f.expr=m.selectors,f.expr[":"]=f.expr.filters,f.unique=m.uniqueSort,f.text=m.getText,f.isXMLDoc=m.isXML,f.contains=m.contains}();var L=/Until$/,M=/^(?:parents|prevUntil|prevAll)/,N=/,/,O=/^.[^:#\[\.,]*$/,P=Array.prototype.slice,Q=f.expr.match.globalPOS,R={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return f(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(f.contains(b[c],this))return!0});var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0)for(h=g;h<e.length;h++)for(i=0;i<g;i++)if(e[i]===e[h]){e.splice(h--,1);break}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(f.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(T(this,a,!1),"not",a)},filter:function(a){return this.pushStack(T(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?Q.test(a)?f(a,this.context).index(this[0])>=0:f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h=1;while(g&&g.ownerDocument&&g!==b){for(d=0;d<a.length;d++)f(g).is(a[d])&&c.push({selector:a[d],elem:g,level:h});g=g.parentNode,h++}return c}var i=Q.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(i?i.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11)break}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a)return this[0]&&this[0].parentNode?this.prevAll().length:-1;if(typeof a=="string")return f.inArray(this[0],f(a));return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(S(c[0])||S(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c);L.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!R[a]?f.unique(e):e,(this.length>1||N.test(d))&&M.test(a)&&(e=e.reverse());return this.pushStack(e,a,P.call(arguments).join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d)))g.nodeType===1&&e.push(g),g=g[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var V="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|style)/i,bb=/<(?:script|object|embed|option|style)/i,bc=new RegExp("<(?:"+V+")[\\s/>]","i"),bd=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/\/(java|ecma)script/i,bf=/^\s*<!(?:\[CDATA\[|\-\-)/,bg={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bh=U(c);bg.optgroup=bg.option,bg.tbody=bg.tfoot=bg.colgroup=bg.caption=bg.thead,bg.th=bg.td,f.support.htmlSerialize||(bg._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){return f.access(this,function(a){return a===b?f.text(this):this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapAll(a.call(this,b))});if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapInner(a.call(this,b))});return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=f.isFunction(a);return this.each(function(c){f(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=f
.clean(arguments);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f.clean(arguments));return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||f.filter(a,[d]).length)!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){return f.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return c.nodeType===1?c.innerHTML.replace(W,""):null;if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!bg[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(;d<e;d++)c=this[d]||{},c.nodeType===1&&(f.cleanData(c.getElementsByTagName("*")),c.innerHTML=a);c=0}catch(g){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a))return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))});typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bd.test(j))return this.each(function(){f(this).domManip(a,c,d,!0)});if(f.isFunction(j))return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)});if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++)d.call(c?bi(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}k.length&&f.each(k,function(a,b){b.src?f.ajax({type:"GET",global:!1,url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bf,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)})}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i,j=a[0];b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof j=="string"&&j.length<512&&i===c&&j.charAt(0)==="<"&&!bb.test(j)&&(f.support.checkClone||!bd.test(j))&&(f.support.html5Clone||!bc.test(j))&&(g=!0,h=f.fragments[j],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[j]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d,e,g,h=f.support.html5Clone||f.isXMLDoc(a)||!bc.test("<"+a.nodeName+">")?a.cloneNode(!0):bo(a);if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bk(a,h),d=bl(a),e=bl(h);for(g=0;d[g];++g)e[g]&&bk(d[g],e[g])}if(b){bj(a,h);if(c){d=bl(a),e=bl(h);for(g=0;d[g];++g)bj(d[g],e[g])}}d=e=null;return h},clean:function(a,b,d,e){var g,h,i,j=[];b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);for(var k=0,l;(l=a[k])!=null;k++){typeof l=="number"&&(l+="");if(!l)continue;if(typeof l=="string")if(!_.test(l))l=b.createTextNode(l);else{l=l.replace(Y,"<$1></$2>");var m=(Z.exec(l)||["",""])[1].toLowerCase(),n=bg[m]||bg._default,o=n[0],p=b.createElement("div"),q=bh.childNodes,r;b===c?bh.appendChild(p):U(b).appendChild(p),p.innerHTML=n[1]+l+n[2];while(o--)p=p.lastChild;if(!f.support.tbody){var s=$.test(l),t=m==="table"&&!s?p.firstChild&&p.firstChild.childNodes:n[1]==="<table>"&&!s?p.childNodes:[];for(i=t.length-1;i>=0;--i)f.nodeName(t[i],"tbody")&&!t[i].childNodes.length&&t[i].parentNode.removeChild(t[i])}!f.support.leadingWhitespace&&X.test(l)&&p.insertBefore(b.createTextNode(X.exec(l)[0]),p.firstChild),l=p.childNodes,p&&(p.parentNode.removeChild(p),q.length>0&&(r=q[q.length-1],r&&r.parentNode&&r.parentNode.removeChild(r)))}var u;if(!f.support.appendChecked)if(l[0]&&typeof (u=l.length)=="number")for(i=0;i<u;i++)bn(l[i]);else bn(l);l.nodeType?j.push(l):j=f.merge(j,l)}if(d){g=function(a){return!a.type||be.test(a.type)};for(k=0;j[k];k++){h=j[k];if(e&&f.nodeName(h,"script")&&(!h.type||be.test(h.type)))e.push(h.parentNode?h.parentNode.removeChild(h):h);else{if(h.nodeType===1){var v=f.grep(h.getElementsByTagName("script"),g);j.splice.apply(j,[k+1,0].concat(v))}d.appendChild(h)}}}return j},cleanData:function(a){var b,c,d=f.cache,e=f.event.special,g=f.support.deleteExpando;for(var h=0,i;(i=a[h])!=null;h++){if(i.nodeName&&f.noData[i.nodeName.toLowerCase()])continue;c=i[f.expando];if(c){b=d[c];if(b&&b.events){for(var j in b.events)e[j]?f.event.remove(i,j):f.removeEvent(i,j,b.handle);b.handle&&(b.handle.elem=null)}g?delete i[f.expando]:i.removeAttribute&&i.removeAttribute(f.expando),delete d[c]}}}});var bp=/alpha\([^)]*\)/i,bq=/opacity=([^)]*)/,br=/([A-Z]|^ms)/g,bs=/^[\-+]?(?:\d*\.)?\d+$/i,bt=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,bu=/^([\-+])=([\-+.\de]+)/,bv=/^margin/,bw={position:"absolute",visibility:"hidden",display:"block"},bx=["Top","Right","Bottom","Left"],by,bz,bA;f.fn.css=function(a,c){return f.access(this,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)},a,c,arguments.length>1)},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=by(a,"opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get"in k&&(g=k.get(a,!1,e))!==b)return g;return j[c]}h=typeof d,h==="string"&&(g=bu.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d))return;h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set"in k)||(d=k.set(a,d))!==b)try{j[c]=d}catch(l){}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get"in g&&(e=g.get(a,!0,d))!==b)return e;if(by)return by(a,c)},swap:function(a,b,c){var d={},e,f;for(f in b)d[f]=a.style[f],a.style[f]=b[f];e=c.call(a);for(f in b)a.style[f]=d[f];return e}}),f.curCSS=f.css,c.defaultView&&c.defaultView.getComputedStyle&&(bz=function(a,b){var c,d,e,g,h=a.style;b=b.replace(br,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!f.contains(a.ownerDocument.documentElement,a)&&(c=f.style(a,b))),!f.support.pixelMargin&&e&&bv.test(b)&&bt.test(c)&&(g=h.width,h.width=c,c=e.width,h.width=g);return c}),c.documentElement.currentStyle&&(bA=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;f==null&&g&&(e=g[b])&&(f=e),bt.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d));return f===""?"auto":f}),by=bz||bA,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){if(c)return a.offsetWidth!==0?bB(a,b,d):f.swap(a,bw,function(){return bB(a,b,d)})},set:function(a,b){return bs.test(b)?b+"px":b}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return bq.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bp,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bp.test(g)?g.replace(bp,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){return f.swap(a,{display:"inline-block"},function(){return b?by(a,"margin-right"):a.style.marginRight})}})}),f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style&&a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return!f.expr.filters.hidden(a)}),f.each({margin:"",padding:"",border:"Width"},function(a,b){f.cssHooks[a+b]={expand:function(c){var d,e=typeof c=="string"?c.split(" "):[c],f={};for(d=0;d<4;d++)f[a+bx[d]+b]=e[d]||e[d-2]||e[0];return f}}});var bC=/%20/g,bD=/\[\]$/,bE=/\r?\n/g,bF=/#.*$/,bG=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bH=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bI=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bJ=/^(?:GET|HEAD)$/,bK=/^\/\//,bL=/\?/,bM=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bN=/^(?:select|textarea)/i,bO=/\s+/,bP=/([?&])_=[^&]*/,bQ=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bR=f.fn.load,bS={},bT={},bU,bV,bW=["*/"]+["*"];try{bU=e.href}catch(bX){bU=c.createElement("a"),bU.href="",bU=bU.href}bV=bQ.exec(bU.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bR)return bR.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bM,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bN.test(this.nodeName)||bH.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bE,"\r\n")}}):{name:b.name,value:c.replace(bE,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.on(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?b$(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),b$(a,b);return a},ajaxSettings:{url:bU,isLocal:bI.test(bV[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bW},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bY(bS),ajaxTransport:bY(bT),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?ca(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified"))f.lastModified[k]=y;if(z=v.getResponseHeader("Etag"))f.etag[k]=z}if(a===304)w="notmodified",o=!0;else try{r=cb(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}else{u=w;if(!w||a)w="error",a<0&&(a=0)}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.fireWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f.Callbacks("once memory"),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bG.exec(n))o[c[1].toLowerCase()]=c[2]}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.add,v.statusCode=function(a){if(a){var b;if(s<2)for(b in a)j[b]=[j[b],a[b]];else b=a[v.status],v.then(b,b)}return this},d.url=((a||d.url)+"").replace(bF,"").replace(bK,bV[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bO),d.crossDomain==null&&(r=bQ.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bV[1]&&r[2]==bV[2]&&(r[3]||(r[1]==="http:"?80:443))==(bV[3]||(bV[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),bZ(bS,d,c,v);if(s===2)return!1;t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bJ.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bL.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bP,"$1_="+x);d.url=y+(y===d.url?(bL.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bW+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)v.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return!1}for(u in{success:1,error:1,complete:1})v[u](d[u]);p=bZ(bT,d,c,v);if(!p)w(-1,"No Transport");else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){if(s<2)w(-1,z);else throw z}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){e(this.name,this.value)});else for(var g in a)b_(g,a[g],c,e);return d.join("&").replace(bC,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var cc=f.now(),cd=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+cc++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=typeof b.data=="string"&&/^application\/x\-www\-form\-urlencoded/.test(b.contentType);if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(cd.test(b.url)||e&&cd.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(cd,l),b.url===j&&(e&&(k=k.replace(cd,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState))d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var ce=a.ActiveXObject?function(){for(var a in cg)cg[a](0,1)}:!1,cf=0,cg;f.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&ch()||ci()}:ch,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields)for(j in c.xhrFields)h[j]=c.xhrFields[j];c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e)h.setRequestHeader(j,e[j])}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,ce&&delete cg[i]);if(e)h.readyState!==4&&h.abort();else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n);try{m.text=h.responseText}catch(a){}try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cf,ce&&(cg||(cg={},f(a).unload(ce)),cg[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var cj={},ck,cl,cm=/^(?:toggle|show|hide)$/,cn=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,co,cp=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cq;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0)return this.animate(ct("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),(e===""&&f.css(d,"display")==="none"||!f.contains(d.ownerDocument.documentElement,d))&&f._data(d,"olddisplay",cu(d.nodeName)));for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none")d.style.display=f._data(d,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(ct("hide",3),a,b,c);var d,e,g=0,h=this.length;for(;g<h;g++)d=this[g],d.style&&(e=f.css(d,"display"),e!=="none"&&!f._data(d,"olddisplay")&&f._data(d,"olddisplay",e));for(g=0;g<h;g++)this[g].style&&(this[g].style.display="none");return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(ct("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){function g(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o,p,q;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]);if((k=f.cssHooks[g])&&"expand"in k){l=k.expand(a[g]),delete a[g];for(i in l)i in a||(a[i]=l[i])}}for(g in a){h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d)return b.complete.call(this);c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(!f.support.inlineBlockNeedsLayout||cu(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)j=new f.fx(this,b,i),h=a[i],cm.test(h)?(q=f._data(this,"toggle"+i)||(h==="toggle"?d?"show":"hide":0),q?(f._data(this,"toggle"+i,q==="show"?"hide":"show"),j[q]()):j[h]()):(m=cn.exec(h),n=j.cur(),m?(o=parseFloat(m[2]),p=m[3]||(f.cssNumber[i]?"":"px"),p!=="px"&&(f.style(this,i,(o||1)+p),n=(o||1)/j.cur()*n,f.style(this,i,n+p)),m[1]&&(o=(m[1]==="-="?-1:1)*o+n),j.custom(n,o,p)):j.custom(n,h,""));return!0}var e=f.speed(b,c,d);if(f.isEmptyObject(a))return this.each(e.complete,[!1]);a=f.extend({},a);return e.queue===!1?this.each(g):this.queue(e.queue,g)},stop:function(a,c,d){typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]);return this.each(function(){function h(a,b,c){var e=b[c];f.removeData(a,c,!0),e.stop(d)}var b,c=!1,e=f.timers,g=f._data(this);d||f._unmark(!0,this);if(a==null)for(b in g)g[b]&&g[b].stop&&b.indexOf(".run")===b.length-4&&h(this,g,b);else g[b=a+".run"]&&g[b].stop&&h(this,g,b);for(b=e.length;b--;)e[b].elem===this&&(a==null||e[b].queue===a)&&(d?e[b](!0):e[b].saveState(),c=!0,e.splice(b,1));(!d||!c)&&f.dequeue(this,a)})}}),f.each({slideDown:ct("show",1),slideUp:ct("hide",1),slideToggle:ct("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue?f.dequeue(this,d.queue):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a){return a},swing:function(a){return-Math.cos(a*Math.PI)/2+.5}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,c,d){function h(a){return e.step(a)}var e=this,g=f.fx;this.startTime=cq||cr(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(f.cssNumber[this.prop]?"":"px"),h.queue=this.options.queue,h.elem=this.elem,h.saveState=function(){f._data(e.elem,"fxshow"+e.prop)===b&&(e.options.hide?f._data(e.elem,"fxshow"+e.prop,e.start):e.options.show&&f._data(e.elem,"fxshow"+e.prop,e.end))},h()&&f.timers.push(h)&&!co&&(co=setInterval(g.tick,g.interval))},show:function(){var a=f._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||f.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f._data(this.elem,"fxshow"+this.prop)||f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cq||cr(),g=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties)i.animatedProperties[b]!==!0&&(g=!1);if(g){i.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&f(h).hide();if(i.hide||i.show)for(b in i.animatedProperties)f.style(h,b,i.orig[b]),f.removeData(h,"fxshow"+b,!0),f.removeData(h,"toggle"+b,!0);d=i.complete,d&&(i.complete=!1,d.call(h))}return!1}i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=f.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return!0}},f.extend(f.fx,{tick:function(){var a,b=f.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||f.fx.stop()},interval:13,stop:function(){clearInterval(co),co=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),f.each(cp.concat.apply([],cp),function(a,b){b.indexOf("margin")&&(f.fx.step[b]=function(a){f.style(a.elem,b,Math.max(0,a.now)+a.unit)})}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cv,cw=/^t(?:able|d|h)$/i,cx=/^(?:body|html)$/i;"getBoundingClientRect"in c.documentElement?cv=function(a,b,c,d){try{d=a.getBoundingClientRect()}catch(e){}if(!d||!f.contains(c,a))return d?{top:d.top,left:d.left}:{top:0,left:0};var g=b.body,h=cy(b),i=c.clientTop||g.clientTop||0,j=c.clientLeft||g.clientLeft||0,k=h.pageYOffset||f.support.boxModel&&c.scrollTop||g.scrollTop,l=h.pageXOffset||f.support.boxModel&&c.scrollLeft||g.scrollLeft,m=d.top+k-i,n=d.left+l-j;return{top:m,left:n}}:cv=function(a,b,c){var d,e=a.offsetParent,g=a,h=b.body,i=b.defaultView,j=i?i.getComputedStyle(a,null):a.currentStyle,k=a.offsetTop,l=a.offsetLeft;while((a=a.parentNode)&&a!==h&&a!==c){if(f.support.fixedPosition&&j.position==="fixed")break;d=i?i.getComputedStyle(a,null):a.currentStyle,k-=a.scrollTop,l-=a.scrollLeft,a===e&&(k+=a.offsetTop,l+=a.offsetLeft,f.support.doesNotAddBorder&&(!f.support.doesAddBorderForTableAndCells||!cw.test(a.nodeName))&&(k+=parseFloat(d.borderTopWidth)||0,l+=parseFloat(d.borderLeftWidth)||0),g=e,e=a.offsetParent),f.support.subtractsBorderForOverflowNotVisible&&d.overflow!=="visible"&&(k+=parseFloat(d.borderTopWidth)||0,l+=parseFloat(d.borderLeftWidth)||0),j=d}if(j.position==="relative"||j.position==="static")k+=h.offsetTop,l+=h.offsetLeft;f.support.fixedPosition&&j.position==="fixed"&&(k+=Math.max(c.scrollTop,h.scrollTop),l+=Math.max(c.scrollLeft,h.scrollLeft));return{top:k,left:l}},f.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){f.offset.setOffset(this,a,b)});var c=this[0],d=c&&c.ownerDocument;if(!d)return null;if(c===d.body)return f.offset.bodyOffset(c);return cv(c,d,d.documentElement)},f.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=cx.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!cx.test(a.nodeName)&&f.css(a,"position")==="static")a=a.offsetParent;return a})}}),f.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);f.fn[a]=function(e){return f.access(this,function(a,e,g){var h=cy(a);if(g===b)return h?c in h?h[c]:f.support.boxModel&&h.document.documentElement[e]||h.document.body[e]:a[e];h?h.scrollTo(d?f(h).scrollLeft():g,d?g:f(h).scrollTop()):a[e]=g},a,e,arguments.length,null)}}),f.each({Height:"height",Width:"width"},function(a,c){var d="client"+a,e="scroll"+a,g="offset"+a;f.fn["inner"+a]=function(){var a=this[0];return a?a.style?parseFloat(f.css(a,c,"padding")):this[c]():null},f.fn["outer"+a]=function(a){var b=this[0];return b?b.style?parseFloat(f.css(b,c,a?"margin":"border")):this[c]():null},f.fn[c]=function(a){return f.access(this,function(a,c,h){var i,j,k,l;if(f.isWindow(a)){i=a.document,j=i.documentElement[d];return f.support.boxModel&&j||i.body&&i.body[d]||j}if(a.nodeType===9){i=a.documentElement;if(i[d]>=i[e])return i[d];return Math.max(a.body[e],i[e],a.body[g],i[g])}if(h===b){k=f.css(a,c),l=parseFloat(k);return f.isNumeric(l)?l:k}f(a).css(c,h)},c,a,arguments.length,null)}}),a.jQuery=a.$=f,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return f})})(window);ï»¿/*! head.load - v1.0.3 */
(function(n,t){"use strict";function w(){}function u(n,t){if(n){typeof n=="object"&&(n=[].slice.call(n));for(var i=0,r=n.length;i<r;i++)t.call(n,n[i],i)}}function it(n,i){var r=Object.prototype.toString.call(i).slice(8,-1);return i!==t&&i!==null&&r===n}function s(n){return it("Function",n)}function a(n){return it("Array",n)}function et(n){var i=n.split("/"),t=i[i.length-1],r=t.indexOf("?");return r!==-1?t.substring(0,r):t}function f(n){(n=n||w,n._done)||(n(),n._done=1)}function ot(n,t,r,u){var f=typeof n=="object"?n:{test:n,success:!t?!1:a(t)?t:[t],failure:!r?!1:a(r)?r:[r],callback:u||w},e=!!f.test;return e&&!!f.success?(f.success.push(f.callback),i.load.apply(null,f.success)):e||!f.failure?u():(f.failure.push(f.callback),i.load.apply(null,f.failure)),i}function v(n){var t={},i,r;if(typeof n=="object")for(i in n)!n[i]||(t={name:i,url:n[i]});else t={name:et(n),url:n};return(r=c[t.name],r&&r.url===t.url)?r:(c[t.name]=t,t)}function y(n){n=n||c;for(var t in n)if(n.hasOwnProperty(t)&&n[t].state!==l)return!1;return!0}function st(n){n.state=ft;u(n.onpreload,function(n){n.call()})}function ht(n){n.state===t&&(n.state=nt,n.onpreload=[],rt({url:n.url,type:"cache"},function(){st(n)}))}function ct(){var n=arguments,t=n[n.length-1],r=[].slice.call(n,1),f=r[0];return(s(t)||(t=null),a(n[0]))?(n[0].push(t),i.load.apply(null,n[0]),i):(f?(u(r,function(n){s(n)||!n||ht(v(n))}),b(v(n[0]),s(f)?f:function(){i.load.apply(null,r)})):b(v(n[0])),i)}function lt(){var n=arguments,t=n[n.length-1],r={};return(s(t)||(t=null),a(n[0]))?(n[0].push(t),i.load.apply(null,n[0]),i):(u(n,function(n){n!==t&&(n=v(n),r[n.name]=n)}),u(n,function(n){n!==t&&(n=v(n),b(n,function(){y(r)&&f(t)}))}),i)}function b(n,t){if(t=t||w,n.state===l){t();return}if(n.state===tt){i.ready(n.name,t);return}if(n.state===nt){n.onpreload.push(function(){b(n,t)});return}n.state=tt;rt(n,function(){n.state=l;t();u(h[n.name],function(n){f(n)});o&&y()&&u(h.ALL,function(n){f(n)})})}function at(n){n=n||"";var t=n.split("?")[0].split(".");return t[t.length-1].toLowerCase()}function rt(t,i){function e(t){t=t||n.event;u.onload=u.onreadystatechange=u.onerror=null;i()}function o(f){f=f||n.event;(f.type==="load"||/loaded|complete/.test(u.readyState)&&(!r.documentMode||r.documentMode<9))&&(n.clearTimeout(t.errorTimeout),n.clearTimeout(t.cssTimeout),u.onload=u.onreadystatechange=u.onerror=null,i())}function s(){if(t.state!==l&&t.cssRetries<=20){for(var i=0,f=r.styleSheets.length;i<f;i++)if(r.styleSheets[i].href===u.href){o({type:"load"});return}t.cssRetries++;t.cssTimeout=n.setTimeout(s,250)}}var u,h,f;i=i||w;h=at(t.url);h==="css"?(u=r.createElement("link"),u.type="text/"+(t.type||"css"),u.rel="stylesheet",u.href=t.url,t.cssRetries=0,t.cssTimeout=n.setTimeout(s,500)):(u=r.createElement("script"),u.type="text/"+(t.type||"javascript"),u.src=t.url);u.onload=u.onreadystatechange=o;u.onerror=e;u.async=!1;u.defer=!1;t.errorTimeout=n.setTimeout(function(){e({type:"timeout"})},7e3);f=r.head||r.getElementsByTagName("head")[0];f.insertBefore(u,f.lastChild)}function vt(){for(var t,u=r.getElementsByTagName("script"),n=0,f=u.length;n<f;n++)if(t=u[n].getAttribute("data-headjs-load"),!!t){i.load(t);return}}function yt(n,t){var v,p,e;return n===r?(o?f(t):d.push(t),i):(s(n)&&(t=n,n="ALL"),a(n))?(v={},u(n,function(n){v[n]=c[n];i.ready(n,function(){y(v)&&f(t)})}),i):typeof n!="string"||!s(t)?i:(p=c[n],p&&p.state===l||n==="ALL"&&y()&&o)?(f(t),i):(e=h[n],e?e.push(t):e=h[n]=[t],i)}function e(){if(!r.body){n.clearTimeout(i.readyTimeout);i.readyTimeout=n.setTimeout(e,50);return}o||(o=!0,vt(),u(d,function(n){f(n)}))}function k(){r.addEventListener?(r.removeEventListener("DOMContentLoaded",k,!1),e()):r.readyState==="complete"&&(r.detachEvent("onreadystatechange",k),e())}var r=n.document,d=[],h={},c={},ut="async"in r.createElement("script")||"MozAppearance"in r.documentElement.style||n.opera,o,g=n.head_conf&&n.head_conf.head||"head",i=n[g]=n[g]||function(){i.ready.apply(null,arguments)},nt=1,ft=2,tt=3,l=4,p;if(r.readyState==="complete")e();else if(r.addEventListener)r.addEventListener("DOMContentLoaded",k,!1),n.addEventListener("load",e,!1);else{r.attachEvent("onreadystatechange",k);n.attachEvent("onload",e);p=!1;try{p=!n.frameElement&&r.documentElement}catch(wt){}p&&p.doScroll&&function pt(){if(!o){try{p.doScroll("left")}catch(t){n.clearTimeout(i.readyTimeout);i.readyTimeout=n.setTimeout(pt,50);return}e()}}()}i.load=i.js=ut?lt:ct;i.test=ot;i.ready=yt;i.ready(r,function(){y()&&u(h.ALL,function(n){f(n)});i.feature&&i.feature("domloaded",!0)})})(window);
/*
//# sourceMappingURL=head.load.min.js.map
*//* jstz.min.js Version: 1.0.6 Build date: 2015-11-04 */
!function(e){var a=function(){"use strict";var e="s",s={DAY:864e5,HOUR:36e5,MINUTE:6e4,SECOND:1e3,BASELINE_YEAR:2014,MAX_SCORE:864e6,AMBIGUITIES:{"America/Denver":["America/Mazatlan"],"Europe/London":["Africa/Casablanca"],"America/Chicago":["America/Mexico_City"],"America/Asuncion":["America/Campo_Grande","America/Santiago"],"America/Montevideo":["America/Sao_Paulo","America/Santiago"],"Asia/Beirut":["Asia/Amman","Asia/Jerusalem","Europe/Helsinki","Asia/Damascus","Africa/Cairo","Asia/Gaza","Europe/Minsk"],"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk","Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]}},i=function(e){var a=-e.getTimezoneOffset();return null!==a?a:0},r=function(){var a=i(new Date(s.BASELINE_YEAR,0,2)),r=i(new Date(s.BASELINE_YEAR,5,2)),n=a-r;return 0>n?a+",1":n>0?r+",1,"+e:a+",0"},n=function(){var e,a;if("undefined"!=typeof Intl&&"undefined"!=typeof Intl.DateTimeFormat&&(e=Intl.DateTimeFormat(),"undefined"!=typeof e&&"undefined"!=typeof e.resolvedOptions))return a=e.resolvedOptions().timeZone,a&&(a.indexOf("/")>-1||"UTC"===a)?a:void 0},o=function(e){for(var a=new Date(e,0,1,0,0,1,0).getTime(),s=new Date(e,12,31,23,59,59).getTime(),i=a,r=new Date(i).getTimezoneOffset(),n=null,o=null;s-864e5>i;){var t=new Date(i),A=t.getTimezoneOffset();A!==r&&(r>A&&(n=t),A>r&&(o=t),r=A),i+=864e5}return n&&o?{s:u(n).getTime(),e:u(o).getTime()}:!1},u=function l(e,a,i){"undefined"==typeof a&&(a=s.DAY,i=s.HOUR);for(var r=new Date(e.getTime()-a).getTime(),n=e.getTime()+a,o=new Date(r).getTimezoneOffset(),u=r,t=null;n-i>u;){var A=new Date(u),c=A.getTimezoneOffset();if(c!==o){t=A;break}u+=i}return a===s.DAY?l(t,s.HOUR,s.MINUTE):a===s.HOUR?l(t,s.MINUTE,s.SECOND):t},t=function(e,a,s,i){if("N/A"!==s)return s;if("Asia/Beirut"===a){if("Africa/Cairo"===i.name&&13983768e5===e[6].s&&14116788e5===e[6].e)return 0;if("Asia/Jerusalem"===i.name&&13959648e5===e[6].s&&14118588e5===e[6].e)return 0}else if("America/Santiago"===a){if("America/Asuncion"===i.name&&14124816e5===e[6].s&&1397358e6===e[6].e)return 0;if("America/Campo_Grande"===i.name&&14136912e5===e[6].s&&13925196e5===e[6].e)return 0}else if("America/Montevideo"===a){if("America/Sao_Paulo"===i.name&&14136876e5===e[6].s&&1392516e6===e[6].e)return 0}else if("Pacific/Auckland"===a&&"Pacific/Fiji"===i.name&&14142456e5===e[6].s&&13961016e5===e[6].e)return 0;return s},A=function(e,i){for(var r=function(a){for(var r=0,n=0;n<e.length;n++)if(a.rules[n]&&e[n]){if(!(e[n].s>=a.rules[n].s&&e[n].e<=a.rules[n].e)){r="N/A";break}if(r=0,r+=Math.abs(e[n].s-a.rules[n].s),r+=Math.abs(a.rules[n].e-e[n].e),r>s.MAX_SCORE){r="N/A";break}}return r=t(e,i,r,a)},n={},o=a.olson.dst_rules.zones,u=o.length,A=s.AMBIGUITIES[i],c=0;u>c;c++){var m=o[c],l=r(o[c]);"N/A"!==l&&(n[m.name]=l)}for(var f in n)if(n.hasOwnProperty(f))for(var d=0;d<A.length;d++)if(A[d]===f)return f;return i},c=function(e){var s=function(){for(var e=[],s=0;s<a.olson.dst_rules.years.length;s++){var i=o(a.olson.dst_rules.years[s]);e.push(i)}return e},i=function(e){for(var a=0;a<e.length;a++)if(e[a]!==!1)return!0;return!1},r=s(),n=i(r);return n?A(r,e):e},m=function(){var e=n();return e||(e=a.olson.timezones[r()],"undefined"!=typeof s.AMBIGUITIES[e]&&(e=c(e))),{name:function(){return e}}};return{determine:m}}();a.olson=a.olson||{},a.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Asuncion","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},a.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572e5,s:12090744e5},{e:1250802e6,s:1240524e6},{e:12858804e5,s:12840696e5},!1,!1,!1,{e:14116788e5,s:1406844e6}]},{name:"Africa/Casablanca",rules:[{e:12202236e5,s:12122784e5},{e:12508092e5,s:12438144e5},{e:1281222e6,s:12727584e5},{e:13120668e5,s:13017888e5},{e:13489704e5,s:1345428e6},{e:13828392e5,s:13761e8},{e:14142888e5,s:14069448e5}]},{name:"America/Asuncion",rules:[{e:12050316e5,s:12243888e5},{e:12364812e5,s:12558384e5},{e:12709548e5,s:12860784e5},{e:13024044e5,s:1317528e6},{e:1333854e6,s:13495824e5},{e:1364094e6,s:1381032e6},{e:13955436e5,s:14124816e5}]},{name:"America/Campo_Grande",rules:[{e:12032172e5,s:12243888e5},{e:12346668e5,s:12558384e5},{e:12667212e5,s:1287288e6},{e:12981708e5,s:13187376e5},{e:13302252e5,s:1350792e6},{e:136107e7,s:13822416e5},{e:13925196e5,s:14136912e5}]},{name:"America/Goose_Bay",rules:[{e:122559486e4,s:120503526e4},{e:125704446e4,s:123648486e4},{e:128909886e4,s:126853926e4},{e:13205556e5,s:129998886e4},{e:13520052e5,s:13314456e5},{e:13834548e5,s:13628952e5},{e:14149044e5,s:13943448e5}]},{name:"America/Havana",rules:[{e:12249972e5,s:12056436e5},{e:12564468e5,s:12364884e5},{e:12885012e5,s:12685428e5},{e:13211604e5,s:13005972e5},{e:13520052e5,s:13332564e5},{e:13834548e5,s:13628916e5},{e:14149044e5,s:13943412e5}]},{name:"America/Mazatlan",rules:[{e:1225008e6,s:12074724e5},{e:12564576e5,s:1238922e6},{e:1288512e6,s:12703716e5},{e:13199616e5,s:13018212e5},{e:13514112e5,s:13332708e5},{e:13828608e5,s:13653252e5},{e:14143104e5,s:13967748e5}]},{name:"America/Mexico_City",rules:[{e:12250044e5,s:12074688e5},{e:1256454e6,s:12389184e5},{e:12885084e5,s:1270368e6},{e:1319958e6,s:13018176e5},{e:13514076e5,s:13332672e5},{e:13828572e5,s:13653216e5},{e:14143068e5,s:13967712e5}]},{name:"America/Miquelon",rules:[{e:12255984e5,s:12050388e5},{e:1257048e6,s:12364884e5},{e:12891024e5,s:12685428e5},{e:1320552e6,s:12999924e5},{e:13520016e5,s:1331442e6},{e:13834512e5,s:13628916e5},{e:14149008e5,s:13943412e5}]},{name:"America/Santa_Isabel",rules:[{e:12250116e5,s:1207476e6},{e:12564612e5,s:12389256e5},{e:12885156e5,s:12703752e5},{e:13199652e5,s:13018248e5},{e:13514148e5,s:13332744e5},{e:13828644e5,s:13653288e5},{e:1414314e6,s:13967784e5}]},{name:"America/Santiago",rules:[{e:1206846e6,s:1223784e6},{e:1237086e6,s:12552336e5},{e:127035e7,s:12866832e5},{e:13048236e5,s:13138992e5},{e:13356684e5,s:13465584e5},{e:1367118e6,s:13786128e5},{e:13985676e5,s:14100624e5}]},{name:"America/Sao_Paulo",rules:[{e:12032136e5,s:12243852e5},{e:12346632e5,s:12558348e5},{e:12667176e5,s:12872844e5},{e:12981672e5,s:1318734e6},{e:13302216e5,s:13507884e5},{e:13610664e5,s:1382238e6},{e:1392516e6,s:14136876e5}]},{name:"Asia/Amman",rules:[{e:1225404e6,s:12066552e5},{e:12568536e5,s:12381048e5},{e:12883032e5,s:12695544e5},{e:13197528e5,s:13016088e5},!1,!1,{e:14147064e5,s:13959576e5}]},{name:"Asia/Damascus",rules:[{e:12254868e5,s:120726e7},{e:125685e7,s:12381048e5},{e:12882996e5,s:12701592e5},{e:13197492e5,s:13016088e5},{e:13511988e5,s:13330584e5},{e:13826484e5,s:1364508e6},{e:14147028e5,s:13959576e5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572e5,s:12066552e5},{e:12520152e5,s:12381048e5},{e:1281474e6,s:126964086e4},{e:1312146e6,s:130160886e4},{e:13481784e5,s:13330584e5},{e:13802292e5,s:1364508e6},{e:1414098e6,s:13959576e5}]},{name:"Asia/Irkutsk",rules:[{e:12249576e5,s:12068136e5},{e:12564072e5,s:12382632e5},{e:12884616e5,s:12697128e5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612e5,s:12066624e5},{e:1254006e6,s:1238112e6},{e:1284246e6,s:12695616e5},{e:131751e7,s:1301616e6},{e:13483548e5,s:13330656e5},{e:13828284e5,s:13645152e5},{e:1414278e6,s:13959648e5}]},{name:"Asia/Kamchatka",rules:[{e:12249432e5,s:12067992e5},{e:12563928e5,s:12382488e5},{e:12884508e5,s:12696984e5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612e5,s:12068172e5},{e:12564108e5,s:12382668e5},{e:12884652e5,s:12697164e5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648e5,s:12068208e5},{e:12564144e5,s:12382704e5},{e:12884688e5,s:126972e7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504e5,s:12068064e5},{e:12564e8,s:1238256e6},{e:12884544e5,s:12697056e5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954e6,s:120681e7},{e:12564036e5,s:12382596e5},{e:1288458e6,s:12697092e5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684e5,s:12068244e5},{e:1256418e6,s:1238274e6},{e:12884724e5,s:12697236e5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972e6,s:1206828e6},{e:12564216e5,s:12382776e5},{e:1288476e6,s:12697272e5},{e:13199256e5,s:13011768e5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076e5,s:12231342e5},{e:12388572e5,s:12545838e5},{e:12703068e5,s:12860334e5},{e:13017564e5,s:1317483e6},{e:1333206e6,s:13495374e5},{e:13652604e5,s:1380987e6},{e:139671e7,s:14124366e5}]},{name:"Australia/Perth",rules:[{e:12068136e5,s:12249576e5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]},{name:"Europe/Minsk",rules:[{e:12249792e5,s:12068352e5},{e:12564288e5,s:12382848e5},{e:12884832e5,s:12697344e5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756e5,s:12068316e5},{e:12564252e5,s:12382812e5},{e:12884796e5,s:12697308e5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528e5,s:13168728e5},{e:13332024e5,s:13489272e5},{e:13652568e5,s:13803768e5},{e:13967064e5,s:14118264e5}]},{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984e5,s:12878424e5},{e:13271544e5,s:1319292e6},{e:1358604e6,s:13507416e5},{e:139005e7,s:1382796e6},{e:14215032e5,s:14148504e5}]},{name:"Europe/London",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]}]},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=a:"undefined"!=typeof define&&null!==define&&null!=define.amd?define([],function(){return a}):"undefined"==typeof e?window.jstz=a:e.jstz=a}();/*!
@fileoverview gl-matrix - High performance matrix and vector operations
@author Brandon Jones
@author Colin MacKenzie IV
@version 3.0.0

Copyright (c) 2015-2019, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).glMatrix={})}(this,function(t){"use strict";var n=1e-6,a="undefined"!=typeof Float32Array?Float32Array:Array,r=Math.random;var u=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)});var e=Object.freeze({EPSILON:n,get ARRAY_TYPE(){return a},RANDOM:r,setMatrixArrayType:function(t){a=t},toRadian:function(t){return t*u},equals:function(t,a){return Math.abs(t-a)<=n*Math.max(1,Math.abs(t),Math.abs(a))}});function o(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1],h=a[2],s=a[3];return t[0]=r*i+e*c,t[1]=u*i+o*c,t[2]=r*h+e*s,t[3]=u*h+o*s,t}function i(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t}var c=o,h=i,s=Object.freeze({create:function(){var t=new a(4);return a!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},clone:function(t){var n=new a(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},fromValues:function(t,n,r,u){var e=new a(4);return e[0]=t,e[1]=n,e[2]=r,e[3]=u,e},set:function(t,n,a,r,u){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t},transpose:function(t,n){if(t===n){var a=n[1];t[1]=n[2],t[2]=a}else t[0]=n[0],t[1]=n[2],t[2]=n[1],t[3]=n[3];return t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a*e-u*r;return o?(o=1/o,t[0]=e*o,t[1]=-r*o,t[2]=-u*o,t[3]=a*o,t):null},adjoint:function(t,n){var a=n[0];return t[0]=n[3],t[1]=-n[1],t[2]=-n[2],t[3]=a,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},multiply:o,rotate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c+e*i,t[1]=u*c+o*i,t[2]=r*-i+e*c,t[3]=u*-i+o*c,t},scale:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1];return t[0]=r*i,t[1]=u*i,t[2]=e*c,t[3]=o*c,t},fromRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=-a,t[3]=r,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t},str:function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3])},LDU:function(t,n,a,r){return t[2]=r[2]/r[0],a[0]=r[0],a[1]=r[1],a[3]=r[3]-t[2]*a[1],[t,n,a]},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t},subtract:i,exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=a[0],c=a[1],h=a[2],s=a[3];return Math.abs(r-i)<=n*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(u-c)<=n*Math.max(1,Math.abs(u),Math.abs(c))&&Math.abs(e-h)<=n*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(o-s)<=n*Math.max(1,Math.abs(o),Math.abs(s))},multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t},mul:c,sub:h});function M(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=a[0],s=a[1],M=a[2],f=a[3],l=a[4],v=a[5];return t[0]=r*h+e*s,t[1]=u*h+o*s,t[2]=r*M+e*f,t[3]=u*M+o*f,t[4]=r*l+e*v+i,t[5]=u*l+o*v+c,t}function f(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t}var l=M,v=f,b=Object.freeze({create:function(){var t=new a(6);return a!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},clone:function(t){var n=new a(6);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},fromValues:function(t,n,r,u,e,o){var i=new a(6);return i[0]=t,i[1]=n,i[2]=r,i[3]=u,i[4]=e,i[5]=o,i},set:function(t,n,a,r,u,e,o){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=a*e-r*u;return c?(c=1/c,t[0]=e*c,t[1]=-r*c,t[2]=-u*c,t[3]=a*c,t[4]=(u*i-e*o)*c,t[5]=(r*o-a*i)*c,t):null},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:M,rotate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=Math.sin(a),s=Math.cos(a);return t[0]=r*s+e*h,t[1]=u*s+o*h,t[2]=r*-h+e*s,t[3]=u*-h+o*s,t[4]=i,t[5]=c,t},scale:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=a[0],s=a[1];return t[0]=r*h,t[1]=u*h,t[2]=e*s,t[3]=o*s,t[4]=i,t[5]=c,t},translate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=a[0],s=a[1];return t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=r*h+e*s+i,t[5]=u*h+o*s+c,t},fromRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=-a,t[3]=r,t[4]=0,t[5]=0,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t[4]=0,t[5]=0,t},fromTranslation:function(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=n[0],t[5]=n[1],t},str:function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t},subtract:f,multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=a[0],s=a[1],M=a[2],f=a[3],l=a[4],v=a[5];return Math.abs(r-h)<=n*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(u-s)<=n*Math.max(1,Math.abs(u),Math.abs(s))&&Math.abs(e-M)<=n*Math.max(1,Math.abs(e),Math.abs(M))&&Math.abs(o-f)<=n*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(i-l)<=n*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(c-v)<=n*Math.max(1,Math.abs(c),Math.abs(v))},mul:l,sub:v});function m(){var t=new a(9);return a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function d(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=a[0],l=a[1],v=a[2],b=a[3],m=a[4],d=a[5],x=a[6],p=a[7],y=a[8];return t[0]=f*r+l*o+v*h,t[1]=f*u+l*i+v*s,t[2]=f*e+l*c+v*M,t[3]=b*r+m*o+d*h,t[4]=b*u+m*i+d*s,t[5]=b*e+m*c+d*M,t[6]=x*r+p*o+y*h,t[7]=x*u+p*i+y*s,t[8]=x*e+p*c+y*M,t}function x(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t[6]=n[6]-a[6],t[7]=n[7]-a[7],t[8]=n[8]-a[8],t}var p=d,y=x,q=Object.freeze({create:m,fromMat4:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t},clone:function(t){var n=new a(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},fromValues:function(t,n,r,u,e,o,i,c,h){var s=new a(9);return s[0]=t,s[1]=n,s[2]=r,s[3]=u,s[4]=e,s[5]=o,s[6]=i,s[7]=c,s[8]=h,s},set:function(t,n,a,r,u,e,o,i,c,h){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t[6]=i,t[7]=c,t[8]=h,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,n){if(t===n){var a=n[1],r=n[2],u=n[5];t[1]=n[3],t[2]=n[6],t[3]=a,t[5]=n[7],t[6]=r,t[7]=u}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=s*o-i*h,f=-s*e+i*c,l=h*e-o*c,v=a*M+r*f+u*l;return v?(v=1/v,t[0]=M*v,t[1]=(-s*r+u*h)*v,t[2]=(i*r-u*o)*v,t[3]=f*v,t[4]=(s*a-u*c)*v,t[5]=(-i*a+u*e)*v,t[6]=l*v,t[7]=(-h*a+r*c)*v,t[8]=(o*a-r*e)*v,t):null},adjoint:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8];return t[0]=o*s-i*h,t[1]=u*h-r*s,t[2]=r*i-u*o,t[3]=i*c-e*s,t[4]=a*s-u*c,t[5]=u*e-a*i,t[6]=e*h-o*c,t[7]=r*c-a*h,t[8]=a*o-r*e,t},determinant:function(t){var n=t[0],a=t[1],r=t[2],u=t[3],e=t[4],o=t[5],i=t[6],c=t[7],h=t[8];return n*(h*e-o*c)+a*(-h*u+o*i)+r*(c*u-e*i)},multiply:d,translate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=a[0],l=a[1];return t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=i,t[5]=c,t[6]=f*r+l*o+h,t[7]=f*u+l*i+s,t[8]=f*e+l*c+M,t},rotate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=Math.sin(a),l=Math.cos(a);return t[0]=l*r+f*o,t[1]=l*u+f*i,t[2]=l*e+f*c,t[3]=l*o-f*r,t[4]=l*i-f*u,t[5]=l*c-f*e,t[6]=h,t[7]=s,t[8]=M,t},scale:function(t,n,a){var r=a[0],u=a[1];return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=u*n[3],t[4]=u*n[4],t[5]=u*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},fromTranslation:function(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=n[0],t[7]=n[1],t[8]=1,t},fromRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=0,t[3]=-a,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=n[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat2d:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t},fromQuat:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a+a,i=r+r,c=u+u,h=a*o,s=r*o,M=r*i,f=u*o,l=u*i,v=u*c,b=e*o,m=e*i,d=e*c;return t[0]=1-M-v,t[3]=s-d,t[6]=f+m,t[1]=s+d,t[4]=1-h-v,t[7]=l-b,t[2]=f-m,t[5]=l+b,t[8]=1-h-M,t},normalFromMat4:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=n[9],f=n[10],l=n[11],v=n[12],b=n[13],m=n[14],d=n[15],x=a*i-r*o,p=a*c-u*o,y=a*h-e*o,q=r*c-u*i,g=r*h-e*i,A=u*h-e*c,w=s*b-M*v,R=s*m-f*v,z=s*d-l*v,P=M*m-f*b,j=M*d-l*b,I=f*d-l*m,S=x*I-p*j+y*P+q*z-g*R+A*w;return S?(S=1/S,t[0]=(i*I-c*j+h*P)*S,t[1]=(c*z-o*I-h*R)*S,t[2]=(o*j-i*z+h*w)*S,t[3]=(u*j-r*I-e*P)*S,t[4]=(a*I-u*z+e*R)*S,t[5]=(r*z-a*j-e*w)*S,t[6]=(b*A-m*g+d*q)*S,t[7]=(m*y-v*A-d*p)*S,t[8]=(v*g-b*y+d*x)*S,t):null},projection:function(t,n,a){return t[0]=2/n,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/a,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},str:function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t[6]=n[6]+a[6],t[7]=n[7]+a[7],t[8]=n[8]+a[8],t},subtract:x,multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t[6]=n[6]+a[6]*r,t[7]=n[7]+a[7]*r,t[8]=n[8]+a[8]*r,t},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=t[6],s=t[7],M=t[8],f=a[0],l=a[1],v=a[2],b=a[3],m=a[4],d=a[5],x=a[6],p=a[7],y=a[8];return Math.abs(r-f)<=n*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(u-l)<=n*Math.max(1,Math.abs(u),Math.abs(l))&&Math.abs(e-v)<=n*Math.max(1,Math.abs(e),Math.abs(v))&&Math.abs(o-b)<=n*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(i-m)<=n*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(c-d)<=n*Math.max(1,Math.abs(c),Math.abs(d))&&Math.abs(h-x)<=n*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(s-p)<=n*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(M-y)<=n*Math.max(1,Math.abs(M),Math.abs(y))},mul:p,sub:y});function g(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function A(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=n[9],l=n[10],v=n[11],b=n[12],m=n[13],d=n[14],x=n[15],p=a[0],y=a[1],q=a[2],g=a[3];return t[0]=p*r+y*i+q*M+g*b,t[1]=p*u+y*c+q*f+g*m,t[2]=p*e+y*h+q*l+g*d,t[3]=p*o+y*s+q*v+g*x,p=a[4],y=a[5],q=a[6],g=a[7],t[4]=p*r+y*i+q*M+g*b,t[5]=p*u+y*c+q*f+g*m,t[6]=p*e+y*h+q*l+g*d,t[7]=p*o+y*s+q*v+g*x,p=a[8],y=a[9],q=a[10],g=a[11],t[8]=p*r+y*i+q*M+g*b,t[9]=p*u+y*c+q*f+g*m,t[10]=p*e+y*h+q*l+g*d,t[11]=p*o+y*s+q*v+g*x,p=a[12],y=a[13],q=a[14],g=a[15],t[12]=p*r+y*i+q*M+g*b,t[13]=p*u+y*c+q*f+g*m,t[14]=p*e+y*h+q*l+g*d,t[15]=p*o+y*s+q*v+g*x,t}function w(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=r+r,c=u+u,h=e+e,s=r*i,M=r*c,f=r*h,l=u*c,v=u*h,b=e*h,m=o*i,d=o*c,x=o*h;return t[0]=1-(l+b),t[1]=M+x,t[2]=f-d,t[3]=0,t[4]=M-x,t[5]=1-(s+b),t[6]=v+m,t[7]=0,t[8]=f+d,t[9]=v-m,t[10]=1-(s+l),t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t}function R(t,n){return t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function z(t,n){var a=n[0],r=n[1],u=n[2],e=n[4],o=n[5],i=n[6],c=n[8],h=n[9],s=n[10];return t[0]=Math.hypot(a,r,u),t[1]=Math.hypot(e,o,i),t[2]=Math.hypot(c,h,s),t}function P(t,n){var r=new a(3);z(r,n);var u=1/r[0],e=1/r[1],o=1/r[2],i=n[0]*u,c=n[1]*e,h=n[2]*o,s=n[4]*u,M=n[5]*e,f=n[6]*o,l=n[8]*u,v=n[9]*e,b=n[10]*o,m=i+M+b,d=0;return m>0?(d=2*Math.sqrt(m+1),t[3]=.25*d,t[0]=(f-v)/d,t[1]=(l-h)/d,t[2]=(c-s)/d):i>M&&i>b?(d=2*Math.sqrt(1+i-M-b),t[3]=(f-v)/d,t[0]=.25*d,t[1]=(c+s)/d,t[2]=(l+h)/d):M>b?(d=2*Math.sqrt(1+M-i-b),t[3]=(l-h)/d,t[0]=(c+s)/d,t[1]=.25*d,t[2]=(f+v)/d):(d=2*Math.sqrt(1+b-i-M),t[3]=(c-s)/d,t[0]=(l+h)/d,t[1]=(f+v)/d,t[2]=.25*d),t}function j(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t[6]=n[6]-a[6],t[7]=n[7]-a[7],t[8]=n[8]-a[8],t[9]=n[9]-a[9],t[10]=n[10]-a[10],t[11]=n[11]-a[11],t[12]=n[12]-a[12],t[13]=n[13]-a[13],t[14]=n[14]-a[14],t[15]=n[15]-a[15],t}var I=A,S=j,E=Object.freeze({create:function(){var t=new a(16);return a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},clone:function(t){var n=new a(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},fromValues:function(t,n,r,u,e,o,i,c,h,s,M,f,l,v,b,m){var d=new a(16);return d[0]=t,d[1]=n,d[2]=r,d[3]=u,d[4]=e,d[5]=o,d[6]=i,d[7]=c,d[8]=h,d[9]=s,d[10]=M,d[11]=f,d[12]=l,d[13]=v,d[14]=b,d[15]=m,d},set:function(t,n,a,r,u,e,o,i,c,h,s,M,f,l,v,b,m){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t[6]=i,t[7]=c,t[8]=h,t[9]=s,t[10]=M,t[11]=f,t[12]=l,t[13]=v,t[14]=b,t[15]=m,t},identity:g,transpose:function(t,n){if(t===n){var a=n[1],r=n[2],u=n[3],e=n[6],o=n[7],i=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=a,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=e,t[11]=n[14],t[12]=u,t[13]=o,t[14]=i}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=n[9],f=n[10],l=n[11],v=n[12],b=n[13],m=n[14],d=n[15],x=a*i-r*o,p=a*c-u*o,y=a*h-e*o,q=r*c-u*i,g=r*h-e*i,A=u*h-e*c,w=s*b-M*v,R=s*m-f*v,z=s*d-l*v,P=M*m-f*b,j=M*d-l*b,I=f*d-l*m,S=x*I-p*j+y*P+q*z-g*R+A*w;return S?(S=1/S,t[0]=(i*I-c*j+h*P)*S,t[1]=(u*j-r*I-e*P)*S,t[2]=(b*A-m*g+d*q)*S,t[3]=(f*g-M*A-l*q)*S,t[4]=(c*z-o*I-h*R)*S,t[5]=(a*I-u*z+e*R)*S,t[6]=(m*y-v*A-d*p)*S,t[7]=(s*A-f*y+l*p)*S,t[8]=(o*j-i*z+h*w)*S,t[9]=(r*z-a*j-e*w)*S,t[10]=(v*g-b*y+d*x)*S,t[11]=(M*y-s*g-l*x)*S,t[12]=(i*R-o*P-c*w)*S,t[13]=(a*P-r*R+u*w)*S,t[14]=(b*p-v*q-m*x)*S,t[15]=(s*q-M*p+f*x)*S,t):null},adjoint:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=n[9],f=n[10],l=n[11],v=n[12],b=n[13],m=n[14],d=n[15];return t[0]=i*(f*d-l*m)-M*(c*d-h*m)+b*(c*l-h*f),t[1]=-(r*(f*d-l*m)-M*(u*d-e*m)+b*(u*l-e*f)),t[2]=r*(c*d-h*m)-i*(u*d-e*m)+b*(u*h-e*c),t[3]=-(r*(c*l-h*f)-i*(u*l-e*f)+M*(u*h-e*c)),t[4]=-(o*(f*d-l*m)-s*(c*d-h*m)+v*(c*l-h*f)),t[5]=a*(f*d-l*m)-s*(u*d-e*m)+v*(u*l-e*f),t[6]=-(a*(c*d-h*m)-o*(u*d-e*m)+v*(u*h-e*c)),t[7]=a*(c*l-h*f)-o*(u*l-e*f)+s*(u*h-e*c),t[8]=o*(M*d-l*b)-s*(i*d-h*b)+v*(i*l-h*M),t[9]=-(a*(M*d-l*b)-s*(r*d-e*b)+v*(r*l-e*M)),t[10]=a*(i*d-h*b)-o*(r*d-e*b)+v*(r*h-e*i),t[11]=-(a*(i*l-h*M)-o*(r*l-e*M)+s*(r*h-e*i)),t[12]=-(o*(M*m-f*b)-s*(i*m-c*b)+v*(i*f-c*M)),t[13]=a*(M*m-f*b)-s*(r*m-u*b)+v*(r*f-u*M),t[14]=-(a*(i*m-c*b)-o*(r*m-u*b)+v*(r*c-u*i)),t[15]=a*(i*f-c*M)-o*(r*f-u*M)+s*(r*c-u*i),t},determinant:function(t){var n=t[0],a=t[1],r=t[2],u=t[3],e=t[4],o=t[5],i=t[6],c=t[7],h=t[8],s=t[9],M=t[10],f=t[11],l=t[12],v=t[13],b=t[14],m=t[15];return(n*o-a*e)*(M*m-f*b)-(n*i-r*e)*(s*m-f*v)+(n*c-u*e)*(s*b-M*v)+(a*i-r*o)*(h*m-f*l)-(a*c-u*o)*(h*b-M*l)+(r*c-u*i)*(h*v-s*l)},multiply:A,translate:function(t,n,a){var r,u,e,o,i,c,h,s,M,f,l,v,b=a[0],m=a[1],d=a[2];return n===t?(t[12]=n[0]*b+n[4]*m+n[8]*d+n[12],t[13]=n[1]*b+n[5]*m+n[9]*d+n[13],t[14]=n[2]*b+n[6]*m+n[10]*d+n[14],t[15]=n[3]*b+n[7]*m+n[11]*d+n[15]):(r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=n[9],l=n[10],v=n[11],t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=i,t[5]=c,t[6]=h,t[7]=s,t[8]=M,t[9]=f,t[10]=l,t[11]=v,t[12]=r*b+i*m+M*d+n[12],t[13]=u*b+c*m+f*d+n[13],t[14]=e*b+h*m+l*d+n[14],t[15]=o*b+s*m+v*d+n[15]),t},scale:function(t,n,a){var r=a[0],u=a[1],e=a[2];return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t[4]=n[4]*u,t[5]=n[5]*u,t[6]=n[6]*u,t[7]=n[7]*u,t[8]=n[8]*e,t[9]=n[9]*e,t[10]=n[10]*e,t[11]=n[11]*e,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},rotate:function(t,a,r,u){var e,o,i,c,h,s,M,f,l,v,b,m,d,x,p,y,q,g,A,w,R,z,P,j,I=u[0],S=u[1],E=u[2],O=Math.hypot(I,S,E);return O<n?null:(I*=O=1/O,S*=O,E*=O,e=Math.sin(r),i=1-(o=Math.cos(r)),c=a[0],h=a[1],s=a[2],M=a[3],f=a[4],l=a[5],v=a[6],b=a[7],m=a[8],d=a[9],x=a[10],p=a[11],y=I*I*i+o,q=S*I*i+E*e,g=E*I*i-S*e,A=I*S*i-E*e,w=S*S*i+o,R=E*S*i+I*e,z=I*E*i+S*e,P=S*E*i-I*e,j=E*E*i+o,t[0]=c*y+f*q+m*g,t[1]=h*y+l*q+d*g,t[2]=s*y+v*q+x*g,t[3]=M*y+b*q+p*g,t[4]=c*A+f*w+m*R,t[5]=h*A+l*w+d*R,t[6]=s*A+v*w+x*R,t[7]=M*A+b*w+p*R,t[8]=c*z+f*P+m*j,t[9]=h*z+l*P+d*j,t[10]=s*z+v*P+x*j,t[11]=M*z+b*P+p*j,a!==t&&(t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t)},rotateX:function(t,n,a){var r=Math.sin(a),u=Math.cos(a),e=n[4],o=n[5],i=n[6],c=n[7],h=n[8],s=n[9],M=n[10],f=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=e*u+h*r,t[5]=o*u+s*r,t[6]=i*u+M*r,t[7]=c*u+f*r,t[8]=h*u-e*r,t[9]=s*u-o*r,t[10]=M*u-i*r,t[11]=f*u-c*r,t},rotateY:function(t,n,a){var r=Math.sin(a),u=Math.cos(a),e=n[0],o=n[1],i=n[2],c=n[3],h=n[8],s=n[9],M=n[10],f=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=e*u-h*r,t[1]=o*u-s*r,t[2]=i*u-M*r,t[3]=c*u-f*r,t[8]=e*r+h*u,t[9]=o*r+s*u,t[10]=i*r+M*u,t[11]=c*r+f*u,t},rotateZ:function(t,n,a){var r=Math.sin(a),u=Math.cos(a),e=n[0],o=n[1],i=n[2],c=n[3],h=n[4],s=n[5],M=n[6],f=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=e*u+h*r,t[1]=o*u+s*r,t[2]=i*u+M*r,t[3]=c*u+f*r,t[4]=h*u-e*r,t[5]=s*u-o*r,t[6]=M*u-i*r,t[7]=f*u-c*r,t},fromTranslation:function(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotation:function(t,a,r){var u,e,o,i=r[0],c=r[1],h=r[2],s=Math.hypot(i,c,h);return s<n?null:(i*=s=1/s,c*=s,h*=s,u=Math.sin(a),o=1-(e=Math.cos(a)),t[0]=i*i*o+e,t[1]=c*i*o+h*u,t[2]=h*i*o-c*u,t[3]=0,t[4]=i*c*o-h*u,t[5]=c*c*o+e,t[6]=h*c*o+i*u,t[7]=0,t[8]=i*h*o+c*u,t[9]=c*h*o-i*u,t[10]=h*h*o+e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},fromXRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=a,t[7]=0,t[8]=0,t[9]=-a,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromYRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=0,t[2]=-a,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=a,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromZRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=0,t[3]=0,t[4]=-a,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotationTranslation:w,fromQuat2:function(t,n){var r=new a(3),u=-n[0],e=-n[1],o=-n[2],i=n[3],c=n[4],h=n[5],s=n[6],M=n[7],f=u*u+e*e+o*o+i*i;return f>0?(r[0]=2*(c*i+M*u+h*o-s*e)/f,r[1]=2*(h*i+M*e+s*u-c*o)/f,r[2]=2*(s*i+M*o+c*e-h*u)/f):(r[0]=2*(c*i+M*u+h*o-s*e),r[1]=2*(h*i+M*e+s*u-c*o),r[2]=2*(s*i+M*o+c*e-h*u)),w(t,n,r),t},getTranslation:R,getScaling:z,getRotation:P,fromRotationTranslationScale:function(t,n,a,r){var u=n[0],e=n[1],o=n[2],i=n[3],c=u+u,h=e+e,s=o+o,M=u*c,f=u*h,l=u*s,v=e*h,b=e*s,m=o*s,d=i*c,x=i*h,p=i*s,y=r[0],q=r[1],g=r[2];return t[0]=(1-(v+m))*y,t[1]=(f+p)*y,t[2]=(l-x)*y,t[3]=0,t[4]=(f-p)*q,t[5]=(1-(M+m))*q,t[6]=(b+d)*q,t[7]=0,t[8]=(l+x)*g,t[9]=(b-d)*g,t[10]=(1-(M+v))*g,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t},fromRotationTranslationScaleOrigin:function(t,n,a,r,u){var e=n[0],o=n[1],i=n[2],c=n[3],h=e+e,s=o+o,M=i+i,f=e*h,l=e*s,v=e*M,b=o*s,m=o*M,d=i*M,x=c*h,p=c*s,y=c*M,q=r[0],g=r[1],A=r[2],w=u[0],R=u[1],z=u[2],P=(1-(b+d))*q,j=(l+y)*q,I=(v-p)*q,S=(l-y)*g,E=(1-(f+d))*g,O=(m+x)*g,T=(v+p)*A,D=(m-x)*A,F=(1-(f+b))*A;return t[0]=P,t[1]=j,t[2]=I,t[3]=0,t[4]=S,t[5]=E,t[6]=O,t[7]=0,t[8]=T,t[9]=D,t[10]=F,t[11]=0,t[12]=a[0]+w-(P*w+S*R+T*z),t[13]=a[1]+R-(j*w+E*R+D*z),t[14]=a[2]+z-(I*w+O*R+F*z),t[15]=1,t},fromQuat:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a+a,i=r+r,c=u+u,h=a*o,s=r*o,M=r*i,f=u*o,l=u*i,v=u*c,b=e*o,m=e*i,d=e*c;return t[0]=1-M-v,t[1]=s+d,t[2]=f-m,t[3]=0,t[4]=s-d,t[5]=1-h-v,t[6]=l+b,t[7]=0,t[8]=f+m,t[9]=l-b,t[10]=1-h-M,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},frustum:function(t,n,a,r,u,e,o){var i=1/(a-n),c=1/(u-r),h=1/(e-o);return t[0]=2*e*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*e*c,t[6]=0,t[7]=0,t[8]=(a+n)*i,t[9]=(u+r)*c,t[10]=(o+e)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*e*2*h,t[15]=0,t},perspective:function(t,n,a,r,u){var e,o=1/Math.tan(n/2);return t[0]=o/a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=u&&u!==1/0?(e=1/(r-u),t[10]=(u+r)*e,t[14]=2*u*r*e):(t[10]=-1,t[14]=-2*r),t},perspectiveFromFieldOfView:function(t,n,a,r){var u=Math.tan(n.upDegrees*Math.PI/180),e=Math.tan(n.downDegrees*Math.PI/180),o=Math.tan(n.leftDegrees*Math.PI/180),i=Math.tan(n.rightDegrees*Math.PI/180),c=2/(o+i),h=2/(u+e);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(o-i)*c*.5,t[9]=(u-e)*h*.5,t[10]=r/(a-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*a/(a-r),t[15]=0,t},ortho:function(t,n,a,r,u,e,o){var i=1/(n-a),c=1/(r-u),h=1/(e-o);return t[0]=-2*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(n+a)*i,t[13]=(u+r)*c,t[14]=(o+e)*h,t[15]=1,t},lookAt:function(t,a,r,u){var e,o,i,c,h,s,M,f,l,v,b=a[0],m=a[1],d=a[2],x=u[0],p=u[1],y=u[2],q=r[0],A=r[1],w=r[2];return Math.abs(b-q)<n&&Math.abs(m-A)<n&&Math.abs(d-w)<n?g(t):(M=b-q,f=m-A,l=d-w,e=p*(l*=v=1/Math.hypot(M,f,l))-y*(f*=v),o=y*(M*=v)-x*l,i=x*f-p*M,(v=Math.hypot(e,o,i))?(e*=v=1/v,o*=v,i*=v):(e=0,o=0,i=0),c=f*i-l*o,h=l*e-M*i,s=M*o-f*e,(v=Math.hypot(c,h,s))?(c*=v=1/v,h*=v,s*=v):(c=0,h=0,s=0),t[0]=e,t[1]=c,t[2]=M,t[3]=0,t[4]=o,t[5]=h,t[6]=f,t[7]=0,t[8]=i,t[9]=s,t[10]=l,t[11]=0,t[12]=-(e*b+o*m+i*d),t[13]=-(c*b+h*m+s*d),t[14]=-(M*b+f*m+l*d),t[15]=1,t)},targetTo:function(t,n,a,r){var u=n[0],e=n[1],o=n[2],i=r[0],c=r[1],h=r[2],s=u-a[0],M=e-a[1],f=o-a[2],l=s*s+M*M+f*f;l>0&&(s*=l=1/Math.sqrt(l),M*=l,f*=l);var v=c*f-h*M,b=h*s-i*f,m=i*M-c*s;return(l=v*v+b*b+m*m)>0&&(v*=l=1/Math.sqrt(l),b*=l,m*=l),t[0]=v,t[1]=b,t[2]=m,t[3]=0,t[4]=M*m-f*b,t[5]=f*v-s*m,t[6]=s*b-M*v,t[7]=0,t[8]=s,t[9]=M,t[10]=f,t[11]=0,t[12]=u,t[13]=e,t[14]=o,t[15]=1,t},str:function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t[6]=n[6]+a[6],t[7]=n[7]+a[7],t[8]=n[8]+a[8],t[9]=n[9]+a[9],t[10]=n[10]+a[10],t[11]=n[11]+a[11],t[12]=n[12]+a[12],t[13]=n[13]+a[13],t[14]=n[14]+a[14],t[15]=n[15]+a[15],t},subtract:j,multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=n[11]*a,t[12]=n[12]*a,t[13]=n[13]*a,t[14]=n[14]*a,t[15]=n[15]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t[6]=n[6]+a[6]*r,t[7]=n[7]+a[7]*r,t[8]=n[8]+a[8]*r,t[9]=n[9]+a[9]*r,t[10]=n[10]+a[10]*r,t[11]=n[11]+a[11]*r,t[12]=n[12]+a[12]*r,t[13]=n[13]+a[13]*r,t[14]=n[14]+a[14]*r,t[15]=n[15]+a[15]*r,t},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[11]===n[11]&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[15]===n[15]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=t[6],s=t[7],M=t[8],f=t[9],l=t[10],v=t[11],b=t[12],m=t[13],d=t[14],x=t[15],p=a[0],y=a[1],q=a[2],g=a[3],A=a[4],w=a[5],R=a[6],z=a[7],P=a[8],j=a[9],I=a[10],S=a[11],E=a[12],O=a[13],T=a[14],D=a[15];return Math.abs(r-p)<=n*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(u-y)<=n*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(e-q)<=n*Math.max(1,Math.abs(e),Math.abs(q))&&Math.abs(o-g)<=n*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(i-A)<=n*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(c-w)<=n*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(h-R)<=n*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(s-z)<=n*Math.max(1,Math.abs(s),Math.abs(z))&&Math.abs(M-P)<=n*Math.max(1,Math.abs(M),Math.abs(P))&&Math.abs(f-j)<=n*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(l-I)<=n*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(v-S)<=n*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(b-E)<=n*Math.max(1,Math.abs(b),Math.abs(E))&&Math.abs(m-O)<=n*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(d-T)<=n*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(x-D)<=n*Math.max(1,Math.abs(x),Math.abs(D))},mul:I,sub:S});function O(){var t=new a(3);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function T(t){var n=t[0],a=t[1],r=t[2];return Math.hypot(n,a,r)}function D(t,n,r){var u=new a(3);return u[0]=t,u[1]=n,u[2]=r,u}function F(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t}function L(t,n,a){return t[0]=n[0]*a[0],t[1]=n[1]*a[1],t[2]=n[2]*a[2],t}function V(t,n,a){return t[0]=n[0]/a[0],t[1]=n[1]/a[1],t[2]=n[2]/a[2],t}function Q(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2];return Math.hypot(a,r,u)}function Y(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2];return a*a+r*r+u*u}function X(t){var n=t[0],a=t[1],r=t[2];return n*n+a*a+r*r}function Z(t,n){var a=n[0],r=n[1],u=n[2],e=a*a+r*r+u*u;return e>0&&(e=1/Math.sqrt(e)),t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t}function _(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function B(t,n,a){var r=n[0],u=n[1],e=n[2],o=a[0],i=a[1],c=a[2];return t[0]=u*c-e*i,t[1]=e*o-r*c,t[2]=r*i-u*o,t}var N,k=F,U=L,W=V,C=Q,G=Y,H=T,J=X,K=(N=O(),function(t,n,a,r,u,e){var o,i;for(n||(n=3),a||(a=0),i=r?Math.min(r*n+a,t.length):t.length,o=a;o<i;o+=n)N[0]=t[o],N[1]=t[o+1],N[2]=t[o+2],u(N,N,e),t[o]=N[0],t[o+1]=N[1],t[o+2]=N[2];return t}),$=Object.freeze({create:O,clone:function(t){var n=new a(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},length:T,fromValues:D,copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},set:function(t,n,a,r){return t[0]=n,t[1]=a,t[2]=r,t},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t},subtract:F,multiply:L,divide:V,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t},min:function(t,n,a){return t[0]=Math.min(n[0],a[0]),t[1]=Math.min(n[1],a[1]),t[2]=Math.min(n[2],a[2]),t},max:function(t,n,a){return t[0]=Math.max(n[0],a[0]),t[1]=Math.max(n[1],a[1]),t[2]=Math.max(n[2],a[2]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t},scale:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t},scaleAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t},distance:Q,squaredDistance:Y,squaredLength:X,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t},normalize:Z,dot:_,cross:B,lerp:function(t,n,a,r){var u=n[0],e=n[1],o=n[2];return t[0]=u+r*(a[0]-u),t[1]=e+r*(a[1]-e),t[2]=o+r*(a[2]-o),t},hermite:function(t,n,a,r,u,e){var o=e*e,i=o*(2*e-3)+1,c=o*(e-2)+e,h=o*(e-1),s=o*(3-2*e);return t[0]=n[0]*i+a[0]*c+r[0]*h+u[0]*s,t[1]=n[1]*i+a[1]*c+r[1]*h+u[1]*s,t[2]=n[2]*i+a[2]*c+r[2]*h+u[2]*s,t},bezier:function(t,n,a,r,u,e){var o=1-e,i=o*o,c=e*e,h=i*o,s=3*e*i,M=3*c*o,f=c*e;return t[0]=n[0]*h+a[0]*s+r[0]*M+u[0]*f,t[1]=n[1]*h+a[1]*s+r[1]*M+u[1]*f,t[2]=n[2]*h+a[2]*s+r[2]*M+u[2]*f,t},random:function(t,n){n=n||1;var a=2*r()*Math.PI,u=2*r()-1,e=Math.sqrt(1-u*u)*n;return t[0]=Math.cos(a)*e,t[1]=Math.sin(a)*e,t[2]=u*n,t},transformMat4:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=a[3]*r+a[7]*u+a[11]*e+a[15];return o=o||1,t[0]=(a[0]*r+a[4]*u+a[8]*e+a[12])/o,t[1]=(a[1]*r+a[5]*u+a[9]*e+a[13])/o,t[2]=(a[2]*r+a[6]*u+a[10]*e+a[14])/o,t},transformMat3:function(t,n,a){var r=n[0],u=n[1],e=n[2];return t[0]=r*a[0]+u*a[3]+e*a[6],t[1]=r*a[1]+u*a[4]+e*a[7],t[2]=r*a[2]+u*a[5]+e*a[8],t},transformQuat:function(t,n,a){var r=a[0],u=a[1],e=a[2],o=a[3],i=n[0],c=n[1],h=n[2],s=u*h-e*c,M=e*i-r*h,f=r*c-u*i,l=u*f-e*M,v=e*s-r*f,b=r*M-u*s,m=2*o;return s*=m,M*=m,f*=m,l*=2,v*=2,b*=2,t[0]=i+s+l,t[1]=c+M+v,t[2]=h+f+b,t},rotateX:function(t,n,a,r){var u=[],e=[];return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],e[0]=u[0],e[1]=u[1]*Math.cos(r)-u[2]*Math.sin(r),e[2]=u[1]*Math.sin(r)+u[2]*Math.cos(r),t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t},rotateY:function(t,n,a,r){var u=[],e=[];return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],e[0]=u[2]*Math.sin(r)+u[0]*Math.cos(r),e[1]=u[1],e[2]=u[2]*Math.cos(r)-u[0]*Math.sin(r),t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t},rotateZ:function(t,n,a,r){var u=[],e=[];return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],e[0]=u[0]*Math.cos(r)-u[1]*Math.sin(r),e[1]=u[0]*Math.sin(r)+u[1]*Math.cos(r),e[2]=u[2],t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t},angle:function(t,n){var a=D(t[0],t[1],t[2]),r=D(n[0],n[1],n[2]);Z(a,a),Z(r,r);var u=_(a,r);return u>1?0:u<-1?Math.PI:Math.acos(u)},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t},str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=a[0],i=a[1],c=a[2];return Math.abs(r-o)<=n*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(u-i)<=n*Math.max(1,Math.abs(u),Math.abs(i))&&Math.abs(e-c)<=n*Math.max(1,Math.abs(e),Math.abs(c))},sub:k,mul:U,div:W,dist:C,sqrDist:G,len:H,sqrLen:J,forEach:K});function tt(){var t=new a(4);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function nt(t){var n=new a(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function at(t,n,r,u){var e=new a(4);return e[0]=t,e[1]=n,e[2]=r,e[3]=u,e}function rt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function ut(t,n,a,r,u){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t}function et(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t}function ot(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t}function it(t,n,a){return t[0]=n[0]*a[0],t[1]=n[1]*a[1],t[2]=n[2]*a[2],t[3]=n[3]*a[3],t}function ct(t,n,a){return t[0]=n[0]/a[0],t[1]=n[1]/a[1],t[2]=n[2]/a[2],t[3]=n[3]/a[3],t}function ht(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t}function st(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2],e=n[3]-t[3];return Math.hypot(a,r,u,e)}function Mt(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2],e=n[3]-t[3];return a*a+r*r+u*u+e*e}function ft(t){var n=t[0],a=t[1],r=t[2],u=t[3];return Math.hypot(n,a,r,u)}function lt(t){var n=t[0],a=t[1],r=t[2],u=t[3];return n*n+a*a+r*r+u*u}function vt(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a*a+r*r+u*u+e*e;return o>0&&(o=1/Math.sqrt(o)),t[0]=a*o,t[1]=r*o,t[2]=u*o,t[3]=e*o,t}function bt(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]}function mt(t,n,a,r){var u=n[0],e=n[1],o=n[2],i=n[3];return t[0]=u+r*(a[0]-u),t[1]=e+r*(a[1]-e),t[2]=o+r*(a[2]-o),t[3]=i+r*(a[3]-i),t}function dt(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function xt(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=a[0],c=a[1],h=a[2],s=a[3];return Math.abs(r-i)<=n*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(u-c)<=n*Math.max(1,Math.abs(u),Math.abs(c))&&Math.abs(e-h)<=n*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(o-s)<=n*Math.max(1,Math.abs(o),Math.abs(s))}var pt=ot,yt=it,qt=ct,gt=st,At=Mt,wt=ft,Rt=lt,zt=function(){var t=tt();return function(n,a,r,u,e,o){var i,c;for(a||(a=4),r||(r=0),c=u?Math.min(u*a+r,n.length):n.length,i=r;i<c;i+=a)t[0]=n[i],t[1]=n[i+1],t[2]=n[i+2],t[3]=n[i+3],e(t,t,o),n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3];return n}}(),Pt=Object.freeze({create:tt,clone:nt,fromValues:at,copy:rt,set:ut,add:et,subtract:ot,multiply:it,divide:ct,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t[3]=Math.ceil(n[3]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t[3]=Math.floor(n[3]),t},min:function(t,n,a){return t[0]=Math.min(n[0],a[0]),t[1]=Math.min(n[1],a[1]),t[2]=Math.min(n[2],a[2]),t[3]=Math.min(n[3],a[3]),t},max:function(t,n,a){return t[0]=Math.max(n[0],a[0]),t[1]=Math.max(n[1],a[1]),t[2]=Math.max(n[2],a[2]),t[3]=Math.max(n[3],a[3]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t[3]=Math.round(n[3]),t},scale:ht,scaleAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t},distance:st,squaredDistance:Mt,length:ft,squaredLength:lt,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t[3]=1/n[3],t},normalize:vt,dot:bt,cross:function(t,n,a,r){var u=a[0]*r[1]-a[1]*r[0],e=a[0]*r[2]-a[2]*r[0],o=a[0]*r[3]-a[3]*r[0],i=a[1]*r[2]-a[2]*r[1],c=a[1]*r[3]-a[3]*r[1],h=a[2]*r[3]-a[3]*r[2],s=n[0],M=n[1],f=n[2],l=n[3];return t[0]=M*h-f*c+l*i,t[1]=-s*h+f*o-l*e,t[2]=s*c-M*o+l*u,t[3]=-s*i+M*e-f*u,t},lerp:mt,random:function(t,n){var a,u,e,o,i,c;n=n||1;do{i=(a=2*r()-1)*a+(u=2*r()-1)*u}while(i>=1);do{c=(e=2*r()-1)*e+(o=2*r()-1)*o}while(c>=1);var h=Math.sqrt((1-i)/c);return t[0]=n*a,t[1]=n*u,t[2]=n*e*h,t[3]=n*o*h,t},transformMat4:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3];return t[0]=a[0]*r+a[4]*u+a[8]*e+a[12]*o,t[1]=a[1]*r+a[5]*u+a[9]*e+a[13]*o,t[2]=a[2]*r+a[6]*u+a[10]*e+a[14]*o,t[3]=a[3]*r+a[7]*u+a[11]*e+a[15]*o,t},transformQuat:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=a[0],i=a[1],c=a[2],h=a[3],s=h*r+i*e-c*u,M=h*u+c*r-o*e,f=h*e+o*u-i*r,l=-o*r-i*u-c*e;return t[0]=s*h+l*-o+M*-c-f*-i,t[1]=M*h+l*-i+f*-o-s*-c,t[2]=f*h+l*-c+s*-i-M*-o,t[3]=n[3],t},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},str:function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},exactEquals:dt,equals:xt,sub:pt,mul:yt,div:qt,dist:gt,sqrDist:At,len:wt,sqrLen:Rt,forEach:zt});function jt(){var t=new a(4);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function It(t,n,a){a*=.5;var r=Math.sin(a);return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=Math.cos(a),t}function St(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1],h=a[2],s=a[3];return t[0]=r*s+o*i+u*h-e*c,t[1]=u*s+o*c+e*i-r*h,t[2]=e*s+o*h+r*c-u*i,t[3]=o*s-r*i-u*c-e*h,t}function Et(t,n,a){a*=.5;var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c+o*i,t[1]=u*c+e*i,t[2]=e*c-u*i,t[3]=o*c-r*i,t}function Ot(t,n,a){a*=.5;var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c-e*i,t[1]=u*c+o*i,t[2]=e*c+r*i,t[3]=o*c-u*i,t}function Tt(t,n,a){a*=.5;var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c+u*i,t[1]=u*c-r*i,t[2]=e*c+o*i,t[3]=o*c-e*i,t}function Dt(t,a,r,u){var e,o,i,c,h,s=a[0],M=a[1],f=a[2],l=a[3],v=r[0],b=r[1],m=r[2],d=r[3];return(o=s*v+M*b+f*m+l*d)<0&&(o=-o,v=-v,b=-b,m=-m,d=-d),1-o>n?(e=Math.acos(o),i=Math.sin(e),c=Math.sin((1-u)*e)/i,h=Math.sin(u*e)/i):(c=1-u,h=u),t[0]=c*s+h*v,t[1]=c*M+h*b,t[2]=c*f+h*m,t[3]=c*l+h*d,t}function Ft(t,n){var a,r=n[0]+n[4]+n[8];if(r>0)a=Math.sqrt(r+1),t[3]=.5*a,a=.5/a,t[0]=(n[5]-n[7])*a,t[1]=(n[6]-n[2])*a,t[2]=(n[1]-n[3])*a;else{var u=0;n[4]>n[0]&&(u=1),n[8]>n[3*u+u]&&(u=2);var e=(u+1)%3,o=(u+2)%3;a=Math.sqrt(n[3*u+u]-n[3*e+e]-n[3*o+o]+1),t[u]=.5*a,a=.5/a,t[3]=(n[3*e+o]-n[3*o+e])*a,t[e]=(n[3*e+u]+n[3*u+e])*a,t[o]=(n[3*o+u]+n[3*u+o])*a}return t}var Lt,Vt,Qt,Yt,Xt,Zt,_t=nt,Bt=at,Nt=rt,kt=ut,Ut=et,Wt=St,Ct=ht,Gt=bt,Ht=mt,Jt=ft,Kt=Jt,$t=lt,tn=$t,nn=vt,an=dt,rn=xt,un=(Lt=O(),Vt=D(1,0,0),Qt=D(0,1,0),function(t,n,a){var r=_(n,a);return r<-.999999?(B(Lt,Vt,n),H(Lt)<1e-6&&B(Lt,Qt,n),Z(Lt,Lt),It(t,Lt,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(B(Lt,n,a),t[0]=Lt[0],t[1]=Lt[1],t[2]=Lt[2],t[3]=1+r,nn(t,t))}),en=(Yt=jt(),Xt=jt(),function(t,n,a,r,u,e){return Dt(Yt,n,u,e),Dt(Xt,a,r,e),Dt(t,Yt,Xt,2*e*(1-e)),t}),on=(Zt=m(),function(t,n,a,r){return Zt[0]=a[0],Zt[3]=a[1],Zt[6]=a[2],Zt[1]=r[0],Zt[4]=r[1],Zt[7]=r[2],Zt[2]=-n[0],Zt[5]=-n[1],Zt[8]=-n[2],nn(t,Ft(t,Zt))}),cn=Object.freeze({create:jt,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},setAxisAngle:It,getAxisAngle:function(t,a){var r=2*Math.acos(a[3]),u=Math.sin(r/2);return u>n?(t[0]=a[0]/u,t[1]=a[1]/u,t[2]=a[2]/u):(t[0]=1,t[1]=0,t[2]=0),r},multiply:St,rotateX:Et,rotateY:Ot,rotateZ:Tt,calculateW:function(t,n){var a=n[0],r=n[1],u=n[2];return t[0]=a,t[1]=r,t[2]=u,t[3]=Math.sqrt(Math.abs(1-a*a-r*r-u*u)),t},slerp:Dt,random:function(t){var n=r(),a=r(),u=r(),e=Math.sqrt(1-n),o=Math.sqrt(n);return t[0]=e*Math.sin(2*Math.PI*a),t[1]=e*Math.cos(2*Math.PI*a),t[2]=o*Math.sin(2*Math.PI*u),t[3]=o*Math.cos(2*Math.PI*u),t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a*a+r*r+u*u+e*e,i=o?1/o:0;return t[0]=-a*i,t[1]=-r*i,t[2]=-u*i,t[3]=e*i,t},conjugate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t},fromMat3:Ft,fromEuler:function(t,n,a,r){var u=.5*Math.PI/180;n*=u,a*=u,r*=u;var e=Math.sin(n),o=Math.cos(n),i=Math.sin(a),c=Math.cos(a),h=Math.sin(r),s=Math.cos(r);return t[0]=e*c*s-o*i*h,t[1]=o*i*s+e*c*h,t[2]=o*c*h-e*i*s,t[3]=o*c*s+e*i*h,t},str:function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},clone:_t,fromValues:Bt,copy:Nt,set:kt,add:Ut,mul:Wt,scale:Ct,dot:Gt,lerp:Ht,length:Jt,len:Kt,squaredLength:$t,sqrLen:tn,normalize:nn,exactEquals:an,equals:rn,rotationTo:un,sqlerp:en,setAxes:on});function hn(t,n,a){var r=.5*a[0],u=.5*a[1],e=.5*a[2],o=n[0],i=n[1],c=n[2],h=n[3];return t[0]=o,t[1]=i,t[2]=c,t[3]=h,t[4]=r*h+u*c-e*i,t[5]=u*h+e*o-r*c,t[6]=e*h+r*i-u*o,t[7]=-r*o-u*i-e*c,t}function sn(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t}var Mn=Nt;var fn=Nt;function ln(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[4],c=a[5],h=a[6],s=a[7],M=n[4],f=n[5],l=n[6],v=n[7],b=a[0],m=a[1],d=a[2],x=a[3];return t[0]=r*x+o*b+u*d-e*m,t[1]=u*x+o*m+e*b-r*d,t[2]=e*x+o*d+r*m-u*b,t[3]=o*x-r*b-u*m-e*d,t[4]=r*s+o*i+u*h-e*c+M*x+v*b+f*d-l*m,t[5]=u*s+o*c+e*i-r*h+f*x+v*m+l*b-M*d,t[6]=e*s+o*h+r*c-u*i+l*x+v*d+M*m-f*b,t[7]=o*s-r*i-u*c-e*h+v*x-M*b-f*m-l*d,t}var vn=ln;var bn=Gt;var mn=Jt,dn=mn,xn=$t,pn=xn;var yn=Object.freeze({create:function(){var t=new a(8);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},clone:function(t){var n=new a(8);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n},fromValues:function(t,n,r,u,e,o,i,c){var h=new a(8);return h[0]=t,h[1]=n,h[2]=r,h[3]=u,h[4]=e,h[5]=o,h[6]=i,h[7]=c,h},fromRotationTranslationValues:function(t,n,r,u,e,o,i){var c=new a(8);c[0]=t,c[1]=n,c[2]=r,c[3]=u;var h=.5*e,s=.5*o,M=.5*i;return c[4]=h*u+s*r-M*n,c[5]=s*u+M*t-h*r,c[6]=M*u+h*n-s*t,c[7]=-h*t-s*n-M*r,c},fromRotationTranslation:hn,fromTranslation:function(t,n){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*n[0],t[5]=.5*n[1],t[6]=.5*n[2],t[7]=0,t},fromRotation:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},fromMat4:function(t,n){var r=jt();P(r,n);var u=new a(3);return R(u,n),hn(t,r,u),t},copy:sn,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},set:function(t,n,a,r,u,e,o,i,c){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t[6]=i,t[7]=c,t},getReal:Mn,getDual:function(t,n){return t[0]=n[4],t[1]=n[5],t[2]=n[6],t[3]=n[7],t},setReal:fn,setDual:function(t,n){return t[4]=n[0],t[5]=n[1],t[6]=n[2],t[7]=n[3],t},getTranslation:function(t,n){var a=n[4],r=n[5],u=n[6],e=n[7],o=-n[0],i=-n[1],c=-n[2],h=n[3];return t[0]=2*(a*h+e*o+r*c-u*i),t[1]=2*(r*h+e*i+u*o-a*c),t[2]=2*(u*h+e*c+a*i-r*o),t},translate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=.5*a[0],c=.5*a[1],h=.5*a[2],s=n[4],M=n[5],f=n[6],l=n[7];return t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=o*i+u*h-e*c+s,t[5]=o*c+e*i-r*h+M,t[6]=o*h+r*c-u*i+f,t[7]=-r*i-u*c-e*h+l,t},rotateX:function(t,n,a){var r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=i*o+s*r+c*e-h*u,f=c*o+s*u+h*r-i*e,l=h*o+s*e+i*u-c*r,v=s*o-i*r-c*u-h*e;return Et(t,n,a),r=t[0],u=t[1],e=t[2],o=t[3],t[4]=M*o+v*r+f*e-l*u,t[5]=f*o+v*u+l*r-M*e,t[6]=l*o+v*e+M*u-f*r,t[7]=v*o-M*r-f*u-l*e,t},rotateY:function(t,n,a){var r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=i*o+s*r+c*e-h*u,f=c*o+s*u+h*r-i*e,l=h*o+s*e+i*u-c*r,v=s*o-i*r-c*u-h*e;return Ot(t,n,a),r=t[0],u=t[1],e=t[2],o=t[3],t[4]=M*o+v*r+f*e-l*u,t[5]=f*o+v*u+l*r-M*e,t[6]=l*o+v*e+M*u-f*r,t[7]=v*o-M*r-f*u-l*e,t},rotateZ:function(t,n,a){var r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=i*o+s*r+c*e-h*u,f=c*o+s*u+h*r-i*e,l=h*o+s*e+i*u-c*r,v=s*o-i*r-c*u-h*e;return Tt(t,n,a),r=t[0],u=t[1],e=t[2],o=t[3],t[4]=M*o+v*r+f*e-l*u,t[5]=f*o+v*u+l*r-M*e,t[6]=l*o+v*e+M*u-f*r,t[7]=v*o-M*r-f*u-l*e,t},rotateByQuatAppend:function(t,n,a){var r=a[0],u=a[1],e=a[2],o=a[3],i=n[0],c=n[1],h=n[2],s=n[3];return t[0]=i*o+s*r+c*e-h*u,t[1]=c*o+s*u+h*r-i*e,t[2]=h*o+s*e+i*u-c*r,t[3]=s*o-i*r-c*u-h*e,i=n[4],c=n[5],h=n[6],s=n[7],t[4]=i*o+s*r+c*e-h*u,t[5]=c*o+s*u+h*r-i*e,t[6]=h*o+s*e+i*u-c*r,t[7]=s*o-i*r-c*u-h*e,t},rotateByQuatPrepend:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1],h=a[2],s=a[3];return t[0]=r*s+o*i+u*h-e*c,t[1]=u*s+o*c+e*i-r*h,t[2]=e*s+o*h+r*c-u*i,t[3]=o*s-r*i-u*c-e*h,i=a[4],c=a[5],h=a[6],s=a[7],t[4]=r*s+o*i+u*h-e*c,t[5]=u*s+o*c+e*i-r*h,t[6]=e*s+o*h+r*c-u*i,t[7]=o*s-r*i-u*c-e*h,t},rotateAroundAxis:function(t,a,r,u){if(Math.abs(u)<n)return sn(t,a);var e=Math.hypot(r[0],r[1],r[2]);u*=.5;var o=Math.sin(u),i=o*r[0]/e,c=o*r[1]/e,h=o*r[2]/e,s=Math.cos(u),M=a[0],f=a[1],l=a[2],v=a[3];t[0]=M*s+v*i+f*h-l*c,t[1]=f*s+v*c+l*i-M*h,t[2]=l*s+v*h+M*c-f*i,t[3]=v*s-M*i-f*c-l*h;var b=a[4],m=a[5],d=a[6],x=a[7];return t[4]=b*s+x*i+m*h-d*c,t[5]=m*s+x*c+d*i-b*h,t[6]=d*s+x*h+b*c-m*i,t[7]=x*s-b*i-m*c-d*h,t},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t[6]=n[6]+a[6],t[7]=n[7]+a[7],t},multiply:ln,mul:vn,scale:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t},dot:bn,lerp:function(t,n,a,r){var u=1-r;return bn(n,a)<0&&(r=-r),t[0]=n[0]*u+a[0]*r,t[1]=n[1]*u+a[1]*r,t[2]=n[2]*u+a[2]*r,t[3]=n[3]*u+a[3]*r,t[4]=n[4]*u+a[4]*r,t[5]=n[5]*u+a[5]*r,t[6]=n[6]*u+a[6]*r,t[7]=n[7]*u+a[7]*r,t},invert:function(t,n){var a=xn(n);return t[0]=-n[0]/a,t[1]=-n[1]/a,t[2]=-n[2]/a,t[3]=n[3]/a,t[4]=-n[4]/a,t[5]=-n[5]/a,t[6]=-n[6]/a,t[7]=n[7]/a,t},conjugate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t[4]=-n[4],t[5]=-n[5],t[6]=-n[6],t[7]=n[7],t},length:mn,len:dn,squaredLength:xn,sqrLen:pn,normalize:function(t,n){var a=xn(n);if(a>0){a=Math.sqrt(a);var r=n[0]/a,u=n[1]/a,e=n[2]/a,o=n[3]/a,i=n[4],c=n[5],h=n[6],s=n[7],M=r*i+u*c+e*h+o*s;t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=(i-r*M)/a,t[5]=(c-u*M)/a,t[6]=(h-e*M)/a,t[7]=(s-o*M)/a}return t},str:function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=t[6],s=t[7],M=a[0],f=a[1],l=a[2],v=a[3],b=a[4],m=a[5],d=a[6],x=a[7];return Math.abs(r-M)<=n*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(u-f)<=n*Math.max(1,Math.abs(u),Math.abs(f))&&Math.abs(e-l)<=n*Math.max(1,Math.abs(e),Math.abs(l))&&Math.abs(o-v)<=n*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(i-b)<=n*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(c-m)<=n*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(h-d)<=n*Math.max(1,Math.abs(h),Math.abs(d))&&Math.abs(s-x)<=n*Math.max(1,Math.abs(s),Math.abs(x))}});function qn(){var t=new a(2);return a!=Float32Array&&(t[0]=0,t[1]=0),t}function gn(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t}function An(t,n,a){return t[0]=n[0]*a[0],t[1]=n[1]*a[1],t}function wn(t,n,a){return t[0]=n[0]/a[0],t[1]=n[1]/a[1],t}function Rn(t,n){var a=n[0]-t[0],r=n[1]-t[1];return Math.hypot(a,r)}function zn(t,n){var a=n[0]-t[0],r=n[1]-t[1];return a*a+r*r}function Pn(t){var n=t[0],a=t[1];return Math.hypot(n,a)}function jn(t){var n=t[0],a=t[1];return n*n+a*a}var In=Pn,Sn=gn,En=An,On=wn,Tn=Rn,Dn=zn,Fn=jn,Ln=function(){var t=qn();return function(n,a,r,u,e,o){var i,c;for(a||(a=2),r||(r=0),c=u?Math.min(u*a+r,n.length):n.length,i=r;i<c;i+=a)t[0]=n[i],t[1]=n[i+1],e(t,t,o),n[i]=t[0],n[i+1]=t[1];return n}}(),Vn=Object.freeze({create:qn,clone:function(t){var n=new a(2);return n[0]=t[0],n[1]=t[1],n},fromValues:function(t,n){var r=new a(2);return r[0]=t,r[1]=n,r},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t},set:function(t,n,a){return t[0]=n,t[1]=a,t},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t},subtract:gn,multiply:An,divide:wn,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t},min:function(t,n,a){return t[0]=Math.min(n[0],a[0]),t[1]=Math.min(n[1],a[1]),t},max:function(t,n,a){return t[0]=Math.max(n[0],a[0]),t[1]=Math.max(n[1],a[1]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t},scale:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t},scaleAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t},distance:Rn,squaredDistance:zn,length:Pn,squaredLength:jn,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t},normalize:function(t,n){var a=n[0],r=n[1],u=a*a+r*r;return u>0&&(u=1/Math.sqrt(u)),t[0]=n[0]*u,t[1]=n[1]*u,t},dot:function(t,n){return t[0]*n[0]+t[1]*n[1]},cross:function(t,n,a){var r=n[0]*a[1]-n[1]*a[0];return t[0]=t[1]=0,t[2]=r,t},lerp:function(t,n,a,r){var u=n[0],e=n[1];return t[0]=u+r*(a[0]-u),t[1]=e+r*(a[1]-e),t},random:function(t,n){n=n||1;var a=2*r()*Math.PI;return t[0]=Math.cos(a)*n,t[1]=Math.sin(a)*n,t},transformMat2:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[2]*u,t[1]=a[1]*r+a[3]*u,t},transformMat2d:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[2]*u+a[4],t[1]=a[1]*r+a[3]*u+a[5],t},transformMat3:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[3]*u+a[6],t[1]=a[1]*r+a[4]*u+a[7],t},transformMat4:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[4]*u+a[12],t[1]=a[1]*r+a[5]*u+a[13],t},rotate:function(t,n,a,r){var u=n[0]-a[0],e=n[1]-a[1],o=Math.sin(r),i=Math.cos(r);return t[0]=u*i-e*o+a[0],t[1]=u*o+e*i+a[1],t},angle:function(t,n){var a=t[0],r=t[1],u=n[0],e=n[1],o=a*a+r*r;o>0&&(o=1/Math.sqrt(o));var i=u*u+e*e;i>0&&(i=1/Math.sqrt(i));var c=(a*u+r*e)*o*i;return c>1?0:c<-1?Math.PI:Math.acos(c)},zero:function(t){return t[0]=0,t[1]=0,t},str:function(t){return"vec2("+t[0]+", "+t[1]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]},equals:function(t,a){var r=t[0],u=t[1],e=a[0],o=a[1];return Math.abs(r-e)<=n*Math.max(1,Math.abs(r),Math.abs(e))&&Math.abs(u-o)<=n*Math.max(1,Math.abs(u),Math.abs(o))},len:In,sub:Sn,mul:En,div:On,dist:Tn,sqrDist:Dn,sqrLen:Fn,forEach:Ln});t.glMatrix=e,t.mat2=s,t.mat2d=b,t.mat3=q,t.mat4=E,t.quat=cn,t.quat2=yn,t.vec2=Vn,t.vec3=$,t.vec4=Pt,Object.defineProperty(t,"__esModule",{value:!0})});
"use strict";function diff_match_patch(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}function SWFObject(e){function t(e){X?e():N[N.length]=e}function n(e){if(typeof I.addEventListener!=T)I.addEventListener("load",e,!1);else if(typeof O.addEventListener!=T)O.addEventListener("load",e,!1);else if(typeof I.attachEvent!=T)m(I,"onload",e);else if("function"==typeof I.onload){var t=I.onload;I.onload=function(){t(),e()}}else I.onload=e}function r(){M?i():o()}function i(){var e=O.getElementsByTagName("body")[0],t=h(R);t.setAttribute("type",P);var n=e.appendChild(t);if(n){var r=0;!function(){if(typeof n.GetVariable!=T){var i=n.GetVariable("$version");i&&(i=i.split(" ")[1].split(","),j.pv=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)])}else if(10>r)return r++,void setTimeout(arguments.callee,10);e.removeChild(t),n=null,o()}()}else o()}function o(){var e=F.length;if(e>0)for(var t=0;e>t;t++){var n=F[t].id,r=F[t].callbackFn,i={success:!1,id:n};if(j.pv[0]>0){var o=g(n);if(o)if(!v(F[t].swfVersion)||j.wk&&j.wk<312)if(F[t].expressInstall&&s()){var d={};d.data=F[t].expressInstall,d.width=o.getAttribute("width")||"0",d.height=o.getAttribute("height")||"0",o.getAttribute("class")&&(d.styleclass=o.getAttribute("class")),o.getAttribute("align")&&(d.align=o.getAttribute("align"));for(var u={},f=o.getElementsByTagName("param"),p=f.length,_=0;p>_;_++)"movie"!=f[_].getAttribute("name").toLowerCase()&&(u[f[_].getAttribute("name")]=f[_].getAttribute("value"));c(d,u,n,r)}else l(o),r&&r(i);else w(n,!0),r&&(i.success=!0,i.ref=a(n),r(i))}else if(w(n,!0),r){var h=a(n);h&&typeof h.SetVariable!=T&&(i.success=!0,i.ref=h),r(i)}}}function a(e){var t=null,n=g(e);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=T)t=n;else{var r=n.getElementsByTagName(R)[0];r&&(t=r)}return t}function s(){return!K&&v("6.0.65")&&(j.win||j.mac)&&!(j.wk&&j.wk<312)}function c(e,t,n,r){K=!0,C=r||null,E={success:!1,id:n};var i=g(n);if(i){"OBJECT"==i.nodeName?(k=d(i),S=null):(k=i,S=n),e.id=U,(typeof e.width==T||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==T||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),O.title=O.title.slice(0,47)+" - Flash Player Installation";var o=j.ie&&j.win?"ActiveX":"PlugIn",a="MMredirectURL="+encodeURI(I.location).toString().replace(/&/g,"%26")+"&MMplayerType="+o+"&MMdoctitle="+O.title;if(typeof t.flashvars!=T?t.flashvars+="&"+a:t.flashvars=a,j.ie&&j.win&&4!=i.readyState){var s=h("div");n+="SWFObjectNew",s.setAttribute("id",n),i.parentNode.insertBefore(s,i),i.style.display="none",function(){4==i.readyState?i.parentNode.removeChild(i):setTimeout(arguments.callee,10)}()}u(e,t,n)}}function l(e){if(j.ie&&j.win&&4!=e.readyState){var t=h("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(d(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(d(e),e)}function d(e){var t=h("div");if(j.win&&j.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(R)[0];if(n){var r=n.childNodes;if(r)for(var i=r.length,o=0;i>o;o++)1==r[o].nodeType&&"PARAM"==r[o].nodeName||8==r[o].nodeType||t.appendChild(r[o].cloneNode(!0))}}return t}function u(e,t,n){var r,i=g(n);if(j.wk&&j.wk<312)return r;if(i)if(typeof e.id==T&&(e.id=n),j.ie&&j.win){var o="";for(var a in e)e[a]!=Object.prototype[a]&&("data"==a.toLowerCase()?t.movie=e[a]:"styleclass"==a.toLowerCase()?o+=' class="'+e[a]+'"':"classid"!=a.toLowerCase()&&(o+=" "+a+'="'+e[a]+'"'));var s="";for(var c in t)t[c]!=Object.prototype[c]&&(s+='<param name="'+c+'" value="'+t[c]+'" />');i.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+o+">"+s+"</object>",V[V.length]=e.id,r=g(e.id)}else{var l=h(R);l.setAttribute("type",P);for(var d in e)e[d]!=Object.prototype[d]&&("styleclass"==d.toLowerCase()?l.setAttribute("class",e[d]):"classid"!=d.toLowerCase()&&l.setAttribute(d,e[d]));for(var u in t)t[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&f(l,u,t[u]);i.parentNode.replaceChild(l,i),r=l}return r}function f(e,t,n){var r=h("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)}function p(e){var t=g(e);t&&"OBJECT"==t.nodeName&&(j.ie&&j.win?(t.style.display="none",function(){4==t.readyState?_(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function _(e){var t=g(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}function g(e){var t=null;try{t=O.getElementById(e)}catch(n){}return t}function h(e){return O.createElement(e)}function m(e,t,n){e.attachEvent(t,n),H[H.length]=[e,t,n]}function v(e){var t=j.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function y(e,t,n,r){if(!j.ie||!j.mac){var i=O.getElementsByTagName("head")[0];if(i){var o=n&&"string"==typeof n?n:"screen";if(r&&(x=null,A=null),!x||A!=o){var a=h("style");a.setAttribute("type","text/css"),a.setAttribute("media",o),x=i.appendChild(a),j.ie&&j.win&&typeof O.styleSheets!=T&&O.styleSheets.length>0&&(x=O.styleSheets[O.styleSheets.length-1]),A=o}j.ie&&j.win?x&&typeof x.addRule==R&&x.addRule(e,t):x&&typeof O.createTextNode!=T&&x.appendChild(O.createTextNode(e+" {"+t+"}"))}}}function w(e,t){if(W){var n=t?"visible":"hidden";X&&g(e)?g(e).style.visibility=n:y("#"+e,"visibility:"+n)}}function b(e){var t=/[\\\"<>\.;]/,n=null!=t.exec(e);return n&&typeof encodeURIComponent!=T?encodeURIComponent(e):e}var k,S,C,E,x,A,T="undefined",R="object",D="Shockwave Flash",L="ShockwaveFlash.ShockwaveFlash",P="application/x-shockwave-flash",U="SWFObjectExprInst",I=e,O=I.document,B=navigator,M=!1,N=[r],F=[],V=[],H=[],X=!0,K=!1,W=!0,j=function(){var e=typeof O.getElementById!=T&&typeof O.getElementsByTagName!=T&&typeof O.createElement!=T,t=B.userAgent.toLowerCase(),n=B.platform.toLowerCase(),r=n?/win/.test(n):/win/.test(t),i=n?/mac/.test(n):/mac/.test(t),o=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,a=!1,s=[0,0,0],c=null;if(typeof B.plugins!=T&&typeof B.plugins[D]==R)c=B.plugins[D].description,!c||typeof B.mimeTypes!=T&&B.mimeTypes[P]&&!B.mimeTypes[P].enabledPlugin||(M=!0,a=!1,c=c.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),s[0]=parseInt(c.replace(/^(.*)\..*$/,"$1"),10),s[1]=parseInt(c.replace(/^.*\.(.*)\s.*$/,"$1"),10),s[2]=/[a-zA-Z]/.test(c)?parseInt(c.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof I.ActiveXObject!=T)try{var l=new ActiveXObject(L);l&&(c=l.GetVariable("$version"),c&&(a=!0,c=c.split(" ")[1].split(","),s=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]))}catch(d){}return{w3:e,pv:s,wk:o,ie:a,win:r,mac:i}}();(function(){j.ie&&j.win&&window.attachEvent("onunload",function(){for(var e=H.length,t=0;e>t;t++)H[t][0].detachEvent(H[t][1],H[t][2]);for(var n=V.length,r=0;n>r;r++)p(V[r]);for(var i in j)j[i]=null;j=null;for(var o in swfobject)swfobject[o]=null;swfobject=null})})();return{registerObject:function(e,t,n,r){if(j.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=n,i.callbackFn=r,F[F.length]=i,w(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){return j.w3?a(e):void 0},embedSWF:function(e,n,r,i,o,a,l,d,f,p){var _={success:!1,id:n};j.w3&&!(j.wk&&j.wk<312)&&e&&n&&r&&i&&o?(w(n,!1),t(function(){r+="",i+="";var t={};if(f&&typeof f===R)for(var g in f)t[g]=f[g];t.data=e,t.width=r,t.height=i;var h={};if(d&&typeof d===R)for(var m in d)h[m]=d[m];if(l&&typeof l===R)for(var y in l)typeof h.flashvars!=T?h.flashvars+="&"+y+"="+l[y]:h.flashvars=y+"="+l[y];if(v(o)){var b=u(t,h,n);t.id==n&&w(n,!0),_.success=!0,_.ref=b}else{if(a&&s())return t.data=a,void c(t,h,n,p);w(n,!0)}p&&p(_)})):p&&p(_)},switchOffAutoHideShow:function(){W=!1},ua:j,getFlashPlayerVersion:function(){return{major:j.pv[0],minor:j.pv[1],release:j.pv[2]}},hasFlashPlayerVersion:v,createSWF:function(e,t,n){return j.w3?u(e,t,n):void 0},showExpressInstall:function(e,t,n,r){j.w3&&s()&&c(e,t,n,r)},removeSWF:function(e){j.w3&&p(e)},createCSS:function(e,t,n,r){j.w3&&y(e,t,n,r)},addDomLoadEvent:t,addLoadEvent:n,getQueryParamValue:function(e){var t=O.location.search||O.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return b(t);for(var n=t.split("&"),r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return b(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(K){var e=g(U);e&&k&&(e.parentNode.replaceChild(k,e),S&&(w(S,!0),j.ie&&j.win&&(k.style.display="block")),C&&C(E)),K=!1}}}}function Websock(){function e(){return P}function t(){return R}function n(){return D}function r(e){D=e}function i(){return R.length-D}function o(){return R[D]}function a(){return R[D++]}function s(e){0===D?R.unshift(e):(D-=1,R[D]=e)}function c(){return(R[D++]<<8)+R[D++]}function l(){return(R[D++]<<24)+(R[D++]<<16)+(R[D++]<<8)+R[D++]}function d(e){"undefined"==typeof e&&(e=i());var t=R.slice(D,D+e);return D+=e,String.fromCharCode.apply(null,t)}function u(e){return"undefined"==typeof e&&(e=i()),D+=e,R.slice(D-e,D)}function f(e,t){return t?R.slice(D+e,D+t):R.slice(D+e)}function p(e,t,n){var r=R.length-D;if(t>r){if(n){if(n>D)throw"rQwait cannot backup "+n+" bytes";D-=n}return!0}return!1}function _(){return"binary"===T?new Uint8Array(P).buffer:Base64.encode(P)}function g(e){if("binary"===T)for(var t=new Uint8Array(e),n=0;n<t.length;n++)R.push(t[n]);else R=R.concat(Base64.decode(e,0))}function h(){return 0!==A.bufferedAmount&&VncHelper.Debug("bufferedAmount: "+A.bufferedAmount),A.bufferedAmount<x.maxBufferedAmount?(P.length>0&&(A.send(_(P)),P=[]),!0):(VncHelper.Info("Delaying send, bufferedAmount: "+A.bufferedAmount),!1)}function m(e){return P=P.concat(e),h()}function v(e){x.send(e.split("").map(function(e){return e.charCodeAt(0)}))}function y(e){try{g(e.data),i()>0?(U.message(),R.length>L&&(R=R.slice(D),D=0)):VncHelper.Debug("Ignoring empty message")}catch(t){"undefined"!=typeof t.stack?VncHelper.Warn("recv_message, caught exception: "+t.stack):"undefined"!=typeof t.description?VncHelper.Warn("recv_message, caught exception: "+t.description):VncHelper.Warn("recv_message, caught exception:"+t),"undefined"!=typeof t.name?U.error(t.name+": "+t.message):U.error(t)}}function w(e,t){U[e]=t}function b(e){R=[],D=0,P=[],A=null;var t=!1,n=!1;if("Uint8Array"in window&&"set"in Uint8Array.prototype&&(t=!0),"undefined"==typeof e&&(e=n?["binary","base64"]:"base64"),!n){if("binary"===e)throw"WebSocket binary sub-protocol requested but not supported";if("object"==typeof e){for(var r=[],i=0;i<e.length;i++)"binary"===e[i]?VncHelper.Warn("Skipping unsupported WebSocket binary sub-protocol"):r.push(e[i]);if(!(r.length>0))throw"Only WebSocket binary sub-protocol was requested and not supported.";e=r}}return e}function k(e,t){if(t=b(t),I)A={};else{if(!Websock_native){var n="xmlsocket://"+location.hostname+":80";VncHelper.Warn("Giving preference to policy file at "+n),WebSocket.loadFlashPolicyFile(n)}A=new WebSocket(e,t),t.indexOf("binary")>=0&&(A.binaryType="arraybuffer")}A.onmessage=y,A.onopen=function(){VncHelper.Debug(">> WebSock.onopen"),A.protocol?(T=A.protocol,VncHelper.Info("Server chose sub-protocol: "+A.protocol)):(T="base64",VncHelper.Error("Server select no sub-protocol!: "+A.protocol)),U.open(),VncHelper.Debug("<< WebSock.onopen")},A.onclose=function(e){VncHelper.Debug(">> WebSock.onclose"),U.close(e),VncHelper.Debug("<< WebSock.onclose")},A.onerror=function(e){VncHelper.Debug(">> WebSock.onerror: "+e),U.error(e),VncHelper.Debug("<< WebSock.onerror")}}function S(){A&&((A.readyState===WebSocket.OPEN||A.readyState===WebSocket.CONNECTING)&&(VncHelper.Info("Closing WebSocket connection"),A.close()),A.onmessage=function(e){})}function C(e,t){return I=!0,T=t,x.send=e,x.close=function(){},y}function E(){return x.maxBufferedAmount=200,x.get_sQ=e,x.get_rQ=t,x.get_rQi=n,x.set_rQi=r,x.rQlen=i,x.rQpeek8=o,x.rQshift8=a,x.rQunshift8=s,x.rQshift16=c,x.rQshift32=l,x.rQshiftStr=d,x.rQshiftBytes=u,x.rQslice=f,x.rQwait=p,x.flush=h,x.send=m,x.send_string=v,x.on=w,x.init=b,x.open=k,x.close=S,x.testMode=C,x}var x={},A=null,T="base64",R=[],D=0,L=1e4,P=[],U={message:function(){},open:function(){},close:function(){},error:function(){}},I=!1;return Websock_native===!1&&(window.WEB_SOCKET_SWF_LOCATION=VncHelper.get_include_uri()+"web-socket-js/WebSocketMain.swf",VncHelper.Engine.trident&&(VncHelper.Debug("Forcing uncached load of WebSocketMain.swf"),window.WEB_SOCKET_SWF_LOCATION+="?"+Math.random()),VncHelper.load_scripts(["web-socket-js/swfobject.js","web-socket-js/web_socket.js"])),E()}function DES(e){function t(e){var t,n,r,i,o,a,s,c,l,d,u=[],f=[],p=[];for(n=0,r=56;56>n;++n,r-=8)r+=-5>r?65:-3>r?31:-1>r?63:27===r?35:0,i=7&r,u[n]=0!==(e[r>>>3]&1<<i)?1:0;for(t=0;16>t;++t){for(i=t<<1,o=i+1,p[i]=p[o]=0,a=28;59>a;a+=28)for(n=a-28;a>n;++n)r=n+y[t],a>r?f[n]=u[r]:f[n]=u[r-28];for(n=0;24>n;++n)0!==f[v[n]]&&(p[i]|=1<<23-n),0!==f[v[n+24]]&&(p[o]|=1<<23-n)}for(t=0,l=0,d=0;16>t;++t)s=p[l++],c=p[l++],b[d]=(16515072&s)<<6,b[d]|=(4032&s)<<10,b[d]|=(16515072&c)>>>10,b[d]|=(4032&c)>>>6,++d,b[d]=(258048&s)<<12,b[d]|=(63&s)<<16,b[d]|=(258048&c)>>>4,b[d]|=63&c,++d}function n(e){var t,n,r,i,o=0,a=e.slice(),s=0;for(n=a[o++]<<24|a[o++]<<16|a[o++]<<8|a[o++],r=a[o++]<<24|a[o++]<<16|a[o++]<<8|a[o++],i=252645135&(n>>>4^r),r^=i,n^=i<<4,i=65535&(n>>>16^r),r^=i,n^=i<<16,i=858993459&(r>>>2^n),n^=i,r^=i<<2,i=16711935&(r>>>8^n),n^=i,r^=i<<8,r=r<<1|r>>>31&1,i=2863311530&(n^r),n^=i,r^=i,n=n<<1|n>>>31&1,o=0;8>o;++o)i=r<<28|r>>>4,i^=b[s++],t=h[63&i],t|=_[i>>>8&63],t|=f[i>>>16&63],t|=d[i>>>24&63],i=r^b[s++],t|=m[63&i],t|=g[i>>>8&63],t|=p[i>>>16&63],t|=u[i>>>24&63],n^=t,i=n<<28|n>>>4,i^=b[s++],t=h[63&i],t|=_[i>>>8&63],t|=f[i>>>16&63],t|=d[i>>>24&63],i=n^b[s++],t|=m[63&i],t|=g[i>>>8&63],t|=p[i>>>16&63],t|=u[i>>>24&63],r^=t;for(r=r<<31|r>>>1,i=2863311530&(n^r),n^=i,r^=i,n=n<<31|n>>>1,i=16711935&(n>>>8^r),r^=i,n^=i<<8,i=858993459&(n>>>2^r),r^=i,n^=i<<2,i=65535&(r>>>16^n),n^=i,r^=i<<16,i=252645135&(r>>>4^n),n^=i,r^=i<<4,i=[r,n],o=0;8>o;o++)a[o]=(i[o>>>2]>>>8*(3-o%4))%256,a[o]<0&&(a[o]+=256);return a}function r(e){return n(e.slice(0,8)).concat(n(e.slice(8,16)))}var i,o,a,s,c,l,d,u,f,p,_,g,h,m,v=[13,16,10,23,0,4,2,27,14,5,20,9,22,18,11,3,25,7,15,6,26,19,12,1,40,51,30,36,46,54,29,39,50,44,32,47,43,48,38,55,33,52,45,41,49,35,28,31],y=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],w=0,b=[];return i=65536,o=1<<24,a=i|o,s=4,c=1024,l=s|c,d=[a|c,w|w,i|w,a|l,a|s,i|l,w|s,i|w,w|c,a|c,a|l,w|c,o|l,a|s,o|w,w|s,w|l,o|c,o|c,i|c,i|c,a|w,a|w,o|l,i|s,o|s,o|s,i|s,w|w,w|l,i|l,o|w,i|w,a|l,w|s,a|w,a|c,o|w,o|w,w|c,a|s,i|w,i|c,o|s,w|c,w|s,o|l,i|l,a|l,i|s,a|w,o|l,o|s,w|l,i|l,a|c,w|l,o|c,o|c,w|w,i|s,i|c,w|w,a|s],i=1<<20,o=1<<31,a=i|o,s=32,c=32768,l=s|c,u=[a|l,o|c,w|c,i|l,i|w,w|s,a|s,o|l,o|s,a|l,a|c,o|w,o|c,i|w,w|s,a|s,i|c,i|s,o|l,w|w,o|w,w|c,i|l,a|w,i|s,o|s,w|w,i|c,w|l,a|c,a|w,w|l,w|w,i|l,a|s,i|w,o|l,a|w,a|c,w|c,a|w,o|c,w|s,a|l,i|l,w|s,w|c,o|w,w|l,a|c,i|w,o|s,i|s,o|l,o|s,i|s,i|c,w|w,o|c,w|l,o|w,a|s,a|l,i|c],i=1<<17,o=1<<27,a=i|o,s=8,c=512,l=s|c,f=[w|l,a|c,w|w,a|s,o|c,w|w,i|l,o|c,i|s,o|s,o|s,i|w,a|l,i|s,a|w,w|l,o|w,w|s,a|c,w|c,i|c,a|w,a|s,i|l,o|l,i|c,i|w,o|l,w|s,a|l,w|c,o|w,a|c,o|w,i|s,w|l,i|w,a|c,o|c,w|w,w|c,i|s,a|l,o|c,o|s,w|c,w|w,a|s,o|l,i|w,o|w,a|l,w|s,i|l,i|c,o|s,a|w,o|l,w|l,a|w,i|l,w|s,a|s,i|c],i=8192,o=1<<23,a=i|o,s=1,c=128,l=s|c,p=[a|s,i|l,i|l,w|c,a|c,o|l,o|s,i|s,w|w,a|w,a|w,a|l,w|l,w|w,o|c,o|s,w|s,i|w,o|w,a|s,w|c,o|w,i|s,i|c,o|l,w|s,i|c,o|c,i|w,a|c,a|l,w|l,o|c,o|s,a|w,a|l,w|l,w|w,w|w,a|w,i|c,o|c,o|l,w|s,a|s,i|l,i|l,w|c,a|l,w|l,w|s,i|w,o|s,i|s,a|c,o|l,i|s,i|c,o|w,a|s,w|c,o|w,i|w,a|c],i=1<<25,o=1<<30,a=i|o,s=256,c=1<<19,l=s|c,_=[w|s,i|l,i|c,a|s,w|c,w|s,o|w,i|c,o|l,w|c,i|s,o|l,a|s,a|c,w|l,o|w,i|w,o|c,o|c,w|w,o|s,a|l,a|l,i|s,a|c,o|s,w|w,a|w,i|l,i|w,a|w,w|l,w|c,a|s,w|s,i|w,o|w,i|c,a|s,o|l,i|s,o|w,a|c,i|l,o|l,w|s,i|w,a|c,a|l,w|l,a|w,a|l,i|c,w|w,o|c,a|w,w|l,i|s,o|s,w|c,w|w,o|c,i|l,o|s],i=1<<22,o=1<<29,a=i|o,s=16,c=16384,l=s|c,g=[o|s,a|w,w|c,a|l,a|w,w|s,a|l,i|w,o|c,i|l,i|w,o|s,i|s,o|c,o|w,w|l,w|w,i|s,o|l,w|c,i|c,o|l,w|s,a|s,a|s,w|w,i|l,a|c,w|l,i|c,a|c,o|w,o|c,w|s,a|s,i|c,a|l,i|w,w|l,o|s,i|w,o|c,o|w,w|l,o|s,a|l,i|c,a|w,i|l,a|c,w|w,a|s,w|s,w|c,a|w,i|l,w|c,i|s,o|l,w|w,a|c,o|w,i|s,o|l],i=1<<21,o=1<<26,a=i|o,s=2,c=2048,l=s|c,h=[i|w,a|s,o|l,w|w,w|c,o|l,i|l,a|c,a|l,i|w,w|w,o|s,w|s,o|w,a|s,w|l,o|c,i|l,i|s,o|c,o|s,a|w,a|c,i|s,a|w,w|c,w|l,a|l,i|c,w|s,o|w,i|c,o|w,i|c,i|w,o|l,o|l,a|s,a|s,w|s,i|s,o|w,o|c,i|w,a|c,w|l,i|l,a|c,w|l,o|s,a|l,a|w,i|c,w|w,w|s,a|l,w|w,i|l,a|w,w|c,o|s,o|c,w|c,i|s],i=1<<18,o=1<<28,a=i|o,s=64,c=4096,l=s|c,m=[o|l,w|c,i|w,a|l,o|w,o|l,w|s,o|w,i|s,a|w,a|l,i|c,a|c,i|l,w|c,w|s,a|w,o|s,o|c,w|l,i|c,i|s,a|s,a|c,w|l,w|w,w|w,a|s,o|s,o|c,i|l,i|w,i|l,i|w,a|c,w|c,w|s,a|s,w|c,i|l,o|c,w|s,o|s,a|w,a|s,o|w,i|w,o|l,w|w,a|l,i|s,o|s,a|w,o|c,o|l,w|w,a|l,i|c,i|c,w|l,w|l,i|s,o|w,a|c],t(e),{encrypt:r}}function Keyboard(e){function t(e){s.onKeyPress&&(VncHelper.Debug("onKeyPress "+("keydown"==e.type?"down":"up")+", keysym: "+e.keysym.keysym+"("+e.keysym.keyname+")"),s.onKeyPress(e.keysym.keysym,"keydown"==e.type))}function n(e){return s.focused&&c.keydown(e)?(VncHelper.stopEvent(e),!1):!0}function r(e){return s.focused&&c.keypress(e)?(VncHelper.stopEvent(e),!1):!0}function i(e){return s.focused&&c.keyup(e)?(VncHelper.stopEvent(e),!1):!0}function o(){VncHelper.Debug(">> Keyboard.allKeysUp"),c.releaseAll(),VncHelper.Debug("<< Keyboard.allKeysUp")}var a={},s={};VncHelper.conf_defaults(s,a,e,[["frame","wo","dom",window,"The frame window that contains the VNC canvas object"],["target","wo","dom",document,"DOM element that captures keyboard input"],["focused","rw","bool",!0,"Capture and send key events"],["onKeyPress","rw","func",null,"Handler for key press/release"],["stopEventPropagation","rw","bool",!0,"Stop input events from bubbling (useful for inadvertanty triggering browser-native functionality)"]]);var c=KeyEventDecoder(kbdUtil.ModifierSync(),VerifyCharModifier(TrackKeyState(EscapeModifiers(t))));return a.grab=function(){var e=s.target;VncHelper.addEvent(e,"keydown",n),VncHelper.addEvent(e,"keyup",i),VncHelper.addEvent(e,"keypress",r),VncHelper.addEvent(window,"blur",o)},a.ungrab=function(){var e=s.target;VncHelper.removeEvent(e,"keydown",n),VncHelper.removeEvent(e,"keyup",i),VncHelper.removeEvent(e,"keypress",r),VncHelper.removeEvent(window,"blur",o),o()},a.sync=function(e){c.syncModifiers(e)},a}function Mouse(e){function t(){g.target.setCapture&&g.target.setCapture(),h=!0}function n(){g.target.releaseCapture&&g.target.releaseCapture(),h=!1}function r(){m=null}function i(e,t){var n,i,o;if(!g.focused)return!0;if(g.notify&&g.notify(e),n=e?e:window.event,i=VncHelper.getEventPosition(g.frame,e,g.target,g.scale),e.touches||e.changedTouches){if(1==t){if(null==m)v=i;else{clearTimeout(m);var a=v.x-i.x,s=v.y-i.y,c=Math.sqrt(a*a+s*s);c<20*window.devicePixelRatio&&(i=v)}m=setTimeout(r,500)}o=g.touchButton}else o=n.which?1<<n.button:(1&n.button)+2*(2&n.button)+(4&n.button)/2;return g.onMouseButton&&(VncHelper.Debug("onMouseButton "+(t?"down":"up")+", x: "+i.x+", y: "+i.y+", bmask: "+o),g.onMouseButton(i.x,i.y,t,o)),g.stopEventPropagation?(n.stopPropagation&&(n.stopPropagation(),n.cancelBubble=!0),!1):!0}function o(e){c(e),e.preventDefault()}function a(e){l(e),e.preventDefault()}function s(e){u(e),e.preventDefault()}function c(e){t(),i(e,1)}function l(e){h&&(i(e,0),n())}function d(e){var t,n,r,i;return g.focused?(g.notify&&g.notify(e),t=e?e:window.event,n=VncHelper.getEventPosition(g.frame,e,g.target,g.scale),i=t.detail?-1*t.detail:t.wheelDelta/40,r=i>0?8:16,g.stopEventPropagation?(VncHelper.stopEvent(e),!1):!0):!0}function u(e){var t,n;return g.focused?(g.notify&&g.notify(e),t=e?e:window.event,n=VncHelper.getEventPosition(g.frame,e,g.target,g.scale),y=n.x,w=n.y,g.onMouseMove&&g.onMouseMove(n.x,n.y),g.stopEventPropagation?(VncHelper.stopEvent(e),!1):!0):!0}function f(e){var t,n;return g.focused?(t=e?e:window.event,n=VncHelper.getEventPosition(g.frame,e,g.target,g.scale),n.realx>=0&&n.realy>=0&&n.realx<g.target.offsetWidth&&n.realy<g.target.offsetHeight&&g.stopEventPropagation?(VncHelper.stopEvent(e),!1):!0):!0}function p(){if(g.onMouseButton){VncHelper.Info("allButtonsUp: onMouseButton");var e=0,t=0;g.onMouseButton(y,w,t,e,!0)}}var _={},g={},h=!1,m=null,v=null;VncHelper.conf_defaults(g,_,e,[["frame","wo","dom",window,"The frame window that contains the VNC canvas object"],["target","ro","dom",document,"DOM element that captures mouse input"],["notify","ro","func",null,"Function to call to notify whenever a mouse event is received"],["focused","rw","bool",!0,"Capture and send mouse clicks/movement"],["scale","rw","float",1,"Viewport scale factor 0.0 - 1.0"],["onMouseButton","rw","func",null,"Handler for mouse button click/release"],["onMouseMove","rw","func",null,"Handler for mouse movement"],["touchButton","rw","int",1,"Button mask (1, 2, 4) for touch devices (0 means ignore clicks)"],["stopEventPropagation","rw","bool",!0,"Stop input events from bubbling (useful for inadvertanty triggering browser-native functionality)"]]);var y=0,w=0;return _.grab=function(){var e=g.target;"ontouchstart"in document.documentElement&&(VncHelper.addEvent(e,"touchstart",o),VncHelper.addEvent(window,"touchend",a),VncHelper.addEvent(e,"touchend",a),VncHelper.addEvent(e,"touchmove",s)),VncHelper.addEvent(e,"mousedown",c),VncHelper.addEvent(window,"mouseup",l),VncHelper.addEvent(e,"mouseup",l),VncHelper.addEvent(e,"mousemove",u),VncHelper.addEvent(e,VncHelper.Engine.gecko?"DOMMouseScroll":"mousewheel",d),VncHelper.addEvent(document,"click",f),VncHelper.addEvent(document.body,"contextmenu",f),VncHelper.addEvent(window,"mouseout",p)},_.ungrab=function(){var e=g.target;"ontouchstart"in document.documentElement&&(VncHelper.removeEvent(e,"touchstart",o),VncHelper.removeEvent(window,"touchend",a),VncHelper.removeEvent(e,"touchend",a),VncHelper.removeEvent(e,"touchmove",s)),VncHelper.removeEvent(e,"mousedown",c),VncHelper.removeEvent(window,"mouseup",l),VncHelper.removeEvent(e,"mouseup",l),VncHelper.removeEvent(e,"mousemove",u),VncHelper.removeEvent(e,VncHelper.Engine.gecko?"DOMMouseScroll":"mousewheel",d),VncHelper.removeEvent(document,"click",f),VncHelper.removeEvent(document.body,"contextmenu",f),VncHelper.removeEvent(window,"mouseout",p)},_}function Display(e){function t(){VncHelper.Debug(">> Display.constructor");var e,t,n,r,i=VncHelper.Engine;if(!l.target)throw"target must be set";if("string"==typeof l.target)throw"target must be a DOM element";if(e=l.target,!e.getContext)throw"no getContext method";if(d||(d=e.getContext("2d")),VncHelper.Debug("User Agent: "+navigator.userAgent),i.gecko&&VncHelper.Debug("Browser: gecko "+i.gecko),i.webkit&&VncHelper.Debug("Browser: webkit "+i.webkit),i.trident&&VncHelper.Debug("Browser: trident "+i.trident),i.presto&&VncHelper.Debug("Browser: presto "+i.presto),c.clear(),!("createImageData"in d))throw"Canvas does not support createImageData";for(l.render_mode="canvas rendering",null===l.prefer_js&&(VncHelper.Info("Prefering javascript operations"),l.prefer_js=!0),v=d.createImageData(16,16),n=[],t=0;256>t;t+=1)n.push(255);try{r=e.style.cursor,changeCursor(l.target,n,n,2,2,8,8),e.style.cursor?(null===l.cursor_uri&&(l.cursor_uri=!0),VncHelper.Info("Data URI scheme cursor supported")):(null===l.cursor_uri&&(l.cursor_uri=!1),VncHelper.Warn("Data URI scheme cursor not supported")),e.style.cursor=r}catch(o){VncHelper.Error("Data URI scheme cursor test exception: "+o),l.cursor_uri=!1}return VncHelper.Debug("<< Display.constructor"),c}var n,r,i,o,a,s,c={},l={},d=null,u=[],f=0,p=0,_={x:0,y:0,w:0,h:0},g={x1:0,y1:0,x2:-1,y2:-1},h="",m=null,v=null,y=0,w=0;return VncHelper.conf_defaults(l,c,e,[["frame","wo","dom",window,"The frame window that contains the VNC canvas object"],["target","wo","dom",null,"Canvas element for rendering"],["context","ro","raw",null,"Canvas 2D context for rendering (read-only)"],["logo","rw","raw",null,'Logo to display when cleared: {"width": width, "height": height, "data": data}'],["true_color","rw","bool",!0,"Use true-color pixel data"],["colourMap","rw","arr",[],"Colour map array (when not true-color)"],["scale","rw","float",1,"Display area scale factor 0.0 - 1.0"],["viewport","rw","bool",!1,"Use a viewport set with viewportChange()"],["width","rw","int",null,"Display area width"],["height","rw","int",null,"Display area height"],["render_mode","ro","str","","Canvas rendering mode (read-only)"],["prefer_js","rw","str",null,"Prefer Javascript over canvas methods"],["cursor_uri","rw","raw",null,"Can we render cursor using data URI"],["local_cursor","rw","bool",!0,"Show the local cursor rather than the remote one"],["browser_cursor_sprites","rw","bool",!0,"Show the server-equivalent cursor on the client side (using browser's built-in cursor images)"]]),c.get_context=function(){return d},c.set_scale=function(e){a(e)},c.set_width=function(e){c.resize(e,p)},c.get_width=function(){return f},c.set_height=function(e){c.resize(f,e)},c.get_height=function(){return p},a=function(e){var t,n,r,i,o=["transform","WebkitTransform","MozTransform",null];for(t=l.target,n=o.shift();n&&"undefined"==typeof t.style[n];)n=o.shift();return null===n?void VncHelper.Debug("No scaling support"):("undefined"==typeof e?e=l.scale:e>1?e=1:.1>e&&(e=.1),void(l.scale!==e&&(l.scale=e,r=t.width-t.width*e,i=t.height-t.height*e,t.style[n]="scale("+l.scale+") translate(-"+r+"px, -"+i+"px)")))},o=function(e){var t,n;t=l.true_color?e:l.colourMap[e[0]],n="rgb("+t[2]+","+t[1]+","+t[0]+")",n!==h&&(d.fillStyle=n,h=n)},c.viewportChange=function(e,t,n,r){var i,o,a,s,c,u,h,m=l.target,v=_,y=g,w=null;l.viewport||(VncHelper.Debug("Setting viewport to full display region"),e=-v.w,t=-v.h,n=f,r=p),"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=v.w),"undefined"==typeof r&&(r=v.h),n>f&&(n=f),r>p&&(r=p),(v.w!==n||v.h!==r)&&(n<v.w&&y.x2>v.x+n-1&&(y.x2=v.x+n-1),v.w=n,r<v.h&&y.y2>v.y+r-1&&(y.y2=v.y+r-1),v.h=r,v.w>0&&v.h>0&&m.width>0&&m.height>0&&(w=d.getImageData(0,0,m.width<v.w?m.width:v.w,m.height<v.h?m.height:v.h)),m.width=v.w,m.height=v.h,w&&d.putImageData(w,0,0)),s=v.x+v.w-1,c=v.y+v.h-1,0>e&&v.x+e<0&&(e=-v.x),s+e>=f&&(e-=s+e-f+1),v.y+t<0&&(t=-v.y),c+t>=p&&(t-=c+t-p+1),(0!==e||0!==t)&&(VncHelper.Debug("viewportChange deltaX: "+e+", deltaY: "+t),v.x+=e,s+=e,v.y+=t,c+=t,v.x>y.x1&&(y.x1=v.x),s<y.x2&&(y.x2=s),v.y>y.y1&&(y.y1=v.y),c<y.y2&&(y.y2=c),0>e?(o=0,u=-e):(o=v.w-e,u=e),0>t?(a=0,h=-t):(a=v.h-t,h=t),i=d.fillStyle,d.fillStyle="rgb(255,255,255)",0!==e&&(d.drawImage(m,0,0,v.w,v.h,-e,0,v.w,v.h),d.fillRect(o,0,u,v.h)),0!==t&&(d.drawImage(m,0,0,v.w,v.h,0,-t,v.w,v.h),d.fillRect(0,a,v.w,h)),d.fillStyle=i)},c.getCleanDirtyReset=function(){var e,t=_,n=g,r=[],i=t.x+t.w-1,o=t.y+t.h-1;return e={x:n.x1,y:n.y1,w:n.x2-n.x1+1,h:n.y2-n.y1+1},n.x1>=n.x2||n.y1>=n.y2?r.push({x:t.x,y:t.y,w:t.w,h:t.h}):(t.x<n.x1&&r.push({x:t.x,y:t.y,w:n.x1-t.x+1,h:t.h}),i>n.x2&&r.push({x:n.x2+1,y:t.y,w:i-n.x2,h:t.h}),t.y<n.y1&&r.push({x:n.x1,y:t.y,w:n.x2-n.x1+1,h:n.y1-t.y}),o>n.y2&&r.push({x:n.x1,y:n.y2+1,w:n.x2-n.x1+1,h:o-n.y2})),g={x1:t.x,y1:t.y,x2:t.x+t.w-1,y2:t.y+t.h-1},{cleanBox:e,dirtyBoxes:r}},c.absX=function(e){return e+_.x},c.absY=function(e){return e+_.y},c.resize=function(e,t){h="",f=e,p=t,a(l.scale),c.viewportChange()},c.clear=function(){l.logo?(c.resize(l.logo.width,l.logo.height),c.blitStringImage(l.logo.data,0,0)):(c.resize(640,20),d.clearRect(0,0,_.w,_.h)),u=[]},c.fillRect=function(e,t,n,r,i){o(i),d.fillRect(e-_.x,t-_.y,n,r)},c.copyImage=function(e,t,n,r,i,o){var a=e-_.x,s=t-_.y,c=n-_.x,u=r-_.y;d.drawImage(l.target,a,s,i,o,c,u,i,o)},c.startTile=function(e,t,n,r,i){var o,a,s,u,f,p;if(y=e,w=t,m=16===n&&16===r?v:d.createImageData(n,r),o=m.data,l.prefer_js)for(a=l.true_color?i:l.colourMap[i[0]],s=a[2],u=a[1],f=a[0],p=0;n*r*4>p;p+=4)o[p]=s,o[p+1]=u,o[p+2]=f,o[p+3]=255;else c.fillRect(e,t,n,r,i)},c.subTile=function(e,t,n,r,i){var o,a,s,d,u,f,p,_,g,h,v;if(l.prefer_js)for(o=m.data,p=m.width,s=l.true_color?i:l.colourMap[i[0]],d=s[2],u=s[1],f=s[0],h=e+n,v=t+r,_=t;v>_;_+=1)for(g=e;h>g;g+=1)a=4*(g+_*p),o[a]=d,o[a+1]=u,o[a+2]=f,o[a+3]=255;else c.fillRect(y+e,w+t,n,r,i)},c.finishTile=function(){l.prefer_js&&d.putImageData(m,y-_.x,w-_.y)},n=function(e,t,n,r,i,o,a,s){var c,l,u,f;for(c=d.createImageData(i,o),f=c.data,l=0,u=s;i*o*4>l;l+=4,u+=3)f[l]=a[u],f[l+1]=a[u+1],f[l+2]=a[u+2],f[l+3]=255;d.putImageData(c,e-n,t-r)},r=function(e,t,n,r,i,o,a,s){var c,l,u,f;for(c=d.createImageData(i,o),f=c.data,l=0,u=s;i*o*4>l;l+=4,u+=4)f[l]=a[u+2],f[l+1]=a[u+1],f[l+2]=a[u],f[l+3]=255;d.putImageData(c,e-n,t-r)},i=function(e,t,n,r,i,o,a,s){var c,u,f,p,_,g;for(c=d.createImageData(i,o),p=c.data,g=l.colourMap,u=0,f=s;i*o*4>u;u+=4,f+=1)_=g[a[f]],p[u]=_[2],p[u+1]=_[1],p[u+2]=_[0],p[u+3]=255;d.putImageData(c,e-n,t-r)},c.blitImage=function(e,t,n,o,a,s){l.true_color?r(e,t,_.x,_.y,n,o,a,s):i(e,t,_.x,_.y,n,o,a,s)},c.blitRgbImage=function(e,t,r,o,a,s){l.true_color?n(e,t,_.x,_.y,r,o,a,s):i(e,t,_.x,_.y,r,o,a,s)},c.blitStringImage=function(e,t,n){var r=new Image;r.onload=function(){d.drawImage(r,t-_.x,n-_.y)},r.src=e},c.drawImage=function(e,t,n){d.drawImage(e,t-_.x,n-_.y)},c.renderQ_push=function(e){u.push(e),1===u.length&&s()},s=function(){for(var e,t=!0;t&&u.length>0;){switch(e=u[0],e.type){case"copy":c.copyImage(e.old_x,e.old_y,e.x,e.y,e.width,e.height);break;case"fill":c.fillRect(e.x,e.y,e.width,e.height,e.color);break;case"blit":c.blitImage(e.x,e.y,e.width,e.height,e.data,0);break;case"blitRgb":c.blitRgbImage(e.x,e.y,e.width,e.height,e.data,0);break;case"img":e.img.complete?c.drawImage(e.img,e.x,e.y):t=!1}t&&(e=u.shift())}u.length>0&&requestAnimFrame(s)},c.changeCursor=function(e,t,n,r,i,o){VncHelper.Debug(">> changeCursor, x: "+n+", y: "+r+", w: "+i+", h: "+o+" pixels: "+e);var a=77;if(l.browser_cursor_sprites===!0){var s="default";if(i==a)switch(o){case 0:s="default";break;case 1:s="pointer";break;case 2:s="text";break;default:s="default"}return VncHelper.Debug("setting cursor to "+s),void(l.target.style.cursor=s)}return l.cursor_uri===!1?void VncHelper.Warn("changeCursor called but no cursor data URI support"):void(l.true_color?changeCursor(l.target,e,t,n,r,i,o):changeCursor(l.target,e,t,n,r,i,o,l.colourMap))},c.defaultCursor=function(){l.target.style.cursor="default"},t()}function changeCursor(e,t,n,r,i,o,a,s){var c,l,d,u,f,p,_,g,h,m,v=[],y=o,w=a;for(y>w?w=y:y=w,v.push16le=function(e){this.push(255&e,e>>8&255)},v.push32le=function(e){this.push(255&e,e>>8&255,e>>16&255,e>>24&255)},l=40,d=y*w*4,f=Math.ceil(y*w/8),u=Math.ceil(y*w/8),v.push16le(0),v.push16le(2),v.push16le(1),v.push(y),v.push(w),v.push(0),v.push(0),v.push16le(r),v.push16le(i),v.push32le(l+d+f+u),v.push32le(22),v.push32le(l),v.push32le(y),v.push32le(2*w),v.push16le(1),v.push16le(32),v.push32le(0),v.push32le(f+u),v.push32le(0),v.push32le(0),v.push32le(0),v.push32le(0),m=w-1;m>=0;m-=1)for(h=0;y>h;h+=1)h>=o||m>=a?(v.push(0),v.push(0),v.push(0),v.push(0)):(_=m*Math.ceil(o/8)+Math.floor(h/8),g=n[_]<<h%8&128?255:0,s?(_=o*m+h,c=s[t[_]],v.push(c[2]),v.push(c[1]),v.push(c[0]),v.push(g)):(_=4*(o*m+h),v.push(t[_+2]),v.push(t[_+1]),v.push(t[_]),v.push(g)));for(m=0;w>m;m+=1)for(h=0;h<Math.ceil(y/8);h+=1)v.push(0);for(m=0;w>m;m+=1)for(h=0;h<Math.ceil(y/8);h+=1)v.push(0);p="data:image/x-icon;base64,"+Base64.encode(v),VncHelper.Debug("<< changeCursor, raw_cursor: "+v+" data_uri: "+p),e.style.cursor="url("+p+") "+r+" "+i+", default"}function RFB(e){function t(){var e,t;for(VncHelper.Debug(">> RFB.constructor"),e=0;e<V.length;e+=1)H[V[e][1]]=H[V[e][0]],X[V[e][1]]=V[e][0],K[V[e][1]]=[0,0];try{j=new Display({target:R.target})}catch(n){VncHelper.Error("Display exception: "+n),a("fatal","No working Display")}return z=new Keyboard({frame:R.frame,target:R.focusContainer,onKeyPress:C}),Y=new Mouse({frame:R.frame,target:R.target,onMouseButton:E,onMouseMove:x,notify:z.sync}),t=j.get_render_mode(),W=new Websock,W.on("message",c),W.on("open",function(){"connect"===I?a("ProtocolVersion","Starting VNC handshake"):s("Got unexpected WebSockets connection")}),W.on("close",function(e){VncHelper.Warn("WebSocket on-close event");
var t="";e.code&&(t=" (code: "+e.code,e.reason&&(t+=", reason: "+e.reason),t+=")"),"disconnect"===I?a("disconnected","VNC disconnected"+t):"ProtocolVersion"===I?s("Failed to connect to server"+t):I in{failed:1,disconnected:1}?VncHelper.Error("Received onclose while disconnected"+t):s("Server disconnected"+t)}),W.on("error",function(e){VncHelper.Warn("WebSocket on-error event")}),o(),Websock_native?(VncHelper.Info("Using native WebSockets"),a("loaded","noVNC ready: native WebSockets, "+t)):(VncHelper.Warn("Using web-socket-js bridge. Flash version: "+VncHelper.getFlashVer().version),!VncHelper.getFlashVer()||VncHelper.getFlashVer().version<9?a("fatal","WebSockets or <a href='http://get.adobe.com/flashplayer'>Adobe Flash</a> is required"):"file://"===document.location.href.substr(0,7)?a("fatal","'file://' URL is incompatible with Adobe Flash"):a("loaded","noVNC ready: WebSockets emulation, "+t)),VncHelper.Debug("<< RFB.constructor"),T}function n(){VncHelper.Debug(">> RFB.connect");var e;e="undefined"!=typeof UsingSocketIO?"http":R.encrypt?"wss":"ws",e+="://"+D,L&&(e+=":"+L),e+="/"+U,VncHelper.Info("connecting to "+e),W.open(e,R.wsProtocols),VncHelper.Debug("<< RFB.connect")}function r(e,t){var n,r=[];for(n=0;n<e.length;n+=1)r.push(e.charCodeAt(n));return new DES(r).encrypt(t)}function i(e){1===$&&s("Tight protocol handler only implements true color mode");var t,n,r,i,o,a,c=-1,l=0,d=-1,u=W.get_rQ(),f=W.get_rQi();if(J.bytes=1,W.rQwait("TIGHT compression-control",J.bytes))return!1;var p=function(e){for(var t=0;4>t;t++)l>>t&1&&(J.zlibs[t].reset(),VncHelper.Info("Reset zlib stream "+t));var n=J.zlibs[d].uncompress(e,0);return 0!==n.status&&VncHelper.Error("Invalid data in zlib stream"),n.data},_=function(e,t,n,r,i){var o,a,s,c,l,d,u,f=[];if(2===t)for(c=Math.floor((r+7)/8),l=Math.floor(r/8),a=0;i>a;a++){for(o=0;l>o;o++)for(s=7;s>=0;s--)d=3*(a*r+8*o+7-s),u=3*(e[a*c+o]>>s&1),f[d]=n[u],f[d+1]=n[u+1],f[d+2]=n[u+2];for(s=7;s>=8-r%8;s--)d=3*(a*r+8*o+7-s),u=3*(e[a*c+o]>>s&1),f[d]=n[u],f[d+1]=n[u+1],f[d+2]=n[u+2]}else for(a=0;i>a;a++)for(o=0;r>o;o++)d=3*(a*r+o),u=3*e[a*r+o],f[d]=n[u],f[d+1]=n[u+1],f[d+2]=n[u+2];return f},g=function(){var e=u[f+2]+1,t=e*$;if(J.bytes+=t,W.rQwait("TIGHT palette "+n,J.bytes))return!1;var i=2>=e?1:8,o=Math.floor((J.width*i+7)/8),s=!1;if(o*J.height<12?(s=!0,r=[0,o*J.height]):r=k(W.rQslice(3+t,3+t+3)),J.bytes+=r[0]+r[1],W.rQwait("TIGHT "+n,J.bytes))return!1;W.rQshiftBytes(3);var c=W.rQshiftBytes(t);W.rQshiftBytes(r[0]),a=s?W.rQshiftBytes(r[1]):p(W.rQshiftBytes(r[1]));var l=_(a,e,c,J.width,J.height);return j.renderQ_push({type:"blitRgb",data:l,x:J.x,y:J.y,width:J.width,height:J.height}),!0},h=function(){var e=!1,t=J.width*J.height*$;return 12>t?(e=!0,r=[0,t]):r=k(W.rQslice(1,4)),J.bytes=1+r[0]+r[1],W.rQwait("TIGHT "+n,J.bytes)?!1:(W.rQshiftBytes(1+r[0]),a=e?W.rQshiftBytes(r[1]):p(W.rQshiftBytes(r[1])),j.renderQ_push({type:"blitRgb",data:a,x:J.x,y:J.y,width:J.width,height:J.height}),!0)};if(t=W.rQpeek8(),l=15&t,t>>=4,d=3&t,8===t)n="fill";else if(9===t)n="jpeg";else if(10===t)n="png";else if(4&t)n="filter";else{if(!(4>t))return s("Illegal tight compression received, ctl: "+t);n="copy"}if(e&&("filter"===n||"copy"===n))return s("filter/copy received in tightPNG mode");switch(n){case"fill":J.bytes+=$;break;case"jpeg":J.bytes+=3;break;case"png":J.bytes+=3;break;case"filter":J.bytes+=2;break;case"copy":}if(W.rQwait("TIGHT "+n,J.bytes))return!1;switch(n){case"fill":W.rQshift8(),i=W.rQshiftBytes($),j.renderQ_push({type:"fill",x:J.x,y:J.y,width:J.width,height:J.height,color:[i[2],i[1],i[0]]});break;case"png":case"jpeg":if(r=k(W.rQslice(1,4)),J.bytes=1+r[0]+r[1],W.rQwait("TIGHT "+n,J.bytes))return!1;W.rQshiftBytes(1+r[0]),o=new Image,o.src="data:image/"+n+S(W.rQshiftBytes(r[1])),j.renderQ_push({type:"img",img:o,x:J.x,y:J.y}),o=null;break;case"filter":if(c=u[f+1],1!==c)throw"Unsupported tight subencoding received, filter: "+c;if(!g())return!1;break;case"copy":if(!h())return!1}return J.bytes=0,J.rects-=1,!0}var o,a,s,c,l,d,u,f,p,_,g,h,m,v,y,w,b,k,S,C,E,x,A,T={},R={},D="",L=5900,P="",U="",I="disconnected",O=0,B=3.8,M="",N=!1,F=0,V=[["COPYRECT",1],["TIGHT",7],["TIGHT_PNG",-260],["HEXTILE",5],["RRE",2],["RAW",0],["DesktopSize",-223],["Cursor",-239],["Fence",-312],["ContinuousUpdates",-313],["JPEG_quality_med",-26],["compress_hi",-247],["last_rect",-224]],H={},X={},K={},W=null,j=null,z=null,Y=null,Q=null,G=null,q=null,J={rects:0,subrects:0,lines:0,tiles:0,bytes:0,x:0,y:0,width:0,height:0,encoding:0,subencoding:-1,background:null,zlibs:[]},Z=4,$=3,ee=0,te=0,ne="",re=100,ie={last_fbu:0,fbu_total:0,fbu_total_cnt:0,full_fbu_total:0,full_fbu_cnt:0,fbu_rt_start:0,fbu_rt_total:0,fbu_rt_cnt:0,pixels:0},oe=!1,ae=!0,se=!1,ce=!1,le=0,de=[],ue=!1,fe={};return VncHelper.conf_defaults(R,T,e,[["frame","wo","dom",window,"The frame window that contains the VNC canvas object"],["target","wo","dom",null,"VNC display rendering Canvas object"],["focusContainer","wo","dom",document,"DOM element that captures keyboard input"],["encrypt","rw","bool",!1,"Use TLS/SSL/wss encryption"],["true_color","rw","bool",!0,"Request true color pixel data"],["local_cursor","rw","bool",!1,"Request locally rendered cursor"],["shared","rw","bool",!0,"Request shared mode"],["view_only","rw","bool",!1,"Disable client mouse/keyboard"],["xvp_password_sep","rw","str","@","Separator for XVP password fields"],["disconnectTimeout","rw","int",3,"Time (s) to wait for disconnection"],["wsProtocols","rw","arr",["binary","base64"],"Protocols to use in the WebSocket connection"],["repeaterID","rw","str","","RepeaterID to connect to"],["viewportDrag","rw","bool",!1,"Move the viewport on mouse drags"],["onUpdateState","rw","func",function(){},"onUpdateState(rfb, state, oldstate, statusMsg): RFB state update/change "],["onContinuousUpdateSetup","rw","func",function(){},"onContinuousUpdateSetup(rfb): Continuous update negotiation setup. "],["onPasswordRequired","rw","func",function(){},"onPasswordRequired(rfb): VNC password is required "],["onClipboard","rw","func",function(){},"onClipboard(rfb, text): RFB clipboard contents received"],["onBell","rw","func",function(){},"onBell(rfb): RFB Bell message received "],["onFBUReceive","rw","func",function(){},"onFBUReceive(rfb, fbu): RFB FBU received but not yet processed "],["onFBUComplete","rw","func",function(){},"onFBUComplete(rfb, fbu): RFB FBU received and processed "],["onFBResize","rw","func",function(){},"onFBResize(rfb, width, height): frame buffer resized"],["onDesktopName","rw","func",function(){},"onDesktopName(rfb, name): desktop name received"],["onXvpInit","rw","func",function(){},"onXvpInit(version): XVP extensions active for this connection"],["onUserInteraction","rw","func",function(){},"onUserInteraction(): When user starts to click mouse."],["updateState","rw","func",function(){},"obsolete, use onUpdateState"],["clipboardReceive","rw","func",function(){},"obsolete, use onClipboard"]]),T.set_local_cursor=function(e){!e||e in{0:1,no:1,"false":1}?R.local_cursor=!1:j.get_cursor_uri()?R.local_cursor=!0:VncHelper.Warn("Browser does not support local cursor")},T.get_display=function(){return j},T.get_keyboard=function(){return z},T.get_mouse=function(){return Y},o=function(){var e;for(W.init(),J.rects=0,J.subrects=0,J.lines=0,J.tiles=0,J.zlibs=[],le=0,de=[],e=0;e<V.length;e+=1)K[V[e][1]][0]=0;for(e=0;4>e;e++)J.zlibs[e]=new TINF,J.zlibs[e].init()},f=function(){var e,t;for(VncHelper.Info("Encoding stats for this connection:"),e=0;e<V.length;e+=1)t=K[V[e][1]],t[0]+t[1]>0&&VncHelper.Info("    "+V[e][0]+": "+t[0]+" rects");for(VncHelper.Info("Encoding stats since page load:"),e=0;e<V.length;e+=1)t=K[V[e][1]],t[0]+t[1]>0&&VncHelper.Info("    "+V[e][0]+": "+t[1]+" rects")},a=function(e,t){var r,i,s=I;if(e===s)return void VncHelper.Debug("Already in state '"+e+"', ignoring.");switch(e in{disconnected:1,loaded:1,connect:1,disconnect:1,failed:1,fatal:1}&&(Q&&(clearInterval(Q),Q=null),q&&(clearTimeout(q),q=null),j&&j.get_context()&&(z.ungrab(),Y.ungrab(),j.defaultCursor(),("debug"!==VncHelper.get_logging()||"loaded"===e)&&j.clear()),W.close()),"fatal"===s&&VncHelper.Error("Fatal error, cannot continue"),r="failed"===e||"fatal"===e?VncHelper.Error:VncHelper.Info,i="undefined"!=typeof t?" Msg: "+t:"",r("New state '"+e+"', was '"+s+"'."+i),I="failed"===s&&"disconnected"===e?"failed":e,G&&"disconnect"!==I&&(VncHelper.Debug("Clearing disconnect timer"),clearTimeout(G),G=null),e){case"normal":("disconnected"===s||"failed"===s)&&VncHelper.Error("Invalid transition from 'disconnected' or 'failed' to 'normal'");break;case"connect":o(),n();break;case"disconnect":f();break;case"failed":"disconnected"===s&&VncHelper.Error("Invalid transition from 'disconnected' to 'failed'"),"normal"===s&&VncHelper.Error("Error while connected."),"init"===s&&VncHelper.Error("Error while initializing."),setTimeout(function(){a("disconnected")},50)}"failed"===s&&"disconnected"===e?(R.updateState(T,e,s),R.onUpdateState(T,e,s)):(R.updateState(T,e,s,t),R.onUpdateState(T,e,s,t))},s=function(e){return a("failed",e),!1},c=function(){if(0===W.rQlen())return void VncHelper.Warn("handle_message called on empty receive queue");switch(I){case"disconnected":case"failed":VncHelper.Error("Got data while disconnected");break;case"normal":d()&&W.rQlen()>0&&(null===q?(VncHelper.Debug("More data to process, creating timer"),q=setTimeout(function(){q=null,c()},10)):VncHelper.Debug("More data to process, existing timer"));break;default:l()}},A=function(){"normal"===I&&!ue&&de.length>0&&(W.send(de),de=[])},C=function(e,t){R.view_only||W.send(m(e,t))},E=function(e,t,n,r,i){if(i&&(le=0),n?(le|=r,R.onUserInteraction&&R.onUserInteraction()):le^=r,R.viewportDrag){if(n&&!ue)return ue=!0,void(fe={x:e,y:t});ue=!1}R.view_only||(de=de.concat(v(j.absX(e),j.absY(t))),W.send(de),de=[])},x=function(e,t){var n,r;return ue?(n=fe.x-e,r=fe.y-t,fe={x:e,y:t},void j.viewportChange(n,r)):void(R.view_only||(de=de.concat(v(j.absX(e),j.absY(t))),A()))},l=function(){var e,t,n,i,o,c,d,u,f,g,m,v,y,w,b,k,S,C,E,x,D,L,U,F,V,H;switch(I){case"ProtocolVersion":if(W.rQlen()<12)return s("Incomplete protocol version");switch(i=W.rQshiftStr(12).substr(4,7),VncHelper.Info("Server ProtocolVersion: "+i),U=0,i){case"000.000":U=1;break;case"003.003":O=3.3;break;case"003.006":O=3.3;break;case"003.889":O=3.3;break;case"003.007":O=3.7;break;case"003.008":O=3.8;break;case"004.000":O=3.8;break;case"004.001":O=3.8;break;default:return s("Invalid server version "+i)}if(U){for(c=R.repeaterID;c.length<250;)c+="\x00";W.send_string(c);break}O>B&&(O=B),oe||(Q=setInterval(function(){W.flush()},50)),o="00"+parseInt(O,10)+".00"+10*O%10,W.send_string("RFB "+o+"\n"),a("Security","Sent ProtocolVersion: "+o);break;case"Security":if(O>=3.7){if(f=W.rQshift8(),W.rQwait("security type",f,1))return!1;if(0===f)return e=W.rQshift32(),t=W.rQshiftStr(e),s("Security failure: "+t);for(M=0,u=W.rQshiftBytes(f),VncHelper.Debug("Server security types: "+u),d=0;d<u.length;d+=1)u[d]>M&&(u[d]<=16||22==u[d])&&(M=u[d]);if(0===M)return s("Unsupported security types: "+u);W.send([M])}else{if(W.rQwait("security scheme",4))return!1;M=W.rQshift32()}a("Authentication","Authenticating using scheme: "+M),l();break;case"Authentication":switch(M){case 0:return W.rQwait("auth reason",4)?!1:(e=W.rQshift32(),t=W.rQshiftStr(e),s("Auth failure: "+t));case 1:if(O>=3.8)return void a("SecurityResult");break;case 22:if(F=R.xvp_password_sep,V=P.split(F),V.length<3)return a("password","XVP credentials required (user"+F+"target"+F+"password) -- got only "+P),void R.onPasswordRequired(T);H=String.fromCharCode(V[0].length)+String.fromCharCode(V[1].length)+V[0]+V[1],W.send_string(H),P=V.slice(2).join(F),M=2;case 2:return 0===P.length?(a("password","Password Required"),void R.onPasswordRequired(T)):W.rQwait("auth challenge",16)?!1:(g=W.rQshiftBytes(16),m=r(P,g),W.send(m),void a("SecurityResult"));case 16:if(W.rQwait("num tunnels",4))return!1;var X=W.rQshift32();if(N=!0,0!=X)return void s("Protocol requested tunnels, not currently supported. numTunnels: "+X);var K={STDVNOAUTH__:1,STDVVNCAUTH_:2},G=[];if(W.rQwait("sub auth count",4))return!1;for(var q=W.rQshift32(),d=0;q>d;d++){if(W.rQwait("sub auth capabilities "+d,16))return!1;var J=(W.rQshift32(),W.rQshiftStr(12));G.push(J)}for(var re in K)if(-1!=G.indexOf(re))switch(W.send([0,0,0,K[re]]),re){case"STDVNOAUTH__":return void a("SecurityResult");case"STDVVNCAUTH_":return M=2,void l();default:return void s("Unsupported tiny auth scheme: "+re)}return;default:return void s("Unsupported auth scheme: "+M)}a("ClientInitialisation","No auth required"),l();break;case"SecurityResult":if(W.rQwait("VNC auth response ",4))return!1;switch(W.rQshift32()){case 0:break;case 1:if(O>=3.8){if(n=W.rQshift32(),W.rQwait("SecurityResult reason",n,8))return!1;t=W.rQshiftStr(n),s(t)}else s("Authentication failed");return;case 2:return s("Too many auth attempts")}a("ClientInitialisation","Authentication OK"),l();break;case"ClientInitialisation":W.send([R.shared?1:0]),a("ServerInitialisation","Authentication OK");break;case"ServerInitialisation":if(W.rQwait("server initialization",24))return!1;if(ee=W.rQshift16(),te=W.rQshift16(),v=W.rQshift8(),y=W.rQshift8(),w=W.rQshift8(),D=W.rQshift8(),b=W.rQshift16(),k=W.rQshift16(),S=W.rQshift16(),C=W.rQshift8(),E=W.rQshift8(),x=W.rQshift8(),W.rQshiftStr(3),VncHelper.Info("Screen: "+ee+"x"+te+", bpp: "+v+", depth: "+y+", big_endian: "+w+", true_color: "+D+", red_max: "+b+", green_max: "+k+", blue_max: "+S+", red_shift: "+C+", green_shift: "+E+", blue_shift: "+x),0!==w&&VncHelper.Warn("Server native endian is not little endian"),16!==C&&VncHelper.Warn("Server native red-shift is not 16"),0!==x&&VncHelper.Warn("Server native blue-shift is not 0"),L=W.rQshift32(),ne=VncHelper.decodeUTF8(W.rQshiftStr(L)),R.onDesktopName(T,ne),R.true_color&&"Intel(r) AMT KVM"===ne&&(VncHelper.Warn("Intel AMT KVM only support 8/16 bit depths. Disabling true color"),R.true_color=!1),N){var ae=W.rQshift16(),se=W.rQshift16(),ce=W.rQshift16();W.rQshift16();for(var d=0;ae>d;d++){W.rQshiftStr(16)}for(var d=0;se>d;d++){W.rQshiftStr(16)}for(var d=0;ce>d;d++){W.rQshiftStr(16)}}j.set_true_color(R.true_color),R.onFBResize(T,ee,te),j.resize(ee,te),z.grab(),Y.grab(),R.true_color?(Z=4,$=3):(Z=1,$=1),m=p(),m=m.concat(_()),m=m.concat(h()),ie.fbu_rt_start=(new Date).getTime(),ie.pixels=0,W.send(m),A(),R.encrypt?a("normal","Connected (encrypted) to: "+ne):a("normal","Connected (unencrypted) to: "+ne)}},d=function(){var e,t,n,r,i,o,c,l,d,f,p,_,g,m=!0;switch(e=J.rects>0?0:W.rQshift8()){case 0:m=u(),se||m&&!ce&&W.send(h()),m&&ae&&(ae=!1,W.send(b(-2147483644)));break;case 1:if(VncHelper.Debug("SetColourMapEntries"),W.rQshift8(),c=W.rQshift16(),l=W.rQshift16(),W.rQwait("SetColourMapEntries",6*l,6))return!1;for(o=0;l>o;o+=1)d=W.rQshift16(),d=parseInt(d/256,10),f=parseInt(W.rQshift16()/256,10),p=parseInt(W.rQshift16()/256,10),j.set_colourMap([p,f,d],c+o);VncHelper.Debug("colourMap: "+j.get_colourMap()),VncHelper.Info("Registered "+l+" colourMap entries");break;case 2:VncHelper.Debug("Bell"),R.onBell(T);break;case 3:if(VncHelper.Debug("ServerCutText"),W.rQwait("ServerCutText header",7,1))return!1;if(W.rQshiftBytes(3),t=W.rQshift32(),W.rQwait("ServerCutText",t,8))return!1;n=W.rQshiftStr(t),R.clipboardReceive(T,n),R.onClipboard(T,n);break;case 248:if(W.rQwait("Fence",31,1))return!1;if(W.rQshiftBytes(3),r=W.rQshift32(),i=W.rQshiftBytes(24),2147483648&r){r=3&r,W.send(b(r,i));break}4&r&&(se=!0,W.send(w(!0,0,0,ee,te)),R.onContinuousUpdateSetup&&R.onContinuousUpdateSetup(T));break;case 250:switch(W.rQshift8(),_=W.rQshift8(),g=W.rQshift8()){case 0:a(I,"Operation failed");break;case 1:F=_,VncHelper.Info("XVP extensions enabled (version "+F+")"),R.onXvpInit(F);break;default:s("Disconnected: illegal server XVP message "+g)}break;default:s("Disconnected: illegal server message type "+e),VncHelper.Debug("ws.rQslice(0,30):"+W.rQslice(0,30))}return m},u=function(){var e,t,n,r=!0;if(0===J.rects){if(W.rQwait("FBU header",3))return W.rQunshift8(0),!1;W.rQshift8(),J.rects=W.rQshift16(),J.bytes=0,ie.cur_fbu=0,ie.fbu_rt_start>0&&(e=(new Date).getTime(),VncHelper.Info("First FBU latency: "+(e-ie.fbu_rt_start)))}for(;J.rects>0;){if("normal"!==I)return!1;if(W.rQwait("FBU",J.bytes))return!1;if(0===J.bytes){if(W.rQwait("rect header",12))return!1;if(t=W.rQshiftBytes(12),J.x=(t[0]<<8)+t[1],J.y=(t[2]<<8)+t[3],J.width=(t[4]<<8)+t[5],J.height=(t[6]<<8)+t[7],J.encoding=parseInt((t[8]<<24)+(t[9]<<16)+(t[10]<<8)+t[11],10),R.onFBUReceive(T,{x:J.x,y:J.y,width:J.width,height:J.height,encoding:J.encoding,encodingName:X[J.encoding]}),!X[J.encoding])return s("Disconnected: unsupported encoding "+J.encoding),!1}if(ie.last_fbu=(new Date).getTime(),r=H[J.encoding](),e=(new Date).getTime(),ie.cur_fbu+=e-ie.last_fbu,r&&(K[J.encoding][0]+=1,K[J.encoding][1]+=1,ie.pixels+=J.width*J.height),ie.pixels>=ee*te&&((J.width===ee&&J.height===te||ie.fbu_rt_start>0)&&(ie.full_fbu_total+=ie.cur_fbu,ie.full_fbu_cnt+=1,VncHelper.Info("Timing of full FBU, cur: "+ie.cur_fbu+", total: "+ie.full_fbu_total+", cnt: "+ie.full_fbu_cnt+", avg: "+ie.full_fbu_total/ie.full_fbu_cnt)),ie.fbu_rt_start>0&&(n=e-ie.fbu_rt_start,ie.fbu_rt_total+=n,ie.fbu_rt_cnt+=1,VncHelper.Info("full FBU round-trip, cur: "+n+", total: "+ie.fbu_rt_total+", cnt: "+ie.fbu_rt_cnt+", avg: "+ie.fbu_rt_total/ie.fbu_rt_cnt),ie.fbu_rt_start=0)),!r)return r}return R.onFBUComplete(T,{x:J.x,y:J.y,width:J.width,height:J.height,encoding:J.encoding,encodingName:X[J.encoding]}),!0},H.RAW=function(){var e,t;return 0===J.lines&&(J.lines=J.height),J.bytes=J.width*Z,W.rQwait("RAW",J.bytes)?!1:(e=J.y+(J.height-J.lines),t=Math.min(J.lines,Math.floor(W.rQlen()/(J.width*Z))),j.blitImage(J.x,e,J.width,t,W.get_rQ(),W.get_rQi()),W.rQshiftBytes(J.width*t*Z),J.lines-=t,J.lines>0?J.bytes=J.width*Z:(J.rects-=1,J.bytes=0),!0)},H.COPYRECT=function(){return J.bytes=4,W.rQwait("COPYRECT",4)?!1:(j.renderQ_push({type:"copy",old_x:W.rQshift16(),old_y:W.rQshift16(),x:J.x,y:J.y,width:J.width,height:J.height}),J.rects-=1,J.bytes=0,!0)},H.RRE=function(){var e,t,n,r,i,o;if(0===J.subrects){if(J.bytes=4+Z,W.rQwait("RRE",4+Z))return!1;J.subrects=W.rQshift32(),e=W.rQshiftBytes(Z),j.fillRect(J.x,J.y,J.width,J.height,e)}for(;J.subrects>0&&W.rQlen()>=Z+8;)e=W.rQshiftBytes(Z),t=W.rQshift16(),n=W.rQshift16(),r=W.rQshift16(),i=W.rQshift16(),j.fillRect(J.x+t,J.y+n,r,i,e),J.subrects-=1;return J.subrects>0?(o=Math.min(re,J.subrects),J.bytes=(Z+8)*o):(J.rects-=1,J.bytes=0),!0},H.HEXTILE=function(){var e,t,n,r,i,o,a,c,l,d,u,f,p,_,g,h,m,v=W.get_rQ(),y=W.get_rQi();for(0===J.tiles&&(J.tiles_x=Math.ceil(J.width/16),J.tiles_y=Math.ceil(J.height/16),J.total_tiles=J.tiles_x*J.tiles_y,J.tiles=J.total_tiles);J.tiles>0;){if(J.bytes=1,W.rQwait("HEXTILE subencoding",J.bytes))return!1;if(e=v[y],e>30)return s("Disconnected: illegal hextile subencoding "+e),!1;if(t=0,r=J.total_tiles-J.tiles,i=r%J.tiles_x,c=Math.floor(r/J.tiles_x),o=J.x+16*i,l=J.y+16*c,a=Math.min(16,J.x+J.width-o),d=Math.min(16,J.y+J.height-l),1&e)J.bytes+=a*d*Z;else if(2&e&&(J.bytes+=Z),4&e&&(J.bytes+=Z),8&e){if(J.bytes+=1,W.rQwait("hextile subrects header",J.bytes))return!1;t=v[y+J.bytes-1],16&e?J.bytes+=t*(Z+2):J.bytes+=2*t}if(W.rQwait("hextile",J.bytes))return!1;if(J.subencoding=v[y],y+=1,0===J.subencoding)1&J.lastsubencoding?VncHelper.Debug("     Ignoring blank after RAW"):j.fillRect(o,l,a,d,J.background);else if(1&J.subencoding)j.blitImage(o,l,a,d,v,y),y+=J.bytes-1;else{if(2&J.subencoding&&(J.background=v.slice(y,y+Z),y+=Z),4&J.subencoding&&(J.foreground=v.slice(y,y+Z),y+=Z),j.startTile(o,l,a,d,J.background),8&J.subencoding)for(t=v[y],y+=1,f=0;t>f;f+=1)16&J.subencoding?(n=v.slice(y,y+Z),y+=Z):n=J.foreground,u=v[y],y+=1,p=u>>4,_=15&u,g=v[y],y+=1,h=(g>>4)+1,m=(15&g)+1,j.subTile(p,_,h,m,n);j.finishTile()}W.set_rQi(y),J.lastsubencoding=J.subencoding,J.bytes=0,J.tiles-=1}return 0===J.tiles&&(J.rects-=1),!0},k=function(e){var t=1,n=0;return n+=127&e[0],128&e[0]&&(t+=1,n+=(127&e[1])<<7,128&e[1]&&(t+=1,n+=e[2]<<14)),[t,n]},S=function(e){return";base64,"+Base64.encode(e)},H.TIGHT=function(){return i(!1)},H.TIGHT_PNG=function(){return i(!0)},H.last_rect=function(){return J.rects=0,!0},H.DesktopSize=function(){return VncHelper.Debug(">> set_desktopsize"),ee=J.width,te=J.height,R.onFBResize(T,ee,te),j.resize(ee,te),ie.fbu_rt_start=(new Date).getTime(),J.bytes=0,J.rects-=1,VncHelper.Debug("<< set_desktopsize"),!0},H.Cursor=function(){var e,t,n,r,i,o;return VncHelper.Debug(">> set_cursor"),e=J.x,t=J.y,n=J.width,r=J.height,i=n*r*Z,o=Math.floor((n+7)/8)*r,J.bytes=i+o,W.rQwait("cursor encoding",J.bytes)?!1:(j.changeCursor(W.rQshiftBytes(i),W.rQshiftBytes(o),e,t,n,r),J.bytes=0,J.rects-=1,VncHelper.Debug("<< set_cursor"),!0)},H.JPEG_quality_lo=function(){VncHelper.Error("Server sent jpeg_quality pseudo-encoding")},H.compress_lo=function(){VncHelper.Error("Server sent compress level pseudo-encoding")},p=function(){var e;return e=[0],e.push8(0),e.push8(0),e.push8(0),e.push8(8*Z),e.push8(8*$),e.push8(0),e.push8(R.true_color?1:0),e.push16(255),e.push16(255),e.push16(255),e.push8(16),e.push8(8),e.push8(0),e.push8(0),e.push8(0),e.push8(0),e},_=function(){var e,t,n=[];for(t=0;t<V.length;t+=1)"Cursor"!==V[t][0]||R.local_cursor?"TIGHT"!==V[t][0]||R.true_color?n.push(V[t][1]):VncHelper.Warn("Skipping tight, only support with true color"):VncHelper.Debug("Skipping Cursor pseudo-encoding");for(e=[2],e.push8(0),e.push16(n.length),t=0;t<n.length;t+=1)e.push32(n[t]);return e},g=function(e,t,n,r,i){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=ee),"undefined"==typeof i&&(i=te);var o;return o=[3],o.push8(e),o.push16(t),o.push16(n),o.push16(r),o.push16(i),o},h=function(){var e,t,n,r=j.getCleanDirtyReset(),i=[];for(t=r.cleanBox,t.w>0&&t.h>0&&(i=i.concat(g(1,t.x,t.y,t.w,t.h))),e=0;e<r.dirtyBoxes.length;e++)n=r.dirtyBoxes[e],i=i.concat(g(0,n.x,n.y,n.w,n.h));return i},m=function(e,t){var n;return n=[4],n.push8(t),n.push16(0),n.push32(e),n},v=function(e,t){var n;return n=[5],n.push8(le),n.push16(e),n.push16(t),n},y=function(e){var t,n,r;for(t=[6],t.push8(0),t.push8(0),t.push8(0),t.push32(e.length),r=e.length,n=0;r>n;n+=1)t.push(e.charCodeAt(n));return t},w=function(e,t,n,r,i){var o;return o=[150],o.push8(e?1:0),o.push16(t),o.push16(n),o.push16(r),o.push16(i),o},b=function(e,t){var n,r,i=24;if(r=[248],r.push8(0),r.push8(0),r.push8(0),r.push32(e),t&&t.length<=i)for(i-=t.length,n=0;n<t.length;n+=1)r.push8(t[n]);for(n=0;i>n;n+=1)r.push8(0);return r},T.connect=function(e,t,n,r){return D=e,L=t,P=void 0!==n?n:"",U=void 0!==r?r:"",D?void a("connect"):s("Must set host")},T.disconnect=function(){a("disconnect","Disconnecting")},T.togglePause=function(e){e!==ce&&(W.send(w(!e,0,0,ee,te)),ce=e)},T.sendPassword=function(e){P=e,I="Authentication",setTimeout(l,1)},T.sendCtrlAltDel=function(){if("normal"!==I||R.view_only)return!1;VncHelper.Info("Sending Ctrl-Alt-Del");var e=[];e=e.concat(m(65507,1)),e=e.concat(m(65513,1)),e=e.concat(m(65535,1)),e=e.concat(m(65535,0)),e=e.concat(m(65513,0)),e=e.concat(m(65507,0)),W.send(e)},T.xvpOp=function(e,t){return e>F?!1:(VncHelper.Info("Sending XVP operation "+t+" (version "+e+")"),W.send_string("Ãº\x00"+String.fromCharCode(e)+String.fromCharCode(t)),!0)},T.xvpShutdown=function(){return T.xvpOp(1,2)},T.xvpReboot=function(){return T.xvpOp(1,3)},T.xvpReset=function(){return T.xvpOp(1,4)},T.sendKey=function(e,t){if("normal"!==I||R.view_only)return!1;var n=[];"undefined"!=typeof t?(VncHelper.Info("Sending key code ("+(t?"down":"up")+"): "+e),n=n.concat(m(e,t?1:0))):(VncHelper.Info("Sending key code (down + up): "+e),n=n.concat(m(e,1)),n=n.concat(m(e,0))),W.send(n)},T.clipboardPasteFrom=function(e){"normal"===I&&W.send(y(e))},T.testMode=function(e,t){oe=!0,T.recv_message=W.testMode(e,t),A=function(){},T.connect=function(e,t,n){D=e,L=t,P=n,o(),a("ProtocolVersion","Starting VNC handshake")}},t()}function JSUnzip(){this.getInt=function(e,t){switch(t){case 4:return(255&this.data.charCodeAt(e+3))<<24|(255&this.data.charCodeAt(e+2))<<16|(255&this.data.charCodeAt(e+1))<<8|255&this.data.charCodeAt(e+0);case 2:return(255&this.data.charCodeAt(e+1))<<8|255&this.data.charCodeAt(e+0);default:return 255&this.data.charCodeAt(e)}},this.getDOSDate=function(e,t){var n=31&e,r=(e>>5&15)-1,i=1980+(e>>9&127),o=2*(31&t),a=t>>5&63;return hour=t>>11&31,new Date(i,r,n,hour,a,o)},this.open=function(e){if(this.data=e,this.files=[],this.data.length<22)return{status:!1,error:"Invalid data"};for(var t=this.data.length-22;t>=0&&101010256!=this.getInt(t,4);)--t;if(0>t)return{status:!1,error:"Invalid data"};if(0!=this.getInt(t+4,2)||0!=this.getInt(t+6,2))return{status:!1,error:"No multidisk support"};var n=this.getInt(t+8,2),r=this.getInt(t+16,4),i=this.getInt(t+20,2);this.comment=this.data.slice(t+22,t+22+i);for(var o=r,a=0;n>a;++a){if(33639248!=this.getInt(o+0,4))return{status:!1,error:"Invalid data"};if(this.getInt(o+6,2)>20)return{status:!1,error:"Unsupported version"};if(1&this.getInt(o+8,2))return{status:!1,error:"Encryption not implemented"};var s=this.getInt(o+10,2);if(0!=s&&8!=s)return{status:!1,error:"Unsupported compression method"};var c=this.getInt(o+12,2),l=this.getInt(o+14,2),d=this.getDOSDate(l,c),u=(this.getInt(o+16,4),this.getInt(o+20,4)),f=this.getInt(o+24,4),p=this.getInt(o+28,2),_=this.getInt(o+30,2),g=this.getInt(o+32,2),h=this.getInt(o+42,4),m=this.data.slice(o+46,o+46+p),v=this.data.slice(o+46+p+_,o+46+p+_+g);if(67324752!=this.getInt(h+0,4))return{status:!1,error:"Invalid data"};var y=this.getInt(h+26,2),w=this.getInt(h+28,2),b=h+30+y+w;this.files[m]={fileComment:v,compressionMethod:s,compressedSize:u,uncompressedSize:f,localFileContent:b,lastModifiedDate:d},o+=46+p+_+g}return{status:!0}},this.read=function(e){var t=this.files[e];if(t){if(8==t.compressionMethod){tinf||(tinf=new TINF,tinf.init());var n=tinf.uncompress(this.data,t.localFileContent);return n.status==tinf.OK?{status:!0,data:n.data}:{status:!1,error:n.error}}return{status:!0,data:this.data.slice(t.localFileContent,t.localFileContent+t.uncompressedSize)}}return{status:!1,error:"File '"+e+"' doesn't exist in zip"}}}function TINF(){function e(e,t,n,r,i){for(var o=0;24>t;)n|=(255&e[r++])<<t,t+=8;return o=n&65535>>16-i,n>>=i,t-=i,[t,n,r,o]}this.OK=0,this.DATA_ERROR=-3,this.WINDOW_SIZE=32768,this.TREE=function(){this.table=new Array(16),this.trans=new Array(288)},this.DATA=function(e){this.source="",this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=[],this.history=[],this.ltree=new e.TREE,this.dtree=new e.TREE},this.sltree=new this.TREE,this.sdtree=new this.TREE,this.length_bits=new Array(30),this.length_base=new Array(30),this.dist_bits=new Array(30),this.dist_base=new Array(30),this.clcidx=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],this.build_bits_base=function(e,t,n,r){var i,o;for(i=0;n>i;++i)e[i]=0;for(i=0;30-n>i;++i)e[i+n]=Math.floor(i/n);for(o=r,i=0;30>i;++i)t[i]=o,o+=1<<e[i]},this.build_fixed_trees=function(e,t){var n;for(n=0;7>n;++n)e.table[n]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,n=0;24>n;++n)e.trans[n]=256+n;for(n=0;144>n;++n)e.trans[24+n]=n;for(n=0;8>n;++n)e.trans[168+n]=280+n;for(n=0;112>n;++n)e.trans[176+n]=144+n;for(n=0;5>n;++n)t.table[n]=0;for(t.table[5]=32,n=0;32>n;++n)t.trans[n]=n},this.build_tree=function(e,t,n,r){var i,o,a=new Array(16);for(i=0;16>i;++i)e.table[i]=0;for(i=0;r>i;++i)e.table[t[n+i]]++;for(e.table[0]=0,o=0,i=0;16>i;++i)a[i]=o,o+=e.table[i];for(i=0;r>i;++i)t[n+i]&&(e.trans[a[t[n+i]]++]=i)},this.getbit=function(e){var t;return e.bitcount--||(e.tag=255&e.source[e.sourceIndex++],e.bitcount=7),t=1&e.tag,e.tag>>=1,t},this.read_bits=function(t,n,r){if(!n)return r;var i=e(t.source,t.bitcount,t.tag,t.sourceIndex,n);return t.bitcount=i[0],t.tag=i[1],t.sourceIndex=i[2],i[3]+r},this.decode_symbol=function(e,t){for(;e.bitcount<16;)e.tag=e.tag|(255&e.source[e.sourceIndex++])<<e.bitcount,e.bitcount+=8;var n=0,r=0,i=0;do r=2*r+((e.tag&1<<i)>>i),++i,n+=t.table[i],r-=t.table[i];while(r>=0);return e.tag>>=i,e.bitcount-=i,t.trans[n+r]},this.decode_trees=function(e,t,n){var r,i,o,a,s,c,l=new this.TREE,d=new Array(320);for(r=this.read_bits(e,5,257),i=this.read_bits(e,5,1),o=this.read_bits(e,4,4),a=0;19>a;++a)d[a]=0;for(a=0;o>a;++a){var u=this.read_bits(e,3,0);d[this.clcidx[a]]=u}for(this.build_tree(l,d,0,19),s=0;r+i>s;){var f=this.decode_symbol(e,l);switch(f){case 16:var p=d[s-1];for(c=this.read_bits(e,2,3);c;--c)d[s++]=p;break;case 17:for(c=this.read_bits(e,3,3);c;--c)d[s++]=0;break;case 18:for(c=this.read_bits(e,7,11);c;--c)d[s++]=0;break;default:d[s++]=f}}this.build_tree(t,d,0,r),this.build_tree(n,d,r,i)},this.inflate_block_data=function(e,t,n){for(var r=e.dest,i=r.length;;){var o=this.decode_symbol(e,t);if(256==o)return this.OK;if(256>o)r[i++]=o,e.history.push(o);else{var a,s,c,l;if(o-=257,a=this.read_bits(e,this.length_bits[o],this.length_base[o]),s=this.decode_symbol(e,n),c=e.history.length-this.read_bits(e,this.dist_bits[s],this.dist_base[s]),0>c)throw"Invalid zlib offset "+c;for(l=c;c+a>l;++l)r[i++]=e.history[l],e.history.push(e.history[l])}}},this.inflate_uncompressed_block=function(e){var t,n,r;if(e.bitcount>7){var i=Math.floor(e.bitcount/8);e.sourceIndex-=i,e.bitcount=0,e.tag=0}if(t=e.source[e.sourceIndex+1],t=256*t+e.source[e.sourceIndex],n=e.source[e.sourceIndex+3],n=256*n+e.source[e.sourceIndex+2],t!=(65535&~n))return this.DATA_ERROR;for(e.sourceIndex+=4,r=t;r;--r)e.history.push(e.source[e.sourceIndex]),e.dest[e.dest.length]=e.source[e.sourceIndex++];return e.bitcount=0,this.OK},this.inflate_fixed_block=function(e){return this.inflate_block_data(e,this.sltree,this.sdtree)},this.inflate_dynamic_block=function(e){return this.decode_trees(e,e.ltree,e.dtree),this.inflate_block_data(e,e.ltree,e.dtree)},this.init=function(){this.build_fixed_trees(this.sltree,this.sdtree),this.build_bits_base(this.length_bits,this.length_base,4,3),this.build_bits_base(this.dist_bits,this.dist_base,2,1),this.length_bits[28]=0,this.length_base[28]=258,this.reset()},this.reset=function(){this.d=new this.DATA(this),delete this.header},this.uncompress=function(e,t){var n,r=this.d;r.source=e,r.sourceIndex=t,r.bitcount=0,r.dest=[],"undefined"==typeof this.header&&(this.header=this.read_bits(r,16,0));var i=0;do{var o,a;switch(n=this.getbit(r),o=this.read_bits(r,2,0)){case 0:a=this.inflate_uncompressed_block(r);break;case 1:a=this.inflate_fixed_block(r);break;case 2:a=this.inflate_dynamic_block(r);break;default:return{status:this.DATA_ERROR}}if(a!=this.OK)return{status:this.DATA_ERROR};i++}while(!n&&r.sourceIndex<r.source.length);return r.history=r.history.slice(-this.WINDOW_SIZE),{status:this.OK,data:r.dest}}}function KeyEventDecoder(e,t){function n(e){for(var n=0;n<e.length;++n)t(e[n])}function r(n,r){var i={type:r},o=kbdUtil.getKey(n);o&&(i.keyId=o);var a=kbdUtil.getKeysym(n),s=e.hasShortcutModifier()||!!e.activeCharModifier();a&&("keydown"!==r||kbdUtil.nonCharacterKey(n)||s)&&(i.keysym=a);var c=16===n.keyCode||"Shift"===n.key,l=!c&&("keydown"!==r||e.hasShortcutModifier()||!!kbdUtil.nonCharacterKey(n)),d="keydown"===r&&e.activeCharModifier()&&!kbdUtil.nonCharacterKey(n),u=e.activeCharModifier();if(u&&a){for(var f=!1,p=0;p<u.length;++p)u[p]===a.keysym&&(f=!0);"keypress"!==r||f||(i.escape=e.activeCharModifier())}return d&&t({type:"stall"}),t(i),l}return{keydown:function(t){return n(e.keydown(t)),r(t,"keydown")},keypress:function(e){return r(e,"keypress")},keyup:function(t){return n(e.keyup(t)),r(t,"keyup")},syncModifiers:function(t){n(e.syncAny(t))},releaseAll:function(){t({type:"releaseall"})}}}function VerifyCharModifier(e){function t(){if(!r)for(;0!==n.length;){var i=n[0];switch(n=n.splice(1),i.type){case"stall":return void(r=setTimeout(function(){clearTimeout(r),r=null,t()},5));case"keydown":0!==n.length&&"keypress"===n[0].type&&(!n[0].escape||i.keysym&&i.keysym.keysym===n[0].keysym.keysym||(i.escape=n[0].escape),i.keysym=n[0].keysym,n=n.splice(1))}"stall"!==i.type&&e(i)}}var n=[],r=null;return function(e){n.push(e),t()}}function TrackKeyState(e){var t=[];return function(n){var r=0!==t.length?t[t.length-1]:null;switch(n.type){case"keydown":r&&n.keyId&&r.keyId===n.keyId||(r={
keyId:n.keyId,keysyms:{}},t.push(r)),n.keysym&&(r.keysyms[n.keysym.keysym]=n.keysym,r.ignoreKeyPress=!0,e(n));break;case"keypress":r||(r={keyId:n.keyId,keysyms:{}},t.push(r)),n.keysym||console.log("keypress with no keysym:",n),n.keysym&&!r.ignoreKeyPress&&(r.keysyms[n.keysym.keysym]=n.keysym,n.type="keydown",e(n));break;case"keyup":if(0===t.length)return;for(var i=null,o=0;o!==t.length;++o)if(t[o].keyId===n.keyId){i=o;break}null===i&&(i=t.length-1);var a=t.splice(i,1)[0];for(var s in a.keysyms){var c=function(){function e(){}return function(t){return e.prototype=t,new e}}(),l=c(n);l.keysym=a.keysyms[s],e(l)}break;case"releaseall":for(var o=0;o<t.length;++o)for(var s in t[o].keysyms){var d=t[o].keysyms[s];e({keyId:0,keysym:d,type:"keyup"})}t=[]}}}function EscapeModifiers(e){return function(t){if("keydown"!==t.type||void 0===t.escape)return void e(t);for(var n=0;n<t.escape.length;++n)e({type:"keyup",keyId:0,keysym:keysyms.lookup(t.escape[n])});e(t);for(var n=0;n<t.escape.length;++n)e({type:"keydown",keyId:0,keysym:keysyms.lookup(t.escape[n])})}}function SoftAssertException(e){this.message=e}function AssertUnimplementedException(e){this.message=e}function reportAssert(e,t){var n=printStackTrace();reportClientEvent&&reportClientEvent(e,{stacktrace:n,message:t||"no message given"})}function soft_assert(e,t){if(!e)throw"string"!=typeof t&&(t=JSON.stringify(t)),reportAssert("tc-soft-assert",t),new SoftAssertException(t)}function assert_unimplemented(e,t){var n;window.DEBUG&&(e||("string"!=typeof t&&(t=JSON.stringify(t)),assert_msg_count.hasOwnProperty(t)?assert_msg_count[t]+=1:(assert_msg_count[t]=1,n=new Logger("assert",{level:"info"}),n.error({event:"unimplemented",message:t}))))}function Logger(e,t){function n(n){var r,i,o,d=new Date,u=printStackTrace()[7],f={};if(d.setUTCHours((24+d.getUTCHours()-d.getTimezoneOffset()/60)%24),r=d.toISOString().substr(11,12)+" | "+Util.fit_string_in_fixed_len_field(e,a,"..")+" | ",u&&(i=u.indexOf("@"),u=u.slice(0,i),r+=Util.fit_string_in_fixed_len_field(u,s,"")+" | "),t.header&&(f=t.header()),"object"==typeof n)for(o in n)n.hasOwnProperty(o)&&(f[o]=n[o]);else f.detail=n;return r+=JSON.stringify(f,function(e,t){return Util.is_string(t)?Util.string_shorten(t,c,"..."):t}),Util.string_shorten(r,l,"...")}function r(e,t){var r,i=e;r=n(t),window.console[e]||(i="log"),"debug"===i&&"Explorer"===browser.name&&browser.version<=10&&(i="log");try{window.console[i](r)}catch(o){window.console.log(r)}}function i(e,t){try{r(e,t)}catch(n){try{window.console.log(n)}catch(i){}}}var o=t.level||"debug",a=12,s=22,c=4096,l=8192,d=this;switch(d.debug=d.info=d.warn=function(e){},o){case"debug":DEBUG&&(d.debug=function(e){i("debug",e)});case"info":d.info=function(e){i("info",e)};case"warn":d.warn=function(e){i("warn",e)}}d.error=function(e){i("error",e)}}function __randstr(e,t){var n,r,i,o=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],a=window.crypto||window.msCrypto,s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_-";for(r="",t&&(n=new window.Uint8Array(e),a.getRandomValues(n)),i=0;e>i;i+=1)r+=t?s[n[i]%s.length]:o[Math.floor(Math.random()*o.length)];return r}function __startswith(e,t){return e.substring(0,t.length)===t}function assert(e,t){if(!e&&("string"!=typeof t&&(t=JSON.stringify(t)),window.reportAssert&&reportAssert("tc-assert",t),DEBUG))throw new Error(t)}function ParsedURL(e){var t=this,n=document.createElement("a");n.href=e,t.defrag=function(){return n.protocol+"//"+n.hostname+n.pathname+n.search},t.hasHash=function(){return t.hash||"#"===t.href.slice(-1)},t.isHashChange=function(e){return t.hasHash()&&t.href===e.href?!0:t.defrag()===e.defrag()?t.hash!==e.hash||t.href.length!==e.href.length:!1},t.withTrackingLabel=function(){return assert(-1===n.search.indexOf("xid=")),n.search+=(n.search?"&":"")+"xid="+__randstr(16),n.href},t.href=n.href,t.protocol=n.protocol,t.hostname=n.hostname,t.host=n.host,n.port&&!("80"===n.port&&"http:"===t.protocol||"443"===n.port&&"https:"===t.protocol)?t.port=n.port:t.port="",n.pathname&&0!==n.pathname.indexOf("/")?t.pathname="/"+n.pathname:t.pathname=n.pathname,t.search=n.search,t.hash=n.hash,t.origin=n.origin||t.protocol+"//"+t.hostname+(t.port?":"+t.port:"")}function ClientEventReporter(e){function t(){c.flush(),c.flushPingStats()}var n,r,i=new Logger("event-reporter",{level:"info"}),o=[],a=100,s=50,c=this,l={},d=0;c.flush=function(){if(!o.length)return window.clearTimeout(d),void(d=window.setTimeout(c.flush,5e3));var t={items:[]};for(n=0,r=o.length;r>n;n+=1)t.items.push(o[n]);e.serverCall({op_name:"client_event",url:e.url_builder.buildProtocolUrl("/safeview-client-logger/clientevent"),data:JSON.stringify(t),skip_report:!0}).done(function(){o.length=0}).fail(function(e,t){}).always(function(){window.clearTimeout(d),d=window.setTimeout(c.flush,5e3)})},c.save_ping_stats=function(e){var t=e.ping;["ping","url","user_agent","build_id"].forEach(function(t){delete e[t]}),e.time_last=t.last,e.time_min=t.min,e.time_avg=t.avg,e.time_stdev=t.stdev,e.time_max=t.max,e.count=t.count,e.mode=t.mode,c.ping_stats=e},c.save_to_local_stats=function(e){return c.local_stats.length>=s?void i.info("clientevent ClientEventReporter local_stats is full, discarding new event"):void c.local_stats.push(e)},c.enqueue=function(e){return o.length===a?void i.info("clientevent ClientEventReporter queue is full, discarding new event"):void o.push(e)},c.shouldReport=function(e){return l[e]?!1:(l[e]=!0,!0)},c.report=function(e,t){switch(e){case"warn":i.warn(t);break;case"error":i.error(t);break;case"debug":break;default:i.info(t)}},c.reportSkipped=function(e){},c.flushPingStats=function(){var t,n,r,i={items:[]};c.ping_stats&&(t=e.url_builder.buildProtocolUrl("/safeview-client-logger/clientevent"),i.items.push(c.ping_stats),n=JSON.stringify(i),navigator.sendBeacon?navigator.sendBeacon(t,n):(r=new XMLHttpRequest,r.open("POST",t,!1),r.withCredentials=!0,r.setRequestHeader("Content-Type","text/plain"),r.send(n)))},e.callback&&e.callback.register("safeview-exit",t),window.setTimeout(c.flush,5e3),c.local_stats=[]}function reportClientEventWork(e,t,n,r){var i,o=e+": "+JSON.stringify(t);return r||safeview.event_reporter.shouldReport(e)?(n?safeview.event_reporter.report(t.tclevel,o):"tc-local-stats"!==t.tclevel&&"tc-ping-stats"!==t.tclevel&&safeview.event_reporter.report("debug",o),i={client_time:Date().toString(),build_id:window.BUILD_ID,event:e,user_agent:window.navigator.userAgent,url:Util.getRawPageUrl()},$.extend(i,t),safeview.pairing_dict&&(i.surrogate_id=safeview.pairing_dict.safe_rid,i.surrogate_router_id=safeview.pairing_dict.cid,i.tab_id=safeview.pairing_dict.tab_id),void("tc-local-stats"===t.tclevel?safeview.event_reporter.save_to_local_stats(i):"tc-ping-stats"===t.tclevel?safeview.event_reporter.save_ping_stats(i):safeview.event_reporter.enqueue(i))):void safeview.event_reporter.reportSkipped(o)}function reportClientEventXFrame(e,t,n,r){assert("top"===safeview.role||"sub"===safeview.role),safeview.postToCommFrame({kind:"client_report_msg",event:e,extrainfo:t,warn:n,always:r})}function reportClientEvent(e,t,n,r){try{safeview.event_reporter?reportClientEventWork(e,t,n,r):reportClientEventXFrame(e,t,n,r)}catch(i){console.log("reportClientEvent threw exception: "+i.toString()+". Original log message: "+e+": "+JSON.stringify(t))}}function reportWarnClientEvent(e,t,n,r){n!==!1&&(n=!0),r!==!0&&(r=!1),void 0===t&&(t={}),t.tclevel="tc-warn",reportClientEvent(e,t,n,r)}function reportErrorClientEvent(e,t,n,r){n!==!1&&(n=!0),r!==!0&&(r=!1),void 0===t&&(t={}),t.tclevel="tc-error",reportClientEvent(e,t,n,r)}function argumentsToArray(e){return Array.prototype.slice.call(e).slice(0)}function Countdown(e,t,n,r){function i(){t(safeview.localization.get("ID_TC_RECONNECT_ERROR")),setTimeout(function(){f.restart()},2e3)}function o(){var e=u/1e3;assert(e>=0),t(safeview.localization.get("ID_TC_RELOADING",e))}function a(){var e=safeview.url_builder.buildServiceURL("/safeview-director/traffic_cop");safeview.serverCall({url:e,timeout:1e3}).done(function(t){reportClientEvent("tc-service-check-done",{action:t,request_url:e}),"go"===t?n():i()}).fail(function(t,n){reportClientEvent("tc-service-check-failed",{textStatus:n,request_url:e}),i()})}function s(){d&&(clearInterval(d),d=null)}function c(){assert(u>=1e3),u-=1e3,o(),0===u&&(s(),a())}function l(){s(),u=e,o(),d=setInterval(c,1e3)}var d=null,u=null,f=this;this.restart=l,this.stop=s}function Poller(e){function t(n){return void 0===n&&(n=0),n+=1,e.cond_func()?void e.success_cb():void(n>e.max_nr_polls?e.timeout_cb&&e.timeout_cb():r=setTimeout(function(){r=null,t(n)},e.poll_interval_ms))}var n=this,r=null;if(!e.cond_func)throw new Error("Must specify condition function");if(!e.max_nr_polls)throw new Error("Must specify max number of polls");if(!e.poll_interval_ms)throw new Error("Must specify poll interval");n.stop=function(){r&&(clearTimeout(r),r=null)},n.start=function(){n.stop(),t()}}function calculateMovement(e,t){var n;return void 0!==e.movementX?{x:e.movementX,y:e.movementY}:(n=safeview[t]?{x:e.screenX-safeview[t].screenX,y:e.screenY-safeview[t].screenY}:{x:0,y:0},safeview[t]={screenX:e.screenX,screenY:e.screenY},n)}function EventListenerModule(){function e(e,t,n,r,i){var o;"function"==typeof e.addEventListener?(o=BrowserDetect.supportsPassiveEventListeners()?{capture:!!r,passive:!!i}:!!r,e.addEventListener(t,n,o)):"function"==typeof e.attachEvent?e.attachEvent("on"+t,n):assert(!1,"Cannot add listener.")}function t(e,t,n,r,i){var o;"function"==typeof e.removeEventListener?(o=BrowserDetect.supportsPassiveEventListeners()?{capture:!!r,passive:!!i}:!!r,e.removeEventListener(t,n,o)):"function"==typeof e.detachEvent?e.detachEvent("on"+t,n):assert(!1,"Cannot remove listener.")}function n(e){function t(e){return e?e.toString():null}try{var n=e?{e:e}:{},r={stacktrace:printStackTrace(n),exception:t(e)};DEBUG&&safeview.ui_frame.call("showCrashModal"),reportErrorClientEvent("tc-uncaught-exception",r)}catch(i){try{reportErrorClientEvent("double-fault",{"first-exception":t(e),"second-exception":t(i)})}catch(o){window.triple_fault={"first-exception":t(e),"second-exception":t(i),"third-exception":t(o)}}}}function r(e){return function(){try{e.apply(this,arguments)}catch(t){n(t)}}}var i=new Logger("event-listener",{level:"info"}),o=this,a=0;o.addListener=function(n,i,o,s,c){var l,d;void 0===n.sv_evt_reg_map&&(n.sv_evt_reg_map={}),void 0===o.sv_evt_reg_id&&(o.sv_evt_reg_id=a,a+=1),l=i+"-"+o.sv_evt_reg_id.toString(),n.sv_evt_reg_map[l]&&(d=n.sv_evt_reg_map[l],t(n,i,d,s,c)),d=r(o),n.sv_evt_reg_map[l]=d,e(n,i,d,s,c)},o.removeListener=function(e,n,r,o,a){var s,c;return void 0===e.sv_evt_reg_map||void 0===r.sv_evt_reg_id?void i.error("Registration id not found in removeListener"):(s=n+"-"+r.sv_evt_reg_id.toString(),(c=e.sv_evt_reg_map[s])?(t(e,n,c,o,a),void delete e.sv_evt_reg_map[s]):void i.error("Callback not found in removeListener"))},o.setListenersEnabled=function(e,t,n,r){var i=e?o.addListener:o.removeListener;assert(t),assert(r),n.forEach(function(e){i(t,e,r)})}}function ExitHandler(e){function t(){r?setTimeout(function(){r=!1},100):(e.callback.fire("safeview-exit"),EventListener.removeListener(window,"beforeunload",t,!1))}var n=this,r=!1;n.openingLocalApp=function(){r=!0},n.isLocalAppOpening=function(){return r},EventListener.addListener(window,"beforeunload",t,!1)}function Selection(e){function t(e){var t,n,r,i=getWindowByFid(getFidByNode(e)),o=i.getSelection();return o.rangeCount?(t=o.getRangeAt(0),n=getUidByNode(t.startContainer),r=getUidByNode(t.endContainer),{mode:"range",collapsed:o.isCollapsed,start_container:n,end_container:r,start_offset:t.startOffset,end_offset:t.endOffset}):{mode:"clear",collapsed:!0,uid_start:0,uid_end:0,selection_start:0,selection_end:0}}function n(e){var t={start:e.selectionStart,end:e.selectionEnd},n=t.start===t.end;return{mode:"input",collapsed:n,uid:getUidByNode(e),selection:t}}function r(e){var t=getWindowByFid(e),n=t.getSelection();if(!n.isCollapsed)try{n.removeAllRanges()}catch(r){throw reportErrorClientEvent("tc-sel-clear-selection-fail",{error:r.toString()}),r}}function i(t,n,r,i){soft_assert(n,"null element passed to setInputSelection");var o=!1;t.document.activeElement!==n&&(n.focus(),o=!0),(n.selectionStart!==r||n.selectionEnd!==i||i!==r)&&(local_echo_enabled&&Util.can_element_use_lecho(n)?e.lecho_regulator.set_remote_caret(getFidByNode(n),getUidByNode(n),r,i):(n.selectionStart=r,n.selectionEnd=i))}function o(t,n,r,i,o,a,s){var c,l=getWindowByFid(t),d=l.document,u=l.getSelection();if(!e.ui_frame.active()){if(use_old_ime){if(e.local_input.in_ime_mode(o)||e.local_input.is_sibling_in_ime(o)||!o.parentNode)return}else if(e.local_input.defer_range_sel_if_needed(t,n,r,i,o,a,s))return;if(!e.local_events.defer_range_sel_if_file_chooser(t,n,r,i,o,a,s))try{s&&d.activeElement!==s&&(d.activeElement&&d.activeElement.blur(),s.focus()),u.removeAllRanges(),c=d.createRange(),c.setStart(r,i),c.setEnd(o,a),u.addRange(c)}catch(f){reportWarnClientEvent("tc-sel-range-error",{error:f.toString()})}}}function a(t,n){var a,s,c,l=JSON.parse(n),d=null,u=getWindowByFid(t);if(l.mode&&u)if("clearselection"===l.mode)r(t);else if("input"===l.mode){if(c=getNodeByUid(t,l.uid),!c)return void reportErrorClientEvent("tc-sel-input-selection-fail",{detail:"Cannot set input selection: node",uid:l.uid});if(e.local_input.in_ime_mode(c))return;i(u,c,l.selection.start,l.selection.end)}else if("range"===l.mode){if(l.active_element&&(d=getNodeByUid(t,l.active_element)),a=getNodeByUid(t,l.start_container),s=getNodeByUid(t,l.end_container),soft_assert(a,"selection data.start_container unknown"),soft_assert(s,"selection data.end_container unknown"),a.textContent&&s.textContent&&(l.start_offset>a.textContent.length||l.end_offset>s.textContent.length))return;o(t,l.type,a,l.start_offset,s,l.end_offset,d)}}var s=this;this.getSelection=function(e){var r=Util.is_element_input_text(e)?n(e):t(e),i=getWindowByFid(getFidByNode(e)),o=i&&i.document.activeElement;return o&&(r.active_element=getUidByNode(o)),r},s.set_range_selection=o,e.interp.registerOpcodeHandler(e.interp.OPCODES.SET_SELECTIONS,a)}function setFidToIframe(e,t){fidToIframeNode[t]=e}function removeFidToIframe(e){delete fidToIframeNode[e]}function getIframeByFid(e){return fidToIframeNode[e]}function setFrameFidForNode(e,t,n){uidToFid[e+"_"+t]=n}function setFidToWindow(e,t){assert(e),fidToWindow[t]=e,e.__sv_fid=t}function __init_id_state(e){main_frame_fid=e,uidToNode={},fidToWindow={},fidToIframeNode={},setFidToWindow(mf.window,e),setFidToIframe(mf.window,e)}function isTopFrameFid(e){return e===main_frame_fid}function getTopFrameFid(){return main_frame_fid}function setNodeIds(e,t,n){assert(e);var r=uidToNode[n];r||(r=uidToNode[n]={}),r[t]=e,e.__sv_uid=t,e.__sv_fid=n}function setNodeInMap(e,t,n,r){e[n]=t,t.__sv_uid=n,t.__sv_fid=r}function getNodeMapForFrame(e){return uidToNode[e]}function setNodeMapForFrame(e,t){uidToNode[e]=t}function getUidByNode(e){return assert(e),e.__sv_uid}function getNodeByUid(e,t){var n=uidToNode[e];return n?n[t]:void 0}function getNodeByUidOnly(e){var t,n;for(t in uidToNode)if(uidToNode.hasOwnProperty(t)&&(n=uidToNode[t],n&&n.hasOwnProperty(e)))return n[e];return void 0}function removeUidNodeEntry(e,t){var n=uidToNode[e];n&&delete n[t]}function removeUidNodeEntriesForFid(e){delete uidToNode[e]}function getFidByNode(e){return e.__sv_fid}function getWindowByFid(e){return fidToWindow.hasOwnProperty(e)?fidToWindow[e]:void 0}function removeFidWindowEntry(e){delete fidToWindow[e]}function getFrameFidByNode(e){var t=getFidByNode(e);return safeview.frameset_wrapper&&(t=safeview.frameset_wrapper.get_original_fid(t)),uidToFid[t+"_"+getUidByNode(e)]||null}function CallbackSupport(){function e(e,t,r){var i=o[e];assert(i),i.is_one_shot&&(i.timer_id&&(clearTimeout(i.timer_id),i.timer_id=null),n.deregister(i.id)),i.call_count+=1;try{i.callbacks[t].apply(this,r)}catch(a){throw reportErrorClientEvent("tc-cb-generated-exception",{cb_id:e,cb_event:i.event_name,cb_info:i,cb_ex:a}),a}}function t(t,n,r,s){var c={};return assert("string"==typeof t),assert("object"==typeof s),c.id=a+1,c.callbacks=s,c.event_name=t,c.is_one_shot=n,c.call_count=0,n&&r&&(assert(c.callbacks.on_timeout),c.timer_id=setTimeout(function(){e(c.id,"on_timeout",[])},r)),assert(c.callbacks.on_success),a+=1,i[t]||(i[t]={}),assert(!i[t].hasOwnProperty(c.id)),i[t][c.id]=!0,o[c.id]=c,c.id}var n=this,r=new Logger("callback",{level:"info"}),i={},o={},a=0;n.register=function(e,n){return t(e,!1,0,{on_success:n})},n.registerOneShot=function(e,n,r){return t(e,!0,n,r)},n.deregister=function(e){var t=o[e];return t?(assert(i.hasOwnProperty(t.event_name)),delete i[t.event_name][t.id],delete o[e],!0):!1},n.fire=function(t){var n,r=i[t]||{};assert("string"==typeof t);for(n in r)r.hasOwnProperty(n)&&e(n,"on_success",argumentsToArray(arguments).slice(1))},n.dumpStats=function(){var e,t;if(DEBUG)for(e in o)o.hasOwnProperty(e)&&(t=o[e],r.info("Callback: id="+e+" event="+t.event_name+" one_shot="+t.is_one_shot+" call_count="+t.call_count))}}function XFrameCallbackSupport(e){function t(t,n,r){var i={kind:"cb_reg",event_name:t,cb_id:n,one_shot:r};"top"===e.role?e.postToCommFrame(i):"comm"===e.role?e.postToTopFrame(i):assert(0)}function n(t){var n={kind:"cb_dereg",cb_id:t};"top"===e.role?e.postToCommFrame(n):"comm"===e.role?e.postToTopFrame(n):assert(0)}function r(e){var t,n,r;for(t in a)if(a.hasOwnProperty(t))for(n=a[t],r=n.length-1;r>=0;r-=1)n[r].cb_id===e&&n.splice(r,1)}function i(t){var n,r,i=a[t];if(i)for(r={kind:"cb_fired",event_name:t,args:argumentsToArray(arguments)},"top"===e.role?e.postToCommFrame(r):"comm"===e.role?e.postToTopFrame(r):assert(0),n=i.length-1;n>=0;n-=1)i[n].one_shot&&i.splice(n,1)}var o=this,a={},s=new CallbackSupport;o.on_cb_msg=function(e){switch(e.kind){case"cb_reg":a[e.event_name]||(a[e.event_name]=[]),a[e.event_name].push({cb_id:e.cb_id,one_shot:e.one_shot});break;case"cb_dereg":r(e.cb_id);break;case"cb_fired":s.fire.apply(s,e.args)}},o.register=function(e,n,r){var i=s.register(e,n);return r&&t(e,i,!1),i},o.registerOneShot=function(e,n,r,i){var o=s.registerOneShot(e,n,r);i&&t(e,o,!0)},o.deregister=function(e){var t=s.deregister(e);return n(e),t},o.fire=function(e){s.fire.apply(s,arguments),i(e)}}function haveIntermediateSurrControllers(e){var t,n=e.length-2;for(t=1;n>=t;t+=1)if("SURR"===e[t].__sv_scroll)return!0;return!1}function isScrollable(e){var t=ScrollControl.tuneScrollMargin;return e&&(e.scrollHeight>e.clientHeight+t||e.scrollWidth>e.clientWidth+t)}function findScrollControllers(e){for(var t=e,n=[];t;)!isScrollable(t)&&void 0===t.__sv_scroll&&t.parentElement&&t.parentElement.parentElement||n.push(t),t=t.parentElement;return n}function ShortcutKeyHandler(e,t){function n(e){var t=0;return e.shiftKey&&(t+=1),e.ctrlKey&&(t+=2),e.altKey&&(t+=4),e.metaKey&&(t+=8),t}var r,i={45:{1:"paste"},65:{2:"selectAll"},66:{2:"bold"},70:{2:"inPageSearch"},71:{2:"inPageSearchNext",3:"inPageSearchPrev"},73:{2:"italic"},80:{2:"print"},85:{2:"underline"},86:{2:"paste",3:"paste"},89:{2:"redo"},90:{2:"undo"}},o={65:{8:"selectAll"},66:{8:"bold"},70:{8:"inPageSearch"},71:{8:"inPageSearchNext",9:"inPageSearchPrev"},73:{8:"italic"},80:{8:"print"},85:{8:"underline"},86:{8:"paste"},90:{8:"undo",9:"redo"}},a=this;r="Mac"===browser.os||"iPhone/iPod"===browser.os?o:i,a.get_operation=function(e){var t=r[e.keyCode];return t?t[n(e)]:void 0},a.tryProcess=function(e){var i,o,a=e.keyCode,s=e.target,c=e.type,l=n(e),d=!1;if("keydown"!==c&&"keypress"!==c)return!1;if("keypress"===e.type&&(e.altKey||e.metaKey||e.ctrlKey))return!0;if("Firefox"===browser.name&&browser.version<=24&&"keypress"===e.type&&!e.charCode)return!0;if(!r.hasOwnProperty(a))return!1;if(i=r[a],o=i[l],!o)return!1;switch(o){case"selectAll":case"bold":case"italic":case"underline":case"redo":case"undo":t&&(d=t(s,e,o));break;case"paste":d=!0}return d}}function KeyMap(){var e=this,t={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",46:"Delete"},n={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Down:"ArrowDown",Right:"ArrowRight",Del:"Delete"};e.SPECIAL_KEYS={8:1,9:1,13:1,27:1,33:1,34:1,35:1,36:1,37:1,38:1,39:1,40:1,46:1},e.SCROLLING_KEYS={32:1,33:1,34:1,35:1,36:1,37:1,38:1,39:1,40:1},e.LECHO_SPECIAL_KEYS={8:1,35:1,36:1,37:1,39:1,46:1},e.getKeyCode=function(e){var r;return r=e.key||t[e.keyCode]||"",r=n[r]||r,"Unidentified"===r&&(r=t[e.keyCode]||""),r}}function MouseEventQueue(e,t,n){var r,i=[],o=this,a="mouseout"===t?"wait_mouseover":"wait_mouseenter",s=30;this.flush=function(){i.length&&e.surrogate_channel.send("multiple-mouse",n,i),clearTimeout(r),e.local_events.mouse_queue_flushed()},this.push=function(e,t,c,l,d,u,f,p,_,g,h){return getFidByNode(e)!==n?(o.flush(),!1):("mouseleave"===t&&(a="wait_mouseenter"),i.push([getUidByNode(e),t,c.x,c.y,c.relative_to_target,l,d,u,f,p,_?getUidByNode(_):null,g,h]),"mouseover"===t&&"wait_mouseover"===a||"mouseenter"===t&&"wait_mouseenter"===a?o.flush():(clearTimeout(r),r=setTimeout(function(){o.flush()},s)),!0)}}function LocalEvents(e){function t(t,n){var r,i,o,a,s,c,l=0,d=null,u=e.ime_helper;if(Util.is_element_input_text(t)||Util.is_elem_editable(t)){switch(Util.is_element_input_text(t)?(r=t,o=r.value,i=r.selectionEnd):(c=getWindowByFid(getFidByNode(t)),a=c.getSelection(),r=a.focusNode,DEBUG&&Util.debug_print_selection(a,F),o=r.data,i=a.focusOffset,BrowserDetect.isIE10()&&"compositionupdate"===n.type&&""!==n.data&&1===r.nodeType&&r.childNodes.length>=a.focusOffset&&(r=r.childNodes[a.focusOffset-1],o=r.data,i=r.data.length)),(void 0===o||null===o)&&(o=""),n.data&&(l=n.data.length),n.type){case"compositionstart":u.set_ime_state(t,r),u.preserve_value_if_needed(r,o.substring(0,o.length-l));break;case"compositionend":u.reset_ime_state(),d=n.data,d||(s=u.compute_new_text(r,o,i,l),!s||"ã"!==s.new_text&&" "!==s.new_text||(d=s.new_text)),u.preserve_value_if_needed(r,Util.is_element_input_text(r)?r.value:r.data);break;case"compositionupdate":if(!BrowserDetect.isIE())break;s=u.compute_new_text(r,o,i,l),s&&(d=s.new_text,u.preserve_value_if_needed(r,s.new_ftext))}d&&(e.surrogate_channel.send("textinput",getFidByNode(t),getUidByNode(t),d,!0),Util.is_element_input_text(r)&&(r.sv_prev_value=r.value,X=!0))}}function n(n,r){use_old_ime?t(n,r):e.local_input.handle_local_input_events(n,r)}function r(e){!TPROXY_ENABLED&&Util.is_autofill_target(e)&&(e.sv_prev_value||(e.sv_prev_value=""),e.value!==e.sv_prev_value+"ã"&&e.value!==e.sv_prev_value+" "&&(e.value="password"===e.type?"":e.sv_prev_value),e.sv_prev_value=e.value)}function i(e){return X?e.sv_prev_value===e.value:!1}function o(t,n){return t.__sv_ignore_input_event?void(t.__sv_ignore_input_event=!1):local_echo_enabled&&n.target.__keypress_just_happened?void delete n.target.__keypress_just_happened:void(BrowserDetect.isIE()&&document.activeElement!==t&&t.placeholder&&!t.value||(Util.is_element_input_text(t)&&(e.local_input.in_ime_mode(t)||i(t)||(r(t),e.surrogate_channel.send("input",getFidByNode(t),getUidByNode(t),t.value)),local_echo_enabled&&e.lecho_regulator.update_local_value(getFidByNode(t),getUidByNode(t),t.value,-1)),X=!1,e.http_alert.update()))}function a(t,n){return local_echo_enabled&&t.__keypress_just_happened?(e.lecho_regulator.update_local_value(getFidByNode(t),getUidByNode(t),t.value,J),void delete t.__keypress_just_happened):void(use_old_ime?o(t,n):(e.local_input.handle_local_input_events(t,n),e.http_alert.update()))}function s(t,n){Util.is_element_input_text(t)&&(229!==K||!BrowserDetect.isChrome()||"ã"!==n.data&&" "!==n.data||(e.surrogate_channel.send("textinput",getFidByNode(t),getUidByNode(t),n.data,!0),t.sv_prev_value=t.value,X=!0,K=null))}function c(t,n){local_echo_enabled&&t.__keypress_just_happened||(use_old_ime?s(t,n):e.local_input.handle_local_input_events(t,n))}function l(t,n){local_echo_enabled&&t.__keypress_just_happened||use_old_ime||e.local_input.handle_local_input_events(t,n)}function d(t,n){var r,i,o,a;return o=getFidByNode(t),a=getUidByNode(t),r=getWindowByFid(o),n=n||r.event,local_echo_enabled&&Util.can_element_use_lecho(t)&&e.lecho_regulator.lecho_enabled(o,a)?void e.local_input.handle_local_input_events(t,n):(i=Util.makePasteDataList(n,r),i.length&&e.surrogate_channel.send("paste",o,a,i),use_old_ime||i.length||!BrowserDetect.isIE()?void n.preventDefault():void e.local_input.handle_local_input_events(t,n))}function u(e){return"body"===Util.get_node_tag(e)||"html"===Util.get_node_tag(e)||e.scrollTo||e.scrollBy||e.scrollByLines||e.scrollByPages?!0:!1}function f(e,t){return local_echo_enabled&&delete V.SCROLLING_KEYS[32],V.SCROLLING_KEYS.hasOwnProperty(t)&&u(e)&&!Util.is_element_input_text(e)&&!Util.is_elem_editable(e)?!0:!1}function p(t,n){var r,i,o,a,s,c=Util.get_node_tag(t),l=n.keyCode,d=n.ctrlKey,u=n.metaKey,p=!1,_=0,g=["#","@","/","\\","$","Â£","â¬","{","[","}","]","Âµ","|"];if(e.detached)return e.detached=!1,void window.location.reload();if(e.callback.fire("key-event",t,n),!e.print_handler.handlePrintKeyEventIfNeeded(n,H.get_operation(n))){if(local_echo_enabled&&"keyup"===n.type&&delete n.target.__keypress_just_happened,"keydown"===n.type&&(K=l,e.context_menu.dismiss_if_necessary(n)),"select"===c){if(!local_echo_enabled)return;if("keydown"!==n.type||9!==l)return}if("keypress"===n.type&&-1!==g.indexOf(n.key)&&(d=!1,u=!1,p=!0),(p||!H.tryProcess(n))&&!(BrowserDetect.isFirefox()&&BrowserDetect.version<=65&&"keypress"===n.type&&l>=112&&123>=l)){if(a="keypress"===n.type&&0===l&&32===n.charCode?32:l,BrowserDetect.isFirefox()&&BrowserDetect.version>=37&&"checkbox"===n.target.type&&32===a&&(n.target.__sv_ignore_click_event=!0),r=V.getKeyCode(n),local_echo_enabled){if(i=getFidByNode(t),o=getUidByNode(t),Util.can_element_use_lecho(t)&&e.lecho_regulator.is_input_locked())return void n.preventDefault();if(("keypress"===n.type||"keydown"===n.type&&8===n.keyCode||"keydown"===n.type&&46===n.keyCode)&&e.lecho_regulator.lecho_enabled(i,o)&&(J+=1,_=J),"keydown"===n.type&&(13===n.keyCode||9===n.keyCode)){if(e.lecho_regulator.show_attention_modal_if_needed(13===n.keyCode?"enter":"tab"))return;s=e.lecho_regulator.get_lecho_values(),e.surrogate_channel.send("precheck",i,13===n.keyCode?"enter":"tab",s)}}if(e.surrogate_channel.send("keyboard",getFidByNode(t),getUidByNode(t),n.type,l,n.charCode,r,n.shiftKey,d,u,_),local_echo_enabled&&Util.can_element_use_lecho(t)){if(i=getFidByNode(t),o=getUidByNode(t),"keydown"===n.type&&(e.lecho_regulator.set_last_keypress(i,o,l),V.LECHO_SPECIAL_KEYS.hasOwnProperty(l)&&e.lecho_regulator.lecho_enabled(i,o)))return void(t.__keypress_just_happened=!0);if("keypress"===n.type&&e.lecho_regulator.lecho_enabled(i,o))return void(n.target.__keypress_just_happened=!0)}u||d||f(t,a)||("keydown"!==n.type||V.SPECIAL_KEYS.hasOwnProperty(l))&&n.preventDefault()}}}function _(e){return e.ctrlKey||e.shiftKey||e.metaKey}function g(e){return Util.findPredicateOnBranch(e,Util.is_node_likely_anchor_tag)}function h(e,t,n){var r=Util.get_node_tag(n),i="click"===t||"mousedown"===t||"mouseup"===t;return t===M||"mouseenter"===t||"mouseleave"===t||1===e.button||2===e.button||i&&("select"===r||("audio"===r||"video"===r)&&n.controls)}function m(e){var t=Util.get_node_tag(e);return"a"===t&&e.href||("input"===t||"button"===t)&&"submit"===e.type.toLowerCase()||"input"===t&&"image"===e.type.toLowerCase()||"input"===t&&"checkbox"===e.type.toLowerCase()||"img"===t||"map"===t?!0:!1}function v(e){return!!Util.findPredicateOnBranch(e,m)}function y(t){!TPROXY_ENABLED&&e.pairing_dict.prepend_client_navs&&(setTimeout(function(e){t.href=e},0,t.href),t.href=window.location.origin+"/"+t.href)}function w(t,n,r){var i,o,a,s,c,l,d,u,f,p,m,w,b,k,S,C=Util.get_node_tag(r);if(n===M){if(i=findScrollControllers(r),o=i.length,1>o)return!1;for(a=i[0],s=o>1?i[1]:a,c=i[o-1],l=o>1?i[o-2]:c,d=a.__sv_scroll,u=s.__sv_scroll,f=l.__sv_scroll,p=c.__sv_scroll,w=0;o>w;w+=1)if(isScrollable(i[w])){m=i[w];break}return!d&&m&&(a=m,d=m.__sv_scroll),void 0!==d?(b=d,S=a.__sv_source||"unknown source","TC"===b&&"SURR"===u&&(b="SURR",S="override")):haveIntermediateSurrControllers(i)?(b="SURR",S="inherit"):void 0!==f?(b=f,S="secondary"):void 0!==p?(b=p,S="root"):(b=ScrollControl.initialMode,S="default"),"TC"===b?!1:!0}if("click"===n&&"input"===C&&"file"===r.type)return!r.getAttribute("__sv_open");if(h(t,n,r))return!1;if("click"===n&&(k=g(r))){if(e.readonly.allow_tab_creation()&&_(t))return y(k),!1;if("_blank"===k.target&&e.tab.tabPreOpen(Util.getRawPageUrl(k.href)))return!0}return v(r)?!0:"click"===n?!0:!1}function b(t,n,r){var i=Util.get_node_tag(r);return B&&"mouseup"===n?!1:1===t.button?!0:"select"===i?!0:"click"===n?"input"===i&&"file"===r.type?r.getAttribute("__sv_open")?(r.removeAttribute("__sv_open"),!0):!1:e.readonly.allow_tab_creation()&&_(t)&&!!g(r):"mousedown"===n&&"option"===i?!0:"dblclick"===n?!0:!1}function k(t,n,r){var i,o,a;switch(r){case"DOMMouseScroll":o=t.detail,i=0,a=1;break;case"mousewheel":o=t.wheelDelta?-t.wheelDelta:0,i=0,a=0;break;case"wheel":o=t.deltaY,i=t.deltaX,a=t.deltaMode;break;default:assert(!1)}(i||o)&&(assert(0===a||1===a),1===a&&(o*=40,i*=40,a=0),e.surrogate_channel.send("wheel",getFidByNode(n),getUidByNode(n),{deltaMode:a,deltaX:i,deltaY:o,cancelable:t.cancelable,bubbles:t.bubbles,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY,pageX:t.pageX,pageY:t.pageY,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey}))}function S(e,t){var n,r,i=getFidByNode(e);for(Y={x:t.clientX,y:t.clientY};i&&!isTopFrameFid(i);)r=getWindowByFid(i).frameElement,r?(n=r.getBoundingClientRect(),n&&(Y.x+=n.left,Y.y+=n.top),i=getFidByNode(r)):i=null}function C(t,n){var r,i,o,a,s,c,l,d,u,f=n.type;if(e.detached)return e.detached=!1,void window.location.reload();if("click"===f&&n.target.__sv_ignore_click_event)return void delete n.target.__sv_ignore_click_event;if(assert(getFidByNode(t)),assert(getUidByNode(t)),r=n.detail||1,i=Util.getRelativeMouseCoords(t,n),S(t,n),o=N.get_mouse_event_reltarget(f,n),a=n.ctrlKey,s=n.altKey,c=n.shiftKey,l=n.metaKey,d=n.button,"mousedown"===f&&e.context_menu.dismiss_if_necessary(n),"mousedown"===f&&0===d&&(e.plugin.click_test(getFidByNode(t),n.clientX,n.clientY),"input"===t.nodeName.toLowerCase()&&"file"===t.getAttribute("type")&&BrowserDetect.isIE()&&(q=!0)),w(n,f,t)){if("mousedown"===f)try{t.focus()}catch(p){if(!BrowserDetect.isEdge()&&!BrowserDetect.isIE()||"typeerror"!==p.name.toLowerCase())throw p}n.preventDefault()}if(!b(n,f,t))switch(!Q||f!==M&&"click"!==f&&"dblclick"!==f||Q.flush(),f){case"mousedown":if(2===d){N.send_mouse_button_and_selection(t,f,i,a,s,c,l,d,o,r,!1);break}B=t,local_echo_enabled&&Util.can_element_use_lecho(t)&&e.lecho_regulator.lock_input(),N.send_mouse_event(t,f,i,a,s,c,l,d,o,r,!1);break;case"mouseup":q=!1,B&&(t=B,i=Util.getRelativeMouseCoords(t,n)),N.send_mouse_button_and_selection(t,f,i,a,s,c,l,d,o,r,!1),local_echo_enabled&&setTimeout(function(){e.lecho_regulator.unlock_input()},0),B=null;break;case M:k(n,t,f);break;case"mousemove":u=Util.calculateMouseMovement(n),j?(u.x+=z.x,u.y+=z.y):setTimeout(function(){j.push(z.x),j.push(z.y),N.send_mouse_event.apply(null,j),j=null,z=null},W),j=[t,f,i,a,s,c,l,d,o,r,!1],z=u;break;case"mouseover":case"mouseout":case"mouseenter":case"mouseleave":local_echo_enabled&&e.lecho_regulator.set_mouse_moved(),"mouseenter"===f&&"html"===Util.get_node_tag(t)&&isTopFrameFid(getFidByNode(t))&&delete e.last_mouse_pos,Q||"mouseout"!==f&&"mouseleave"!==f||(Q=new MouseEventQueue(e,f,getFidByNode(t))),Q&&Q.push(t,f,i,a,s,c,l,d,o,r,!1)||(Q=null,setTimeout(function(){N.send_mouse_event(t,f,i,a,s,c,l,d,o,r,!1)},0));break;default:setTimeout(function(){N.send_mouse_event(t,f,i,a,s,c,l,d,o,r,!1)},0)}}function E(t,n){return assert(t),"dragstart"===n.type&&"div"===t.nodeName.toLowerCase()&&(t.className.toLowerCase().indexOf("ytp-volume-slider")>=0||t.className.toLowerCase().indexOf("ytp-progress-bar")>=0)?void n.preventDefault():e.allow_backend_dragdrop?void("#text"!==t.nodeName&&(n.preventDefault(),
"drop"===n.type&&e.upload.setupDroppedUpload(n.dataTransfer.files),e.surrogate_channel.send("drag",getFidByNode(t),{t:getUidByNode(t),y:n.type,p:Util.getRelativeMouseCoords(t,n),m:Util.calculateDragMovement(n),d:Util.getMouseAndKeyboardModifiers(n,F),f:Util.gen_dragdrop_file_list(n.dataTransfer),i:n.dataTransfer.items}))):void console.debug("No Backend drop Handlers")}function x(t,n){var r=getWindowByFid(getFidByNode(t)),i=t,o=r&&r.__sv_surrogate_is_readonly,a=Util.findPredicateOnBranch(t,Util.is_node_likely_anchor_tag),s=Util.getTopWindowMousePosition(n);if(e.context_menu.set_last_pos(s),a&&y(a),a&&o)n.preventDefault();else if(e.ctx_menu_mode&&e.ctx_menu_mode.backend_driven){if(e.ctx_menu_mode.native_menu_for_input&&(3===i.nodeType&&(i=i.parentNode),Util.is_element_input_text(i)||Util.is_elem_editable(i)))return;C(t,n),n.preventDefault()}}function A(t,n){var r=Util.get_node_tag(t);"select"===r&&e.surrogate_channel.send("change",getFidByNode(t),getUidByNode(t),t.value,t.selectedIndex),"input"===r&&"file"===t.type&&e.upload.setupUploads(t,n)}function T(t,n){var r,i,o,a,s,c=Util.get_node_tag(t),l=0,d=0;if(e.http_alert.update(),a=getFidByNode(t),s=getUidByNode(t),N.ignored_events.scroll[a+"_"+s])return void delete N.ignored_events.scroll[a+"_"+s];if("marquee"!==c){if(r=getWindowByFid(getFidByNode(t)),"body"===c?(void 0!==r.pageYOffset&&(d=r.pageXOffset,l=r.pageYOffset),(0===d||0===l)&&BrowserDetect.isIE()&&BrowserDetect.version>=9&&(0===d&&(d=r.document.body.scrollLeft),0===l&&(l=r.document.body.scrollTop)),o=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight),i=Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.body.clientWidth,document.documentElement.clientWidth)):(l=t.scrollTop,d=t.scrollLeft,i=t.scrollWidth,o=t.scrollHeight),!i||!o)return void reportWarnClientEvent("tc-scroll-ignored-bad-dim",{target_uid:getUidByNode(t),x:d,y:l});d/=i,l/=o,e.surrogate_channel.send("scroll",getFidByNode(t),getUidByNode(t),d,l)}}function R(e,t){t.preventDefault(),t.stopImmediatePropagation()}function D(e,t){}function L(e,t){}function P(e,t){}function U(e,t){}function I(t,n){var r=e.xbrowser.getEventTarget(n);r&&!Util.IsEventTargetForeign(r,n)&&(N.ignored_events[n]?N.ignored_events[n]=!1:t(r,n))}function O(e,t,n){var r,i;for(r=0;r<N.window_params.length;r+=1)i=N.window_params[r],e?EventListener.addListener(t,i[0],i[1],i[2]):EventListener.removeListener(t,i[0],i[1],i[2]);for(r=0;r<N.document_params.length;r+=1)i=N.document_params[r],e?EventListener.addListener(n,i[0],i[1],i[2]):EventListener.removeListener(n,i[0],i[1],i[2])}var B,M,N=this,F=new Logger("local-events",{level:"info"}),V=new KeyMap,H=new ShortcutKeyHandler(e,function(t,n,r){var i=getFidByNode(n.target),o=getUidByNode(n.target),a=!1;switch(r){case"bold":case"italic":case"underline":e.surrogate_channel.send("keyboard",i,o,n.type,n.keyCode,n.charCode,V.getKeyCode(n),n.shiftKey,n.ctrlKey,n.metaKey,0),a=!0;break;case"selectAll":case"undo":case"redo":e.surrogate_channel.send("execcmd",i,r),a=!0}return a&&n.preventDefault(),a}),X=!1,K=null,W=100,j=null,z=null,Y={x:0,y:0},Q=null,G=null,q=!1,J=0;M=void 0!==document.onwheel?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",N.ignored_events={},N.ignored_events.scroll={},N.get_last_mouse_pos=function(){return Y},N.get_mouse_event_reltarget=function(e,t){var n=null;return"mouseover"===e?n=t.relatedTarget||t.fromElement:"mouseout"===e?n=t.relatedTarget||t.toElement:("mouseenter"===e||"mouseleave"===e)&&(n=t.relatedTarget),n},N.send_mouse_event=function(t,n,r,i,o,a,s,c,l,d,u,f,p){var _,g=[];if(local_echo_enabled&&"click"===n){if(e.lecho_regulator.show_attention_modal_if_needed("click"))return;g=e.lecho_regulator.get_lecho_values(),e.surrogate_channel.send("precheck",getFidByNode(t),"click",g)}_=["mouse",getFidByNode(t),getUidByNode(t),n,r.x,r.y,r.relative_to_target,i,o,a,s,c,l?getUidByNode(l):null,d,u],void 0!==f&&(_.push(f),_.push(p)),e.surrogate_channel.send.apply(e.surrogate_channel,_)},N.send_mouse_button_and_selection=function(t,n,r,i,o,a,s,c,l,d,u){setTimeout(function(){var f=getWindowByFid(getFidByNode(t)),p=f.document.activeElement;"mouseup"===n&&0===c&&G&&(e.selection.set_range_selection(G[0],G[1],G[2],G[3],G[4],G[5],G[6]),G=null),p&&!Util.IsEventTargetForeign(p)&&e.surrogate_channel.send("selection",getFidByNode(p),e.selection.getSelection(p)),N.send_mouse_event(t,n,r,i,o,a,s,c,l,d,u)},0)},this.mouse_queue_flushed=function(){Q=null},N.resize_event=function(t,n){var r=MetricsUtils.getVisualViewportMetrics();e.surrogate_channel.send("resize",r.width,r.height,Util.getDeviceScaleFactor()),e.http_alert.update()},N.install_event_listeners=function(t,n,r){(!t.__handlers_installed||r)&&(O(!0,t,n),e.print_handler.attachKeyEventHandler(!0),t.__handlers_installed=!0)},N.uninstall_event_listeners=function(t,n){t.__handlers_installed&&(O(!1,t,n),e.print_handler.attachKeyEventHandler(!1),t.__handlers_installed=!1)},N.defer_range_sel_if_file_chooser=function(e,t,n,r,i,o,a){return q?(G=[e,t,n,r,i,o,a],!0):!1},N.has_deferred_range_sel=function(){return!!G},N.key_event=p,N.window_params=[["scroll",function(e){I(T,e)},!0],["dblclick",function(e){I(C,e)},!1],["resize",function(e){I(N.resize_event,e)},!1],["input",function(e){I(a,e)},!1],["textInput",function(e){I(c,e)},!1],["beforeinput",function(e){I(l,e)},!1],["compositionstart",function(e){I(n,e)},!1],["compositionend",function(e){I(n,e)},!1],["compositionupdate",function(e){I(n,e)},!1]],N.document_params=[["keydown",function(e){I(p,e)},!0],["keypress",function(e){I(p,e)},!0],["keyup",function(e){I(p,e)},!0],["mousedown",function(e){I(C,e)},!1],["mouseenter",function(e){I(C,e)},!0],["mouseleave",function(e){I(C,e)},!0],["mouseup",function(e){I(C,e)},!1],["mousemove",function(e){I(C,e)},!1],["mouseover",function(e){I(C,e)},!1],["mouseout",function(e){I(C,e)},!1],["dragstart",function(e){I(E,e)},!1],["dragover",function(e){I(E,e)},!1],["drop",function(e){I(E,e)},!1],["dragenter",function(e){I(E,e)},!1],["dragleave",function(e){I(E,e)},!1],[M,function(e){I(C,e)},!0],["contextmenu",function(e){I(x,e)},!1],["submit",function(e){I(R,e)},!1],["reset",function(e){I(D,e)},!1],["cut",function(e){I(L,e)},!1],["copy",function(e){I(P,e)},!1],["paste",function(e){I(d,e)},!1],["select",function(e){I(U,e)},!1],["change",function(e){I(A,e)},!1],["click",function(e){I(C,e)},!1]]}function ImeHelper(){function e(e,t,n,r){var i,o,a,s,c,l,d;if("Explorer"===browser.name)return Util.is_element_input_text(e)?d=e.prev_ftext_ie:"#text"===e.nodeName.toLowerCase()&&(d=e.parentNode.prev_ftext_ie),void 0===d&&(d=""),i=t.substring(0,n-r),o=t.substring(n),a=o?d.substring(0,d.length-o.length):d,s=i.length-a.length,s>0?(c=i.substring(a.length,i.length),l=i+o,{new_text:c,new_ftext:l}):null}function t(e){if(!f)return!1;for(;null!==e;){if(Util.is_elem_editable(e)&&(e===f||e===p))return!0;if(e===e.parentNode||!Util.is_elem_editable(e)&&1===e.nodeType)break;e=e.parentNode}return!1}function n(e,t){return e!==f&&e!==p?!1:(h.push(["update",e,t]),!0)}function r(e,n,r,i){var o=getNodeByUid(e,n);return t(o)?(h.push(["add",e,n,r,i]),!0):!1}function i(e,n,r){return t(r)?(h.push(["remove",e,getWindowByFid(e).document,n,r]),!0):!1}function o(e){return e===f||e===p}function a(e){var t,n,r,i=[f,p];for(t=0;t<i.length;t+=1)for(n=i[t],r=n;r&&(1===r.nodeType||3===r.nodeType);){if(r===e)return!0;r=r.parentNode}return!1}function s(e,t){"Explorer"===browser.name&&(Util.is_element_input_text(e)?e.prev_ftext_ie=t:"#text"===e.nodeName.toLowerCase()?e.parentNode.prev_ftext_ie=t:Util.is_elem_editable(e)&&(e.prev_ftext_ie=t))}function c(){for(var e,t;h.length;)e=h.shift(),"add"===e[0]?safeview.dom_updater.add_text_node(e[1],e[2],e[3],e[4]):"remove"===e[0]?safeview.dom_updater.remove_node(e[1],e[2],e[3],e[4]):"update"===e[0]?(t=e[1],Util.is_element_input_text(t)?t.value=e[2]:safeview.dom_updater.apply_text_node_patch(t,t.data,e[2]),s(t,e[2])):assert(!1,"IME Unknown deferred operation.")}function l(e,t){g&&(clearTimeout(g),g=null),f=e,p=t}function d(){g=setTimeout(function(){f=null,p=null,c(),g=null},0)}function u(e,t){var n,r,i=getNodeByUid(e,t),o=[];if(i&&Util.is_elem_editable(i)&&i.hasChildNodes()){for(n=0;n<i.childNodes.length;n+=1)o.push(i.childNodes[n]);for(;o.length;)r=o.shift(),r.__sv_uid||i.removeChild(r)}}var f,p,_=this,g=null,h=[];_.clear_local_text=u,_.defer_update_if_needed=n,_.defer_add_if_needed=r,_.defer_remove_if_needed=i,_.preserve_value_if_needed=s,_.set_ime_state=l,_.reset_ime_state=d,_.in_ime_mode=o,_.is_editable_in_ime_mode=a,_.is_sibling_in_ime=t,_.compute_new_text=e}function LocalInput(){function e(e){return void 0!==e.prev_text}function t(e){var t=e.prev_text;return void 0===t&&(t=""),t}function n(e){var t;return Util.is_element_input_text(e)?t=e.value:3===e.nodeType&&(t=e.data),t}function r(e){var r,i,o,a,s;if(r=n(e),i=t(e),i===r)return[];for(o=j.diff_main(i,r),a=0,s=o.length;s>a;a+=1)1!==o[a][0]&&(o[a][1]=o[a][1].length);return o}function i(e){return e===T||e===R}function o(e){if(!T)return!1;for(;null!==e;){if(Util.is_elem_editable(e)&&(e===T||e===R))return!0;if(e===e.parentNode||!Util.is_elem_editable(e)&&1===e.nodeType)break;e=e.parentNode}return!1}function a(e,t){return e!==T&&e!==R?!1:(U.push(["update",e,t]),!0)}function s(e,t,n,r){var i=getNodeByUid(e,t);return o(i)?(U.push(["add",e,t,n,r]),!0):!1}function c(e,t,n){return o(n)?(U.push(["remove",e,getWindowByFid(e).document,t,n]),1===t.nodeType||3===t.nodeType,!0):!1}function l(e,t,n,r,a,s,c){return i(a)||o(a)||!a.parentNode?(I=[e,t,n,r,a,s,c],!0):!1}function d(){var e=(new Date).getTime();return O&&500>e-O?!0:!1}function u(e){var t,n,r,i=[T,R];if(d())return!0;for(t=0;t<i.length;t+=1)for(n=i[t],r=n;r&&(1===r.nodeType||3===r.nodeType);){if(r===e)return!0;r=r.parentNode}return!1}function f(e,t){void 0===t&&(t=3!==e.nodeType||getUidByNode(e)||e.__sv_client_id?n(e):""),Util.is_element_input_text(e)||3===e.nodeType||reportErrorClientEvent("tc-local-input-error",{detail:"Unexpected node type in preserve value call"}),e.prev_text=t}function p(e,t){var n,r;if(!e.parentNode)return!1;if(t&&e.parentNode!==t)return!1;for(r=e.parentNode.childNodes,n=0;n<r.length;n+=1)if(r[n]===e)return!0;return!1}function _(){var e,t,n;for(U.length;U.length;)e=U.shift(),"add"===e[0]?safeview.dom_updater.add_text_node(e[1],e[2],e[3],e[4]):"remove"===e[0]?(n=e[3],3===n.nodeType,p(e[3],e[4])&&safeview.dom_updater.remove_node(e[1],e[2],e[3],e[4])):"update"===e[0]?(t=e[1],Util.is_element_input_text(t)?t.value=e[2]:safeview.dom_updater.apply_text_node_patch(t,t.data,e[2]),f(t,e[2])):assert(!1,"IME Unknown deferred operation.");I&&(safeview.selection.set_range_selection(I[0],I[1],I[2],I[3],I[4],I[5],I[6]),I=null)}function g(e,t){P&&(clearTimeout(P),P=null),T=e,R=t}function h(){var e,t,n;H&&(e=H.parentNode,e&&e.hasChildNodes()&&(t=e.childNodes,-1===X||X>=t.length||(n=t[X],n!==H&&n.data===H.data&&(n.__sv_uid||n.__sv_client_id||(setNodeIds(n,getUidByNode(H),getFidByNode(H)),n.__sv_client_id=H.__sv_client_id,delete H.__sv_client_id,delete H.__sv_uid,delete H.__sv_fid)))))}function m(){if(BrowserDetect.isIE()){if(H){var e=H.data;H.data=e}h(),H=null,X=-1}}function v(){P=setTimeout(function(){T=null,R=null,m(),_(),P=null},0)}function y(e){"compositionend"===e&&v()}function w(e,t){var n,r,i=getNodeByUid(e,t),o=[];if(i&&Util.is_elem_editable(i)&&i.hasChildNodes()){for(n=0;n<i.childNodes.length;n+=1)r=i.childNodes[n],r.__sv_client_id||r.__sv_uid||o.push(r);for(;o.length;)r=o.shift(),i.removeChild(r)}}function b(e,t,n,r){var i,o,a,s,c,l,d,u,f=[],p=0,_=-1,g=!1;for(void 0===e.__sv_client_id&&(e.__sv_client_id="l"+K,K+=1),d=e.parentNode.childNodes,i=0;i<d.length;i+=1)if(u=d[i],u===e){if(!e.__sv_client_id)return void reportErrorClientEvent("tc-local-input-error",{detail:"Missing a local node with client id."});f.push(e.__sv_client_id),H=e,X=i,g=!0}else o=getUidByNode(u),void 0!==o?f.push(o):reportErrorClientEvent("tc-local-input-error",{detail:"Unexpected local node among siblings"});if(!g)return void reportErrorClientEvent("tc-local-input-error",{detail:"Inconsistent state about whether there is local node."});if(!f.length)return void reportErrorClientEvent("tc-local-input-error",{detail:"Empty sibling list is unexpected."});for(a=e.parentNode;a&&!(p=getFidByNode(a));)a=a.parentNode;return p?(s=e.ownerDocument.defaultView,c=s.getSelection(),c.rangeCount?(l=c.getRangeAt(0),l.endContainer===e?_=l.endOffset:reportErrorClientEvent("tc-local-input-error",{detail:"Incorrect selection for ime node"})):reportErrorClientEvent("tc-local-input-error",{detail:"Selection missing for ime node"}),void safeview.surrogate_channel.send("ednt",p,getUidByNode(e.parentNode),f,t,_,n,r)):void reportErrorClientEvent("tc-local-input-error",{detail:"fid missing for the ime node"})}function k(e){var t=safeview.selection.getSelection(e);return t.mode!==B.mode&&t.mode!==M.mode?!1:"range"===t.mode?t.start_container===B.start_container&&t.end_container===B.end_container&&t.start_offset===B.start_offset&&t.end_offset===B.end_offset||t.start_container===M.start_container&&t.end_container===M.end_container&&t.start_offset===M.start_offset&&t.end_offset===M.end_offset:"input"===t.mode?t.uid===B.uid&&t.selection.start===B.selection.start&&t.selection.end===B.selection.end||t.uid===M.uid&&t.selection.start===M.selection.start&&t.selection.end===M.selection.end:!1}function S(e,t){var n,r,i,o,a,s,c,l=0,d=-1;if(c=JSON.parse(JSON.stringify(e)),BrowserDetect.isFirefox())return c;if(r=t.length,0===r)return c;if(i=r-1,1!==t[i][0]){if(2>r)return c;i=r-2}if(1!==t[i][0])return c;if(o=t[i][1],1!==o.length&&2!==o.length||!Util.is_korean_char(o))return c;for(n=0;i>=n;n+=1)switch(t[n][0]){case-1:break;case 0:l+=t[n][1];break;case 1:l+=t[n][1].length}if("input"===e.mode)a=e.selection.start,s=e.selection.end;else{if("range"!==e.mode)return reportErrorClientEvent("tc-local-input-error",{detail:"Unexpected selection mode",mode:e.mode}),c;a=e.start_offset,s=e.end_offset}return s===a+1?d=s:s===a&&s+1===l&&(d=l),-1!==d&&("input"===e.mode?(c.selection.start=d,c.selection.end=d):"range"===e.mode&&(c.start_offset=d,c.end_offset=d),c.collapsed=!0),c}function C(e,t){var i=r(e),o=Util.hashCode(n(e)),a=D.EDIT_REASON_COMPOSITION;if(y(t),"paste"===t&&(a=D.EDIT_REASON_PASTE),O=(new Date).getTime(),p(e)){if(getUidByNode(e)){if(!i.length&&k(e))return;B=safeview.selection.getSelection(e),M=S(B,i),safeview.surrogate_channel.send("edtx",getFidByNode(e),getUidByNode(e),i,M,o,a)}else b(e,i,o,a);f(e),!TPROXY_ENABLED&&Util.is_autofill_target(e)&&(e.sv_prev_value=e.value)}}function E(e,t){N=t,V=e,F=setTimeout(function(){C(e,t),F=null},0)}function x(e,t){if(F)return clearTimeout(F),C(V,N),F=null,N=null,void(V=null);if(!i(e)&&Util.is_element_input_text(e)){if(e.__sv_ignore_input_event)return void(e.__sv_ignore_input_event=!1);if((!BrowserDetect.isIE()||document.activeElement===e||!e.placeholder||e.value)&&e.sv_prev_value!==e.value){if(!TPROXY_ENABLED&&Util.is_autofill_target(e))return e.value="password"===e.type?"":e.sv_prev_value,e.sv_prev_value=e.value,void safeview.surrogate_channel.send("input",getFidByNode(e),getUidByNode(e),e.value);safeview.surrogate_channel.send("input",getFidByNode(e),getUidByNode(e),e.value),e.sv_prev_value=e.value}}}function A(t,n){var r,i,o,a,s;if("input"===n.type)return x(t,n),void(local_echo_enabled&&Util.can_element_use_lecho(t)&&(a=getFidByNode(t),s=getUidByNode(t),safeview.lecho_regulator.lecho_enabled(a,s)&&safeview.lecho_regulator.update_local_value(a,s,t.value,-1)));if(!Util.is_element_input_text(t)&&!Util.is_elem_editable(t))return void y(n.type);if(a=getFidByNode(t),Util.is_element_input_text(t))r=t;else if(o=getWindowByFid(a),i=o.getSelection(),DEBUG&&Util.debug_print_selection(i,L),r=i.focusNode,!r)return reportErrorClientEvent("tc-local-input-error",{detail:"No focus node found for local input event",event_type:n.type}),void y(n.type);if("compositionstart"===n.type&&g(t,r),3!==r.nodeType&&!Util.is_element_input_text(r))return void y(n.type);if(!p(r))return void y(n.type);if("paste"!==n.type||Util.is_element_input_text(r)){if("compositionstart"===n.type||"beforeinput"===n.type||"paste"===n.type){if(F&&e(r))return;f(r)}("compositionupdate"===n.type||"compositionend"===n.type||"textInput"===n.type||"paste"===n.type)&&E(r,n.type)}}var T,R,D=this,L=new Logger("localinput",{level:"info"}),P=null,U=[],I=null,O=null,B={},M={},N=null,F=null,V=null,H=null,X=-1,K=1,W=diff_match_patch,j=new W;D.EDIT_REASON_COMPOSITION=1,D.EDIT_REASON_BROWSER=2,D.EDIT_REASON_PASTE=3,D.clear_local_text=w,D.defer_update_if_needed=a,D.defer_add_if_needed=s,D.defer_remove_if_needed=c,D.defer_range_sel_if_needed=l,D.in_ime_mode=i,D.is_editable_in_ime_mode=u,D.is_sibling_in_ime=o,D.handle_local_input_events=A,D.is_node_attached=p}function LEchoRegulator(e){function t(e,t){return e+"_"+t}function n(e){var t=e.split("_");return{fid:t[0],uid:t[1]}}function r(e){return assert(e,"Input state not found."),38===e.last_keypress||40===e.last_keypress?!0:u?!0:!1}function i(e,n,r){var i=t(e,n),o=getNodeByUid(e,n),a=f[i];return assert(a,"Input state not found."),assert(o,"Input element is missing when checking auto completion."),0===r.indexOf(o.value)?!0:!1}function o(e,t,n){var r,i=/[\-, \,, \., \/, \:, \(, \)]/g,o=n.replace(i,"");if(t.value.length>n.length&&0===t.value.indexOf(n))return!1;for(r=0;r<e.local_value_list.length;r+=1)if(e.local_value_list[r].val===o)return!0;return!1}function a(e){var t=local_echo_config.tolerance,n=local_echo_config.tolerance_time,r=e.local_value_list.length;return r?t+1>=r&&Date.now()-e.local_value_list[r-1].ts<n?!0:!1:!0}function s(t,n,s,c,l,d){var u=r(s)||i(t,n,l)||o(s,c,l);s.mode=v,_&&(p=!0),s.remote_value=l,c.value=l,!u&&d&&(a(s)||(s.require_attention=!0,e.lecho_error_alert.add_alert_for_input(t,n,function(){delete s.require_attention})))}function c(){var e;for(e in f)if(f.hasOwnProperty(e)&&f[e].require_attention)return!0;return!1}function l(){var e;for(e in f)f.hasOwnProperty(e)&&delete f[e].require_attention}var d=this,u=!1,f={},p=!1,_=!0,g=!1,h=new KeyMap,m=1,v=2,y=3;d.show_attention_modal_if_needed=function(e){return local_echo_config.need_confirmation&&c()?(local_echo_config.show_alert?d.show_modal_alert():reportClientEvent("tc-lecho-modal-alert",{skipped:!0},!0,!1),l(),!0):!1},d.create_input_state=function(e){f[e]={mode:local_echo_enabled?m:v,local_value_list:[],remote_value:null,remote_care_pos:[0,0],last_keypress:null}},d.set_mouse_moved=function(){u=!0},d.set_last_keypress=function(e,n,r){var i,o=t(e,n);u=!1,f[o]||d.create_input_state(o),i=f[o],i.last_keypress=r,i.require_attention&&!h.LECHO_SPECIAL_KEYS.hasOwnProperty(r)&&delete i.require_attention},d.update_remote_value=function(e,n,r,i,o){var a,c,l,u=t(e,n),_=!1;if(a=getNodeByUid(e,n),assert(a,"Input element is missing when in update_remote_value."),f[u]||(d.create_input_state(u),a.value=r,f[u].remote_value=r,f[u].local_value_list.push({ts:Date.now(),val:r})),c=f[u],p||c.mode===v)return a.value=r,void(c.remote_value=r);if(!c.had_local_input)return a.value=r,c.remote_value=r,void(c.local_value_list=[{ts:Date.now(),val:r}]);if(!r&&!a.value)return c.local_value_list=[{ts:Date.now(),val:""}],void(c.remote_value=r);if(!r&&a.value)return c.mode=v,a.value=r,void(c.remote_value=r);if(i)return void s(e,n,c,a,r,o);for(l=0;l<c.local_value_list.length;l+=1)if(c.local_value_list[l].val===r){_=!0,l===c.local_value_list.length-1&&(c.remote_has_caught_up=!0,a.value!==r&&reportErrorClientEvent("tc-lecho-error-wrong-local-value",{detail:"The last reconciled value on the local value list is inconsistent with the input value."}));break}_?(c.local_value_list.splice(0,l),1===c.local_value_list.length&&c.mode===y&&(c.mode=v)):s(e,n,c,a,r,o)},d.update_local_value=function(n,r,i,o){var a,s,c,l=t(n,r);f[l]||d.create_input_state(l),a=f[l],s=a.local_value_list.length,u=!1,a.had_local_input=!0,c=-1===o,s>=1&&a.local_value_list[s-1].non_keypress&&c?(a.local_value_list[s-1].val=i,a.local_value_list[s-1].ts=Date.now()):a.local_value_list.push({ts:Date.now(),val:i,non_keypress:c}),a.remote_has_caught_up=!1,e.surrogate_channel.send("lecho-hash",n,r,Util.hashCode(i),o,DEBUG?i:void 0),a.local_value_list.length>local_echo_config.max_typeahead+1&&(a.mode=y)},d.set_remote_caret=function(e,n,r,i){var o,a,s=t(e,n);return f[s]||d.create_input_state(s),o=f[s],a=getNodeByUid(e,n),assert(a,"Input element is missing when setting remote caret."),p||o.mode===v?(a.selectionStart=r,void(a.selectionEnd=i)):(r===i||a.selectionStart===r&&a.selectionEnd===i||(a.selectionStart=r,a.selectionEnd=i,o.remote_has_caught_up||(o.mode=v,a.value=o.remote_value)),void(o.remote_caret_pos=[r,i]))},d.lecho_enabled=function(e,n){var r=t(e,n);return f[r]||d.create_input_state(r),!p&&f[r].mode===m},d.get_lecho_values=function(){var e,t,r,i,o,a=[];for(o in f)f.hasOwnProperty(o)&&(e=n(o).fid,e=parseInt(e,10),t=n(o).uid,t=parseInt(t,10),r=getNodeByUid(e,t),r?(i=r.value,a.push([e,t,i||""])):reportErrorClientEvent("tc-lecho-error-clean-up",{detail:"Lecho state was not cleaned up properly"}));return a},d.input_elem_is_managed=function(e,n){var r=t(e,n);return f.hasOwnProperty(r)?!0:!1},d.on_remove_node=function(e,n){var r=t(e,n);delete f[r]},d.lock_input=function(){g=!0},d.unlock_input=function(){g=!1},d.is_input_locked=function(){return g},d.show_modal_alert=function(t,n){var r=e.localization.get("ID_MODAL_LECHO_ALERT_TEXT"),i=e.localization.get("ID_MODAL_LECHO_ALERT_TITLE");reportClientEvent("tc-lecho-modal-alert",{},!0,!1),e.ui_frame.call("showInputInconsistencyAlert",r,i)}}function TextMonitor(e){function t(t,n,r,i){var o,a,s,c;if(null===r&&(r=""),null===i&&(i=""),r!==i)if(o=A.diff_main(r,i),use_old_ime)e.surrogate_channel.send("patch-text",t,n,o,r,i),e.surrogate_channel.send("selection",t,e.selection.getSelection(getNodeByUid(t,n)));else{for(s=0,c=o.length;c>s;s+=1)1!==o[s][0]&&(o[s][1]=o[s][1].length);a=Util.hashCode(i),e.surrogate_channel.send("edtx",t,n,o,e.selection.getSelection(getNodeByUid(t,n)),a,e.local_input.EDIT_REASON_BROWSER)}}function n(e){var t;for(t=0;t<e.length;t+=1)if("characterData"!==e[t].type)return!1;return!0}function r(e,n,r){var i,o,a={};for(i=0;i<r.length;i+=1){if(assert("characterData"===r[i].type),o=getUidByNode(r[i].target),!o)return!1;a[o]||(a[o]=r[i])}for(o in a)a.hasOwnProperty(o)&&t(e,parseInt(o,10),a[o].oldValue,a[o].target.nodeValue);return!0}function i(e,t){for(var n=[];t&&t!==t.parentNode&&(1===t.nodeType||3===t.nodeType||8===t.nodeType)&&t!==e;)n.unshift(t),t=t.parentNode;return n.unshift(e),n}function o(e){var t,n={};for(assert(e),t=0;t<e.attributes.length;t+=1)n[e.attributes[t].name]=e.attributes[t].value;return n}function a(e,t){var n,r,i,s=[];for(n=0;n<e.childNodes.length;n+=1)r=e.childNodes[n],3===r.nodeType||1===r.nodeType?(s.push(r.nodeName),3===r.nodeType?s.push(r.nodeValue):1===r.nodeType?s.push(o(r)):assert(!1),i={},t&&t.startContainer===r&&(i.startOffset=t.startOffset),t&&t.endContainer===r&&(i.endOffset=t.endOffset),s.push(i),s.push(a(r,t))):reportWarnClientEvent("tc-text-monitoring-error",{node_type:r.nodeType,error:"Unexpected node type"});return s}function s(e){var t=e.ownerDocument.defaultView,n=t.getSelection();return n.rangeCount?n.getRangeAt(0):null}function c(e,t){var n,r,o,a=[],s=-1;for(assert(!!t&&t.length>=1),n=0;n<t.length;n+=1)a.push(i(e,t[n]));for(;;){for(r=s+1,o=a[0][r],n=0;n<t.length;n+=1)if(a[n].length<=r||a[n][r]!==o)return-1===s?null:a[0][s];s+=1}return a[0][s]}function l(e,t){var n,r;for(n=0;n<e.childNodes.length;n+=1)r=e.childNodes[n],getUidByNode(r)?l(r,t):t.push(r)}function d(t,n,r){var i,o,l=getNodeByUid(t,n);if(!r.length)return void reportErrorClientEvent("tc-text-monitoring-error",{error:"No DOM node add/remove detected",root_editable:getNodeByUid(t,n).nodeName});for(i=c(l,r);i&&!getUidByNode(i);)i=i.parentNode;if(!i)return void reportErrorClientEvent("tc-text-monitoring-error",{error:"No common ancestor",root_editable:getNodeByUid(t,n).nodeName});for(o=s(i),e.surrogate_channel.send("graft",t,getUidByNode(i),a(i,o)),y.pause_all();i.firstChild;)i.removeChild(i.firstChild);y.resume_all()}function u(e){var t,n="";for(t=0;t<e.length;t+=1)n+=" ["+e[t].type,"childList"===e[t].type&&(n+=", +"+e[t].addedNodes.length+"/-"+e[t].removedNodes.length),n+="]"}function f(t){return t?e.local_input.is_editable_in_ime_mode(t)?!1:!0:(reportErrorClientEvent("tc-text-monitoring-error",{error:"Root editable no longer exists"}),!1)}function p(e,t,i){var o=!1,a=[],s=getNodeByUid(e,t);f(s)&&(u(i),n(i)&&(o=r(e,t,i)),o||(l(s,a),d(e,t,a)))}function _(e,n){var r,i,o,a,s=[],c=getNodeByUid(e,n);if(l(c,s),s.length)d(e,n,s);else for(i in E)E.hasOwnProperty(i)&&(r=E[i].text_node_id,a=getNodeByUid(e,r).nodeValue,o=E[i].old_text,t(e,r,o,a));E={}}function g(e,t,n){var r,i,o=getNodeByUid(e,t);if(f(o)){if(r=getUidByNode(n.target),"DOMCharacterDataModified"===n.type&&r){if(i=e+"_"+r,E[i])return;E[i]={text_node_id:r,old_text:n.prevValue}}else;C||(C=setTimeout(function(){_(e,t),C=null},100))}}function h(e,t){EventListener.addListener(e,"DOMCharacterDataModified",t),EventListener.addListener(e,"DOMNodeInserted",t),EventListener.addListener(e,"DOMNodeRemoved",t)}function m(e,t){EventListener.removeListener(e,"DOMCharacterDataModified",t),EventListener.removeListener(e,"DOMNodeInserted",t),EventListener.removeListener(e,"DOMNodeRemoved",t)}function v(e,t){var n,r;y.in_effect=!0,n=getNodeByUid(e,t),b[e+"_"+t]||(k?(r=new MutationObserver(function(n){p(e,t,n)}),S||r.observe(n,w)):(r=function(n){g(e,t,n)},S||h(n,r)),b[e+"_"+t]={node:n,observer:r})}var y=this,w={attributes:!1,childList:!0,characterData:!0,subtree:!0,characterDataOldValue:!0},b={},k=!0,S=0,C=null,E={},x=diff_match_patch,A=new x;y.monitor_text_change=function(e,t){var n,r=t;for(assert(Util.is_elem_editable(t));r.parentNode&&1===r.parentNode.nodeType&&Util.is_elem_editable(r.parentNode);)r=r.parentNode;return(n=getUidByNode(r))?void v(e,n):void reportErrorClientEvent("tc-text-monitoring-error",{error:"Root editable node is not a mapped node",root_editable:r.nodeName})},y.on_remove_node=function(e,t){var n;y.in_effect&&(n=b[e+"_"+t],n&&(k?n.observer.disconnect():m(n.node,n.observer),delete b[e+"_"+t],Object.keys(b).length||(y.in_effect=!1)))},y.pause_all=function(){var e,t;if(S+=1,assert(S>0),y.in_effect)for(t in b)b.hasOwnProperty(t)&&(e=b[t],k?e.observer.disconnect():m(e.node,e.observer))},y.resume_all=function(){var e,t;if(0===S)return reportErrorClientEvent("tc-text-monitoring-error",{error:"Pause/resume count does not match"}),void soft_assert(!1);if(S-=1,!S&&y.in_effect)for(t in b)b.hasOwnProperty(t)&&(e=b[t],k?e.observer.observe(e.node,w):h(e.node,e.observer))},k=!!window.MutationObserver&&"Explorer"!==browser.name,y.in_effect=!1}function ShadowDomSupport(e){function t(e){var t,n;for(t=0;t<e.childNodes.length;t+=1)n=e.childNodes[t],!n.__sv_shadow_root&&n.style&&"none"!==n.style.display&&(n.style.display="none")}function n(e,n,r){var i,o,a,s,c,l,d,u,f,p=getNodeByUid(e,r),_=["width","height","max-width","max-height"],g=!1,h=!1;if(!p)return void reportWarnClientEvent("tc-shadow-root-missing",{fid:e,shadow_root_id:r});for(i=getNodeByUid(e,n),assert(i===p.parentNode),t(i),o=p.contentWindow.document,a=o.body.scrollWidth,s=o.body.scrollHeight,c=0;c<_.length;c+=1)l=_[c],d=i.style.getPropertyValue(l),d&&(u=p.style.getPropertyValue(l),u!==d&&(f=i.style.getPropertyPriority(l),p.style.setProperty(l,d,f?"important":""),"width"===l&&(h=!0),"height"===l&&(g=!0)));h||p.getAttribute("width")===a.toString()||p.setAttribute("width",a),g||p.getAttribute("height")===s.toString()||p.setAttribute("height",s)}function r(t,r,i,s){var c=t.contentWindow;assert(Util.isIframeReady(t)),assert(a[r]),assert(a[r][s]),a[r][s].is_ready=!0,setFidToWindow(c,s),e.local_events.install_event_listeners(c,c.document,!1),c.onbeforeunload=function(){},o.loading_shadow_root(r)||e.update_queue.deliver(r,e.interpretQueued),a[r][s].timer=setInterval(function(){n(r,i,s)},1e3)}function i(e,n,i){var c,l=getWindowByFid(e),d=getNodeByUid(e,n);c=l.document.createElement("iframe"),c.setAttribute("name","sv-shadow-root"),c.setAttribute("src","about:blank"),c.setAttribute("style","border:none; margin: 0px; padding: 0px"),c.setAttribute("scrolling","no"),c.setAttribute("sv_frame_id",i),c.__sv_shadow_root=!0,c.onload=function(){r(c,e,n,i)},o.on_node_remove(e,n),setNodeIds(c,i,e),a[e]||(a[e]={}),a[e][i]={},a[e][i].is_ready=!1,s[e+"_"+n]=i,t(d),d.insertBefore(c,d.firstChild)}var o=this,a={},s={};o.loading_shadow_root=function(e){var t,n=a[e];if(!n)return!1;for(t in n)if(n.hasOwnProperty(t)&&!n[t].is_ready)return!0;return!1},o.adjust_parent_fragment_size=function(e,t){var r,i,o,a=getNodeByUid(e,t),s=getWindowByFid(e),c=a.ownerDocument.defaultView;c&&c!==s&&(o=c.frameElement,o&&o.__sv_shadow_root&&(r=getUidByNode(o),i=getUidByNode(o.parentNode),n(e,i,r)))},o.on_node_remove=function(e,t){var n,r;a[e]&&(n=s[e+"_"+t],n&&a[e][n]&&(r=getNodeByUid(e,n),r&&(r.remove?r.remove():r.removeNode(!0)),clearInterval(a[e][n].timer),delete a[e][n],delete s[e+"_"+t],Object.keys(a[e]).length||delete a[e]))},o.add_shadow_root=function(e,t,n){var r=getNodeByUid(e,t);assert(r),i(e,t,n)}}function DOMUpdater(e){function t(e,t){var n,r;if(e)for(n=e.childNodes.length-1;n>=0;n-=1)r=e.childNodes[n],r.id&&t.indexOf(r.id)>-1||e.removeChild(r)}function n(e){for(;e.attributes.length;)e.removeAttribute(e.attributes[0].name)}function r(r,i,o,a){if("Explorer"!==browser.name||!e.xbrowser.processIECharacterData(o,a,"remove",void 0))try{"sub"===e.role||!isTopFrameFid(r)||o!==i.head&&o!==i.body?a.removeChild(o):(t(o,e.feedback_bar.feedbackElementIDs()),o.firstChild?(n(o),o.__sv_saved_for_feedback=!0):a.removeChild(o))}catch(s){if(a.isContentEditable)return;soft_assert(!1,"parent_node.removeChild() raised exception : "+s)}}function i(t){var n,r,o,a;if(!t.__sv_unmapped_frame){if(o=getFidByNode(t),a=getUidByNode(t),removeUidNodeEntry(o,a),local_echo_enabled&&Util.can_element_use_lecho(t)&&e.lecho_regulator.on_remove_node(o,a),Util.is_frame_node(t)){if(r=getFrameFidByNode(t),!r)return void reportWarnClientEvent("tc-dom-unexpected-iframe",{node_detail:t.outerHTML});removeFidWindowEntry(r),removeFidToIframe(r),removeUidNodeEntriesForFid(r),e.callback.fire("frame-node-removed",r,t)}for(n=0;n<t.childNodes.length;n+=1)i(t.childNodes[n])}}function o(e){return e&&(__startswith(e,"cof-server:")||__startswith(e,"safeview")||__startswith(e,"__safly_"))}function a(e){var t,n,s,c=mf.document;for(assert(e===c.documentElement||e===c.body),s=e.querySelectorAll("iframe, frame"),t=s.length-1;t>=0;t-=1)o(s[t].id)||i(s[t]);for(t=e.childNodes.length-1;t>=0;t-=1)n=e.childNodes[t],o(n.id)||(n===c.body?a(n):r(mf.window.__sv_fid,c,n,e))}function s(t,n,r,i,o,a){e.preload_indicator.dismiss(),e.callback.fire("dom-init",n,i,o,a)}function c(t,n){e.stats.stop("time_tc_dom_load"),e.stats.stop("time_tc_nav_load"),n?n.mode="r1":n={mode:"r1"},e.callback.fire("dom-loaded",n)}function l(t,n,r){var i,o=getWindowByFid(t);o&&(i=o.document,r&&i.documentElement&&(a(i.documentElement),e.callback.fire("dom-reset",t)),setNodeIds(i,n,t))}function d(e){var t=e.target.window.feedback_bar;t&&t.updateReadonlyUI()}function u(t,n,r,i){var o,a=getWindowByFid(t);a&&(reportClientEvent("readonly-status-update",{is_readonly:r,is_parent_readonly:i,is_top_isolated_frame:n,fid:t,tclevel:"tc-local-stats"},!1,!0),n?o=e.feedback_bar:a.feedback_bar?o=a.feedback_bar:(EventListener.addListener(a,"resize",d,!1),o=new FeedbackBar(e,a,!1),a.feedback_bar=o),o.setReadonlyUI(r,i),a.__sv_surrogate_is_readonly=r)}function f(e,t){var n,r,i=t;return TPROXY_ENABLED&&(n=e.localName.toLowerCase(),r=t[0],"link"!==n&&"/"===r&&(i=t.substr(1))),i}function p(e,t,n){return"href"===e?n=f(t,n):"action"===e&&(-1!==n.toLowerCase().indexOf("javascript")&&(n=""),"form"===t.localName.toLowerCase()&&(n="about:blank")),n}function _(e,t,n,r,i){var o,a;for(o=0;o<r.length;o+=1)if("sv_frame_id"===r[o][0]){
a=r[o][1];break}return a?Util.compute_iframe_src(i,a,null):(reportErrorClientEvent("tc-dom-frame-fid-missing"),"about:blank")}function g(t,n,r,i,o){function a(e){var n=null;return t.document?("head"===e&&t.document.head&&t.document.head.__sv_saved_for_feedback?n=t.document.head:"body"===e&&t.document.body&&t.document.body.__sv_saved_for_feedback&&(n=t.document.body),n&&delete n.__sv_saved_for_feedback,n):null}var s,c;return"safely_embed"===n?s=t.document.createElement("object"):(isTopFrameFid(t.__sv_fid)&&(s=a(n)),s||(s=e.xbrowser.createElement(t,o,r))),assert(s),c=s.localName.toLowerCase().trim(),re.hasOwnProperty(c)?void reportClientEvent("tc-blocked-element",{name:n}):s}function h(e,t,n,r){if(soft_assert(t,"Node is null for insertion."),soft_assert(n,"Parent is null for insertion."),n.hasChildNodes()){if(r){var i=getNodeByUid(e,r);t.previousSibling!==i&&n.insertBefore(t,i.nextSibling)}else n.firstChild!==t&&n.insertBefore(t,n.firstChild);return!0}return!1}function m(t,n){var i,o=t.document;return assert(o),i=o.getElementsByTagName("html")[0],i||(i=e.xbrowser.createElement(t,n,"html"),o.appendChild(i)),o.head&&r(t.__sv_fid,o,o.head,o.head.parentNode),o.body&&r(t.__sv_fid,o,o.body,o.body.parentNode),assert(i),i}function v(e){return Util.makeSet(["id","class","style","width","height","name","hspace","vspace","align","title","tabindex","data-sv-src"]).hasOwnProperty(e)}function y(t,n,r,i){var o,a,s,c,l,d=e.url_builder.buildServiceURL(n),u=t.createElement("iframe");if(i)for(o=0;o<i.length;o+=1)"style"===i[o][0]?s=i[o][1]:"height"===i[o][0]?c=i[o][1]:"width"===i[o][0]&&(l=i[o][1]);u.setAttribute("width",l||"100%"),u.setAttribute("height",c||"100%"),s&&u.setAttribute("style",s),u.style.margin="0",u.setAttribute("src",d),u.__sv_unmapped_frame=!0,u.onload=function(e,t){for(a=e.target.parentElement.childNodes,o=0;o<a.length;o+=1)a[o]!==e.target&&a[o].style&&(a[o].style.display="none")},r.appendChild(u)}function w(t,n,r,i,o){var a,s,c,l,d=[];for(a=0;a<o.length;a+=1)if(c=o[a][0],s=o[a][1],l=o[a][2],("src"!==c||"audio"!==i&&"video"!==i||!e.media_source_extensions.get_media_source_or_falsy(getFidByNode(n),r))&&("Explorer"===browser.name&&"input"===i&&"value"===c&&d.push([c,s]),"safely_embed"!==i||v(c))){if("safely_embed"===i&&"data-sv-src"===c){y(t.document,s,n,o);break}"value"===c&&"textarea"===i&&(DEBUG&&n.value===s,n.value=s),s=p(c,n,s),Util.is_frame_node_name(i)&&"src"===c&&(s="main"===e.role?"about:blank":_(t,n,l,o,s)),"Explorer"===browser.name&&browser.version>=10&&"textarea"===i&&"placeholder"===c&&(n.__sv_ignore_input_event=!0);try{"xmlns"===c&&(l=null),e.xbrowser.setAttribute(t,n,l,c,s)}catch(u){reportClientEvent("tc-set-attribute-exception",{node_name:n.nodeName,attribute_name:c},!0)}}return d}function b(e){e.hasOwnProperty||(e.hasOwnProperty=Object.prototype.hasOwnProperty)}function k(t,n,r,i,o,a,s,c){var l,d=!1,u=!1,f=!1;if("object"===Util.get_node_tag(r)&&r.backend_object_created&&1===i.nodeType&&i.style&&(i.style.display="none"),Util.is_frame_node_name(a))e.callback.fire("frame-node-inserted",i,o);else if(("img"===a||"input"===a)&&e.xbrowser.hasAttribute(i,null,"height")&&e.xbrowser.hasAttribute(i,null,"width")){for(l=0;l<s.length;l+=1)"height"===s[l][0]?d=!0:"width"===s[l][0]?u=!0:"type"===s[l][0]&&"image"===s[l][1]&&(f=!0);("img"===a||"input"===a&&f)&&(!d&&e.xbrowser.hasAttribute(i,null,"height")&&i.removeAttribute("height"),!u&&e.xbrowser.hasAttribute(i,null,"width")&&i.removeAttribute("width"))}else"animate"===a&&"Explorer"===browser.name?"path"===Util.get_node_tag(r)&&e.xbrowser.hasAttribute(i,null,"to")&&e.xbrowser.hasAttribute(i,null,"attributeName")&&"d"===i.getAttribute("attributeName")&&e.xbrowser.hasAttribute(r,null,"d")&&e.xbrowser.setAttribute(n,r,"","d",i.getAttribute("to")):"form"===a&&e.xbrowser.setAttribute(n,i,"","action","about:blank");w(n,i,o,a,c),b(i)}function S(t,n,r,i,o,a,s){var c,l,d,u,f,p,_=getWindowByFid(t),v=r.toLowerCase(),y=de[t+"_"+n],b=[];if(l=getNodeByUid(t,o),soft_assert(l,"Unknown parent "+o),ue&&l.__sv_shadow_root&&(p=l.contentDocument,l=p.body,_=p.defaultView),"html"===v&&"#document"===l.nodeName)c=m(_,s),d=!0,e.local_events.install_event_listeners(_,_.document,d),b=w(_,c,n,v,i);else{if(y)c=y;else if(c=g(_,v,r,n,s),!c)return;b=w(_,c,n,v,i),u=!1;try{u=h(t,c,l,a)}catch(S){reportWarnClientEvent("tc-dom-insert-sibling-error",{node:c.nodeName,error:S.toString()})}if(!u)try{l.appendChild(c)}catch(S){f=e.xbrowser.appendChildThatHandlesIE8CornerCase(_,v,n,i,l),f?c=f:reportWarnClientEvent("tc-dom-alternate-append-child-failed",{child:v,parent:Util.get_node_tag(l)})}}setNodeIds(c,n,t),k(s,_,l,c,n,v,i,b),ue&&ue.adjust_parent_fragment_size(t,n),Util.is_elem_editable(c)&&e.text_monitor.monitor_text_change(t,c),e.callback.fire("add-element",_,c,v,s),("video"===v||"audio"===v)&&e.callback.fire("new-media-node",t,n)}function C(e,t,n,r,i,o){S(e,t,n,r,i,o,"http://www.w3.org/1999/xhtml")}function E(e,t,n,r,i,o){S(e,t,n,r,i,o,"http://www.w3.org/2000/svg")}function x(e,t,n,r,i,o,a){S(e,t,n,r,i,o,a)}function A(t,n,r,i){var o=getNodeByUid(t,n);e.local_input.clear_local_text(t,n);try{h(t,i,o,r)||o.appendChild(i)}catch(a){reportWarnClientEvent("tc-dom-char-data-add-error",{error:a.toString()}),soft_assert(0,"Exception adding characterData element")}}function T(e,t,n,r){var i,o,a=getNodeByUid(e,n);if(a.hasChildNodes)for(o=a.childNodes,i=0;i<o.length;i+=1)if(o[i].__sv_client_id===r)return setNodeIds(o[i],t,e),!0;return!1}function R(t,n,r,i,o,a,s){var c,l,d,u,f=getWindowByFid(t),p=!1;if(f){if(r=r.toLowerCase(),"#text"!==r)return void e.fatalError("tc-unsupported_character-data",{name:r});if(d=getNodeByUid(t,o),soft_assert(d,"Unknown parent"),c=f.document,ue&&d.__sv_shadow_root&&(c=d.contentDocument,d=c.body),s)return void T(t,n,o,s);if(l=c.createTextNode(i),"TEXTAREA"!==d.nodeName){if("Explorer"===browser.name&&(p=e.xbrowser.processIECharacterData(l,d,"add",i)),!p){if(e.local_input.defer_add_if_needed(t,o,a,l))return void setNodeIds(l,n,t);A(t,o,a,l)}setNodeIds(l,n,t),"option"===Util.get_node_tag(d)&&(u=d.parentNode,"select"===Util.get_node_tag(u)&&u.hasOwnProperty("__safely_select_value")&&u.__safely_select_value===d.value&&e.xbrowser.setSelectValue(u,u.__safely_select_value)),ue&&ue.adjust_parent_fragment_size(t,n)}}}function D(e,t,n){var r,i,o,a,s=le.diff_main(t,n),c=0;for(r=0,i=s.length;i>r;r+=1)o=s[r][0],a=s[r][1],-1===o?e.deleteData(c,a.length):0===o?c+=a.length:(e.insertData(c,a),c+=a.length);e.parentNode&&e.parentNode.isContentEditable&&e.data!==n&&(reportErrorClientEvent("tc-local-input-error",{detail:"Value not consistent after text node update."}),use_old_ime||(e.data=n))}function L(t,n,r,i){var o,a=getNodeByUid(t,n),s=getNodeByUid(t,i),c=unescape(r);if(soft_assert(a,"Unknown node"),soft_assert(s,"Unknown parent"),"Explorer"!==browser.name||!e.xbrowser.processIECharacterData(a,s,"modify",c)){if(o=a.data,o===c)return;e.local_input.defer_update_if_needed(a,c)||D(a,o,c)}ue&&ue.adjust_parent_fragment_size(t,n)}function P(t,n,o){var s,c=getNodeByUid(t,n);if(e.text_monitor.on_remove_node(t,n),c===mf.document.documentElement||c===mf.document.body)return void a(c);if(c||(s=getNodeByUid(t,o),!s||"TEXTAREA"!==s.nodeName)){if(soft_assert(c,"Unknown node"),i(c),o){if(s=getNodeByUid(t,o),e.local_input.defer_remove_if_needed(t,c,s))return;soft_assert(s,"Unknown parent"),r(t,getWindowByFid(t).document,c,s)}ue&&ue.on_node_remove(t,n)}}function U(){var e,t,n=fe;fe={},pe=null;for(e in n)n.hasOwnProperty(e)&&(t=getNodeByUid(n[e].fid,n[e].uid),t.sheet?t.sheet.disabled=n[e].disabled:(n[e].tried+=1,100===n[e].tried?reportErrorClientEvent("tc-dom-node-sheet-missing",{fid:n[e].fid,uid:n[e].uid}):I(n[e].fid,n[e].uid,n[e].disabled,n[e].tried)))}function I(e,t,n,r){var i=e+"_"+t;fe[i]={fid:e,uid:t,disabled:n,tried:r},pe||(pe=setTimeout(U,200))}function O(e,t){var n=e+"_"+t;fe.hasOwnProperty(n)&&delete fe[n]}function B(t,n,r,i,o,a,s,c){var l,d,u,f=getNodeByUid(t,n);soft_assert(f,"Unknown node"),u=Util.get_node_tag(f),i=i.toLowerCase(),"select"===u?"value"===i?e.xbrowser.setSelectValue(f,o):"selectedindex"===i&&(f.selectedIndex=o):"input"===u&&"checked"===i?f.checked=o:"value"===i&&Util.is_element_input_text(f)?(l=s,d=c,DEBUG&&f.value===o,e.local_input.defer_update_if_needed(f,o)||(local_echo_enabled&&Util.can_element_use_lecho(f)?e.lecho_regulator.update_remote_value(t,n,o,l,d):f.value=o),!TPROXY_ENABLED&&Util.is_autofill_target(f)&&(f.sv_prev_value=o)):"input"===u&&"file"===f.type?reportErrorClientEvent("tc-dom-unexpected-property-update",{op:r,name:i,value:o,node_value:f.value,value_on_TC:f.value||"(unset)"}):"__sv_ss_disabled"===i?"link"===u?f.sheet?(f.sheet.disabled=o,O(t,n)):I(t,n,o,1):"style"===u&&(f.disabled=o):"img"===u&&"currentsrc"===i?f.src=o:soft_assert(0,"modify-prop: unknown property: op="+r+" tag="+u+" name="+i+" value="+o),Util.is_elem_editable(f)&&e.text_monitor.monitor_text_change(t,f),ue&&ue.adjust_parent_fragment_size(t,n)}function M(t,n,r,i,o,a){var s,c,l,d,u=getNodeByUid(t,n),f=getWindowByFid(t),_=i.toLowerCase();if(soft_assert(u,"Unknown node"),s=Util.get_node_tag(u),"object"!==s||v(_)){if("object"===s&&"data-sv-src"===_&&y(f.document,o,u),"add"===r?(("xmlns"===_||__startswith(_,"xmlns:"))&&(a=null),o=p(_,u,o),f=getWindowByFid(getFidByNode(u)),e.xbrowser.setAttribute(f,u,a,i,o)):"remove"===r&&u.removeAttribute(i),"link"===s&&"disabled"===_)for(c=document.getElementsByTagName("link"),d=0;d<c.length;d+=1)l=c[d],l.hasAttribute("disabled")?l.disabled=!0:l.getAttribute("rel")&&-1!==l.getAttribute("rel").indexOf("style")&&l.getAttribute("title")&&(l.disabled=!0,l.disabled=!1);Util.is_elem_editable(u)&&e.text_monitor.monitor_text_change(t,u),ue&&ue.adjust_parent_fragment_size(t,n)}}function N(e,t,n){if("SURR"!==n&&"TC"!==n)return void reportErrorClientEvent("tc-dom-unknown-scroll-control",{scroll_controller:n});var r,i,o,a,s=getNodeByUid(e,t),c=findScrollControllers(s),l=c.length;if(l){if(r=c[0],i=c[l-1],"TC"===n&&!isScrollable(r)){for(o=0;l>o;o+=1)if(isScrollable(c[o])){r=c[o],a=!0;break}a||(l>1?r=c[l-2]:i.__sv_scroll||(r=i))}r.__sv_scroll=n,r.__sv_source="explicit",i.__sv_scroll!==n&&"SURR"===n&&(i.__sv_scroll=n,i.__sv_source="root")}}function F(t,n,r,i){var o=getWindowByFid(t),a=getNodeByUid(t,n),s=Util.get_node_tag(a);soft_assert(a,"Unknown node"),a===document.body&&document.scrollingElement&&(a=document.scrollingElement),r=Math.floor(a.scrollWidth*r),i=Math.floor(a.scrollHeight*i),e.local_events.ignored_events.scroll[t+"_"+n]=!0,"body"===s?o.scrollTo(r,i):(a.scrollTop=i,a.scrollLeft=r)}function V(e,t,n){var r,i,o=!1;if(r=null===t?getWindowByFid(e):getNodeByUid(e,t),soft_assert(r,"Unknown node"),r.focus){if(document.body&&document.activeElement===r)return;ge&&n&&!Util.elementIsInsideViewport(r)&&isTopFrameFid(e)&&0===getWindowByFid(e).pageYOffset&&(o=!0),o&&(i=document.body.style.position,document.body.style.position="fixed"),r.focus(),o&&setTimeout(function(){document.body.style.position=i},0)}}function H(e,t){var n;if(n=null===t?getWindowByFid(e):getNodeByUid(e,t),soft_assert(n,"Unknown node"),n.blur){if(document.body&&document.activeElement!==n)return;n.blur()}else reportWarnClientEvent("tc-dom-unable-to-blur",{node:n.nodeName})}function X(e,t,n){try{e.sheet.insertRule(t,n)}catch(r){reportClientEvent("tc-css-insert-rule-exception",{rule:t},!0);try{e.sheet.insertRule("#_sv_dummy {}",n)}catch(i){}}}function K(e,t){try{e.sheet.deleteRule(t)}catch(n){reportClientEvent("tc-css-delete-rule-exception",{},!0)}}function W(e){var t,n=[];for(e&&ae&&clearTimeout(ae),ae=0,t=0;t<ie.length;t+=1)j(ie[t],n);ie=n}function j(e,t){var n=getNodeByUid(e[1],e[2]);return n?(e[0]===oe.INSERT?X(n,e[3],e[4]):K(n,e[3]),void(ue&&ue.adjust_parent_fragment_size(e[1],e[2]))):(t.push(e),void(ae||(ae=setTimeout(W,se))))}function z(e,t,n,r){W(!0),j([oe.INSERT,e,t,n,r],ie)}function Y(e,t,n){W(!0),j([oe.DELETE,e,t,n],ie)}function Q(e,t){var n=getWindowByFid(e).document;"Explorer"===browser.name||browser.version<=10?"on"===t?n.body.setAttribute("contenteditable"):"off"===t&&n.body.removeAttribute("contenteditable"):n.designMode=t}function G(e){var t="__sv_favicon",n=document.getElementById(t);document.head&&(n||(n=document.createElement("link"),n.type="image/x-icon",n.rel="shortcut icon",n.id=t,document.head.appendChild(n)),(__startswith(e,"data:image/")||__startswith(e,"https://"))&&(n.href=e))}function q(t){return isTopFrameFid(t)?void(e.frameset_wrapper=new FramesetWrapper(mf.window,t,function(){e.update_queue.deliver(t,e.interpretQueued)})):void soft_assert(!1,"using_frameset command sent to a wrong frame.")}function J(t,n,r){ue||(ue=new ShadowDomSupport(e)),ue.add_shadow_root(t,n,r)}function Z(e){return ue&&ue.loading_shadow_root(e)}function $(){e.ui_frame.call("showCopyPasteModal",BrowserDetect.isMac())}function ee(e,t,n){var r=getNodeByUid(t,n);return r||(r=document.createElement(e),setNodeIds(r,n,t),ne.addRetainedNode(t,n,r)),r}function te(e,t){ne.removeRetainedNode(e,t)}var ne=this,re={script:1,embed:1,applet:1},ie=[],oe={INSERT:1,DELETE:2},ae=0,se=100,ce=diff_match_patch,le=new ce,de={},ue=null,fe={},pe=null,_e=1e4,ge=!0;ne.addRetainedNode=function(e,t,n){de[e+"_"+t]=n},ne.removeRetainedNode=function(e,t){delete de[e+"_"+t]},ne.apply_text_node_patch=D,ne.add_text_node=A,ne.remove_node=r,ne.clear_dom=a,ne.has_pending_shadow_root=Z,e.media_objects.setClient({new_media_node:ee,did_remove_media_node:te}),e.interp.registerOpcodeHandler("CSS_insert_rule",z),e.interp.registerOpcodeHandler("CSS_delete_rule",Y),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_ELEMENT,C),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_CHARACTER_DATA,R),e.interp.registerOpcodeHandler(e.interp.OPCODES.MODIFY_PROP_VALUE,B),e.interp.registerOpcodeHandler(e.interp.OPCODES.MODIFY_ATTR_VALUE,M),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOVE_ELEMENT,P),e.interp.registerOpcodeHandler(e.interp.OPCODES.MODIFY_CHARACTER_DATA,L),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_SVG_ELEMENT,E),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_NS_ELEMENT,x),e.interp.registerOpcodeHandler(e.interp.OPCODES.FOCUS_ELEMENT,V),e.interp.registerOpcodeHandler(e.interp.OPCODES.BLUR_ELEMENT,H),e.interp.registerOpcodeHandler(e.interp.OPCODES.SCROLL_ELEMENT,F),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_DOCUMENT,l),e.interp.registerOpcodeHandler("DOM_init",s),e.interp.registerOpcodeHandler(e.interp.OPCODES.LOADED,c),e.interp.registerOpcodeHandler(e.interp.OPCODES.SCROLL_CONTROL,N),e.interp.registerOpcodeHandler(e.interp.OPCODES.DESIGN_MODE,Q),e.interp.registerOpcodeHandler(e.interp.OPCODES.WEB_READONLY_STATUS,u),e.interp.registerOpcodeHandler("favicon",G),e.interp.registerOpcodeHandler("using_frameset",q),e.interp.registerOpcodeHandler("add_shadow_root",J),e.interp.registerOpcodeHandler("display_copy_paste_modal",$),e.callback.registerOneShot("dom-loaded",_e,{on_success:function(){setTimeout(function(){ge=!1},_e)},on_timeout:function(){ge=!1}})}function MsePlayback(e,t,n,r,i){function o(e){var t=(new Date).getTime(),n=p+_;if(!b){if(u.updating)return assert(!k),void(k=e);if(e.byteLength)try{u.appendBuffer(e)}catch(r){return void reportErrorClientEvent("tc-flash-mse-buf-append-error",{seq_num:w,error:r.toString()})}e.byteLength>=h||t>=n?a():m=setTimeout(function(){a()},n-t)}}function a(){var e=new XMLHttpRequest,t=f+"&seq_num="+w;m=null,w+=1,e.withCredentials=!0,e.open("POST",t,!0),e.onload=function(){return 200!==e.status?void reportErrorClientEvent("tc-flash-mse-fetch-error",{seq_num:w,status:e.status}):void o(e.response)},e.onerror=function(e){reportErrorClientEvent("tc-flash-mse-fetch-error",{seq_num:w,detail:e})},e.send(JSON.stringify({fetch_token:g})),e.responseType="arraybuffer",p=(new Date).getTime()}function s(){k&&(o(k),k=null)}function c(){u=d.addSourceBuffer(v),u.addEventListener("updateend",s),m=setTimeout(function(){a()},_)}function l(){d=new MediaSource,e.src=URL.createObjectURL(d),f=safeview.url_builder.buildClusterURL("/RDS/mse/v/f/"+t+"?cid="+r+"&rid="+i),d.addEventListener("sourceopen",c)}var d,u,f,p,_,g,h,m,v,y=this,w=0,b=!1,k=null;y.start_mse=function(){safeview.serverCall({op_name:"start_stream",drawable_id:t,url:safeview.url_builder.buildClusterURL("/RDS/mse/v/s/"+n),success:function(e){h=e.mse_max_size,_=e.fetch_interval,g=e.fetch_token,v=e.codec_mime,l()},error:function(e,n){reportErrorClientEvent("tc-flash-mse-start-failure",{drawable_id:t,text_status:n,xhr_status:e.status})}})},y.stop_mse=function(){b=!0,m&&(clearTimeout(m),m=null)}}function VideoStreaming(e,t,n,r,i,o,a,s){function c(){return w.width<32||w.height<32||w.width*w.height<=4096?!0:!1}function l(){w.overlay_ui.style.display="none"}function d(e){function t(){var n,r,i;r=w.overlay_ui.firstChild,i=w.overlay_ui.getElementsByTagName("a")[0],e>0?(n="Switching to streaming in "+e+(1===e?" second.":" seconds."),i.style.display="inline",i.addEventListener("click",function(){clearTimeout(w.count_down_timer),delete w.count_down_timer,w.overlay_ui.style.display="none"})):(n="Switching in progress ...",i.style.display="none",w.useFlash&&setTimeout(function(){w.toggleView(),l()},2e3)),e-=1,n="Waiting ...",r.nodeValue=n,w.overlay_ui.style.display="inline",e>=0?w.count_down_timer=setTimeout(function(){t()},1e3):(clearTimeout(w.count_down_timer),delete w.count_down_timer,w.switchToStreamingView())}w.count_down_timer&&(clearTimeout(w.count_down_timer),delete w.count_down_timer),t()}function u(e){w.video_listener_installed||(w.video_tag.addEventListener("canplay",function(){"Firefox"!==browser.name&&w.video_tag.play()}),w.video_tag.addEventListener("loadedmetadata",function(){w.video_tag.style.setProperty("width",w.video_tag.videoWidth+"px","important"),w.video_tag.style.setProperty("height",w.video_tag.videoHeight+"px","important"),"Firefox"===browser.name&&w.video_tag.play()},!1),w.video_tag.addEventListener("error",function(){},!1),w.video_tag.addEventListener("abort",function(){},!1),w.video_tag.addEventListener("playing",function(){"vnc"===w.current_mode?(w.toggleView(),l()):w.vnc_canvas.style.opacity=0},!1),w.video_listener_installed=!0),e?(w.mse_playback=new MsePlayback(w.video_tag,w.drawable_id,w.videoUrl,w.cid,w.rid),w.mse_playback.start_mse()):(w.video_tag.setAttribute("src",safeview.url_builder.buildClusterURL("/RDS/video/"+w.videoUrl)),w.video_tag.setAttribute("preload","metadata"),w.video_tag.load(),("Edge"===browser.name||"Explorer"===browser.name)&&w.video_tag.play())}function f(){var e,t,n,r,i,o={wmode:"opaque",allowScriptAccess:"false"},a={};"Firefox"===browser.name&&(o.wmode="opaque"),t="flash_placeholder_"+w.drawable_id,n=w.frame.document.createElement("div"),n.innerHTML="Flash version "+sv_flash_version_required+" or up is required.",n.setAttribute("id",t),n.style.width="100%",n.style.height="100%",n.style["pointer-events"]="none",w.flash_wrapper.appendChild(n),w.flash_wrapper.style.width=w.width+"px",w.flash_wrapper.style.height=w.height+"px",r=safeview.url_builder.buildClusterURL("/RDS/video/"+w.videoUrl),i=safeview.url_builder.buildClusterURL("/safeview-static/lib/strobe/StrobeMediaPlayback.swf"),e={src:encodeURIComponent(r),controlBarMode:"none",playButtonOverlay:!1,autoPlay:!0,scaleMode:"stretch",streamType:"live",initialBufferTime:.3,expandedBufferTime:.8,minContinuousPlaybackTime:.3,optimizeInitialIndex:!1,backgroundColor:"0xFFFFFF",verbose:!1},w.frame.swfobject.embedSWF(i,t,"100%","100%",sv_flash_version_required,null,e,o,a,null)}function p(){w.vnc_canvas.style.opacity=0,w.rfb.togglePause(!0)}function _(){w.vnc_canvas.style.opacity=1,w.rfb.togglePause(!1)}function g(e){function t(e,t,n,i){var o;switch(t){case"failed":o="error";break;case"fatal":o="error";break;case"normal":o="debug";break;case"disconnected":o="debug";break;case"loaded":o="debug";break;default:o="debug"}void 0!==i&&b[o]("VNC state for "+r+": "+t+".")}var n,r,i="RDS/websocket/"+w.drawable_id+"?cid="+w.cid+"&rid="+w.rid;n=safeview.url_builder.getDomain("cluster"),r="noVNC_canvas_"+w.drawable_id,VncHelper.set_include_uri(safeview.url_builder.buildClusterURL("/safeview-static/lib/noVNC/include/")),w.rfb=new RFB({frame:w.frame,target:w.vnc_canvas,encrypt:!0,true_color:!0,local_cursor:!0,shared:!1,view_only:!1,updateState:t,onPasswordRequired:null,check_rate:40,fbu_req_rate:50,onContinuousUpdateSetup:e?function(){w.rfb.togglePause(!0),w.useFlash&&setTimeout(function(){w.vnc_canvas.style.opacity=0},2e3)}:null,onUserInteraction:function(){w.switchToInteractionView()}}),w.rfb.connect(n,"","",i),w.rfb.get_keyboard().set_stopEventPropagation(!1),w.rfb.get_mouse().set_stopEventPropagation(!1),w.rfb.set_view_only(!0),w.state="started"}function h(){w.rfb.disconnect()}function m(){function e(){var e,t;return assert("Windows"===browser.os),e=window.navigator.userAgent.match(/Windows NT \d+\.\d+/),e&&(t=e[0],e=t.match(/ \d+\.\d+/),assert(e),t=e[0],t=Number(t),t>=6.3)?!0:!1}"Explorer"!==browser.name||e()?("Firefox"===browser.name||"Safari"===browser.name)&&(w.useFlash=!0):w.useFlash=!0,w.useFlash&&!w.frame.swfobject&&(w.frame.swfobject=new SWFObject(w.frame)),w.videoUrl=w.drawable_id+"?video_src_type=x11grab&audio_src_type=alsa&drawable="+w.drawable_id+"&dimension="+w.width+"x"+w.height+"&audio_src="+w.alsa_device+"&cid="+w.cid+"&rid="+w.rid,w.useFlash&&(w.videoUrl+="&format=flv"),w.useFlash?f():u("Chrome"===browser.name&&browser.version>=54),w.state="started"}function v(){var e;w.useFlash?(e="flash_placeholder_"+w.drawable_id,w.frame.swfobject.removeSWF(e)):w.mse_playback?w.mse_playback.stop_mse():(w.video_tag.pause(),w.video_tag.setAttribute("src",""),w.video_tag.load())}function y(e){safeview.serverCall({op_name:"stop_stream",drawable_id:w.drawable_id,url:safeview.url_builder.buildClusterURL("/RDS/streamcontrol/stop/"+w.drawable_id+"?cid="+w.cid+"&rid="+w.rid)}).always(function(){e&&e()})}var w=this,b=new Logger("streaming",{level:"info"});w.frame=e,w.cid=t,w.rid=n,w.drawable_id=r,w.width=i,w.height=o,w.alsa_device=a,w.current_mode=null,w.vncPaused=!0,w.rfb=null,w.vnc_only=s,w.useFlash=!1,w.video_tag=e.document.getElementById("video_"+r),w.flash_wrapper=e.document.getElementById("flash_wrapper_"+r),w.vnc_canvas=e.document.getElementById("noVNC_canvas_"+r),w.overlay_ui=e.document.getElementById("overlay_ui_"+r),w.state="created",w.toggleView=function(){w.vnc_only||w.current_mode&&!c()&&(assert("streaming"===w.current_mode||"vnc"===w.current_mode),"streaming"===w.current_mode?(_(),w.current_mode="vnc",w.useFlash?w.flash_wrapper.style.visibility="hidden":(w.video_tag.style.visibility="hidden",w.video_tag.setAttribute("muted",!0),w.video_tag.muted="muted")):(p(),w.current_mode="streaming",w.useFlash?w.flash_wrapper.style.visibility="visible":(w.video_tag.style.visibility="visible",w.video_tag.muted=!1)))},w.switchToInteractionView=function(){"streaming"===w.current_mode&&(w.toggleView(),v(),y(),d(2))},w.switchToStreamingView=function(){w.rfb.togglePause(!0),m()},w.toggleVncPause=function(){w.rfb.togglePause(w.vncPaused),w.vncPaused=!w.vncPaused},w.resize=function(e,t){var n=!1;(w.width!==e||w.height!==t)&&(c()&&(n=!0),w.width=e,w.height=t,w.current_mode&&(assert("streaming"===w.current_mode||"vnc"===w.current_mode),"vnc"===w.current_mode?c()||!n||w.vnc_only||(m(),p(),w.current_mode="streaming"):w.useFlash&&(w.flash_wrapper.style.setProperty("width",e+"px","important"),w.flash_wrapper.style.setProperty("height",t+"px","important"))))},w.start=function(){c()||w.vnc_only?(g(!1),w.current_mode="vnc"):(g(!0),m(),w.current_mode="streaming")},w.stop=function(){var e=c()||w.vnc_only;return"created"===w.state?void(w.state="stopped"):void("stopping"!==w.state&&(w.state="stopping",e?h():(h(),v()),w.current_mode=null,y(function(){w.state="stopped"})))},w.getState=function(){return w.state}}function AudioStreaming(e,t,n,r){function i(){var e,t,n,r,i={},o={};a.audioUrl+="&format=flv",t=window.document.createElement("div"),t.setAttribute("id",s),t.style.display="none",document.body.appendChild(t),n=safeview.url_builder.buildClusterURL(a.audioUrl),r=safeview.url_builder.buildClusterURL("/safeview-static/lib/strobe/StrobeMediaPlayback.swf"),e={src:encodeURIComponent(n),controlBarMode:"none",playButtonOverlay:!1,autoPlay:!0,streamType:"live",initialBufferTime:.3,expandedBufferTime:.8,minContinuousPlaybackTime:.3,optimizeInitialIndex:!1,backgroundColor:"0xFFFFFF",verbose:!1},window.sv_swfobject.embedSWF(r,s,"1","1",sv_flash_version_required,null,e,i,o,null)}function o(){a.audioUrl+="&format=mpeg",a.audio_tag=document.createElement("audio"),document.body.appendChild(a.audio_tag),a.audio_tag.addEventListener("canplay",function(){a.audio_tag.play()}),a.audio_tag.addEventListener("error",function(){reportWarnClientEvent("tc-streaming-audio-playback-error",{error_code:a.audio_tag.error.code})},!1),a.audio_tag.addEventListener("abort",function(){reportWarnClientEvent("tc-streaming-audio-playback-aborted",{})},!1),a.audio_tag.addEventListener("ended",function(){a.audio_tag.parentNode.removeChild(a.audio_tag)},!1),a.audioUrl+="&xid="+__randstr(16),a.audio_tag.setAttribute("src",safeview.url_builder.buildClusterURL(a.audioUrl)),a.audio_tag.load(),"Firefox"===browser.name&&a.audio_tag.play()}var a=this,s="sv_flash_audio";a.cid=e,a.rid=t,a.alsa_device=r,a.start=function(){var e=0===a.alsa_device.indexOf("hw:")?"alsa":"pipe";a.audioUrl="/RDS/audio/"+n+"?&audio_src_type="+e+"&audio_src="+a.alsa_device+"&cid="+a.cid+"&rid="+a.rid,"Explorer"===browser.name?(window.sv_swfobject||(window.sv_swfobject=new SWFObject(window)),window.sv_swfobject.hasFlashPlayerVersion(sv_flash_version_required)?i():o()):o()},a.stop=function(){a.audio_tag?(a.audio_tag.parentNode.removeChild(a.audio_tag),a.audio_tag.pause(),a.audio_tag.setAttribute("src",""),a.audio_tag.load(),a.audio_tag=null):window.sv_swfobject.removeSWF(s),safeview.serverCall({op_name:"stop_stream",plugin_view_id:n,url:safeview.url_builder.buildClusterURL("/RDS/streamcontrol/stop/"+n+"?cid="+a.cid+"&rid="+a.rid)}).always(function(){})}}function StreamingManager(){var e=this;e.create=function(e,t,n,r,i,o,a,s){return new VideoStreaming(e,t,n,r,i,o,a,s)}}function __hide_object_fallback_content(e){for(var t=e.firstElementChild;t&&t.style;)t.style.display="none",t=t.nextElementSibling}function PluginViewList(e){function t(e){var t=JSON.parse(JSON.stringify(e));return t}function n(e,n,o){var a,s=r.getByDrawableId(e);if(o&&!s&&assert(!1),!s)return s=t(n),s.drawable_id=e,void i.push(s);for(a in n)n.hasOwnProperty(a)&&n[a]&&s[a]!==n[a]&&(s[a]=n[a],("width"===a||"height"===a)&&s.streaming_client&&(r.log.info({event:"tc-pv-restart-plugin-client",detail:"Restart plugin client needed due to resize: drawable_id: "+e}),s.size_changed=!0,s.pending_start=1,s.streaming_client.stop()))}var r=this,i=[];r.log=e,r.getByUid=function(e,t){var n,r;for(n=0;n<i.length;n++)if(r=i[n],r.hasOwnProperty("fid")&&r.hasOwnProperty("uid")&&e+"_"+t==r.fid+"_"+r.uid)return r;return null},r.getByDrawableId=function(e){var t,n;for(t=0;t<i.length;t++)if(n=i[t],n.hasOwnProperty("drawable_id")&&String(n.drawable_id)===String(e))return n;return null},r.uidExists=function(e,t){return r.getByUid(e,t)?!0:!1},r.create=function(e,t,n){assert(!r.getByUid(e,t)),i.push({fid:e,uid:t,plugin_name:n,need_click_to_play:!0})},r.createOrAssociate=function(t,n,o){var a,s,c;a=r.getByUid(n,o);{if(!a)return(s=r.getByDrawableId(t))?(s.fid=n,void(s.uid=o)):void i.push({drawable_id:t,fid:n,uid:o});if(a.drawable_id&&a.drawable_id!==t&&(a.drawable_changed=!0,e.info({event:"tc-pv-drawable-id-changed",detail:"The drawable for "+o+" is changed from "+a.drawable_id+" to "+t})),s=r.getByDrawableId(t)){for(c in s)s.hasOwnProperty(c)&&(a[c]=s[c]);r.remove(s)}else a.drawable_id=t}},r.update=function(e,t){n(e,t,!0)},r.remove=function(e){var t;for(t=0;t<i.length;t++)if(e===i[t])return i.splice(t,1),!0;return!1},r.forEachPluginViewDo=function(e){var t,n;for(t=i.length-1;t>=0;t--)n=i[t],e(n)},r.dump=function(){var e,t,n="";for(e=0;e<i.length;e++)t=i[e],n+=t.drawable_id+": ("+t.width+","+t.height+","+t.title+","+t.uid+") ";return n}}function ClickToPlayLayer(e,t,n,r,i,o){function a(e,t){var n,r=e.firstChild.firstChild;r.className="sv_logoContainer sv_hidden",r.lastChild.className="sv_logo sv_tmp",r.firstChild.textContent=t,r.lastChild.textContent=t,n=function(){var t=e.offsetWidth,n=e.offsetHeight,i=r.firstChild.offsetWidth,o=r.firstChild.offsetHeight,a=r.lastChild.offsetWidth,s=r.lastChild.offsetHeight;t-4>=i&&n-4>=o?r.className="sv_logoContainer":t-4>=a&&n-4>=s?r.className="sv_logoContainer sv_mini":r.className="sv_logoContainer",r.lastChild.className="sv_logo sv_inset"},setTimeout(n,100)}function s(){i(),l.placeholder.parentNode&&l.placeholder.parentNode.removeChild(l.placeholder)}function c(){var n,i;getUidByNode(r);return n=t.document.createElement("div"),n.className="sv_noimage sv_placeholder",$("#placeholder_css",t.document).length||$("head",t.document).append('<link rel="stylesheet" id="placeholder_css" href="'+e.url_builder.buildAssetURL("/safeview-static/css/safeview.css")+'" type="text/css" />'),$(n).bind("click",function(e){s(),e.stopPropagation(),e.preventDefault()}),i=r.getAttribute("id"),i&&n.setAttribute("plugin_id",i),n.innerHTML='<div class="sv_placeholderContainer"><div class="sv_logoContainer sv_nodisplay"><div class="sv_logo"></div><div class="sv_logo sv_inset"></div></div></div>',n.firstChild.style.opacity=.7,r.style.display&&"inline"!==r.style.display||(r.style.display="inline-block"),r.style.overflow="hidden",a(n,"Play"),n}var l=this;l.placeholder=null,l.log=o,assert(t),l.show=function(){__hide_object_fallback_content(r),r.appendChild(l.placeholder)},l.destroy=function(){l.placeholder.parentNode&&l.placeholder.parentNode.removeChild(l.placeholder)},l.click_test=function(e,t,r){var i;return e!==n?!1:(i=l.placeholder.getBoundingClientRect(),t>i.left&&t<i.right&&r>i.top&&r<i.bottom?(s(),!0):!1)},l.placeholder=c()}function PluginSupport(e){function t(t,n){e.local_events.key_event(t,n)}function n(t,n){var r=n.type,i=n.detail||1,o=Util.getRelativeMouseCoords(t,n),a=e.local_events.get_mouse_event_reltarget(r,n),s=Util.calculateMouseMovement(n);e.local_events.send_mouse_event(t,r,o,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,a,i,!0,s.x,s.y)}function r(t,n){var r,i=t.document.createElement("div");return i.setAttribute("id","plugin_view_"+n),i.style.setProperty("position","relative","important"),i.style.setProperty("margin","0","important"),r='   <div id="overlay_ui_'+n+'" style="position:absolute;top:0;left:0;z-index:9;background:rgba(0,0,0,0.8);color:white;display:none;width:100%;font-size: 18px">Switching in progress...<a style="cursor:pointer;padding-left:10px;color:#00CCFF;text-decoration:underline;">',r+=e.pairing_dict.client_caps&&e.pairing_dict.client_caps.enable_flash_debug?"Do not switch</a>":"</a>",r+='   </div>   <canvas id="noVNC_canvas_'+n+'" style="position:absolute;top:0;left:0;z-index:3">      Canvas not supported.   </canvas>   <video id="video_'+n+'"  width=10 preload="none" style="position:absolute;top:0;left:0;z-index:2">      Your browser does not support HTML5 video.   </video>   <div id="flash_wrapper_'+n+'" style="position:absolute;top:0;left:0;z-index:2;pointer-events:none;">      </div></div>',i.innerHTML=r,i}function i(e){var r,i=Util.makeSet(["click","mousemove","mousedown","mouseup","mouseover","mouseout","keydown","keypress","keyup"]),o=function(r){Util.makeSet(["keypress","keyup","keydown"]).hasOwnProperty(r.type)?t(e,r):n(e,r)};for(r in i)i.hasOwnProperty(r)&&EventListener.addListener(e,r,o,!1)}function o(t){var n,o,a,s,c,l,d;s=getWindowByFid(t.fid),c=r(s,t.drawable_id),n=getNodeByUid(t.fid,t.uid),assert(n),l=n.getAttribute("id"),l&&c.setAttribute("plugin_id",l),__hide_object_fallback_content(n),n.appendChild(c),n.style.display||(n.style.display="inline-block"),t.width&&(c.style.width=t.width+"px"),t.height&&(c.style.height=t.height+"px"),a=e.pairing_dict,d=0===t.plugin_name.indexOf("Java")||!t.need_click_to_play,o=y.create(s,a.s_nid_with_underscore,a.rid,t.drawable_id,t.width,t.height,t.alsa_device,d),i(c.parentNode),v.update(t.drawable_id,{plugin_div:c,streaming_client:o}),o.start()}function a(t,n,r){
var i=getNodeByUid(n,r),o=v.getByUid(n,r);o.click_to_play_layer||(o.click_to_play_layer=new ClickToPlayLayer(e,t,n,i,function(){o.backend_started||(o.backend_started=!0,e.surrogate_channel.send("start-plugin-view",o.fid,r)),o.pending_start=1,l()},m),o.click_to_play_layer.show())}function s(){var e=!1;return v.forEachPluginViewDo(function(t){var n;t.plugin_name&&0===t.plugin_name.indexOf("Shockwave Flash")&&t.streaming_client&&t.need_click_to_play&&"started"===t.streaming_client.getState()&&!t.pending_destroy&&(t.streaming_client.stop(),n=getWindowByFid(t.fid),a(n,t.fid,t.uid),e=!0)}),e}function c(e){try{e.plugin_div&&e.plugin_div.parentNode&&e.plugin_div.parentNode.removeChild(e.plugin_div)}catch(t){assert(e.containing_iframe_destroyed)}delete e.plugin_div,delete e.streaming_client}function l(){var e,t,n=!1,r=[];for(w.pluginWorkerTimer&&(clearTimeout(w.pluginWorkerTimer),delete w.pluginWorkerTimer),v.forEachPluginViewDo(function(e){return!e.pending_destroy||e.streaming_client&&"stopped"!==e.streaming_client.getState()?!e.drawable_changed&&!e.size_changed||e.streaming_client&&"stopped"!==e.streaming_client.getState()?void(e.streaming_client&&"stopped"===e.streaming_client.getState()&&c(e)):(c(e),e.click_to_play_layer&&(e.click_to_play_layer.destroy(),delete e.click_to_play_layer),delete e.drawable_changed,void delete e.size_changed):(c(e),e.check_for_reattach&&r.push({fid:e.fid,uid:e.uid,plugin_name:e.plugin_name}),void v.remove(e))}),v.forEachPluginViewDo(function(e){var t,n=!1;if(e.pending_start){if(e.pending_start++,e.pending_start>=50)return reportErrorClientEvent("tc-pv-start-failed",{uid:e.uid,drawable_id:e.drawable_id}),void delete e.pending_start;if(e.pending_start>=49&&(n=!0),!e.drawable_id)return void delete e.pending_start;if(t=getNodeByUid(e.fid,e.uid),!t)return void(n&&reportErrorClientEvent("tc-abort-play-missing-container-node",{uid:e.uid,drawable_id:e.drawable_id}));if(t.backend_object_created=!0,0===e.plugin_name.indexOf("Shockwave Flash")&&e.need_click_to_play&&s())return void(n&&reportErrorClientEvent("tc-pv-abort-play-other-plugins-active",{uid:e.uid,drawable_id:e.drawable_id}));if(e.streaming_client)return assert("stopping"===e.streaming_client.getState(),"Plugin view client is in wrong state."),void(n&&reportErrorClientEvent("tc-pv-abort-play-bad-plugin-state",{uid:e.uid,drawable_id:e.drawable_id}));o(e),e.click_to_play_layer&&(e.click_to_play_layer.destroy(),delete e.click_to_play_layer),delete e.pending_start,delete e.drawable_changed,delete e.size_changed}}),v.forEachPluginViewDo(function(e){(e.pending_start||e.pending_destroy)&&(n=!0)}),t=0;t<r.length;t++)e=r[t],m.info({event:"tc-pv-recreate-view",detail:"Recreate plugin-view for uid="+e.uid}),d(e.fid,e.uid,e.plugin_name);n&&(w.pluginWorkerTimer=setTimeout(l,100))}function d(e,t,n){var r,i=getWindowByFid(e),o=getNodeByUid(e,t);return m.info({event:"tc-pv-view-created",detail:"PluginView Created: fid="+e+" uid="+t+" plugin_name="+n}),v.uidExists(e,t)?(m.info({event:"tc-pv-view-already-created",detail:"Plugin view already created for uid: "+t+", parepare for detach/reattach case."}),r=v.getByUid(e,t),void(r.check_for_reattach=!0)):(v.create(e,t,n),assert(!o||i),void(o&&(o.backend_object_created=!0,a(i,e,t))))}function u(t,n,r,i){var o=e.pairing_dict,a=new AudioStreaming(o.s_nid_with_underscore,o.rid,r,i);a.start()}function f(e,t,n){var r=v.getByUid(e,t);return r||(r=v.getByDrawableId(n)),r?(r.click_to_play_layer&&(r.click_to_play_layer.destroy(),delete r.click_to_play_layer),delete r.pending_start,r.pending_destroy=!0,r._was_using_click_to_play=r.need_click_to_play,delete r.need_click_to_play,r.streaming_client&&r.streaming_client.stop(),void l()):void reportWarnClientEvent("tc-pv-unexpected-destroy",{})}function p(e,t,n,r,i,o,a,s){var c,d;assert(!i),c=v.getByUid(e,t),c&&c.pending_destroy&&(m.info({event:"tc-pv-pending-destroy",detail:"Plugin View is being stopped and destroyed, uid: "+t+", resurrect for resize case."}),delete c.pending_destroy,c.need_click_to_play=c._was_using_click_to_play),v.createOrAssociate(n,e,t),c=v.getByUid(e,t),c.drawable_changed&&c.streaming_client&&c.streaming_client.stop(),assert(c),c.pending_start=1,d={fid:e,plugin_name:r,alsa_device:s,width:o,height:a},v.update(n,d);try{l()}catch(u){if("SecurityError"!==u.name)throw u;reportErrorClientEvent("tc-pv-security-error",{uid:t}),f(e,t,n)}}function _(e,t){var n,r=getUidByNode(t),i=getFidByNode(t);v.uidExists(i,r)&&(t.backend_object_created=!0,n=v.getByUid(i,r),n.need_click_to_play&&a(e,i,r))}function g(e){var t=Number(e);v.forEachPluginViewDo(function(e){e.fid===t&&(e.pending_destroy=!0,e.streaming_client&&(e.containing_iframe_destroyed=!0,e.streaming_client.stop()),l())})}function h(e,t){if("keyup"===t.type){var n="T".charCodeAt(0),r="P".charCodeAt(0);if(t.shiftKey&&t.ctrlKey&&t.altKey)switch(t.keyCode){case n:w.toggleFlashView();break;case r:w.toggleVncPause()}}}var m=new Logger("plugin-view",{level:"info"}),v=new PluginViewList(m),y=new StreamingManager,w=this;this.toggleFlashView=function(){v.forEachPluginViewDo(function(e){e.streaming_client&&e.streaming_client.toggleView()})},this.toggleVncPause=function(){v.forEachPluginViewDo(function(e){e.streaming_client&&e.streaming_client.toggleVncPause()})},this.click_test=function(e,t,n){v.forEachPluginViewDo(function(r){r.click_to_play_layer&&r.click_to_play_layer.click_test(e,t,n)})},e.callback.register("add-element",_),e.callback.register("frame-node-removed",g),e.callback.register("key-event",h),e.interp.registerOpcodeHandler("DOM_plugin_view_created",d),e.interp.registerOpcodeHandler("DOM_plugin_view_started",p),e.interp.registerOpcodeHandler("DOM_plugin_view_destroyed",f),e.interp.registerOpcodeHandler("DOM_plugin_audio_open",u)}function DownloadSupport(e){function t(e,t){assert(!g.hasOwnProperty(e.id)),g[e.id]={cb_fn:t,status:"not-started",filename:e.filename,counter:0,errors:0}}function n(t){e.pairing_dict.client_caps.custom_file_block_page?window.location=e.url_builder.buildVanityFileTransferURL("/file_transfer/block/"+t.uri):e.ui_frame.call("showDownloadBlocked",t.filename,e.localization.get("ID_DOWNLOAD_POLICY_BLOCK"))}function r(t){return e.serverCall({op_name:"get_download_action",url:e.url_builder.buildFileServerUrl("/safeview-fileserv/tc_status"),data:JSON.stringify({file_id:t.key})})}function i(t,n){var o=0;r(t).done(function(r){g[t.id]?"pending"===r.action||"processing"===r.action?(o=g[t.id].counter,r.stage<=1&&20>o?4>o?e.ui_frame.call("showScanProgress",2):7>o?e.ui_frame.call("showScanProgress",3):e.ui_frame.call("showScanProgress",4):(r.stage>=2||o>=20)&&e.ui_frame.call("showScanProgress",5),g[t.id].counter=o+1,g[t.id].errors=0,setTimeout(i.curry(t,n),500)):n(r):n({action:"cancel"})}).fail(function(){var e=5;reportErrorClientEvent("tc-download-failed-to-get-policy",{download:JSON.stringify(t)}),g[t.id]&&(e=g[t.id].errors,g[t.id].errors=e+1),5>e?setTimeout(i.curry(t,n),500):n({error:"connection_lost"})})}function o(t){var n,r,i={};INSPECT_DOMAIN!==CLUSTER_DOMAIN&&(i.file_url=encodeURIComponent(t.uri)),r=e.url_builder.buildFileServerUrl("/safeview-fileserv/tc_download/"+t.key+"/",!0,i),e.ui_frame.call("setDownloadHref",r),e.ui_frame.hide(),setTimeout(function(){"Firefox"!==browser.name?window.location=r:(n=document.getElementById("safeview-file-download-container"),n||(n=document.createElement("iframe"),n.style="visibility:hidden;display:none",n.id="safeview-file-download-container",n=document.body.appendChild(n)),n.onload=function(){n.onload=null,window.location=r},n.src=r)},200)}function a(t,r){var i;"cancel"!==r.action&&(e.ui_frame.call("hideScanProgress"),g[t.id]&&delete g[t.id],r.error?e.ui_frame.call("showDownloadError",t.filename):"safedoc"===r.action?e.pairing_dict.client_caps.docview_modal?(i=e.url_builder.buildLoginURL(r.url),e.ui_frame.call("showDocviewModal",i,t.filename)):(i=TPROXY_ENABLED?e.url_builder.buildLoginURL(r.url):r.url,"replace"===t.history_action?(window.history.replaceState(null,"",location.href),window.location.replace(i)):window.location.assign(i)):"allow"===r.action?o(t):"block"===r.action?n(t):("error"===r.action||"expired"===r.action)&&e.ui_frame.call("showDownloadError",t.filename))}function s(t,n){var r="",o=null;t.nav_session_id&&(o=t.nav_session_id),t.uri.length<4096&&(__startswith(t.uri,"http:")||__startswith(t.uri,"https:"))&&(r=t.uri),e.serverCall({url:e.url_builder.buildFileServerUrl("/safeview-fileserv/tc_processing"),data:JSON.stringify({download_id:t.id,file_id:t.key,rid:e.pairing_dict.rid,src_uri:r,referrer:document.URL,nav_session_id:o,is_prepend:!TPROXY_ENABLED,read_only:e.readonly.isShowingBanner(),category:t.category})}).done(function(e){g[t.id]?i(t,n):n({action:"cancel"})}).fail(function(){_.error({event:"tc-download-failed-to-start-processing",download:t}),n({error:"connection_lost"})})}function c(t,n,r){if(!t||t.length<1)return r("error");var i={},o=e.pairing_dict.s_nid_with_underscore;i.url=t,i.type="GET",i.cache=!1,i.async=!0,i.timeout=1e4,i.xhrFields={withCredentials:!0},i.crossDomain=!0,i.headers={Accept:"msip/category,cid/"+o+",key/"+n+",*/*"},$.ajax(i).done(function(){return r(null,!0)}).fail(function(e,t,n){return r("error")})}function l(e){var t,n,r=[" B"," KB"," MB"];for(e=parseFloat(e),t=0;t<r.length;t+=1){if(1024>e)return n=e>1e3?0:e>100?1:e>10?2:3,e.toFixed(n)+r[t];e/=1024}return e.toFixed(3)+" GB"}function d(n){var r,i=!0;return _.info({event:"tc-download-requested",uri:n.uri,id:n.id,filename:n.filename,key:n.key}),"pubmatic"===n.filename?(reportWarnClientEvent("tc-spurious-download-requested"),void p.cancelDownload(n.id)):(("10.3.0.1:8081"===new ParsedURL(n.uri).host||"10.3.0.1"===new ParsedURL(n.uri).host)&&(i=!1),void t(n,function(t,o){i?"finished"===t?(e.ui_frame.call("showScanProgress",1),TPROXY_ENABLED&&n.cat_check_enabled?c(n.xhr_url,n.key,function(e,t){s(n,a.curry(n)),e&&reportWarnClientEvent("tc-downstream-cat-check-failed",{xhr_uri:n.xhr_url})}):s(n,a.curry(n))):"started"===t&&(r=" "+l(o.received),n.total&&(r=r+" / "+l(n.total)),e.ui_frame.call("updateDownloadProgress",n.id,n.filename,Math.ceil(100*o.progress),r)):"finished"===t&&s(n,a.curry(n))}))}function u(t){e.ui_frame.call("showDownloadsDisabledModal",t)}function f(t){var n=g[t.id];n&&(delete g[t.id],assert(h.hasOwnProperty(t.reason_code)),2===t.reason_code&&e.ui_frame.call("showDownloadBlocked",n.filename,e.localization.get("ID_DOWNLOAD_FILE_SIZE_EXCEEDED")))}var p=this,_=new Logger("download",{level:"info"}),g={},h={1:"download was cancelled by the user",2:"max download file size exceeded"};p.cancelDownload=function(t){var n=g[t];n&&"finished"===n.status?delete g[t]:e.surrogate_channel.send("cancel-download",t,1)},e.interp.registerOpcodeHandler("download_status_updated",function(e,t,n){var r=g[e];r&&(r.cb_fn(t,n),r.status=t)}),e.interp.registerOpcodeHandler("download_requested",d),e.interp.registerOpcodeHandler("download_ignored",u),e.interp.registerOpcodeHandler("download_cancelled",f)}function UploadSupport(e){function t(t,n){U=!0,e.ui_frame.call("updateUploadProgress",R,t,n)}function n(){U&&(e.ui_frame.call("hideUploadProgress"),U=!1)}function r(){var e=100,n=D?D.file.name:L?L.file.name:"-";T>O&&(e=Math.ceil(100*O/T),(e>N||n!==M)&&(t(n,e),N=e,M=n))}function i(){D&&(L=D,D=null),P.length&&(D=P.shift(),e.surrogate_channel.send("upload",R,D.id,D.file.size,D.file.name,D.file.type||"n/a",D.file.lastModified||0))}function o(t,r,i){var o,a=e.pairing_dict&&e.pairing_dict.client_caps||{};r=r||"showDLPOrNetworkUploadBlockedModal",fileChooserTargetNode&&(fileChooserTargetNode.value=""),n(),o="showDLPBlockedModal"!==r||!i||!i.length||a.dlp_do_not_show_block_payload_uploads,e.surrogate_channel.send("abort-upload",R,"showDLPBlockedModal"===r,!o,t||0,i||""),reportErrorClientEvent("tc-upload-error",{file_id:D.id,size:D.file&&D.file.size,name:D.file&&D.file.name,status:t,upload_id:R,dialog:r}),R=-1,o&&e.ui_frame.call(r)}function a(t){var n,r;r="cid="+e.pairing_dict.cid+"&tab_id="+e.pairing_dict.tab_id+"&upload_id="+R+"&file_id="+t.id+"&page_url="+encodeURIComponent(Util.getRawPageUrl()),n=new FileReader,n.filename=t.file.name,n.onloadend=function(){n.result&&e.cof.call(["doUpload",r,n.filename,n.result],null,[n.result])},n.onerror=function(){reportErrorClientEvent("tc-upload-read-failed",{name:t.file.name,size:t.file.size,error:n.error&&n.error.name,message:n.error&&n.error.message}),E.abortUpload(R)};try{n.readAsArrayBuffer(t.file)}catch(i){reportErrorClientEvent("tc-upload-read-failed",{name:t.file.name,size:t.file.size,error:i.toString()}),E.abortUpload(R)}}function s(e){O+=e-I,I=e,r()}function c(t,n){var a=e.pairing_dict&&e.pairing_dict.client_caps||{},s="showDLPBlockedModal";return 200!==t||"MSIP_OK"!==n?(D.xhr=null,a.dlp_block_codes&&a.dlp_block_codes.length&&-1===a.dlp_block_codes.indexOf(t)&&(s="showDLPOrNetworkUploadBlockedModal"),void o(t,s,n)):(r(),void i())}function l(t){var n,r=new FormData,i=new XMLHttpRequest;I=0,r.append("file",t.file),n=e.url_builder.buildInspectURL("/r/upload?cid="+e.pairing_dict.cid+"&tab_id="+e.pairing_dict.tab_id+"&upload_id="+R+"&file_id="+t.id+"&page_url="+encodeURIComponent(Util.getRawPageUrl())),i.open("POST",n),i.withCredentials=!0,i.onload=function(e){c(i.status,i.responseText)},i.upload.onprogress=function(e){s(e.loaded)},i.onerror=function(){t.xhr=null,o(i.status)},i.onabort=function(){t.xhr=null,fileChooserTargetNode&&(fileChooserTargetNode.value="")},t.xhr=i,i.send(r)}function d(t){assert(t===R),-1!==R&&(e.surrogate_channel.send("file-chooser-cancelled",R),R=-1)}function u(e,t){fileChooserTargetFid=e,R=t}function f(t,n,r){u(t,r),fileChooserTargetUid=n,e.ui_frame.call("showConfirmUpload")}function p(t,n){u(t,n),assert(P.length===A),e.surrogate_channel.send("upload",R,0,A),i()}function _(t,n,r){R=r,fileChooserTargetNode&&(fileChooserTargetNode.value=""),e.ui_frame.call("showUploadsDisabledModal")}function g(t,r,i){R=i,n(),fileChooserTargetNode&&(fileChooserTargetNode.value=""),e.ui_frame.call("showUploadBlockedModal")}function h(e,t,r){R=r,n()}function m(e){E.setupUploads(fileChooserTargetNode,e)}function v(e){var t;assert(e===R),fileChooserTargetNode=null,fileChooserTargetUid&&(t=getNodeByUid(fileChooserTargetFid,fileChooserTargetUid),t?(fileChooserTargetNode=t,fileChooserTargetNode.setAttribute("__sv_open","true")):reportErrorClientEvent("tc-upload-show-file-chooser-error",{uid:fileChooserTargetUid,fid:fileChooserTargetFid})),fileChooserTargetNode||(fileChooserTargetNode=document.createElement("input"),fileChooserTargetNode.setAttribute("type","file"),document.body.appendChild(fileChooserTargetNode),EventListener.addListener(fileChooserTargetNode,"change",m)),fileChooserTargetNode.click()}function y(t,n){R!==t||0>=n||(B=O,F=e.pairing_dict.client_caps.mpfd_cof_uploads&&!BrowserDetect.isIE10()&&D.file.size<COF_MPFD_MAX_SIZE,F?a(D):l(D),r())}function w(e){n(),R===e?R=-1:-1!==R&&reportErrorClientEvent("tc-upload-mismatch",{upload_id:e,cur_upload:R})}function b(e,t,n){var i=B+n;R===e&&D&&t===D.id&&i>O&&(O=i,r())}function k(t,n,r){var i=t?"showUploadPassword":"hideUploadPassword";e.ui_frame.call(i,n,r)}function S(t,n,r){var i,o=e.pairing_dict&&e.pairing_dict.client_caps||{};i=!r||!r.length||o.dlp_do_not_show_block_payload||o.dlp_show_block_payload_codes&&o.dlp_show_block_payload_codes.length&&-1===o.dlp_show_block_payload_codes.indexOf(n),e.surrogate_channel.send("inspect-failed",t,n,r,!i),reportErrorClientEvent("tc-inspect-failed",{status:n,input_count:t}),i&&e.ui_frame.call("showDLPBlockedModal")}function C(t,n,r){var i,o,a,s=e.pairing_dict&&e.pairing_dict.client_caps||{};return s.dlp_disable_cof?(a=new XMLHttpRequest,a.input_count=t,o=e.url_builder.buildInspectURL("/r/user_input?cid="+e.pairing_dict.cid+"&tab_id="+e.pairing_dict.tab_id+"&safe_rid="+e.pairing_dict.safe_rid+"&ic="+t+"&page_url="+encodeURIComponent(Util.getRawPageUrl())),a.open("POST",o),a.withCredentials=!0,a.onload=function(e){(200!==a.status||"MSIP_OK"!==a.responseText)&&S(a.input_count,a.status,a.responseText)},a.onerror=function(){S(a.input_count,a.status)},a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.setRequestHeader("Accept","text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"),void a.send(r)):(i="cid="+e.pairing_dict.cid+"&tab_id="+e.pairing_dict.tab_id+"&safe_rid="+e.pairing_dict.safe_rid+"&ic="+t+"&page_url="+encodeURIComponent(Util.getRawPageUrl()),void e.cof.call(["doInspect",i,t,r]))}var E=this,x=new Logger("upload",{level:"info"}),A=0,T=0,R=-1,D=null,L=null,P=[],U=!1,I=0,O=0,B=0,M="n/a",N=-1,F=!1;return E.abortUpload=function(t){n(),D&&D.xhr&&D.xhr.abort&&D.xhr.abort(),F&&e.cof.call(["doUploadAbort"],null),e.surrogate_channel.send("abort-upload",R,!1,""),-1!==R&&(R!==t&&reportWarnClientEvent("tc-upload-user-abort",{upload_id:t,cur_upload:R}),R=-1),fileChooserTargetNode&&(fileChooserTargetNode.value="")},E.setupUploads=function(t,n){assert("input"===Util.get_node_tag(t)),assert("file"===t.type.toLowerCase());var r,o,a=t.files;if(fileChooserTargetUid||(document.body.removeChild(t),EventListener.removeListener(fileChooserTargetNode,"change",m)),P=[],A=0,T=0,O=0,N=-1,!a||!a.length)return reportErrorClientEvent("tc-upload-no-files-specified",{}),void d(R);for(r=0;r<a.length;r+=1)o=a[r],A+=1,T+=o.size,P.push({file:o,id:A,upload:R});assert(P.length===A),e.surrogate_channel.send("upload",R,0,A),i()},E.setupDroppedUpload=function(e){var t,n;if(P=[],A=0,T=0,O=0,N=-1,!e||!e.length)return void reportErrorClientEvent("tc-drop-upload-no-files-specified",{});for(t=0;t<e.length;t+=1)n=e[t],A+=1,T+=n.size,P.push({file:n,id:A,upload:R}),x.info("Queued upload ID# "+A+" (of "+e.length+")");assert(P.length===A)},E.dismissConfirmUpload=function(e){e?v(R):d(R)},e.interp.registerOpcodeHandler("inspect",C),e.interp.registerOpcodeHandler("upload_dropped_files",p),e.interp.registerOpcodeHandler("run_file_chooser",f),e.interp.registerOpcodeHandler("uploads_disabled",_),e.interp.registerOpcodeHandler("upload_blocked",g),e.interp.registerOpcodeHandler("upload_complete",h),e.interp.registerOpcodeHandler("upload_ack",y),e.interp.registerOpcodeHandler("upload_aborted",w),e.interp.registerOpcodeHandler("upload_progress",b),e.interp.registerOpcodeHandler("upload_password",k),E.onerror=o,E.onload=c,E.onprogress=s,E.oninspecterror=S,E}function XBrowserHelpers(){function e(e,t,n){return"http://www.w3.org/1999/xhtml"===t?e.createElement(n):e.createElementNS(t,n)}function t(e,t){var n,r;for(e=e.toLowerCase(),n=0;n<t.length;n+=1)if(r=t[n][0].toLowerCase(),r===e)return t[n][1];return void 0}function n(e,t,n){var r,i,o,a="<"+e+" ";for(r=0;r<t.length;r+=1)i=t[r][0].toLowerCase(),o=t[r][1],a+=i+'="'+o+'" ';return a+='__uid="'+n+'"',a+=">"}function r(e,r,i,o,a){var s,c=t("id",o);return c||(c=i,o.push(["id",c])),a.altHtml=n(r,o,i),s=e.document.getElementById(c)}var i=["tel","email","number"],o=function(){var e=0;return function(){return e+=1,"invalid_name_replaced_"+e}}(),a=new Logger("xbrowser",{level:"info"}),s=this;this.isBlockedInputTypeAttr=function(e,t,n){return("Chrome"===browser.name||"Firefox"===browser.name)&&"input"===Util.get_node_tag(e)&&"type"===t&&i.indexOf(n)>-1},this.isIEQuirksMode=function(){return"Explorer"===browser.name&&null===document.doctype},this.supportsWebSockets=function(){return window.WebSocket||window.MozWebSocket},this.hasAttribute=function(e,t,n){return e.hasAttributeNS&&t?e.hasAttributeNS(t,n):e.hasAttribute?e.hasAttribute(n):e[n]},this.createElement=function(t,n,r){var i,s=null,c=t.document;if(c.createElementNS&&n)try{s=e(c,n,r)}catch(l){if(!(l instanceof t.DOMException)||l.code!==l.INVALID_CHARACTER_ERR&&l.code!==l.NAMESPACE_ERR)throw a.info("ex.code="+l.code+" ICE="+l.INVALID_CHARACTER_ERR),l;i=o(),s=e(c,n,i),reportWarnClientEvent("tc-xbrowser-invalid-attribute",{name:r,sanitized:i})}else try{s=c.createElement(r)}catch(l){if(!(l instanceof t.DOMException&&l.code===l.INVALID_CHARACTER_ERR))throw a.info("ex.code="+l.code+" ICE="+l.INVALID_CHARACTER_ERR),l;i=o(),s=c.createElement(i),reportWarnClientEvent("tc-xbrowser-invalid-attribute",{name:r,sanitized:i})}return s},this.doSetAttributeWork=function(e,t,n,r){var i,o,a=!1;if("type"===n.toLowerCase()&&"submit"===r.toLowerCase()&&(o=e.value,a=!0),this.isBlockedInputTypeAttr(e,n,r)&&(r="text"),e.setAttributeNS&&t)e.setAttributeNS(t,n,r);else if(this.isIEQuirksMode())switch(n.toLowerCase()){case"style":e.style.cssText=r;break;case"class":e.className=r;break;case"for":e.htmlFor=r;break;case"scrolling":case"frameborder":case"type":case"method":case"rowspan":case"colspan":e.setAttribute(n,r);break;default:i=document.createAttribute(n),i.value=r,e.setAttributeNode(i)}else e.setAttribute(n,r);a&&e.value!==o&&(e.value=o)},this.setAttribute=function(e,t,n,r,i){var s;try{this.doSetAttributeWork(t,n,r,i)}catch(c){if(c instanceof e.DOMException&&c.code===c.INVALID_CHARACTER_ERR)s=o(),this.doSetAttributeWork(t,n,s,i),reportWarnClientEvent("tc-xbrowser-invalid-attribute",{name:r,sanitized:s});else{if(-1===c.toString().toLowerCase().indexOf("not implemented"))throw c;a.info("Ignoring setAttribute exception: "+c.toString())}}},this.processIECharacterData=function(e,t,n,r){var i=!0;switch(t.nodeName){case"STYLE":browser.version<9||9===browser.version&&safeview.xbrowser.isIEQuirksMode()?t.cssText="remove"===n?" ":r:i=!1;break;case"TITLE":t.text="remove"===n?"":r;break;default:i=!1}return i},this.appendChildThatHandlesIE8CornerCase=function(e,t,n,i,o){var a=Util.get_node_tag(o);if("Explorer"===browser.name&&8===browser.version){if("embed"===t&&"object"===a)return r(e,t,n,i,o);reportWarnClientEvent("tc-xbrowser-IE8-append-fail",{child:t,parent:a})}else reportWarnClientEvent("tc-xbrowser-general-append-fail",{name:t})},this.setSelectValue=function(e,t){var n,r=e.options.length;if(e.__safely_select_value=t,"Explorer"===browser.name){for(n=0;r>n;n+=1)if(e.options[n].value===t)return void(e.selectedIndex=n)}else e.value=t},this.getControlNode=function(e){var t;return e.hasOwnProperty("control")?e.control:e.htmlFor?document.getElementById(e.htmlFor):(t=e.getElementsByTagName("input"),t.length?t[0]:null)},this.isDocumentInstance=function(e){if(!e)return!1;if("#document"===Util.get_node_tag(e))return!0;try{return e instanceof Document||e instanceof HTMLDocument}catch(t){return!1}},this.getEventTarget=function(e){var t,n=e.target||e.srcElement;return s.isDocumentInstance(n)&&(t=getWindowByFid(getFidByNode(n)),t&&(n=t.document.body)),"Edge"===browser.name&&n&&n.correspondingUseElement&&(n=n.correspondingUseElement),n},this.exitFullscreen=document.exitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitExitFullscreen,this.requestFullscreen=function(e){var t=e.requestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitRequestFullscreen;t?t.apply(e):reportErrorClientEvent("tc-xbrowser-full-screen-fail")},void 0!==document.onfullscreenchange?(this.fullscreenchange="fullscreenchange",this.fullscreenElement="fullscreenElement"):void 0!==document.onwebkitfullscreenchange?(this.fullscreenchange="webkitfullscreenchange",this.fullscreenElement="webkitFullscreenElement"):void 0!==document.onmozfullscreenchange?(this.fullscreenchange="mozfullscreenchange",this.fullscreenElement="mozFullScreenElement"):void 0!==document.onmsfullscreenchange&&(this.fullscreenchange="MSFullscreenChange",this.fullscreenElement="msFullscreenElement")}function CrossOriginHistory(e){function t(e,t){return new ParsedURL(e).isHashChange(new ParsedURL(t))}function n(){return e.use_html5_api&&Util.hasHTML5Support()}function r(e,t){return new ParsedURL(e).origin===new ParsedURL(t).origin}function i(e,t){var n=JSON.stringify(t),r=e;return r+=new ParsedURL(e).hasHash()?"!":"#",r+=m+Util.b64Encode(n)}function o(n,r){var i=t(window.location.href,new ParsedURL(n).href);i&&(_+=1),v=n,setTimeout(function(){r?window.location.assign(n):window.location.replace(n)},10),n.match(/^(http|https):\/\//)?i?e.on_soft_update&&e.on_soft_update(n):e.on_hard_update&&e.on_hard_update(n):safeview.exit_handler.openingLocalApp()}function a(e,t,n){var r=i(e,t);assert(-1===e.indexOf(m)),o(r,n)}function s(i,s,c){var l=!1;if(n())if(e.enable_same_origin_soft_updates&&r(location.href,i)||t(location.href,i))g=!0,v=i,c?window.history.pushState(s,"",i):window.history.replaceState(s,"",i),e.on_soft_update&&e.on_soft_update(i);else{if(BrowserDetect.isIE()||BrowserDetect.isEdge())try{l=decodeURIComponent(location.href)===decodeURIComponent(i)}catch(d){}(!c||i===location.href||l)&&window.history.replaceState({},"",location.href),o(i,c)}else a(i,s,c)}function c(t,i,o){assert(r(location.href,t)),g=!0,n()?(v=t,o?window.history.pushState(i,"",t):window.history.replaceState(i,"",t),e.on_soft_update&&e.on_soft_update(t)):a(p.getRawUrl(),i,o)}function l(){var t;v=location.href,assert(_>=0),_?_-=1:(t=n()&&!g&&location.href===h,g=!0,!t&&e.on_soft_traversal&&e.on_soft_traversal(y))}function d(){new ParsedURL(location.href).hasHash()||new ParsedURL(v).hasHash()||l()}function u(e){var t=p.getState();assert(!t||t.url),t&&t.url!==location.href&&(y=!0),l(),y=!1}function f(){n()?"Explorer"===browser.name?(EventListener.addListener(window,"hashchange",u,!1),EventListener.addListener(window,"popstate",d,!1)):EventListener.addListener(window,"popstate",l,!1):EventListener.addListener(window,"hashchange",l,!1)}var p=this,_=0,g=!1,h=location.href,m=e.html4_state_key||"@sv=",v=null,y=!1;p.getState=function(){var e,t;if(n())return window.history.state;e=location.hash.indexOf(m),t=location.hash.slice(e+m.length);try{return JSON.parse(Util.b64Decode(t))}catch(r){return null}},p.getRawUrl=function(){var e,t;return n()?location.href:(e=location.href.indexOf("!"+m),t=location.href.indexOf("#"+m),e>=0?location.href.slice(0,e):t>=0?location.href.slice(0,t):location.href)},p.assign=function(e,t){s(e,t,!0)},p.replace=function(e,t){s(e,t,!1)},p.pushState=function(e,t){c(e,t,!0)},p.replaceState=function(e,t){c(e,t,!1)},p.updateState=function(e,t){n()?window.history.replaceState(t,document.title,e):(_+=1,location.replace(i(e,t)))},f()}function HistorySupport(e){function t(t,n){return assert(t),e.surrogate_channel?void e.surrogate_channel.send("navigate",t,n):void g.push({url:t,hid:n})}function n(){var n;for(assert(e.surrogate_channel),n=0;n<g.length;n+=1)t(g[n].url,g[n].hid);g=[]}function r(){return"Explorer"===browser.name&&Util.hasHTML5Support()}function i(e,t){var n,r,i=t.split("&"),o=document.createElement("form"),a=0;for(o.setAttribute("method","post"),o.setAttribute("action",e),a=0;a<i.length;a+=1)r=i[a].split("="),n=document.createElement("input"),n.setAttribute("type","hidden"),n.setAttribute("name",decodeURIComponent(r[0])),n.setAttribute("value",decodeURIComponent(r[1])),o.appendChild(n);document.body.appendChild(o),o.submit()}function o(t,n,o,a,s,c,l,d){var u=new ParsedURL(_.getSafeUrl(t,a)).href,f={hid:o,persistent_policy:s||{}};if(r()&&(f.url=u),assert(u),!__startswith(Util.getRawPageUrl(),"http://doc/")){if(l)return void i(u,d);switch(n){case"add":p.assign(u,f);break;case"replace":p.replace(u,f);break;case"pushstate":p.pushState(u,f);break;case"replacestate":p.replaceState(u,f);break;case"stateupdate":try{p.updateState(u,f)}catch(g){reportWarnClientEvent("tc-history-invalid-stateupdate"),p.replace(u,f)}break;default:assert(0)}e.readonly.onEmailPolicy()}}function a(e){window.history.go(e)}function s(t){return"top"===e.role?void e.surrogate_channel.reattach():(e.surrogate_channel.close(),void(e.surrogate_channel=startSurrogateChannelLoop()))}function c(e){var t=new Error(JSON.stringify({target_url:e}));throw t.name="shutdown-tc",t}function l(e){var n=Util.getRawPageUrl(),r=e?null:_.getHID();t(n,r)}function d(t,n,r){(_.getHID()!==n||Util.persistentPolicy()!==r)&&(p.updateState(p.getRawUrl(),{hid:n,url:p.getRawUrl(),persistent_policy:r||{}}),e.readonly.onEmailPolicy())}function u(t){p.updateState(p.getRawUrl(),{hid:_.getHID(),url:p.getRawUrl(),persistent_policy:t||{}}),e.readonly.onEmailPolicy()}function f(){e.interp.registerOpcodeHandler("update_navbar",o),e.interp.registerOpcodeHandler("history_jump",a),e.interp.registerOpcodeHandler("persistent-policy",u),e.callback.register("surrogate-channel-connected",n,!0),e.callback.register("dom-init",d),p=new CrossOriginHistory({use_html5_api:!0,html4_state_key:"@sv=",enable_same_origin_soft_updates:!1,on_soft_traversal:l,on_soft_update:s,on_hard_update:c})}var p,_=this,g=[];_.getHID=function(){var e=p.getState();return e?e.hid:null},_.getSafeUrl=function(e,t){return"about:blank"===e&&(e="__about_~_blank__"),TPROXY_ENABLED||!t?e:"/"+e},f()}function TabSupport(e){function t(e){var t=e.split("?")[0];return g.hasOwnProperty(t)}function n(t){return e.tab_store.format(t.pairing_dict)}function r(){var n=_.shift();return n&&(h?(_.unshift(n),n=void 0):t(n.uri)&&(l.info("Denying repeated popup request for "+n.uri),e.surrogate_channel.send("allow-tab-open",!1,n.pairing_dict.tab_id),n=r())),n}function i(){var t=r();t&&(t.user_initiated&&0!==f.length?d.tabOpenAction(t,"allow"):(h=!0,e.ui_frame.call("showPopupOpenModal",t)))}function o(){var e=f.shift();if(e)try{e.close()}catch(t){}}function a(e,t,n,r){var a,s,c,l={},p="",g=new ParsedURL(t),h=g.origin,m={new_popup:!0,tab_id:e,cid:d.safeview.pairing_dict.cid,safe_rid:d.safeview.pairing_dict.safe_rid};if(r)try{l=JSON.parse(r)}catch(y){reportErrorClientEvent("tc-tab-invalid-features-json",{features_json:r})}for(s=0;s<u.length;s+=1)a=u[s],void 0!==l[a]&&(p&&(p+=","),p+=a+"="+l[a]);("about:blank"===t||"about:blank#blocked"===t)&&(t=TPROXY_ENABLED?window.location.origin+"/__about_~_blank__":"__about_~_blank__",h="about:blank"),("doc"===g.hostname||"10.3.0.1"===g.hostname)&&(h="safedocs"),c={user_initiated:!n,uri:t,uri_origin:h,target_uri:TPROXY_ENABLED?t:"/"+t,feature_str:p,pairing_dict:m},""!==p&&c.user_initiated&&0!==f.length&&o(),c.user_initiated?_.unshift(c):_.push(c),v&&i()}function s(t,n){for(assert(window===window.top);0!==f.length;)o();return n?(l.info("Detached"),e.detached=!0,e.surrogate_channel.close("client-detach"),void clearPairingState(e)):void window.close()}function c(){v=!0,i()}var l=new Logger("tab",{level:"info"}),d=this,u=["width","height","left","top","menubar","toolbar","location","status","fullscreen","scrollbars","resizable"],f=[],p=400,_=[],g={},h=!1,m=[],v=!1;d.safeview=e,d.tabPreOpen=function(n){var r,i=e.pairing_dict&&e.pairing_dict.client_caps||{};return!i.preopen_tab||t(n)?!1:(r=window.open(),r&&f.push(r),!!r)},d.tabOpenAction=function(t,r){var o,a=t.uri.split("?")[0];e.ui_frame.hide(),"allow"===r?(t.user_initiated&&(o=f.shift()),o||(o=window.open("","",t.feature_str)),o?(o.name=n(t),o.location.replace(t.target_uri),m.push({window:o,tab_id:t.pairing_dict.tab_id})):(l.warn("Failed to open new tab"),r="blocked")):"deny"===r&&(g[a]=!0),e.surrogate_channel.send("allow-tab-open","allow"===r,t.pairing_dict.tab_id),h=!1,setTimeout(i,0)},e.interp.registerOpcodeHandler("TAB_open",a),e.interp.registerOpcodeHandler("TAB_close",s),e.interp.registerOpcodeHandler("TAB_denied",o),e.callback.register("dom-reset",c),e.callback.register("remoting-v2-activated",function(){v=!0}),setInterval(function(){var t;for(t=0;t<m.length;t+=1)try{m[t].window.closed&&(e.surrogate_channel.send("tab_close",m[t].tab_id),m.splice(t,1),t-=1)}catch(n){m.splice(t,1),t-=1}},p)}function WebSocketTester(e,t,n,r){function i(r,i,o){var s={};f||(r||n&&(s={subtype:"failure",request_url:e,reason:i},o&&(s.detail=o),n("websock-test",s)),a&&(clearTimeout(a),a=null),f=!0,t(r))}function o(){s=null;try{s=Util.safeCreateWebSocket(e,!0)}catch(t){i(!1,"open exception",t.name+": "+t.message)}return s?(s.onopen=function(){s.send(d)},s.onmessage=function(e){u=e.data===d,s.close()},s.onclose=function(e){i(u,"response does not match test message")},void(s.onerror=function(e){l.info({event:"tc-websock-tester-connect-error",details:"Is server reachable via WebSockets?"}),i(!1,"websocket error")})):void i(!1,"open failed")}var a,s,c=this,l=new Logger("ws-tester",{level:"info"}),d=__randstr(16),u=!1,f=!1;c.start=function(){a=setTimeout(function(){try{s&&(s.close(),s=null)}catch(e){l.info({event:"tc-websock-tester-timeout-exception"
})}i(!1,"test timed out")},r),o()}}function ChannelException(e){this.message=e}function LatencyDetector(e,t){function n(){var t=Date.now();return c.length?t-c[0][1]>e+5e3?2:t-c[0][1]>e?1:0:0}function r(){var e;assert(t),e=n(),a!==e&&t(e),a=e}function i(e){if(!c.length)return void reportWarnClientEvent("tc-channel-ack-error",{reason:"No pending ack",ack_seq:e});if(c[0][0]>e)return void reportWarnClientEvent("tc-channel-ack-error",{reason:"ack on old seq number",ack_seq:e,expected_ack_seq:c[0][0],pending_ack_length:c.length});if(c[0][0]<e)for(;c.length&&c[0][0]<e;)c.shift();c.shift(),r()}var o=this,a=0,s=null,c=[];o.update_msg_seq=function(e){var t=[e,Date.now()];c.push(t)},o.shutdown=function(){clearInterval(s),s=null,safeview.interp.deregisterOpcodeHandler(safeview.interp.OPCODES.CHANNEL_ACK)},safeview.interp.registerOpcodeHandler(safeview.interp.OPCODES.CHANNEL_ACK,function(e,t){i(t)}),s=setInterval(function(){r()},1e3)}function Channel(e,t){function n(n,r){t.on_report&&(r.channel_name=e,r.channel_id=fe,r.channel_status=ie,r.is_using_websockets=!!te,t.on_report(n,r))}function r(e,t,n){var r="";return assert(e),n=n||{},n.chid=fe,n.msg_nr=_e,t&&(r+=t),r+="/"+e+"?"+Util.buildQueryStr(n)}function i(e,n,i){var o=r(e,n,i);return t.url_builder?t.url_builder(o):"https://"+location.hostname+o}function o(e,n,i){var o=r(e,n,i);return t.url_builder?t.url_builder(o,!0):"wss://"+location.hostname+o}function a(){return ee+=1,assert(ee>=0),ee}function s(e){var t=e.slice(0);return t.unshift(a()),t}function c(e){var t;t=safeview.stats.agg_get("time_tc_ping"),Object.keys(t).length>0&&(t.mode=e,reportClientEvent("tc-ping-stats",{ping:t,tclevel:"tc-ping-stats"},!1,!0))}function l(){Y=W,Q=12e3}function d(){Y=j,Q=0}function u(){t.silent_reconnect||Util.hide_message_bar()}function f(e,n){if(ie===re.DEAD)return void assert(!1,"cannot move from STATUS.DEAD");switch(ie=e,u(),e){case re.PENDING:break;case re.CONNECTED:t.on_connect&&t.on_connect(F),I();break;case re.DEAD:t.on_disconnect&&t.on_disconnect(n);break;default:assert(0,"invalid status "+e)}}function p(){return ie===re.CONNECTED}function _(){return ie===re.DEAD}function g(e){e&&e.abort()}function h(){g(J),g(q),q=J=null}function m(){pe=!0}function v(){te&&te.ping_timer&&(clearTimeout(te.ping_timer),te.ping_timer=null)}function y(){te&&te.pong_deadline_timer&&(clearTimeout(te.pong_deadline_timer),te.pong_deadline_timer=null)}function w(){ne&&(clearTimeout(ne),ne=null)}function b(){te&&(v(),y(),w(),te.close(),te=null)}function k(){de&&(safeview&&safeview.callback.deregister(de),de=null),ue&&(safeview&&safeview.callback.deregister(ue),ue=null)}function S(){k(),h(),b(),safeview.callback.register("safeview-exit",m)}function C(e,t){var r=t||{};ie!==re.DEAD&&(r.reason=e,n("tc-channel-died",r),f(re.DEAD,e),S(),ye&&ye.shutdown())}function E(e){safeview.cof.call(["setWSSupportState",e])}function x(e){safeview.cof.call(["getWSSupportState",safeview.perf.ws_assume_working],e)}function A(){E("ERR"),ce=!0,b(),_()||(f(re.PENDING),O())}function T(e){te.ping_timer=setTimeout(function(){var e=X;ae?(ae=!1,e=0):te.send(JSON.stringify({ping:{}})),ve=Date.now(),te.pong_deadline_timer||(te.pong_deadline_timer=setTimeout(function(){A()},e)),T(K)},e)}function R(e){var t=Date.now()-ve;y(),e&&(safeview.stats.agg("time_tc_ping",t),c("websockets"),t>z&&reportWarnClientEvent("tc-channel-ws-high-rtt",{rtt_ms:t,threshold_ms:z}))}function D(n,r,i){var a=o("websocket",t.service_prefix,t.query_params);return n?!1:(te=Util.safeCreateWebSocket(a,!1))?(te.binaryType="arraybuffer",te.onopen=function(){te&&T(0)},EventListener.addListener(te,"message",function(n){var o=n.data;safeview.stats.add("counter_tc_channel_"+e+"_data_bytes",o.length),i&&(o="session_not_found",E("OK")),o&&"session_not_found"!==o?"session_found"===o?(f(re.CONNECTED),r||w()):(R("pong"===o),t.on_recv&&"pong"!==o&&(_e+=1,t.on_recv(o))):C("session-not-found",{subtype:"session-not-found",context:"ws.onmessage",request_url:a})},!1),te.onclose=function(e){if(!ce){var t=1001===e.code||pe,n=-1===[1e3,1001,1005].indexOf(e.code),r=n&&!_()||safeview.exit_handler.isLocalAppOpening();r?me>ge?(reportWarnClientEvent("tc-channel-websock-retry",{close_event_code:e.code,retry_count:ge,max_retries:me}),ge+=1,b(),f(re.PENDING),D()):A():C(t?"client-close":"websocket-close",{subtype:"websocket_closed",close_event_code:e.code,request_url:a})}},te.onerror=function(e){reportWarnClientEvent("tc-channel-websock-error",{})},ne=setTimeout(function(){ne=null,A()},safeview.perf.ws_session_found_timeout_ms),!0):!1}function L(t,n,r,i,o){var a={subtype:"push_pull_failure",service_prefix:r,status:n,jqXHR_status:t.status,request_url:i};if(!_())switch(n){case"parsererror":case"timeout":case"abort":case"error":me>he&&!pe&&!_()?(reportWarnClientEvent("tc-channel-long-poll-retry",{is_pull:o,retry_count:he,report_dict:a}),he+=1,o?P(e):I()):C(pe?"client-close":"network-error",a);break;default:C("server-error",a)}}function P(e){var n,r,o=null;_()||(safeview.stats.inc("counter_tc_channel_"+e+"_polls"),o=t.query_params||{},o.tms=p()?Q:0,n=i("p",t.service_prefix,o),safeview.stats.start("time_tc_channel_"+e+"_pull_wait"),q=new XMLHttpRequest,q.open("POST",n),q.responseType="arraybuffer",q.timeout=V,q.withCredentials=!0,q.onload=function(n){var i,o;return 200!==q.status?void q.onerror(n):(o=q.getResponseHeader("X-Backend-Delay"),null!==o&&(i=Date.now()-r-Number(o),safeview.stats.agg("time_tc_ping",i),c("polling")),safeview.stats.stop("time_tc_channel_"+e+"_pull_wait"),he=0,void(_()||(p()||(assert(ie===re.PENDING),f(re.CONNECTED)),q.response&&safeview.stats.add("counter_tc_channel_"+e+"_data_bytes",q.response.byteLength),_e+=1,setTimeout(function(){P(e)},Y),setTimeout(function(e){t.on_recv(e.response)},0,q))))},q.onerror=function(r){var i={};return safeview.stats.stop("time_tc_channel_"+e+"_pull_wait"),q.aborted&&!se?void P(e):(se=!1,i.status=q.status,i.textStatus=q.timedout?"timeout":q.aborted?"abort":"error",void L(i,i.textStatus,t.service_prefix,n,!0))},q.ontimeout=function(e){q.timedout=!0,q.onerror(e)},q.onabort=function(e){q.aborted=!0,q.onerror(e)},r=Date.now(),q.send())}function U(){var e,n=i("push",t.service_prefix,t.query_params);$.length?(be.warn({event:"tc-channel-push-xhr-retry",payload_size:JSON.stringify($).length}),e=$):(e=s(Z),Z=[]),assert(e.length),oe&&(oe=!1,se=!0,n="BROKEN"),le=!0,J=t.ajax({url:n,dataType:"json",data:JSON.stringify(e),timeout:H}).always(function(){le=!1}).done(function(){$=[],I()}).fail(function(e,r){L(e,r,t.service_prefix,n,!1)}),ye&&ye.update_msg_seq(e[0]),$=e}function I(){var e,t;p()&&0!==Z.length&&(le||(te?(t=s(Z),e=JSON.stringify(t),te.send(e),ye&&ye.update_msg_seq(t[0]),Z=[]):U()))}function O(){h(),P(e)}function B(){if(!t.ajax)throw new ChannelException("must specify a jQuery-like AJAX implementation")}function M(){var e=new WebSocketTester(o("wsecho",t.service_prefix,t.query_params),function(e){e?E("OK"):(E("ERR"),be.info({event:"tc-channel-websock-test-failed",detail:"WebSockets background test failed."}))},t.on_report,safeview.perf.ws_test_timeout_ms);e.start()}function N(){return B(),de=safeview.callback.register("window-became-active",l,!0),ue=safeview.callback.register("window-became-passive",d,!0),ee=-1,G&&(ye=new LatencyDetector(G,t.on_latency_change)),t.use_websockets?void x(function(e){return e?("OK"===e.state?D(e.inject_open_error,e.inject_response_error,e.inject_session_not_found_error)||E("ERR"):(new Date).getTime()-e.time>safeview.perf.ws_backoff_period_ms&&M(),void(te||O())):void O()}):void O()}var F=this,V=safeview.perf.pull_timeout_ms,H=safeview.perf.push_timeout_ms,X=safeview.perf.pong_timeout_ms,K=12e3,W=0,j=3e3,z=safeview.perf.high_rtt_threshold_ms,Y=W,Q=12e3,G=safeview.perf.latency_notif_threshold_ms,q=null,J=null,Z=[],$=[],ee=null,te=null,ne=null,re={PENDING:"pending",CONNECTED:"connected",DEAD:"dead"},ie=re.PENDING,oe=!1,ae=!1,se=!1,ce=!1,le=!1,de=null,ue=null,fe=__randstr(16),pe=!1,_e=0,ge=0,he=0,me=void 0===t.max_retries?3:t.max_retries,ve=0,ye=null,we=function(){return{name:e,id:fe,status:ie,websockets_active:!!te}},be=new Logger("channel",{level:"info",header:we});if(void 0===V||void 0===H||void 0===X||void 0===z||Q>=V)throw new Error("Invalid parameters for Channel object.");F.send=function(e){var t=p(),n=_(),r=argumentsToArray(arguments);n||(Z.push([e].concat(r.slice(1))),t&&I())},F.injectError=function(e){if(reportWarnClientEvent("tc-channel-inject-error",{kind:e}),te)"websock-close"===e?te.close(4999):"network-unplugged-1"===e&&(ae=!0);else if("pull-error"===e){var t=q;t&&(reportWarnClientEvent("tc-channel-abort"),se=!0,t.abort())}else"push-error"===e&&(oe=!0)},F.setRetryCount=function(e){ge=e,he=e},F.close=function(e){C(e||"client-close")},F.isPolling=function(){return null===te},F.isMixedMode=function(){var e=!!window.WebSocket||!!window.MozWebSocket;return!(!e||!t.use_websockets)},F.isLongPolling=function(){return F.isPolling()&&Y===W},safeview.callback.register("safeview-exit",m),N()}function Interpreter(e){function t(e){c=e}function n(e,t){d[e]&&l.error({event:"tc-opcode-already-registered",opcode:e}),d[e]=t}function r(e){delete d[e]}function i(t){e.finish(),Util.show_message_bar(t)}function o(t,n){var r,i=!1,o=Util.getFramingStatus();if(t&&o&&(2!==t||2!==o)&&(i=e.pairing_dict.client_caps.enforce_framing,reportWarnClientEvent("tc-blocked-framing",{restriction:t,enforced:i,framing_status:o}),i))throw window.setTimeout(Util.show_message_bar,0,"Disallowed framing"),r=new Error("Disallowed framing"),r.name="shutdown-tc",r}function a(t){var n=t[0],r=d[n];if(e.stats.inc("counter_tc_interpret_commands"),!r)return l.warn({e:"unknown-opcode",opcode:n}),!0;try{r.apply(this,t.slice(1))}catch(i){if("shutdown-tc"===i.name)return e.finish(),!1;if("notfounderror"===i.toString().toLowerCase().trim())return l.info({event:"tc-interp-element-not-found-error",error:i.toString(),stacktrace:printStackTrace({e:i})}),!0;if(!(i instanceof SoftAssertException))throw i}return!0}function s(t,n){var r,i,o,s,l,u,f=!0;if(t!==MSG_KIND_DATA&&t!==MSG_KIND_CONTROL)return c(t,n);if(u=n[0],"rfc"===u)return r=n[1],l=n[2],i=n[3],setFrameFidForNode(r,l,i),!0;if(!d.hasOwnProperty(u)&&"fupd"!==u)return reportWarnClientEvent("tc-interp-unknown-opcode",{opcode:u}),!0;if("set_doctype"===u){r=n[1];try{f=getWindowByFid(r)!==mf.window}catch(p){}f&&e.update_queue.discard(r)}if("fupd"===u){for(e.text_monitor.pause_all(),r=n[1],o=2;o<n.length;o+=1)if(s=n[o],e.frameset_wrapper&&(r=e.frameset_wrapper.map_fid_if_necessary(r)),s.splice(1,0,r),!a(s))return e.text_monitor.resume_all(),!1;return e.text_monitor.resume_all(),!0}return a(n)}this.OPCODES={ADD_ELEMENT:1,ADD_CHARACTER_DATA:2,MODIFY_PROP_VALUE:3,MODIFY_ATTR_VALUE:4,REMOVE_ELEMENT:5,MODIFY_CHARACTER_DATA:6,ADD_SVG_ELEMENT:7,ADD_NS_ELEMENT:8,CHANNEL_ACK:9,FOCUS_ELEMENT:10,BLUR_ELEMENT:11,SCROLL_ELEMENT:12,FULLSCREEN_CHANGE:13,MEDIA_BLOB:14,MEDIA_UPDATE:15,MEDIA_NEW_NODE:16,ADD_DOCUMENT:17,SET_SELECTIONS:18,LOADED:19,SCROLL_CONTROL:21,DESIGN_MODE:22,WEB_READONLY_STATUS:23,MEDIA_REMOVE_NODE:24,REMOTING_V2_SET_SELECTIONS:25,REMOTING_V2_FOCUS_ELEMENT:26,REMOTING_V2_FOCUS_OUT:27,REMOTING_V2_CARET_POS:28,REMOTING_V2_INPUT_VALUE:29,REMOTING_V2_INPUTS_UPDATE:30};var c,l=new Logger("interpreter",{level:"info"}),d={},u=this;c=function(e,t){return reportWarnClientEvent("tc-unhandled-binary-message"),!0},n("screenshot",function(t,n){u.surrogate_screenshot=t,e.callback.fire("got-screenshot",t,n)}),n("bounding_rect",function(e,t){u.bounding_rect=t}),n("site_caps",function(t){t.disable_local_echo&&(local_echo_enabled=!1),t.disable_preopen_tab&&(e.pairing_dict.client_caps.preopen_tab=!1),t.hasOwnProperty("print_enabled")&&e.print_handler.setPrintEnabled(t.print_enabled),t.hasOwnProperty("framing_restriction")&&o.apply(this,t.framing_restirction)}),n("window_print",function(t,n,r){var i=getWindowByFid(t);e.print_handler.setPrintEnabled(n),n?e.ui_frame.call("showPrintOptions"):r>0?setTimeout(function(){i.print()},1e3*r):i.print()}),n("visible_tree",function(e){u.surrogate_visible_tree=e,console.log("Received surrogate tree.")}),n("disconnect",i),u.registerOpcodeHandler=n,u.deregisterOpcodeHandler=r,u.processOneCommand=s,u.registerBinaryHandler=t,this.surrogate_screenshot=null,this.surrogate_visible_tree=null,this.bounding_rect=null}function FeedbackBar(e,t,n){function r(e){if(!e||!e.token||!e.domain)return void k.info({event:"tc-feedback-no-bypass",details:"No bypass token or domain found in server response."});var t=new ParsedURL(Util.getRawPageUrl()),n="https:"===t.protocol,r=new Date(Date.now()+12e5);Util.setCookie("_sc_bypass",e.token,r,"/",e.domain,n),window.location.reload()}function i(){return e.policy.setAction("bypass",null,{},r),!1}function o(){return e.surrogate_channel.send("enable-flash-plugin"),!1}function a(){return e.ui_frame.call("showFeedback"),!1}function s(e,n){var r=200,i=4e3;v.body?e():n>=i?(v.documentElement.insertBefore(v.createElement("body"),null),v.body.__sv_saved_for_feedback=!0,e()):(n+=r,t.setTimeout(function(){s(e,n)},r))}function c(){assert(!v.head);var e=v.createElement("head");assert(v.body),assert(v.documentElement),e.__sv_saved_for_feedback=!0,v.documentElement.insertBefore(e,v.body)}function l(){var r,s,l,d,u,f,p=v.getElementById(E),_=v.getElementById(D);N=!0,v.head||c(),_||(assert(v.head),_=$(v.head).find("[href='"+H+"']"),_.length||(_=v.createElement("link"),_.type="text/css",_.rel="stylesheet",_.href=H,v.head.appendChild(_)),_.id||$(_).attr("id",D)),p||(p=v.createElement("div"),p.setAttribute("id",E),p.classList.add(E),f=e.localization.get("ID_LOCALIZATION_CLASS"),""!==f&&p.classList.add(f),p.setAttribute("style","display:none"),v.body.appendChild(p),r=v.createElement("div"),r.setAttribute("id",A),r.classList.add(A),p.appendChild(r),d=v.createElement("img"),d.setAttribute("id",x),d.setAttribute("src",K),d.classList.add(x),r.appendChild(d),d=v.createElement("div"),d.setAttribute("id",I),d.classList.add("__safly_arrow_down"),p.appendChild(d),d.addEventListener("click",function(){$(p).slideUp(),t.setTimeout(function(){$(p).slideDown()},5e3)})),S.indicate_readonly&&!v.getElementById(T)?(d=v.createElement("div"),d.setAttribute("id",T),d.classList.add(T),d.textContent=n?e.localization.get("ID_TC_WEB_READONLY"):e.localization.get("ID_TC_WEB_READONLY_SHORT"),d.setAttribute("data-tooltip",e.localization.get("ID_TC_WEB_READONLY_TOOLTIP")),p.insertBefore(d,v.getElementById(A).nextSibling),C+=1):!S.indicate_readonly&&v.getElementById(T)&&(p.removeChild(v.getElementById(T)),C-=1),S.enable_feedback&&!v.getElementById(R)?(l=S.indicate_readonly?T:A,d=v.createElement("div"),d.setAttribute("id",R),d.classList.add(R),d.textContent=e.localization.get("ID_TC_FEEDBACK"),d.addEventListener("click",a),p.insertBefore(d,v.getElementById(l).nextSibling),C+=1):!S.enable_feedback&&v.getElementById(R)&&(p.removeChild(v.getElementById(R)),C-=1),S.enable_bypass&&!v.getElementById(L)?(l=S.enable_feedback?R:S.indicate_readonly?T:A,d=v.createElement("div"),d.setAttribute("id",L),d.classList.add(L),d.textContent=e.localization.get("ID_TC_BYPASS"),d.setAttribute("data-tooltip",e.localization.get("ID_TC_BYPASS_TOOLTIP")),d.addEventListener("click",i),p.insertBefore(d,v.getElementById(l).nextSibling),C+=1):!S.enable_bypass&&v.getElementById(L)&&(p.removeChild(v.getElementById(L)),C-=1),S.enable_flash&&!O?v.getElementById(P)||(d=v.createElement("div"),d.setAttribute("id",P),d.classList.add(P),d.addEventListener("click",o),u=v.createElement("img"),u.setAttribute("id",U),u.setAttribute("src",X),d.appendChild(u),p.insertBefore(d,v.getElementById(I)),C+=1):v.getElementById(P)&&(p.removeChild(v.getElementById(P)),C-=1),1>=C?p.classList.add("__safly_single_action"):p.classList.remove("__safly_single_action"),d=v.getElementById(A),S.enable_feedback||S.enable_bypass||!S.enable_logo?d.classList.remove("__safly_isolation_logo"):(d.classList.add("__safly_isolation_logo"),d.setAttribute("data-tooltip",e.localization.get("ID_TC_ISOLATE_TOOLTIP"))),s=new UX(e,v),s.customizeFeedbackBar(e.feedback_bar_customizations,E,T,L,R,x,A,n),BrowserDetect.isMobile()||$(p).slideDown()}function d(){v.head||c(),N?l():head.load([H],l)}function u(){var e=Util.getRawPageUrl(),t=new ParsedURL(e);!(S.enable_feedback||S.enable_bypass||S.enable_logo||S.indicate_readonly)||e&&"docs.menlosecurity.com"===t.hostname||(!Util.is_in_iframe()||S.indicate_readonly)&&s(d,0)}function f(){void 0!==e.feedback_bar_policy&&void 0!==h&&(Object.keys(e.feedback_bar_policy).forEach(function(t){S.hasOwnProperty(t)&&(S[t]=e.feedback_bar_policy[t])}),S.indicate_readonly=h,(h||!n)&&(S.enable_feedback=!1,S.enable_bypass=!1,S.enable_logo=!1),u())}function p(t){e.feedback_bar_policy=t,e.feedback_bar_customizations=(t[F]||{})[V]||{},delete e.feedback_bar_policy[F],f()}function _(){var t=["enable_feedback","enable_bypass","enable_logo",F];e.policy.getValues(t,p)}function g(){return e.feedback_bar_policy?void f():(b--,void(b>0&&t.setTimeout(g,w)))}var h,m=this,v=t.document,y=2e3,w=100,b=100,k=new Logger("feedback-bar",{level:"info"}),S={enable_feedback:!1,enable_bypass:!1,enable_logo:!1,enable_flash:!1,indicate_readonly:!1},C=0,E="__safly_actions",x="__safly_icon",A="__safly_icon_container",T="__safly_web_readonly_mode",R="__safly_feedback",D="__safly_feedback_css_link",L="__safly_bypass",P="__safly_flash",U="__safly_flash_icon",I="__safly_feedback_arrow_down",O=!0,B=!1,M=!1,N=!1,F="notification_customization",V="default",H=e.url_builder.buildAssetURL("/safeview-static/css/feedback.css"),X=e.url_builder.buildAssetURL("/safeview-static/images/flash.png"),K=e.url_builder.buildAssetURL("/safeview-static/images/menlo-icon.png");m.submit=function(t){return e.serverCall({op_name:"feedback",url:e.url_builder.buildProtocolUrl("/safeview-client-logger/feedback"),data:JSON.stringify({rid:e.pairing_dict.safe_rid,url:Util.getRawPageUrl(),user_agent:window.navigator.userAgent,message:t})})},m.showOrHideFlashIcon=function(e){var t,n,r;if(t=v.getElementById(E),n=v.getElementById(I),e){if(!t)return S.enable_flash=!0,void(O=!1);S.enable_flash||(S.enable_flash=!0,$("<div>",{id:P}).prepend($("<img>",{id:U,src:X})).addClass(P).click(o).insertBefore(n),C+=1,1>=C?$(t).addClass("__safly_single_action"):$(t).removeClass("__safly_single_action"))}else t&&2>=C&&$(t).addClass("__safly_single_action"),r=v.getElementById(P),r&&$(r).remove(),O=!0},m.updateReadonlyUI=function(){var r;h=!e.readonly.isShowingReadonlyBanner()&&B&&(n||!M&&t.innerWidth>=200&&t.innerHeight>=200),r=v.getElementById(E),r&&t.innerWidth<200&&t.innerHeight<200?r.parentNode.removeChild(r):f()},m.setReadonlyUI=function(e,t){B=e,M=t,m.updateReadonlyUI()},m.feedbackElementIDs=function(){return[E,D]},n&&e.interp.registerOpcodeHandler("flash_plugin_needed",function(t){e.pairing_dict.client_caps&&e.pairing_dict.client_caps.enable_flash_button&&e.feedback_bar.showOrHideFlashIcon(!t)}),t.setTimeout(function(){n?_():g()},y)}function AlertSupport(e){function t(){return Util.getRawPageUrl()}function n(e,t,r){var i,o,a,s=e.contentDocument;if(r-=1,!s||"complete"!==s.readyState||!s.head)return void(r>=0?setTimeout(function(){n(e,t,r)},500):reportErrorClientEvent("tc-alert-block-page-failed",{error:"iframe-load-timeout"}));for(i=new DOMParser,o=i.parseFromString(t,"text/html"),a=0;a<o.head.children.length;a+=1)s.head.appendChild(o.head.children[a]);s.body=o.body}var r={},i=this;this.dismissAlert=function(){e.surrogate_channel.send("alert-dismiss")},this.dismissConfirm=function(t){e.surrogate_channel.send("confirm-dismiss",t)},this.dismissPrompt=function(t,n){e.surrogate_channel.send("prompt-dismiss",t,n)},this.dismissHttpAuthChallenge=function(t,n,r){e.surrogate_channel.send("httpauth-challenge-dismiss",t,n,r)},this.dismissInvalidCert=function(t,n,r){return t?void e.surrogate_channel.send("accept-cert",n,r):void window.history.back()},this.showBlockPage=function(t,i,o,a,s,c,l,d){var u=getIframeByFid(t),f={url:o,categories:JSON.parse(a),risks:JSON.parse(s),is_iframe:!i,is_bandwidth_block:!!d};return u||i?(c&&(f.is_email_block=!0,f.explain=l.explain,f.experience_mode=l.experience_mode),void e.serverCall({url:e.url_builder.buildProtocolUrl("/generate_block_page"),data:JSON.stringify(f)}).done(function(t){t?i?e.ui_frame.call("showCustomBlockPage",t.html):"Firefox"===browser.name?n(u,t.html,10):(u.contentDocument.write(t.html),u.contentDocument.close()):e.ui_frame.call("showBlockPage",o)}).fail(function(t,n){reportErrorClientEvent("tc-alert-block-page-failed",{}),i&&e.ui_frame.call("showBlockPage",o)})):void(r[t]={fid:t,is_main_frame:i,url:o,categories:a,risks:s})},this.checkAndShowBlockPage=function(e){var t;return r[e]?(t=r[e],i.showBlockPage(t.fid,t.is_main_frame,t.url,t.categories,t.risks),delete r[e],!0):!1},e.interp.registerOpcodeHandler("alert_show",function(n){e.ui_frame.call("showAlert",n,t())}),e.interp.registerOpcodeHandler("confirm_show",function(n){e.ui_frame.call("showConfirm",n,t())}),e.interp.registerOpcodeHandler("prompt_show",function(n,r){e.ui_frame.call("showPrompt",n,t(),r)}),e.interp.registerOpcodeHandler("httpauth_challenge_show",function(t,n,r){var i=__startswith(n.toLowerCase(),"https://")?"":e.localization.get("ID_TC_HTTPAUTH_WARNING_MSG",t);e.ui_frame.call("showHttpAuthChallenge",e.localization.get("ID_TC_HTTPAUTH_CHALLENGE_MSG",n,r),i)}),e.interp.registerOpcodeHandler("invalid_certificate",function(t,n,r,i,o){e.ui_frame.call("showInvalidCert",t,n,r,i,o)}),e.interp.registerOpcodeHandler("show_block_page",i.showBlockPage),e.interp.registerOpcodeHandler("tab_limit",function(t){e.ui_frame.call("showTabLimit",!0)}),e.interp.registerOpcodeHandler("password_input_on_http",function(){})}function UIFrame(e){function t(){return document.getElementById("safeview-ui-frame")}function n(e){assert(i);var n,r,o=t();return o||(o=document.createElement("iframe"),o.id="safeview-ui-frame",o.frameborder="0",o.border="0",o.src="about:blank",o.style.position="fixed",o.scrolling="no",o.allowtransparency="true",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.overflow="visible !important",o.style.border="0",o.style.display="none",o.style.visibility="visible",o.style.zIndex="2147483647",n=document.getElementsByTagName("html")[0],n||(document.write("<!DOCTYPE html><html></html>"),document.close(),n=document.getElementsByTagName("html")[0],assert(n)),r=document.body,r||(r=document.createElement("body"),n.appendChild(r)),r.appendChild(o),o.contentDocument.write(e),o.contentDocument.close()),o}function r(t){var n=e.url_builder.buildProtocolUrl("/safeview-template/ui.html");return assert(t),o?void t(o):void e.serverCall({op_name:"ui_html",url:n}).done(function(e){o=e,t(o)}).fail(function(e,t){reportErrorClientEvent("tc-ui-frame-fetch-failed")})}var i=this,o=null,a=0,s=1,c=2,l=a,d=[];this.load=function(e){var t;r(function(r){t=n(r),assert(t),e&&(t&&t.contentWindow&&t.contentWindow.is_frame_loaded?e(t):setTimeout(function(){i.load(e)},100))})},this.callInFrame=function(e){var n=t(),r=e.toString(),o=n.contentWindow[r];assert(o),n.style.display="block",i.savedFocus=document.activeElement,o.apply(n.contentWindow,argumentsToArray(arguments).slice(1))},this.call=function(){var e=this,t=arguments,n={};return l===c?void i.callInFrame.apply(e,t):(d.push({saved_this:e,saved_args:t}),void(l===a&&(l=s,i.load(function(){for(l=c;d.length;)n=d.shift(),i.callInFrame.apply(n.saved_this,n.saved_args)}))))},this.hide=function(){var e=t();e&&(e.style.display="none",e.blur(),i.savedFocus?(document.activeElement&&document.activeElement!==i.savedFocus&&document.activeElement.blur(),BrowserDetect.isEdge()&&window.focus(),i.savedFocus.focus()):document.body.focus())},this.active=function(){var e=t();return e&&"none"!==e.style.display}}function ContextMenu(e){function t(){h={undo:"ID_MENU_UNDO",redo:"ID_MENU_REDO",copy:"ID_MENU_COPY",cut:"ID_MENU_CUT",paste:"ID_MENU_PASTE",back:"ID_MENU_BACK",forward:"ID_MENU_FORWARD",reload:"ID_MENU_RELOAD",select_all:"ID_MENU_SELECT_ALL",link_open_new_window:"ID_MENU_LINK_OPEN_NEW_WINDOW",link_copy_address:"ID_MENU_LINK_COPY_ADDRESS",image_open_new_window:"ID_MENU_IMAGE_OPEN_NEW_WINDOW",image_copy_address:"ID_MENU_IMAGE_COPY_ADDRESS",image_save:"ID_MENU_IMAGE_SAVE"},m={copy:"C",cut:"X",paste:"V",select_all:"A",undo:"Z",redo:"Z"},v={edit:["undo","redo"],copy_only:["copy"],cut_copy_paste:["cut","copy","paste","select_all"],regular:["back","forward","reload","select_all"],link:["link_open_new_window","link_copy_address"],image:["image_open_new_window","image_copy_address","image_save"]},"Windows"===browser.os&&(w="Explorer"===browser.name&&browser.version<=10?"windows8":"windows10")}function n(t){("image"===t.media_type||"canvas"===t.media_type)&&e.surrogate_channel.send("cmcb","dl",t.fid,t.media_type,t.x,t.y,t.src_url,t.frame_url,t.referrer_policy)}function r(t,r){switch(t){case"undo":case"redo":return function(){e.surrogate_channel.send("execcmd",r.fid,t)};case"select_all":return function(){e.surrogate_channel.send("execcmd",r.fid,"selectAll")};case"copy":case"cut":case"paste":return function(){e.ui_frame.call("showCopyPasteModal",BrowserDetect.isMac())};case"back":case"forward":case"reload":return function(){x?e.surrogate_channel.send("cmcb","nav",t):"forward"===t?window.history.forward():"back"===t?window.history.back():"reload"===t&&e.reload(0)};case"link_open_new_window":case"link_copy_address":return function(){var n=r.link_url;TPROXY_ENABLED||e.pairing_dict.prepend_client_navs||(n=e.url_builder.getServiceDomain()+"/"+n),"link_copy_address"===t?e.ui_frame.call("showCopyLinkModal",{link:n}):window.open(n,"_blank")};case"image_open_new_window":case"image_copy_address":return function(){var n=r.src_url;TPROXY_ENABLED||(n=e.url_builder.getServiceDomain()+"/"+n),"image_open_new_window"===t?window.open(n,"_blank"):e.ui_frame.call("showCopyLinkModal",{link:n})};case"image_save":return function(){n(r)};case"divider":return function(){};default:assert(!1)}}function i(e,t){var n=t.src_url;switch(e){case"copy":case"cut":case"paste":case"redo":case"undo":case"select_all":return-1!==t.edit_enum.indexOf(e);case"image_copy_address":case"image_open_new_window":return n&&(0===n.indexOf("http:")||0===n.indexOf("https:"));case"link_open_new_window":case"link_copy_address":return!!t.link_url;case"back":return!x||!!(2&t.can_nav_flag);case"forward":return!x||!!(1&t.can_nav_flag);default:return!0}}function o(t,n){var o,a;for(o=0;o<t.length;o+=1)a="divider"===t[o]?"divider":e.localization.get(h[t[o]]),k.push({token:t[o],text:a,enabled:i(t[o],n),cb:r(t[o],n)})}function a(e){var t;return document.getElementById(C)?void e():(t=document.createElement("link"),t.type="text/css",t.rel="stylesheet",t.href=S,t.setAttribute("id",C),t.onload=function(){t.onload=null,e()},void document.head.appendChild(t))}function s(e){return!!Util.findPredicateOnBranch(e,function(e){return e.className&&e.className.indexOf&&-1!==e.className.indexOf(R)})}function c(e){var t,n;switch(t=e.target,e.type){case"click":if(!s(t))break;for(;-1===["DIV","UL","LI"].indexOf(t.nodeName);)t=t.parentNode;if(n=t.getAttribute(I),!n)break;n=parseInt(n,10),n>=0&&n<k.length&&-1===t.className.indexOf(T)&&(b.dismiss(),k[n].cb());break;case"mousedown":s(t)||b.dismiss(),e.preventDefault();break;case"contextmenu":e.preventDefault();break;case"keydown":27===e.keyCode&&b.dismiss()}}function l(){var e;for(e=0;e<A.length;e+=1)EventListener.addListener(document,A[e],c,!1)}function d(){var e;for(e=0;e<A.length;e+=1)EventListener.removeListener(document,A[e],c,!1)}function u(e,t,n){var r=e.getBoundingClientRect(),i=r.width,o=r.height,a=Util.getScreenWidth(),s=Util.getScreenHeight(),c=window.scrollX||window.pageXOffset,l=window.scrollY||window.pageYOffset;i>a-t&&(t=a-i-1),o>s-n&&(n=s-o-1),e.style.top=Math.round(n.toString())+l+"px",e.style.left=Math.round(t.toString())+c+"px",e.style.visibility="visible"}function f(e){return BrowserDetect.isMac()?"redo"===e?"â§â":"â":"redo"===e?"Shift+Ctrl+":"Ctrl+"}function p(e,t,n){var r,i,o,a=t.token;"divider"===a?e.classList.add(U):(m[a]?(r=document.createElement("span"),r.classList.add(D),r.textContent=t.text,i=document.createElement("span"),i.classList.add(L),o=document.createElement("span"),o.classList.add(P),o.textContent=f(a),i.appendChild(o),i.appendChild(document.createTextNode(m[a])),e.appendChild(r),e.appendChild(i)):e.textContent=t.text,e.setAttribute(I,n)),t.enabled||e.classList.add(T)}function _(){var e,t,n=document.createElement("div"),r=document.createElement("ul");for(n.classList.add(R),w&&n.classList.add(R+"-"+w),t=0;t<k.length;t+=1)e=document.createElement("li"),p(e,k[t],t),r.appendChild(e);return n.appendChild(r),n}function g(e,t){l(),y=_(),document.body.appendChild(y),u(y,e,t)}var h,m,v,y,w,b=this,k=[],S=e.url_builder.buildAssetURL("/safeview-static/css/context-menu.css"),C="__safly_contextmenu_css_link",E=null,x=!1,A=["click","mousedown","contextmenu","keydown"],T="menlo-context-disabled",R="menlo-context-menu",D="menlo-key-command",L="menlo-shortcut",P="menlo-key",U="menlo-context-divider",I="data-menlo-menu-item-index";b.set_last_pos=function(e){E=e},b.dismiss_if_necessary=function(e){"mousedown"!==e.type||s(e.target)?"keydown"===e.type&&27===e.keyCode&&b.dismiss():b.dismiss()},b.dismiss=function(){y&&(document.body.removeChild(y),d(),e.useRemotingV2()&&e.compositor.selection.enable(),y=null)},b.display=function(t,n,r,i,s,c,l,d,u,f,p,_,h){var m,y={fid:t,frame_url:n,referrer_policy:r,media_type:i,suggested_filename:s,link_url:c,src_url:l,has_selection:d,is_editable:u,edit_enum:f.split(","),can_nav_flag:p,x:_,y:h};e.ctx_menu_mode&&e.ctx_menu_mode.backend_driven&&(!e.useRemotingV2()&&E&&(y.x=E.x,y.y=E.y,E=null),k=[],b.dismiss(),u?(m=v.edit.slice(),m.push("divider"),m=m.concat(v.cut_copy_paste),o(m,y)):"image"===i&&c?(m=v.image.slice(),m.push("divider"),m=m.concat(v.link),o(m,y)):"image"===i||"canvas"===i?o(v.image,y):c?o(v.link,y):d?o(v.copy_only,y):o(v.regular,y),k.length&&a(function(){e.useRemotingV2()&&e.compositor.selection.disable(),g(y.x,y.y)}))},t()}function ActiveTab(e){function t(n){var r;if(e.detached)return e.detached=!1,void window.location.reload();if(!u.is_active){for(u.is_active=!0,e.cof.call(["setActiveCookie",d],function(e){assert(e)}),r=0;r<l.length;r+=1)EventListener.removeListener(window,l[r],t,!1);s=setTimeout(a,c),e.callback.fire("window-became-active")}}function n(){var n;if(u.is_active){for(u.is_active=!1,s&&(clearTimeout(s),s=null),n=0;n<l.length;n+=1)EventListener.addListener(window,l[n],t,!1);e.callback.fire("window-became-passive")}}function r(){e.cof.call(["setActiveCookie",d],function(e){assert(e)}),u.is_active=!0,s=setTimeout(a,c)}function i(){e.surrogate_channel&&("hidden"===document.visibilityState&&e.context_menu.dismiss(),e.surrogate_channel.send("hidden"===document.visibilityState?"hide-tab":"show-tab"))}function o(){e.surrogate_channel&&e.surrogate_channel.send("acquire-focus")}var a,s,c=200,l=["focus","focusin","keydown","mousemove","scroll"],d=__randstr(16),u=this;a=function(){s=null,e.cof.call(["getActiveCookie"],function(e){e!==d?n():s=setTimeout(a,c)})},assert(e.cof),EventListener.addListener(document,"visibilitychange",i,!0),EventListener.addListener(window,"focus",o,!0),e.callback.register("surrogate-channel-connected",function(){i(),o()},!0),r()}function TabStorageException(e){this.message=e}function TabStorage(){this.format=function(e){return"JSON:"+JSON.stringify(e)},this.save=function(e){window.name=this.format(e)},this.load=function(){var e;if(-1===window.name.indexOf("JSON:",0))throw new TabStorageException("storage is empty or invalid");return e=window.name.substr(5),JSON.parse(e)},this.clear=function(){window.name="",assert(0===window.name.length)}}function TabStorageBackedByLocalStorage(e){function t(){var e,t,n,r;for(e=0;e<localStorage.length;e+=1){n=localStorage.key(e);try{t=JSON.parse(localStorage.getItem(n)),r=Date.now()-t.timestamp,(void 0===t.timestamp||r>10*o)&&localStorage.removeItem(n)}catch(i){}}}function n(){var e;try{e=i.load()}catch(t){e=null}i.save(e)}function r(){setInterval(function(){n(),t()},o),n()}var i=this,o=1e4;this.save=function(t){localStorage.setItem(e,JSON.stringify({
timestamp:Date.now(),value:t}))},this.load=function(){var t,n=localStorage.getItem(e);if(!n)throw new TabStorageException("storage is empty or invalid");if(assert("string"==typeof n),t=JSON.parse(n),null===t.value||void 0===t.value)throw new TabStorageException("storage is empty or invalid");return t.value},this.clear=function(){localStorage.removeItem(e)},r()}function Pairing(e,t){function n(e){var t=Util.parseURL(e);return t.protocol+"//"+t.hostname}function r(e){var t,n="readonly",r=n+"/";return __startswith(e,r)?{ro:!0,url:e.substr(r.length)}:(t=new ParsedURL(e),t.hostname===n?{ro:!0,url:t.protocol+"/"+t.pathname+t.search}:{ro:!1,url:e})}function i(e,t,n,r){var i,o,a;return i=window.IS_POST||!1,a=navigator.userAgent.indexOf("MSIE 10.0")>=0||navigator.userAgent.indexOf("Trident")>=0?jstz.determine().name():Intl.DateTimeFormat().resolvedOptions().timeZone,o={url:e,transparent_mode:TPROXY_ENABLED,read_only_entry:n.ro,persistent_policy:Util.persistentPolicy(),timezone:a,build_id:BUILD_ID,top_frame_doctype:t,language:Util.getLanguage(),languages:Util.getLanguages(),platform:window.navigator.platform,referrer:document.referrer,framing_status:r,viewport_bounds:MetricsUtils.getVisualViewportMetrics(),render_params:MetricsUtils.getAllMetrics(),is_post:i},window.DOC_HEADERS&&(o.doc_headers=window.DOC_HEADERS),i&&(o.body=window.BODY||"",o.content_type=window.CONTENT_TYPE||""),o}function o(e,t,n,r,i){var o,a;a=k.safeview.url_builder.buildProtocolUrl(e),o=new XMLHttpRequest,o.open("POST",a),o.timeout=void 0===i?k.safeview.perf.xhr_timeout_ms:i,o.withCredentials=!0,o.onload=function(t){200===o.status?n(JSON.parse(o.response)):r(o,t,e)},o.onerror=function(t){r(o,t,e)},o.ontimeout=function(t){r(o,t,e)},o.send(JSON.stringify(t))}function a(t){var n,r,i;(k.safeview.active_tab||{}).is_active&&k.safeview.pairing_dict.sb&&(i=e.url_builder.getDomain("cluster"),r=e.url_builder.getDomain("inspect"),n=r!==i?[i,r]:[i],k.safeview.cof.call(["doAuthCheck",{check_hosts:n,sb:k.safeview.pairing_dict.sb,timeout:k.safeview.perf.xhr_timeout_ms,transparent_mode:window.TPROXY_ENABLED},t,k.safeview.itok],function(e){}))}function s(e){var t;t=Util.buildLoginForm(e,e.url),Util.submitLoginForm(t,"_self")}function c(e,t,n){k.safeview.reset("repair XHR failed")}function l(e,t,r,i,a,s){var c,u,f=E,p=function(t){reportWarnClientEvent(t,{target_url:e,xhr_url:k.safeview.url_builder.buildProtocolUrl(s),textStatus:i.response,statusCode:i.status,retry_count:C,timeout_ms:f})};!i.status&&(navigator.userAgent.indexOf("Trident")>=0||navigator.userAgent.indexOf("MSIE 10.0")>=0||navigator.userAgent.indexOf("Edge")>=0)&&(c=n(k.safeview.url_builder.buildProtocolUrl(y)),S[c]||(S[c]=1,u=document.createElement("img"),u.src=c+"/safeview-static/img/indicator.png?fie="+__randstr(10))),k.safeview.preload_indicator.showPreloadIndicator(),"pairing_retry"===i.response?(f=Math.min(E,50*Math.pow(2,C)),p("tc-pairing-retry")):"global_pool_depleted"===i.response?p("tc-global-pool-depleted"):3>C?p("tc-pairing-slow-retry"):Util.showError(k.safeview.localization.get("ID_TC_NETWORK_ISSUE",Math.abs(Util.hashCode(i.response))),k.safeview.localization.get("ID_TC_NETWORK_RETRY"),{statusCode:i.status,responseText:i.response,status:i.status,retry_count:C,timeout_ms:f},k.safeview.template),C+=1,setTimeout(function(){o(s,t,d.curry(e,t,r),l.curry(e,t,r))},f)}function d(e,t,r,i){return i.retry_nid?void o(y+"?cid="+i.retry_nid+"_any",t,d.curry(e,t,r),l.curry(e,t,r),k.safeview.perf.xhr_timeout_ms+k.safeview.perf.pre_pair_xhr_ms):(i.origin=n(e),void r(i))}function u(e,t,n,a,s,l,u,f){var p,_,g,h,m,v=e.hasOwnProperty("new_popup"),y=r(t);return t=y.url,assert(e.cid&&e.safe_rid&&e.tab_id,"bad pairing state"),p=w+"?cid="+e.cid,_=i(t,a,y,f),_.tab_id=e.tab_id,_.hid=n,_.safe_rid=e.safe_rid,_.popup_initial_pair=v,_.doctype_correction=e.is_pending_doctype_correction,g=d.curry(t,_,u),s?(h=s,m=l):(h=g,m=c),o(p,_,h,m),{on_load:g,on_error:c}}function f(e,t,n,a,s,c){var u,f,p,_,g,h=r(e);return e=h.url,u=i(e,t,h,c),f=d.curry(e,u,s),p=l.curry(e,u,s),n?(_=n,g=a):(_=f,g=p),o(y,u,_,g,k.safeview.perf.xhr_timeout_ms+k.safeview.perf.pre_pair_xhr_ms),{on_load:f,on_error:p}}function p(e){return e.safe_rid&&e.cid}function _(e){function t(e){return e.split(".").slice(-2).join(".")}return assert(!Util.isIpAddress(CLUSTER_DOMAIN)),e?t(e)===t(CLUSTER_DOMAIN):!0}function g(e){assert(p(e)),e.protocol_domain=b.protocol_domain||PROTOCOL_DOMAIN,e.cluster_domain=b.cluster_domain||CLUSTER_DOMAIN,e.inspect_domain=b.inspect_domain||INSPECT_DOMAIN,k.safeview.tab_store.save({safe_rid:e.safe_rid,cid:e.cid,tab_id:e.tab_id,protocol_domain:e.protocol_domain,cluster_domain:e.cluster_domain,inspect_domain:e.inspect_domain,surrogate_view_active:e.surrogate_view_active})}function h(){var e;assert(k.safeview.tab_store);try{b=k.safeview.tab_store.load(),p(b)||(k.safeview.tab_store.clear(),b={})}catch(t){t instanceof TabStorageException&&(b={})}return b.is_pending_doctype_correction&&(e=b.is_pending_doctype_correction,b.is_pending_doctype_correction=!1,g(b),b.is_pending_doctype_correction=e),Util.isIpAddress(window.location.hostname)?b:(_(b.protocol_domain)&&_(b.cluster_domain)&&_(b.inspect_domain)||(console.error("tc-pairing-tab-storage-invalid"),b.protocol_domain=PROTOCOL_DOMAIN,b.cluster_domain=CLUSTER_DOMAIN,b.inspect_domain=INSPECT_DOMAIN),b)}function m(e){b=e,p(b)||(b={})}function v(e,t,n){var r;return n.login_url?k.safeview.itok?void k.safeview.cof.call(["doITok",k.safeview.itok,n.integrity_hosts,n.inspect_host,window.location.href],function(e){var t;e||(t=document.createElement("button"),t.innerText="Try again!",document.body.appendChild(t),t.addEventListener("click",function(){window.open(window.location.href,"_blank")}))}):n.use_integrity_token&&navigator.userAgent.indexOf("Trident")>=0?void k.safeview.cof.call(["doToksAuth",n,location.href],function(e){}):(r=Util.buildLoginForm(n,location.href),void Util.submitLoginForm(r,"_self")):n.direct_access?void location.replace(n.direct_access):n.server_build_id?(reportErrorClientEvent("tc-pairing-unexpected-tc-build-id",{expected_build_id:n.server_build_id,client_build_id:BUILD_ID}),void k.safeview.reset("unexpected tc build id")):n.error||n.block?void t(n):p(n)?(e&&n.safe_rid!==e&&reportWarnClientEvent("tc-pairing-repaired-to-new-surrogate",{old_safe_rid:e,safe_rid:n.safe_rid}),n.s_nid_with_underscore=n.s_nid+"_",b&&(n.surrogate_view_active=b.surrogate_view_active),g(n),b=n,void k.safeview.cof.call(["setNidCookie",n.s_nid],function(){t(n)})):(reportErrorClientEvent("tc-pairing-unexpected-response",{pairing_dict:JSON.stringify(n)}),void k.safeview.reset("invalid pairing state"))}var y="/r/pair",w="/r/repair",b={},k=this,S={},C=0,E=t&&t.max_timeout_ms||3e3;k.setSafeview=function(e){k.safeview=e},k.withSurrogateDo=function(e,t,n,r,i){var o,a,s;return o=b.hasOwnProperty("safe_rid")?b.safe_rid:"",r=r||Util.getRawPageUrl(),void 0===i&&(i=window.history.state?window.history.state.hid:null),s=v.curry(o,e.on_complete),a=o?u(b,r,i,t,e.on_load,e.on_error,s,n):f(r,t,e.on_load,e.on_error,s,n)},k.safeview=e,k.loadPairingState=h,k.savePairingState=g,k.initPairingState=m,k.doCheckRequest=a,k.doRecookie=s}function clearPairingState(e){var t;try{t=e.tab_store.load(),delete t.safe_rid,delete t.cid,delete t.tab_id,delete t.protocol_domain,delete t.cluster_domain,delete t.inspect_domain,e.tab_store.save(t)}catch(n){}}function Stats(e,t){function n(e,t,n){e.hasOwnProperty(t)||(e[t]=0),e[t]+=n}function r(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}var i={},o={},a={},s={},c=this;assert("main"===e.role||"comm"===e.role),e.callback.register("dom-loaded",function(e){s={},r(s,e),r(s,i),reportClientEvent("tc-dom-loaded",s)}),this.inc=function(e){n(i,e,1)},this.add=function(e,t){n(i,e,t)},this.agg=function(e,t){var n,r;a.hasOwnProperty(e)?(n=a[e],n.last=t,n.sum+=t,n.count+=1,r=n.avg,n.avg=n.sum/n.count,n.min=Math.min(n.min,t),n.max=Math.max(n.max,t),n["var"]=((n.count-1)*n["var"]+(t-n.avg)*(t-r))/n.count):n={last:t,min:t,avg:t,max:t,sum:t,count:1,"var":0},a[e]=n},this.agg_get=function(e){if(!a.hasOwnProperty(e))return{};var t=a[e];return{last:t.last,min:t.min,avg:t.avg,max:t.max,count:t.count,stdev:Math.sqrt(t["var"])}},this.start=function(e){o[e]=Date.now()},this.stop=function(e){var t=Date.now()-o[e];n(i,e,t),delete o[e]},this.on_xframe_stats_msg=function(e){switch(e.op){case"inc":c.inc(e.counter_name);break;case"add":c.add(e.counter_name,e.val);break;case"agg":c.agg(e.counter_name,e.val);break;case"start":c.start(e.timer_name);break;case"stop":c.stop(e.timer_name);break;default:assert(0)}},this.getRawStatsAsJSON=function(){return JSON.stringify(s)},this.setNavStartTime=function(e){o.time_tc_nav_load=e},o.time_tc_dom_load=load_time,o.time_tc_nav_load=load_time}function XFrameStats(e){function t(t){var n,r={kind:"stats"};for(n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);e.postToCommFrame(r)}assert("top"===e.role||"sub"===e.role),this.inc=function(e){t({op:"inc",counter_name:e})},this.add=function(e,n){t({op:"add",counter_name:e,val:n})},this.agg=function(e,n){t({op:"agg",counter_name:e,val:n})},this.start=function(e){t({op:"start",timer_name:e})},this.stop=function(e){t({op:"stop",timer_name:e})}}function MediaObjects(e){function t(e,t){return e+"_"+t}function n(e){var t=e.split("_");return{fid:Number(t[0]),uid:Number(t[1])}}function r(e){S&&(Util.forEachItem(m,function(e,t){var r,i,o;t.gesture_required&&(o=n(e),i=getNodeByUid(o.fid,o.uid),i?(i.paused?(r=i.src,i.src=r?Resource.videoDataUri:"",b.callPlay(i,o.fid,o.uid,!0),i.src=r,i.load()):(i.pause(),b.callPlay(i,o.fid,o.uid,!0)),t.need_unmute&&(i.muted=!1)):reportWarnClientEvent("tc-media-unknown-node",{fid:o.fid,uid:o.uid}),t.gesture_required=!1,t.need_unmute=!1)}),S=!1)}function i(e){var t,n,r;if(!e)return e;if(e.startswith("data:"))return Util.string_shorten(e,120,"...").replace(/,.*$/,"...");for(e=e.replace(/.m3u8$/,""),e=e.replace(/~+$/,""),t=e.split("/"),n=t[t.length-1].split("_"),r=0;r<n.length;r+=1)try{n[r]=atob(n[r])}catch(i){return e}return n.join("?")}function o(e){var t=getUidByNode(e);e.currentSrc&&reportWarnClientEvent("tc-media-error",{error_code:e.error?e.error.code:"UNKNOWN",uid:t,src:i(e.currentSrc)})}function a(n){var r,i,a,s,c,d,u=e.xbrowser.getEventTarget(n),f={};if(assert(u,"No target"),s=getFidByNode(u),c=getUidByNode(u),d=t(s,c),r=m[d]){if(a=r.state,assert(a,"No state"),assert(n.type,"No event type"),i=r.ignore[n.type]===!0,delete r.ignore[n.type],"error"===n.type)return void o(u);if("canplay"===n.type)return r.use_client_metadata&&e.surrogate_channel.send.apply(e.surrogate_channel,["client-media-metadata",s,c,u.duration]),!a.paused&&u.paused&&b.callPlay(u,s,c),w[d]&&0===u.currentTime&&l(u,s,c,w[d],r),void delete w[d];if("loadedmetadata"===n.type)return void(w[d]&&l(u,s,c,w[d],r));if(!i&&u.controls){switch(f.type=n.type,n.type){case"pause":if(u.ended)return;break;case"ratechange":f.playbackRate=u.playbackRate;break;case"seeking":f.currentTime=u.currentTime;break;case"volumechange":f.muted=u.muted,f.volume=u.volume}e.surrogate_channel.send("client-media",getFidByNode(u),JSON.stringify([c,f]))}}}function s(t){var n,r;for(n=0;n<v.length;n+=1)r=v[n],EventListener.addListener(t,r,a,!1);e.fullscreen.installListeners(t)}function c(){var e,t;for(e=0;e<y.length;e+=1)t=y[e],EventListener.addListener(document,t,r,!0,!0)}function l(e,t,n,r,i){var o=t+"_"+n,a=1;return e.readyState<a?void(w[o]=r):(e.currentTime=r,i.ignore.seeking=!0,void(e.paused||(i.ignore.pause=!0,i.ignore.play=!0)))}function d(e){k.hasOwnProperty(e)&&(clearTimeout(k[e]),delete k[e])}function u(n,r,o,a,s){var c,u,f,p=t(r,o),_=m[p];b.last_updated_node=n;for(c in a)if(a.hasOwnProperty(c))if(c in n)if(_.state[c]=a[c],a[c]!==n[c])switch(c){case"paused":a.paused?s.currentTime&&s.currentTime>n.currentTime?(f=Math.min(s.currentTime-n.currentTime,1),d(p),k[p]=setTimeout(function(){n.pause(),d(p),_.ignore.pause=!0},1e3*f)):(n.pause(),_.ignore.pause=!0):(d(p),s.currentTime&&s.currentTime>n.currentTime&&(w[p]=s.currentTime),b.callPlay(n,r,o));break;case"currentSrc":if(a.currentSrc=a.currentSrc||"",u=n.src||"",!a.currentSrc)break;u!==a.currentSrc&&(s.forceCurrentSrc||!e.media_source_extensions.get_media_source_or_falsy(r,o))&&("#"===a.currentSrc?n.src=Resource.videoDataUri:n.src=a.currentSrc,n.load(),Util.endsWith(n.src,".m3u8")&&(_.use_client_metadata=!0,reportWarnClientEvent("tc-media-unsupported-hls",{fid:r,uid:o,src:i(n.src)})));break;case"currentTime":l(n,r,o,a.currentTime,_);break;case"controls":if(e.useRemotingV2())break;default:switch(n[c]=a[c],c){case"volume":case"muted":_.ignore.volumechange=!0,_.gesture_required&&(n.muted?_.need_unmute=!1:(n.muted=!0,_.need_unmute=!0));break;case"playbackRate":_.ignore.ratechange=!0}}else"paused"===c&&d(p);else reportWarnClientEvent("tc-media-state-update-missing-property",{node:o,missing_property:c})}function f(n,r,i,o){var a=h.new_media_node(o,n,r),c=t(n,r);return a?(m[c]={state:{},ignore:{}},BrowserDetect.isSafari()&&(m[c].gesture_required=!0,S=!0),BrowserDetect.isIOS()&&a.setAttribute("playsinline","1"),u(a,n,r,i,{}),s(a),void e.callback.fire("new-media-node",n,r)):void reportWarnClientEvent("tc-media-unknown-node",{uid:r,tag_name:o})}function p(n,r){var i=t(n,r);assert(e.useRemotingV2()),delete m[i],h.did_remove_media_node(n,r)}function _(e,t,n,r){var i=getNodeByUid(e,t);return i?void u(i,e,t,n,r):void reportWarnClientEvent("tc-media-unknown-node",{uid:t})}function g(e,t,n){var r=getNodeByUid(e,t);return r?void(r.src=n):void reportWarnClientEvent("tc-media-unknown-node",{fid:e,uid:t})}var h,m={},v=["canplay","error","pause","play","ratechange","seeking","volumechange","loadedmetadata"],y=["touchend","click"],w={},b=this,k={},S=!1,C=!1;b.callPlay=function(n,r,i,o){var a,s=t(r,i),c=m[s];return C?void e.surrogate_channel.send("client-media",r,JSON.stringify([i,{type:"pause"}])):(!o&&c&&c.gesture_required&&(n.muted||(n.muted=!0,c.need_unmute=!0)),a=n.play(),c&&(c.ignore.play=!0),void(a&&a["catch"](function(t){!o&&n.paused&&e.surrogate_channel.send("client-media",getFidByNode(n),JSON.stringify([getUidByNode(n),{type:"pause"}])),c&&(!o&&BrowserDetect.isSafari()&&(c.gesture_required=!0,S=!0),delete c.ignore.play)})))},b.setClient=function(e){h=e},b.backendValuesForNode=function(e,n){var r=m[t(e,n)];return r?r.state:void 0},b.stopAllMedia=function(){C=!0,Util.forEachItem(m,function(t,r){var i,o=n(t);i=getNodeByUid(o.fid,o.uid),i&&(i.pause(),e.surrogate_channel.send("client-media",o.fid,JSON.stringify([o.uid,{type:"pause"}])))})},e.interp.registerOpcodeHandler(e.interp.OPCODES.MEDIA_NEW_NODE,f),e.interp.registerOpcodeHandler(e.interp.OPCODES.MEDIA_UPDATE,_),e.interp.registerOpcodeHandler(e.interp.OPCODES.MEDIA_BLOB,g),e.interp.registerOpcodeHandler(e.interp.OPCODES.MEDIA_REMOVE_NODE,p),BrowserDetect.isSafari()&&c()}function MediaSourceExtensions(e){function t(t,n){return e.useRemotingV2()?"1_"+n:t+"_"+n}function n(e,t){var n,r=e.source_buffers;for(n in r)if(r.hasOwnProperty(n)&&!t(r[n]))return!1;return!0}function r(e,n){var r=t(e,n),i={key:r,source_buffers:{},queue:[],fid:e,uid:n};return U[r]=i,i}function i(e,t){var n=M.get_media_source_or_falsy(e,t);return n||reportErrorClientEvent("tc-mse-no-media-source-found-error",{fid:e,uid:t}),n}function o(e){clearInterval(e.advance_poller),e.so_callback&&(EventListener.removeListener(e.ms_object,"sourceopen",e.so_callback),delete e.so_callback),n(e,function(e){return e.ue_callback&&(e.sb_object&&EventListener.removeListener(e.sb_object,"updateend",e.ue_callback),delete e.ue_callback),!0})}function a(t){o(t),t.fid&&t.uid&&e.dom_updater.removeRetainedNode(t.fid,t.uid),t.error=!0,delete t.ms_object,delete t.source_buffers,delete t.queue}function s(e,t,n,r){var o,a;return n.data=r,o=i(e,t),o&&!o.error?(a=o.source_buffers[n.src_bfr_id])?void h(o):void reportWarnClientEvent("tc-mse-no-source-buffer-found-segment-fetch-error",{src_buf_id:n.src_bfr_id}):void 0}function c(e,t,n){var r;reportWarnClientEvent("tc-mse-segment-fetch-error",{evt:n}),r=i(e,t),r&&a(r)}function l(t,n,r){var o,d,u,f="/r/mse",p={cid:e.pairing_dict.cid,rid:e.pairing_dict.rid,tab_id:e.pairing_dict.tab_id};o={safe_rid:e.pairing_dict.safe_rid,tab_id:e.pairing_dict.tab_id,fid:t,uid:n,src_buf_id:r.src_bfr_id,seq_id:r.seq_id},d=f+"?"+Util.buildQueryStr(p),d=e.url_builder.buildProtocolUrl(d),u=new XMLHttpRequest,u.withCredentials=!0,u.open("POST",d,!0),u.onload=function(e){delete r.fetch_req,O=0,s(t,n,r,u.response)},u.onerror=function(e){return delete r.fetch_req,L>O?(O+=1,void setTimeout(function(){l(t,n,r)},P)):void c(t,n,e)},u.onabort=function(e){var o=i(t,n);delete r.fetch_req,o&&a(o)},r.fetch_req=u,u.send(JSON.stringify(o)),u.responseType="arraybuffer"}function d(e,t,n){var r,i=e.ms_object,o={id:t,media_type:n,seq_id:0},s=n;e.source_buffers[t]=o,o.ue_callback=function(t){h(e)},-1!==s.indexOf("avc3")&&"Explorer"===browser.name&&(s=s.replace("avc3","avc1"));try{r=i.addSourceBuffer(s),o.sb_object=r,EventListener.addListener(r,"updateend",o.ue_callback)}catch(c){reportErrorClientEvent("tc-mse-sourcebuffer-init-error",{error:c.toString(),type:n}),a(e)}return!0}function u(e,t){var n=e.source_buffers[t];if(n&&n.sb_object){n.ue_callback&&EventListener.removeListener(n.sb_object,"updateend",n.ue_callback);try{e.ms_object.removeSourceBuffer(n.sb_object)}catch(r){reportErrorClientEvent("tc-mse-sourcebuffer-remove-error",{error:r.toString()}),a(e)}delete e.source_buffers[t]}else reportWarnClientEvent("tc-mse-no-source-buffer-found-to-remove-error",{src_buf_id:t});return!0}function f(e,t){var r=e.ms_object;if(!n(e,function(e){var t=e.sb_object;return!(t&&t.updating)}))return!1;try{r.duration=t}catch(i){reportErrorClientEvent("tc-mse-set-duration-error",{error:i.toString()}),a(e)}return!0}function p(r){var i=!0;return n(r,function(e){var t=e.sb_object;return!(t&&t.updating)})||(i=!1),o(r),r.fid&&r.uid&&(e.dom_updater.removeRetainedNode(r.fid,r.uid),delete U[t(r.fid,r.uid)]),i}function _(e,t){var n=e.ms_object;return n&&"open"===n.readyState?"add_src_bfr"===t.cmd?d(e,t.id,t.media_type):"remove_src_bfr"===t.cmd?u(e,t.id):"set_duration"===t.cmd?f(e,t.duration):"src_close"===t.cmd?p(e):(reportErrorClientEvent("tc-mse-unrecognized-media-source-command-error",{item:t}),a(e),!0):!1}function g(e,t){var n,r,i,o=e.source_buffers[t.src_bfr_id];if(!o)return reportWarnClientEvent("tc-mse-no-source-buffer-found-run-command-error",{src_buf_id:t.src_bfr_id}),!0;if("append"===t.cmd&&void 0===t.seq_id)return t.seq_id=o.seq_id++,l(e.fid,e.uid,t),!1;if(n=e.ms_object,r=o.sb_object,!n||"open"!==n.readyState||!r||r.updating)return!1;try{if("append"===t.cmd){if(!t.data)return assert(t.fetch_req),!1;r.appendBuffer(t.data)}else"abort"===t.cmd?r.abort():"remove"===t.cmd?r.remove(t.start,t.end):"attr"===t.cmd&&-1!==B.indexOf(t.attr_name)?(i="inf"===t.attr_value?1/0:t.attr_value,r[t.attr_name]=i):(reportErrorClientEvent("tc-mse-unrecognized-source-buffer-command-error",{item:t}),a(e))}catch(s){reportErrorClientEvent("tc-mse-source-buffer-action-error",{cmd:t.cmd,error:s.toString(),type:o.media_type}),a(e)}return!0}function h(e){for(var t,n,r=e.queue;!e.error&&r.length;){if(t=r[0],n=t.src_bfr_id?g:_,!n(e,t))return;r.shift()}}function m(e,t){e.error||(e.queue.push(t),h(e))}function v(t,n){var r,o,a,s,c,l,d,u=getNodeByUid(t,n),f=i(t,n),p="Explorer"===browser.name||"Edge"===browser.name?2:.2;if(!u&&f)return void clearInterval(f.advance_poller);if(u){if(u.paused)return r=e.media_objects.backendValuesForNode(t,n)||{},void(r.paused===!1&&e.media_objects.callPlay(u,t,n));if(a=u.currentTime,l=u.prev_currentTime,u.prev_currentTime=a,l&&l===a?f.same_currentTime_count++:f.same_currentTime_count=0,!(f.same_currentTime_count<2))for(o=u.buffered,c=0,d=0;d<o.length&&a>=c;d++){if(s=o.start(d),s>a&&p>s-a&&o.end(d)-s>5){u.currentTime=o.start(d)+.01;break}c=o.end(d)}}}function y(e,t){var n=M.get_media_source_or_falsy(e,t);n&&(n.queue.length&&n.queue[0].fetch_req&&n.queue[0].fetch_req.abort(),o(n)),n=r(e,t)}function w(t,n){var r,o=getNodeByUid(t,n),s=i(t,n),c=function(e){h(s)};try{r=new MediaSource,s.ms_object=r,o.src=URL.createObjectURL(r),EventListener.addListener(r,"sourceopen",c),s.so_callback=c}catch(l){reportErrorClientEvent("tc-mse-mediasource-init-error",{error:l.toString()}),a(s)}e.dom_updater.addRetainedNode(t,n,o),s.advance_poller=setInterval(function(){v(t,n)},200)}function b(e,n){var r=getNodeByUid(e,n);return y(e,n),r?void w(e,n):void(I[t(e,n)]=!0)}function k(e,t,n,r){var o=i(e,t);m(o,{cmd:"add_src_bfr",id:n,media_type:r})}function S(e,t,n){var r=i(e,t);m(r,{cmd:"remove_src_bfr",id:n})}function C(e,t,n){var r=i(e,t);m(r,{cmd:"set_duration",duration:n})}function E(e,t,n){var r=i(e,t);r.error||m(r,{cmd:"append",src_bfr_id:n})}function x(e,t,n){var r=i(e,t);m(r,{cmd:"abort",src_bfr_id:n})}function A(e,t,n,r,o){var a=i(e,t);m(a,{cmd:"remove",src_bfr_id:n,start:r,end:o})}function T(e,t,n,r,o){var a=i(e,t);m(a,{cmd:"attr",src_bfr_id:n,attr_name:r,attr_value:o})}function R(e,t){var n=i(e,t);n&&!n.error&&m(n,{cmd:"src_close"})}function D(e,n){var r=t(e,n);I[r]&&(delete I[r],w(e,n))}var L=10,P=1e3,U={},I={},O=0,B=["mode","timestampOffset","appendWindowStart","appendWindowEnd"],M=this;M.get_media_source_or_falsy=function(e,n){return U[t(e,n)]},e.interp.registerOpcodeHandler("mse_attach_media_src",b),e.interp.registerOpcodeHandler("mse_add_src_bfr",k),e.interp.registerOpcodeHandler("mse_remove_src_bfr",S),e.interp.registerOpcodeHandler("mse_set_duration",C),e.interp.registerOpcodeHandler("mse_add_to_src_bfr",E),e.interp.registerOpcodeHandler("mse_abort_src_bfr",x),e.interp.registerOpcodeHandler("mse_remove_from_src_bfr",A),e.interp.registerOpcodeHandler("mse_set_src_bfr_attr",T),e.interp.registerOpcodeHandler("mse_src_close",R),e.callback.register("new-media-node",D)}function CanvasSupport(e){function t(){var e,t=a;a={},i=null;for(e in t)t.hasOwnProperty(e)&&n.apply(s,t[e])}function n(e,n,r,s){var c,l=n+"_"+r,d=getNodeByUid(n,r);return d?"canvas"!==d.nodeName.toLowerCase()?void reportWarnClientEvent("tc-canvas-mismatch",{fid:n,uid:r,node:d.nodeName}):void(o[l][0]>s||(o[l][0]=s,c=d.getContext("2d"),c.globalCompositeOperation="copy",c.drawImage(e,0,0,d.width,d.height),window.URL.revokeObjectURL(e.src))):(a[l]=[e,n,r,s],void(i||(i=window.setTimeout(t,1e3))))}function r(e,t){var r,i,a,s,c,l,d;return s=new window.DataView(t.buffer,t.byteOffset,8),a=s.getUint32(0,!1),l=s.getUint32(4,!1),i=a+"_"+l,r=new window.Blob([new window.Uint8Array(t.buffer,t.byteOffset+8)],{type:"image/png"}),o[i]?o[i][1]+=1:o[i]=[0,1],d=o[i][1],c=new Image,c.onload=n.curry(c,a,l,d),c.src=window.URL.createObjectURL(r),!0}var i,o={},a={},s=this;e.interp.registerBinaryHandler(r)}function URLBuilder(e){function t(){return!TPROXY_ENABLED&&Util.isIpAddress(window.location.hostname)}function n(e){return"/"!==e.substr(0,1)&&(e="/"+e),e}function r(e){var t,n="";for(t=0;t<e.byteLength;t+=1)n+=String.fromCharCode(e[t]);return window.btoa(n)}function i(e){var t=r(e);return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"~")}var o=this;o.getDomain=function(n){if(t())return window.location.hostname;switch(n){case"service":return TPROXY_ENABLED?CLUSTER_DOMAIN:window.location.hostname;case"login":return window.LOGIN_DOMAIN;case"cluster":case"inspect":case"cluster-protocol":return"main"!==e.role?CLUSTER_DOMAIN:"cluster"===n?e.pairing_dict.cluster_domain||CLUSTER_DOMAIN:"cluster-protocol"===n?e.pairing_dict.protocol_domain||PROTOCOL_DOMAIN:e.pairing_dict.inspect_domain||INSPECT_DOMAIN;default:throw new Error("invalid domain kind "+n)}},o.buildProtocolUrl=function(e,t){return assert(e),assert(e),(t?"wss://":"https://")+o.getDomain("cluster-protocol")+n(e)},o.buildFileServerUrl=function(t,n,r){var i,a=n?o.buildInspectURL:o.buildProtocolUrl,s={cid:e.pairing_dict.s_nid_with_underscore,rid:e.pairing_dict.rid};if(r)for(i in r)r.hasOwnProperty(i)&&(s[i]=r[i]);return a(t+"?"+Util.buildQueryStr(s,!1))},o.buildClusterURL=function(e){return"https://"+o.getDomain("cluster")+n(e)},o.buildInspectURL=function(e){return"https://"+o.getDomain("inspect")+n(e)},o.buildImageURLFromU8Array=function(e){var t=i(e);return o.buildClusterURL("/c/i/"+t)},o.buildAssetURL=function(e){return o.buildClusterURL(e)+"?v="+BUILD_ID},o.buildServiceURL=function(e){return"https://"+o.getDomain("service")+n(e)},o.buildLoginURL=function(e){return"https://"+o.getDomain("login")+n(e)},o.buildVanityFileTransferURL=function(e){return TPROXY_ENABLED?o.buildLoginURL(e):o.buildServiceURL(e)},o.getServiceDomain=function(){return"https://"+o.getDomain("service")}}function Template(){function e(e){var t=e.getAttribute("content");return assert(t),Util.b64Decode(t)}function t(){var t,n,i;for(n=document.getElementsByTagName("sv-template"),t=0;t<n.length;t+=1)i=n[t].id,assert(i),r[i]=e(n[t]),assert(r[i]);assert(r)}var n=this,r={};n.get=function(e,t){var n,i;if(!r.hasOwnProperty(e))throw new Error('Invalid template "'+e+'"');if(n=r[e],t)for(i in t)t.hasOwnProperty(i)&&(n=n.replace("{{"+i+"}}",t[i]));return n},t()}function Localization(e,t){function n(){i=t?t:JSON.parse(e.template.get("localization-template"))}var r=this,i={};r.get=function(e){var t,n=i[e];if(void 0===n)return reportErrorClientEvent("tc-localization-no-entry",{id:e}),e;for(t=1;t<arguments.length;t+=1)n=n.replace("$"+t,arguments[t]);return n},r.get_localization_data=function(){return i},n()}function ServerCall(){function e(e){return e.contentType="text/plain",e.xhrFields={withCredentials:!0},$.ajax(e)}function t(e){var t;return t=$.extend({},e),assert(t.url),t.url=new ParsedURL(t.url).withTrackingLabel(),t.type="POST",t.dataType="json",t.async=!0,t.cache=!1,t.timeout||(t.timeout=safeview.perf.xhr_timeout_ms),t.success&&(t.success=t.success.bind(e)),t.complete&&(t.complete=t.complete.bind(e)),assert(!t.orig_error_func),t.orig_error_func=t.error,t.error=function(n,r,i){t.skip_report||reportClientEvent("tc-server-call-failed",{url:t.url,method:t.type,dataType:t.dataType,timeout:t.timeout,textStatus:r,errorThrown:i,responseHeaders:n.getAllResponseHeaders(),statusCode:n.statusCode()}),t.orig_error_func&&t.orig_error_func.call(e,n,r,i)},t}var n=this;n.call=function(n){return e(t(n))}}function SCContext(e,t){var n=this;n.call_id=e,n.done_cbs=[],n.fail_cbs=[],n.always_cbs=[],n.done=function(e){return n.done_cbs.push(e),n},n.fail=function(e){return n.fail_cbs.push(e),n},n.always=function(e){return n.always_cbs.push(e),n},t.success&&n.done_cbs.push(t.success),t.error&&n.fail_cbs.push(t.error),t.complete&&n.always_cbs.push(t.complete)}function ServerCallDelegate(e){function t(t,n){e.postToCommFrame({kind:"server_call",fid:e.fid,call_id:t.call_id,op_name:n.op_name,data:n.data,timeout:n.timeout})}var n=this,r={},i=0;n.call=function(e){var n=new SCContext(i,e);return r[i]=n,i+=1,t(n,e),n},n.on_sc_result=function(e,t,n){assert("server_call_resp"===n.kind);var i,o=n.call_id,a=r[o];if(!a)return void reportErrorClientEvent("tc-sc-delegate-context-missing");switch(n.ret){case"done":for(i=0;i<a.done_cbs.length;i+=1)a.done_cbs[i](n.result);break;case"fail":for(i=0;i<a.fail_cbs.length;i+=1)a.fail_cbs[i](n.xhr,n.text_status);break;default:assert(!1)}for(i=0;i<a.always_cbs.length;i+=1)a.always_cbs[i](n.xhr,n.text_status);delete r[o]}}function ServerCallDispatcher(e){function t(t){var n,r={},i=e.url_builder;switch(t.data&&(r.data=t.data),t.call_timeout&&(r.timeout=t.call_timeout),t.op_name){case"client_event":n=i.buildProtocolUrl("/safeview-client-logger/clientevent");break;case"get_download_action":n=i.buildFileServerUrl("/safeview-fileserv/tc_status");break;case"feedback":n=i.buildProtocolUrl("/safeview-client-logger/feedback");break;case"query_policy":n=i.buildProtocolUrl("/r/policy/query");break;case"policy_action":n="/r/policy/"+t.action+(t.cid?"?cid="+t.cid:"");break;case"ui_html":n=i.buildProtocolUrl("/safeview-template/ui.html");break;case"stop_stream":n=i.buildClusterURL("/RDS/streamcontrol/stop/"+t.plugin_view_id+"?cid="+e.pairing_dict.s_nid_with_underscore+"&rid="+e.pairing_dict.rid);break;default:assert(!1)}return r.url=n,r}var n=this;n.dispatch=function(n,r){assert("server_call"===r.kind);var i=t(r);e.server_call.call(i).done(function(t){e.postToFrame(n,{kind:"server_call_resp",call_id:r.call_id,ret:"done",result:t})}).fail(function(t,i){var o={};o.status=t.status,e.postToFrame(n,{kind:"server_call_resp",call_id:r.call_id,ret:"fail",xhr:o,text_status:i})})}}function CrossOriginFrame(e,t){function n(){var e=document.createElement("iframe");return e.id="cof-server:"+p,e.src=t,e.width="0",e.height="0",e.style.display="none",e.tabindex="-1",e}function r(e){document.getElementById("cof-server:"+p)||(e.parentNode||document.documentElement.appendChild(e),assert(e.parentNode))}function i(e){return l&&l.iframe.contentWindow&&l.is_registered?void e(l):(f.push(e),l||(l={iframe:n(),is_registered:!1}),void r(l.iframe))}function o(e){var t;for(assert(l),assert(l.iframe.contentWindow),l.is_registered=!0,t=0;t<f.length;t+=1)f[t](l);f=[]}function a(e){var t=u[e.call_id];delete u[e.call_id],t&&t(e.result)}function s(){assert(window.postMessage),assert(/^http(s)?:\/\//.test(p))}var c=this,l=null,d=0,u={},f=[],p=new ParsedURL(t).origin;c.onReceiveMessage=function(t){var n;if(t.origin!==p)return void reportWarnClientEvent("tc-cof-client-unexpected-origin",{expected_origin:p,actual_origin:t.origin});try{n=JSON.parse(t.data)}catch(r){return void reportWarnClientEvent("tc-cof-client-unexpected-message",{detail:t.data,error:r.toString()})}switch(n.kind){case"register-server":o(n);break;case"call-result":a(n);break;case"auth-check-reauth":e.pairing.doRecookie(n.result[0]);break;case"inspect-onerror":e.upload.oninspecterror.apply(null,n.result);break;case"upload-onerror":e.upload.onerror(n.result[0]);break;case"upload-onload":e.upload.onload(n.result[0],n.result[1]);break;case"upload-onprogress":e.upload.onprogress(n.result[0]);break;default:assert(0)}},c.call=function(e,t,n){var r=d,o={call_id:r,call_args:e};u[r]=t,d+=1,i(function(e){var t=e.iframe.contentWindow;assert(e.is_registered),assert(t),BrowserDetect.isIE10()||BrowserDetect.isChrome()?t.postMessage(o,p):t.postMessage(o,p,n)})},s()}function doLoginXHR(e,t,n){var r=new XMLHttpRequest;r.open("POST",t),r.target_url=t,r.withCredentials=!0,r.onload=function(e){var t;if(200===r.status)try{return t=JSON.parse(r.response),void n(t.use_inspect_host)}catch(i){}n()},r.onerror=function(e){n()},r.send(JSON.stringify(e))}function record_auth_check(){try{window.localStorage.setItem("ac_last",(new Date).getTime())}catch(e){}}function record_auth_check_result(e){var t=0;try{e||(t=(parseInt(window.localStorage.getItem("ac_fail"),10)||0)+1),window.localStorage.setItem("ac_fail",t)}catch(n){}}function should_auth_check(){var e,t,n=3,r=3e5;try{return e=parseInt(window.localStorage.getItem("ac_fail"),10)||0,t=parseInt(window.localStorage.getItem("ac_last"),10)||0,n>e||t+r<(new Date).getTime()}catch(i){return!0}}function RPCHandlers(e){function t(e,t,r,i,o,a,s,c){var l=new XMLHttpRequest;l.open("POST","https://"+e+"/safeview-auth-server/check"),l.timeout=t,l.withCredentials=!0,l.onerror=function(t){record_auth_check_result(!1),console.error("auth check "+e+" response failure")},l.onload=function(t){var r,d;if(200!==l.status)return void l.onerror(t);if(r=JSON.parse(l.response),!r.success)return void l.onerror(t);if(record_auth_check_result(!r.reauth),r.reauth){if(s)return void n.doITok(s,a,null,o.url);d=i&&r.use_integrity_token&&navigator.userAgent.indexOf("Trident")>=0,reportWarnClientEvent("tc-attempt-recookie",{target_url:o.url,login_url:o.login_url,host:e,do_toks:d,redirect_list:o.redirect_list}),d?n.doToksAuth(o,o.url):c.postToController({kind:"auth-check-reauth",result:[o]})}},l.send(JSON.stringify({sb:r})),record_auth_check()}var n=this,r="ws_support",i=null;n.getActiveCookie=function(){return Util.getCookie("active")},n.setActiveCookie=function(e){return Util.setCookie("active",e,null,null,null,!0)},n.setNidCookie=function(e){return Util.setCookie("nid",e,null,"/",null,!0)},n.setWSSupportState=function(e,t){var n;void 0===t&&(t=(new Date).getTime()),n={state:e,time:t};try{localStorage.setItem(r,JSON.stringify(n));
}catch(i){throw new Error("tc-localstorage-setitem-error")}return n},n.getWSSupportState=function(e){var t;try{t=JSON.parse(localStorage.getItem(r))}catch(i){throw new Error("tc-localstorage-getitem-error")}return t||(t=n.setWSSupportState(e?"OK":"ERR",0)),t},n.getFeatureReport=function(){try{return localStorage.getItem("feature_report")}catch(e){return null}},n.setFeatureReport=function(e){localStorage.setItem("feature_report",e)},n.doToksAuth=function(e,t){var n,r=__randstr(43,!0),i=Util.buildLoginForm(e,t);try{window.localStorage.setItem("tok_s",r),n=document.createElement("input"),n.type="hidden",n.name="tok_s",n.value=r,i.appendChild(n)}catch(o){console.error("Failed to use local storage.")}Util.submitLoginForm(i,"_top")},n.doAuthCheck=function(n,r,i){var o;if(n.check_hosts&&should_auth_check())for(o=0;o<n.check_hosts.length;o+=1)t(n.check_hosts[o],n.timeout,n.sb,n.transparent_mode,r,n.check_hosts,i,e)},n.doITok=function(e,t,n,r){function i(t){c-=1,t&&!l&&(l=!0,c+=1,doLoginXHR({itok:e,tok_s:s,host:o},"https://"+n+"/safeview-auth-server/do_itok_auth",i)),0===c&&(window.top.location=r)}var o,a,s,c=t.length,l=!1;o=new ParsedURL(r).host;try{s=window.localStorage.getItem("tok_s")}catch(d){console.log("Failed to get tok_s from local storage.")}if(!s)return!1;for(a=0;a<t.length;a+=1)doLoginXHR({itok:e,tok_s:s,host:o},"https://"+t[a]+"/safeview-auth-server/do_itok_auth",i);return!0},n.doUpload=function(t,n,r){var o=new FormData,a=new XMLHttpRequest,s=new Blob([r],{type:"application/octet-stream"});o.append("file",s,n),a.open("POST",window.location.origin+"/r/upload?"+t),a.withCredentials=!0,a.onload=function(t){i=null,e.postToController({kind:"upload-onload",result:[a.status,a.responseText]})},a.upload.onprogress=function(t){e.postToController({kind:"upload-onprogress",result:[t.loaded]})},a.onerror=function(){e.postToController({kind:"upload-onerror",result:[a.status]}),i=null},a.onabort=function(){i=null},i=a,a.send(o)},n.doUploadAbort=function(){i&&i.abort&&i.abort()},n.doInspect=function(t,n,r){var i=new XMLHttpRequest;i.open("POST",window.location.origin+"/r/user_input?"+t),i.input_count=n,i.onload=function(t){(200!==i.status||"MSIP_OK"!==i.responseText)&&e.postToController({kind:"inspect-onerror",result:[i.input_count,i.status,i.responseText]})},i.onerror=function(){e.postToController({kind:"inspect-onerror",result:[i.input_count,i.status]})},i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.setRequestHeader("Accept","text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"),i.send(r)},n.setDebugFlag=function(e){window.DEBUG=e}}function CrossOriginFrameServer(e){function t(e){window.parent.postMessage(JSON.stringify(e),"*")}function n(e){var n,r,i;n=e.data;try{i=n.call_args[0]}catch(c){return void reportWarnClientEvent("tc-cof-server-unexpected-message",{detail:e.data,error:c.toString()})}if(!s.hasOwnProperty(i))return void reportWarnClientEvent("tc-cof-server-unexpected-method",{method_name:i});try{r=s[i].apply(a,n.call_args.slice(1))}catch(c){o.error({event:"tc-cof-rpc-exception",e:c.toString()}),r=null}t({kind:"call-result",call_id:n.call_id,result:r})}function r(){t({kind:"register-server",domain:location.hostname})}var i=this,o=new Logger("cof-server",{level:"info"}),a=new RPCHandlers(i),s={getActiveCookie:a.getActiveCookie,setActiveCookie:a.setActiveCookie,setNidCookie:a.setNidCookie,getFeatureReport:a.getFeatureReport,setFeatureReport:a.setFeatureReport,getWSSupportState:a.getWSSupportState,setWSSupportState:a.setWSSupportState,doToksAuth:a.doToksAuth,doAuthCheck:a.doAuthCheck,doITok:a.doITok,doUpload:a.doUpload,doUploadAbort:a.doUploadAbort,doInspect:a.doInspect,setDebugFlag:a.setDebugFlag};i.init=function(){window.BUILD_ID=Util.getParam("v"),i.event_reporter=new ClientEventReporter(i),EventListener.addListener(window,"message",n,!1),r()},i.postToController=t}function BrowserVoodoo(e){function t(){i||(i=setInterval(function(){var e;document.body&&(e=document.createElement("iframe"),e.id="sv-ff-spinner-dummy",e.src="about:blank",e.width=e.height="0",e.style.display="none",e.tabindex="-1",document.body.appendChild(e),document.body.removeChild(e))},3e3))}function n(){var e=5e3;setInterval(function(){var e,t;for(e in fidToIframeNode)fidToIframeNode.hasOwnProperty(e)&&(t=fidToIframeNode[e],t&&t.contentDocument&&t.contentDocument.close())},e)}function r(){"Firefox"===browser.name?e.callback.registerOneShot("dom-loaded",6e3,{on_success:t,on_timeout:t}):"Chrome"===browser.name&&45===browser.version&&e.callback.registerOneShot("dom-loaded",6e3,{on_success:n,on_timeout:n})}var i;r()}function PolicySupport(e){function t(e){return 0===e.indexOf("readonly/")&&(e=e.slice("readonly/".length)),e}var n=this;n.getValues=function(n,r){var i={},o="/r/policy/query";i.url=t(Util.getRawPageUrl()),i.policy_keys=n,i.transparent_mode=TPROXY_ENABLED,e.serverCall({op_name:"query_policy",url:e.url_builder.buildProtocolUrl(o),data:JSON.stringify(i),timeout:e.perf.xhr_timeout_ms+e.perf.pre_pair_xhr_ms,success:function(e){r(e)},error:function(e,t){reportClientEvent("tc-policy-query-failed",{status:t,jqXHR_status:e.status,request_url:o}),r({})}})},n.setAction=function(n,r,i,o){var a="/r/policy/"+n+(r?"?cid="+r:"");void 0===i&&(i={}),i.url=t(Util.getRawPageUrl()),e.serverCall({op_name:"policy_action",action:n,cid:r,url:e.url_builder.buildProtocolUrl(a),data:JSON.stringify(i),success:function(e){o(e)},error:function(e,t){reportClientEvent("tc-policy-action-failed",{action:n,status:t,jqXHR_status:e.status,request_url:a}),o({})}})}}function HttpAlertSupport(e){function t(){var e,t,n=document.documentElement.clientWidth,r=l?l.offsetHeight:0,i=l?l.offsetWidth:0,o=Util.getTopWindowPosition(l),a=0,s=0;c&&"hide"!==c.style.display&&(e=c.offsetHeight,t=c.offsetWidth,o.x+i+t>n&&o.y+r/2-e/2>=1?(c.classList.remove("menlo-http-alert-bottom"),c.classList.add("menlo-http-alert-top"),a=o.x+i/2-t/2,s=o.y-e-12,1>s&&(c.classList.remove("menlo-http-alert-top"),c.classList.add("menlo-http-alert-bottom"),a=o.x+i/2-t/2,s=o.y+r+16)):(c.classList.remove("menlo-http-alert-top"),c.classList.remove("menlo-http-alert-bottom"),a=o.x+i+12,s=o.y+r/2-e/2,1>s&&(c.classList.remove("menlo-http-alert-top"),c.classList.add("menlo-http-alert-bottom"),a=o.x+i/2-t/2,s=o.y+r+16)),c.style.left=a+"px",c.style.top=s+"px")}function n(){l=null,c&&(c.style.display="none")}function r(e){c&&(l=e.target,c.style.display="block",t())}function i(){var t;for(c&&c.parentNode.removeChild(c),d&&e.callback.deregister(d),t=0;t<f.length;t+=1)EventListener.removeListener(f[t],"focus",r),EventListener.removeListener(f[t],"blur",n);l&&l.focus(),c=null,l=null,d=null,f=[]}function o(t){var n=e.url_builder.buildAssetURL(t),r=document.createElement("link");return r.type="text/css",r.id=g,r.rel="stylesheet",r.href=n,r.media="all",r}function a(){var t;document.body.insertAdjacentHTML("beforeend",e.template.get("http-alert-template")),t=document.getElementById(_),EventListener.addListener(t,"mousedown",i),c=document.getElementById(h),c.classList.add(p),c.style.display="none"}function s(e,t,i,s){Util.is_element_input_text(t)&&(c||(document.getElementById(g)||document.head.appendChild(o("/safeview-static/css/http-alert.css")),a()),EventListener.addListener(t,"focus",r),EventListener.addListener(t,"blur",n),f.push(t))}var c,l,d,u=this,f=[],p="menlo-http-alert-hidden",_="menlo-http-alert-close",g="menlo-http-alert-css",h="menlo-http-alert";u.configHttpAlert=function(t){!window.TPROXY_ENABLED&&t.client_caps&&t.client_caps.insecure_form_warning&&!t.secure_backend&&(d=e.callback.register("add-element",s))},u.update=function(){c&&t()},u.dismiss=function(){i()}}function LEchoErrorAlert(e){function t(){var e,t,n=document.documentElement.clientWidth,r=l?l.offsetHeight:0,i=l?l.offsetWidth:0,o=Util.getTopWindowPosition(l),a=0,s=0;c&&"none"!==c.style.display&&(e=c.offsetHeight,t=c.offsetWidth,o.x+i+t>n&&o.y+r/2-e/2>=1?(c.classList.remove("menlo-mismatch-alert-bottom"),c.classList.add("menlo-mismatch-alert-top"),a=o.x+i/2-t/2,s=o.y-e-12,1>s&&(c.classList.remove("menlo-mismatch-alert-top"),c.classList.add("menlo-mismatch-alert-bottom"),a=o.x+i/2-t/2,s=o.y+r+16)):(c.classList.remove("menlo-mismatch-alert-top"),c.classList.remove("menlo-mismatch-alert-bottom"),a=o.x+i+12,s=o.y+r/2-e/2,1>s&&(c.classList.remove("menlo-mismatch-alert-top"),c.classList.add("menlo-mismatch-alert-bottom"),a=o.x+i/2-t/2,s=o.y+r+16)),c.style.left=a+"px",c.style.top=s+"px")}function n(e,n){l=getNodeByUid(e,n),l&&c&&(c.style.display="block",t())}function r(){c&&c.parentNode.removeChild(c),u&&e.callback.deregister(u),d(),d=null,l&&l.focus(),c=null,l=null,u=null}function i(t){var n=e.url_builder.buildAssetURL(t),r=document.createElement("link");return r.type="text/css",r.id=g,r.rel="stylesheet",r.href=n,r.media="all",r}function o(){var t;document.body.insertAdjacentHTML("beforeend",e.template.get("mismatch-alert-template")),t=document.getElementById(_),EventListener.addListener(t,"mousedown",r),c=document.getElementById(h),c.classList.add(p),c.style.display="none"}function a(e,t,n,r){Util.can_element_use_lecho(t)&&(c||(document.getElementById(g)||document.head.appendChild(i("/safeview-static/css/mismatch-alert.css")),o()))}function s(){setTimeout(function(){if(l&&c&&"none"!==c.style.display){if(!l.parentNode)return void r();t(),s()}},500)}var c,l,d,u,f=this,p="menlo-mismatch-alert-hidden",_="menlo-mismatch-alert-close",g="menlo-mismatch-alert-css",h="menlo-mismatch-alert";f.config_alert=function(t){local_echo_enabled&&(u=e.callback.register("add-element",a))},f.add_alert_for_input=function(e,t,r){var i=getNodeByUid(e,t);return local_echo_config.show_alert?void(i&&Util.can_element_use_lecho(i)&&(reportClientEvent("tc-lecho-bubble-alert",{},!0,!1),d=r,n(e,t),s(),DEBUG&&(i.style.background="aqua",i.style.border="solid",i.style.borderColor="red"))):void reportClientEvent("tc-lecho-bubble-alert",{skipped:!0},!0,!1)}}function PreloadIndicator(e){function t(){var e;for(e=a.length-1;e>=0;e-=1)a[e]&&a[e].parentNode&&a[e].parentNode.removeChild(a[e]);a=[]}function n(t){var n=e.url_builder.buildAssetURL(t),r=document.createElement("link");return r.type="text/css",r.id=s,r.rel="stylesheet",r.href=n,r.media="all",r}function r(){return a.length>0}function i(){var e;r()||(a.push(document.head.appendChild(n("/safeview-static/css/loader.css"))),e=document.createElement("div"),e.id=c,e.className="menlo-loader-spinner",a.push(document.body.appendChild(e)),e=document.createElement("div"),e.id=l,e.className="menlo-loader-info",a.push(document.body.appendChild(e)))}var o=this,a=[],s="menlo-loader-css",c="menlo-loader-spinner",l="menlo-loader-info";o.configPreloadIndicator=function(e){e.client_caps&&e.client_caps.preload_indicator&&i()},o.showPreloadIndicator=function(){i()},o.dismiss=function(){t()}}function ReadonlySupport(e){function t(){return"read_only"===Util.persistentPolicy().entry_action}function n(){var e=Util.persistentPolicy();return{explain:e.explain,experience_mode:e.user_experience_banner}}function r(t,n,r){var i=e.url_builder.buildAssetURL(t),o=document.createElement("link");return o.type="text/css",o.rel="stylesheet",o.href=i,m[r].css_link=o,EventListener.addListener(o,"load",n),o}function i(t){m[t].div.className.indexOf(m[t].hide_class)<0?(m[t].hidden=!0,m[t].div.className+=m[t].hide_class):(m[t].hidden=!1,m[t].div.className=m[t].div.className.replace(m[t].hide_class,"")),"ro"===t&&e.surrogate_channel.send("banner_hidden",m[t].hidden)}function o(){Util.persistentPolicy();e.surrogate_channel.send("readonly-mode-relax")}function a(e){m[e].div&&(m[e].div.parentNode.removeChild(m[e].div),m[e].div=void 0),m[e].css_link&&(document.head.removeChild(m[e].css_link),m[e].css_link=void 0),m[e].has_banner=!1}function s(){var t=Util.persistentPolicy(),n=e.tab_store.load();a("ro"),e.policy.setAction("readonly_exit",n.cid,{safe_rid:n.safe_rid,tab_id:n.tab_id,exit_mode:t.upgrade_action,persistent_policy:t},o)}function c(n){if("bw"===n)return a(n),void e.surrogate_channel.send("bandwidth-acknowledge");var r=Util.persistentPolicy();return"coach"===r.user_experience_banner&&r.explain&&r.explain.length>0?void e.ui_frame.call("showCoachModeModal",r.explain,e.pairing_dict.customization,r.exit_url?s:null,t(),r.upgrade_action):void s()}function l(r){var o,a=e.pairing_dict.customization,s=Util.persistentPolicy();document.body.insertAdjacentHTML("beforeend",e.template.get(m[r].template)),document.getElementById(m[r].logo_id).src=h,a&&("ro"===r?e.ux.customizeBanner(n(),a,t(),s.upgrade_action,s.exit_url):"bw"===r&&(e.ux.customizeBandwidthBanner(a),e.ux.customizeBandwidthBannerText(a,m.bw.exceed))),p=document.getElementById(m[r].button_id),EventListener.addListener(p,"click",c.curry(r)),m[r].div=document.getElementById(m[r].div_id),o=document.getElementById(m[r].hide_id),EventListener.addListener(o,"click",i.curry(r)),m[r].hidden&&(m[r].div.className+=m[r].hide_class)}function d(t){return m[t].has_banner||document.getElementById(m[t].div_id)?void("bw"===t&&e.ux.customizeBandwidthBannerText(e.pairing_dict.customization,m.bw.exceed)):(Util.ensureElementPresent("head"),Util.ensureElementPresent("body"),document.head.appendChild(r(m[t].css,l.curry(t),t)),void(m[t].has_banner=!0))}function u(){_.isShowingBanner()&&(m.ro.hidden=e.pairing_dict.banner_hidden,g?d("ro"):e.callback.registerOneShot("dom-loaded",0,{on_success:d.curry("ro")})),e.feedback_bar.updateReadonlyUI()}function f(){switch(v.action){case"allow":a("bw");break;case"warn":case"exceed":m.bw.exceed="exceed"===v.action,v.acknowledge?a("bw"):d("bw");break;case"block":a("bw"),e.alert.showBlockPage(null,!0,Util.getRawPageUrl(),"[]","[]",!1,null,!0),e.media_objects.stopAllMedia()}}var p,_=this,g=!1,h=e.url_builder.buildAssetURL("/safeview-static/images/logo.png"),m={ro:{hidden:!1,has_banner:!1,hide_class:" safemail-banner-hidden",div_id:"safemail-readonly-banner",button_id:"safemail-disable-btn",logo_id:"safemail-logo",hide_id:"safemail-hide",div:null,template:"ro-banner-template",css:"/safeview-static/css/readonly.css",css_link:null},bw:{hidden:!1,has_banner:!1,hide_class:" bandwidth-banner-hidden",div_id:"bandwidth-banner",button_id:"bandwidth-disable-btn",logo_id:"bandwidth-logo",hide_id:"bandwidth-hide",div:null,template:"bw-banner-template",css:"/safeview-static/css/bandwidth.css",css_link:null}},v={};_.showBlocked=function(){e.alert.showBlockPage(null,!0,Util.getRawPageUrl(),"[]","[]",!0,n())},_.onEmailPolicy=function(){u(),"block"===Util.persistentPolicy().entry_action&&_.showBlocked()},_.isShowingBanner=function(){var e=Util.persistentPolicy();return __startswith(Util.getRawPageUrl(),"http://doc/")?!1:("read_only"===e.entry_action||"read_write"===e.entry_action)&&"none"!==e.user_experience_banner},_.isShowingReadonlyBanner=function(){var e=Util.persistentPolicy();return __startswith(Util.getRawPageUrl(),"http://doc/")?!1:"read_only"===e.entry_action&&"none"!==e.user_experience_banner},_.allow_tab_creation=function(){return!t()},_.onDomLoaded=function(){g=!0,_.onEmailPolicy()},_.onBandwidthAction=function(t,n){v={action:t,acknowledge:n},g?f():e.callback.registerOneShot("dom-loaded",0,{on_success:f})},_.onDomInit=function(t,n,r,i){v=i,g?f():e.callback.registerOneShot("dom-loaded",0,{on_success:f})},e.callback.register("dom-loaded",_.onDomLoaded),e.callback.register("dom-init",_.onDomInit),e.interp.registerOpcodeHandler("bandwidth_action",_.onBandwidthAction)}function FrameLoader(e){function t(){var t=e.tab_store.load();t.is_pending_doctype_correction=!0,e.tab_store.save(t),e.finish(),location.reload()}function n(e,t){assert(Util.is_frame_node(t)),t.__timeoutId&&(clearTimeout(t.__timeoutId),t.__timeoutId=null)}function r(t,i,o,a,s){var c,l=i.contentWindow;if(void 0===s&&(n(t,i),s=0),s+=1,l&&l.document&&l.document.documentElement&&l.document.documentElement.getAttribute("tc-nonce")===o)return void a();if(void 0===e.perf.max_nr_load_checks)throw new Error("Invalid max_nr_load_checks value.");s>e.perf.max_nr_load_checks?(c=e.update_queue.discard(t),e.callback.fire("tc-frame-load-timed-out",t,s,o,c)):i.__timeoutId=setTimeout(function(){i.__timeoutId=null,r(t,i,o,a,s)},u.FRAME_LOAD_CHECK_INTERVAL_MS)}function i(e,t){assert(Util.is_frame_node(e)),e.__sv_is_ready_for_updates=!!t}function o(e,t,n,r){function o(){assert(e.contentWindow),e.__frame_helper_poller=null,i(e,!1);var o=window.top.location.toString();e.contentWindow.location.replace(window.location.protocol+"//"+window.location.host+u.FRAME_HELPER+"?dt="+encodeURIComponent(Util.b64Encode(t))+"&n="+n+"&furl="+encodeURIComponent(Util.b64Encode(r))+"&turl="+encodeURIComponent(Util.b64Encode(o)))}e.__frame_helper_poller&&e.__frame_helper_poller.stop(),e.__frame_helper_poller=new Poller({max_nr_polls:500,poll_interval_ms:100,cond_func:function(){return!!e.contentWindow},success_cb:o,timeout_cb:function(){reportErrorClientEvent("tc-frame-helper-load-timed-out",{current_src:e.src,readyState:e.readyState})}}),e.__frame_helper_poller.start()}function a(t,n,a){var s=getFrameFidByNode(t),c=(getUidByNode(t),__randstr(8));assert(s),assert(Util.is_frame_node(t)),assert("string"==typeof n),o(t,n,c,a),r(s,t,c,function(){var r=t.contentWindow;assert(r),Util.getDoctypeDecl(r)!==n&&reportWarnClientEvent("tc-doctype-load-mismatch",{expected:n,actual:Util.getDoctypeDecl(r)}),setFidToWindow(r,s),setFidToIframe(t,s),i(t,!0),e.update_queue.deliver(s,e.interpretQueued)})}function s(t,n){var r,i=getIframeByFid(t);return i?void n(i):void(r=e.callback.register("frame-node-inserted",function(){i=getIframeByFid(t),i&&(e.callback.deregister(r),n(i))}))}function c(e,n,r,i,o){var c;o?(c=Util.getDoctypeDecl(window),c!==i&&t()):s(e,function(e){assert(Util.is_frame_node(e)),a(e,i,n)})}function l(t,n){var r=getFrameFidByNode(t);setFidToIframe(t,r),e.alert.checkAndShowBlockPage(r)}function d(t,r){n(t,r),e.update_queue.discard(t)}var u=this;u.FRAME_HELPER="/safeview-redirect/tc_frame.html",u.FRAME_LOAD_CHECK_INTERVAL_MS=100,e.callback.register("tc-frame-load-timed-out",function(e,t,n,r){reportErrorClientEvent("tc-frame-load-timed-out",{fid:e,nr_polls:t,nonce:n,discarded_updates:r?r.slice(0,20):null})}),u.isFrameReadyForUpdates=function(e){var t=getIframeByFid(e);return t&&t.__sv_is_ready_for_updates},e.interp.registerOpcodeHandler("set_doctype",c),e.callback.register("frame-node-inserted",l),e.callback.register("frame-node-removed",d)}function FramesetWrapper(e,t,n){function r(e,t,n){var r,i=getFidByNode(t),o=getUidByNode(t);9===t.nodeType?setNodeInMap(n,e.document,o,i):1!==t.nodeType&&3!==t.nodeType||getUidByNode(t)===h||(r=t.cloneNode(!1),setNodeInMap(n,r,o,i))}function i(e,t){for(var n,r,i,o,a,s,c,l=[e];l.length;)for(r=l.shift(),c=getUidByNode(r),n=0;n<r.childNodes.length;n+=1)i=r.childNodes[n],s=getUidByNode(i),s&&s!==h&&(o=t[s],a=t[c],9===a.nodeType&&a.documentElement&&a.removeChild(a.documentElement),a.appendChild(o)),l.push(i)}function o(e,n){var o,a,s,c={},l=getNodeMapForFrame(t);for(a in l)l.hasOwnProperty(a)&&(s=l[a],r(n,s,c),9===s.nodeType&&(o=s));return i(o,c),c}function a(){var t,r=f.contentWindow;try{t=o(e,r)}catch(i){return reportWarnClientEvent("tc-dom-frameset-error",{error:"Failed to replicate nodes from top frame.",exception:i.toString()}),_="error",void n()}_="ready",setNodeMapForFrame(g,t),setFidToWindow(r,g),n()}function s(){var e,n=p.documentElement;return n?(n.style.setProperty("margin","0","important"),n.style.setProperty("padding","0","important"),n.style.setProperty("height","100%","important"),n.style.setProperty("overflow","hidden","important"),p.body?reportWarnClientEvent("tc-dom-frameset-error",{error:"There should not be a body element in frameset document."}):(e=p.createElement("body"),n.appendChild(e)),e=p.body,e.style.setProperty("margin","0","important"),e.style.setProperty("padding","0","important"),e.style.setProperty("height","100%","important"),e.style.setProperty("overflow","hidden","important"),f=p.createElement("iframe"),f.setAttribute("width","100%"),f.setAttribute("height","100%"),f.setAttribute("frameborder","0"),f.setAttribute("src","about:blank"),f.style.setProperty("position","absolute","important"),f.style.setProperty("left","0px","important"),f.style.setProperty("right","0px","important"),f.style.setProperty("bottom","0px","important"),f.style.setProperty("top","0px","important"),setNodeIds(f,h,t),void e.appendChild(f)):(reportWarnClientEvent("tc-dom-frameset-error",{error:"Missing html node."}),void(_="error"))}function c(){return"pending"===_}function l(e){return isTopFrameFid(e)&&"ready"===_?g:e}function d(e){return e===g?t:e}var u,f,p=e.document,_="pending",g="sv-wrapper-fid",h="sv-wrapper-uid",m=this;m.is_pending=c,m.map_fid_if_necessary=l,m.get_original_fid=d,s(),u=new Poller({max_nr_polls:100,poll_interval_ms:100,cond_func:Util.isIframeReady.curry(f),success_cb:a,timeout_cb:function(){_="error",reportWarnClientEvent("tc-dom-frameset-error",{error:"Frameset wrapper frame failed to load."})}}),u.start()}function UX(e,t){function n(e,n,r){function i(e,n){for(var r,i,o=!1,a=e.length;n.firstChild;)n.removeChild(n.firstChild);for(r=0;a>r;r+=1)i=t.createElement(o?"strong":"span"),i.textContent=e[r],n.appendChild(i),o=!o}var o,a,s;if(o=t.getElementById("ro-ux-"+e),!o)return void reportWarnClientEvent("tc-ux-no-template",{id:"ro-ux-"+e});for(a in n)n.hasOwnProperty(a)&&(s=t.getElementById("ro-ux-"+e+"-"+a),s?n[a].hasOwnProperty("type")?"array"===n[a].type&&n[a].val?s.textContent=n[a].val.join(", "):reportWarnClientEvent("tc-ux-unknown-type",{type:n[a].type}):i(n[a],s):w.info({event:"tc-ux-no-placeholder",id:"ro-ux-"+e+"-"+a}));t.getElementById(r).appendChild(o)}function r(e,t){return function(n,r){var i,o;if(!(r&&t.indexOf(r)<0)){for(o=n.className,i=0;i<t.length;i+=1)o=o.replace(e+t[i],"");o=o.replace(/ {2}/g," "),n.className=o+" "+e+r}}}function i(e,t){e.textContent=t}function o(e){return function(t,n){t.setAttribute(e,n)}}function a(e){return e.replace(/[<>"\/]/gim,"")}function s(e){return e.replace(/[<>"]/gim,"")}function c(e){return __startswith(e,"http://")||__startswith(e,"https://")?encodeURI(e):""}function l(e){return e.match(/^\#[0-9a-fA-F]{3}$/)||e.match(/^\#[0-9a-fA-F]{6}$/)?e:""}function d(e){var t=e.split(";"),n=t[0].split("/");return 2===t.length&&2===n.length&&"data:image"===n[0]&&__startswith(t[1],"base64,")&&["gif","png","jpeg","svg+xml"].indexOf(n[1])>=0?e:""}function u(e){var t,n=e.split("."),r=v;for(t=0;t<n.length;t+=1){if(!r||!r.hasOwnProperty(n[t]))return"";r=r[n[t]]}return r}function f(e,n,r,i){var o=t.getElementById(e),a=u(n);!o||!a&&n||(a=i?i(a):a,r(o,a))}function p(){var e=t.getElementById("UX-INLINE-STYLE-SHEET");return e||(e=t.createElement("style"),e.id="UX-INLINE-STYLE-SHEET",t.head.appendChild(e)),e}function _(e,t,n){var r;r=p(),r.innerHTML+="."+e+" {"+t+": "+n+" !important;}"}function g(e,t,n,r){var i=u(n);i&&_(e,t,i)}function h(e){return e?"read_only_banner.":"read_write_banner."}function m(e,t){return e&&"read_write"===t?h(e)+"exit_action.read_write.":"direct"===t?h(e)+"exit_action.direct.":h(e)+"exit_action.not_allowed."}var v,y=this,w=new Logger("ux",{level:"info"}),b="safemail-readonly-banner",k="safemail-disable-btn",S="safemail-banner-",C="safemail-",E=e.url_builder.buildAssetURL("/safeview-static/images/logo.png"),x={arial:"Arial, Helvetica, sans-serif",georgia:"Georgia, serif",gotham:'Gotham, "Helvetica Neue", Helvetica, Arial, sans-serif',helvetica:'"Helvetica Neue", Helvetica, Arial, sans-serif',lucida:'"Lucida Sans Unicode", "Lucida Grande", sans-serif',tahoma:"Tahoma, Geneva, sans-serif",times:'"Times New Roman", Times, serif',verdana:"Verdana, Geneva, sans-serif"};y.customizeBanner=function(e,s,p,_,y){var w,E=h(p),x=m(p,_),A=e&&e.explain&&e.explain.length>0;if(v=s,f(b,"banner_theme",r(S,["white","yellow","red"]),a),f(b,E+"css.banner_type",r(S,["wide","regular"]),a),g("safemail-background","background",E+"css.background_color",l),f(b,E+"css.font_family",r("safemail-font-",["arial","georgia","gotham","helvetica","lucida","tahoma","times","verdana"]),a),f("safemail-logo",E+"logo_icon.base64_img",o("src"),d),u(E+"logo_icon.link")&&f("safemail-logo-link",E+"logo_icon.url",o("href"),c),g("safemail-link","color",E+"css.link_color",l),f("safemail-main-text",x+"banner_text",i),g("safemail-text","color",E+"css.text_color",l),g("safemail-border","border-color",E+"css.border_color",l),u(E+"custom_link.show_link")&&u(E+"custom_link.link_url").length>7&&(f("safemail-policy","",r("",[C+"hidden"]),a),f("safemail-policy-link",E+"custom_link.link_text",i),f("safemail-policy-link",E+"custom_link.link_url",o("href"),c)),y||A&&"coach"===e.experience_mode?(f(b,E+"css.button_type",r("safemail-",["outline","regular"]),a),y?f(k,x+"button_label",i):t.getElementById(k).textContent="Details",g("safemail-button","color",E+"css.button_text_color",l),g("safemail-button","background-color",E+"css.button_background_color",l),g("safemail-button","border-color",E+"css.button_border_color",l)):t.getElementById(k).style.display="none",A&&"basic"!==e.experience_mode){for(w=0;w<e.explain.length&&3>w;w+=1)n(e.explain[w].factor_name+"-short",e.explain[w].attributes,"safemail-details-"+w);f("safemail-details","",r("",["safemail-hidden"]))}},y.customizeCoachModeModal=function(e,s,p,_,h){var y;if(v=s,e)for(y=0;y<e.length&&3>y;y+=1)n(e[y].factor_name,e[y].attributes,"coach-mode-modal-body");f("coach-mode-modal","warning_modal_theme",r("",["white","yellow","red"]),a),f("coach-mode-modal-text","warning_modal.modal_text",i),g("coach-mode-text","color","warning_modal.css.text_color",l),g("coach-mode-button-1","color","warning_modal.css.button_one_text_color",l),g("coach-mode-button-1","background-color","warning_modal.css.button_one_background_color",l),g("coach-mode-button-1","border-color","warning_modal.css.button_one_border_color",l),f("coach-mode-cancel","warning_modal.css.button_one_type",r("",["outline"]),a),g("coach-mode-button-2","color","warning_modal.css.button_two_text_color",l),g("coach-mode-button-2","background-color","warning_modal.css.button_two_background_color",l),g("coach-mode-button-2","border-color","warning_modal.css.button_two_border_color",l),f("coach-mode-proceed","warning_modal.css.button_two_type",r("",["outline"]),a),u("warning_modal.logo_icon.base64_img")?f("coach-mode-logo","warning_modal.logo_icon.base64_img",o("src"),d):t.getElementById("coach-mode-logo").src=E,u("warning_modal.logo_icon.link")&&f("coach-mode-logo-link","warning_modal.logo_icon.url",o("href"),c),f("coach-mode-modal","warning_modal.css.font_family",r("font-",["arial","georgia","gotham","helvetica","lucida","tahoma","times","verdana"]),a),g("custom-highlight strong","color","warning_modal.css.highlight_color",l),p?(t.getElementById("coach-mode-cancel").setAttribute("class","hide"),t.getElementById("coach-mode-proceed").textContent="OK"):f("coach-mode-proceed",m(_,h)+"button_label",i)},y.customizeFeedbackBar=function(e,t,n,r,c,p,h,m){var y,w,b;v=e,g(t,"background","css.background_color",l),e.css&&e.css.border_color&&(y=l(e.css.border_color)+" 1px solid",_(t,"border-left",y),_(t,"border-right",y),_(t,"border-top",y)),g(t,"color","css.text_color",l),g(t+" > *","color","css.text_color",l),g(t+" > #__safly_feedback_arrow_down.__safly_arrow_down","border-top-color","css.text_color",l),w=u("css.font_family"),w&&(b=x[w],b&&_(t+" > div","font-family",b)),f(p,"logo_icon.base64_img",o("src"),d),f(n,m?"readonly_indicator.text":"readonly_indicator.iframe_text",i,s),f(n,"readonly_indicator.tooltip",o("data-tooltip"),a),f(r,"bypass_indicator.text",i,a),f(r,"bypass_indicator.tooltip",o("data-tooltip"),a),f(c,"feedback_indicator.label",i,a),f(h,"isolate_indicator.tooltip",o("data-tooltip"),a)},y.customizeBandwidthBanner=function(e){var t="bandwidth-banner",n="bandwidth-banner-";v=e,f(t,"bandwidth.theme",r(n,["white","yellow","red"]),a),e.bandwidth&&e.bandwidth.content&&!e.bandwidth.content.use_custom_styling||(f(t,"bandwidth.css.banner_type",r(n,["wide","regular"]),a),g("bandwidth-background","background","bandwidth.css.background_color",l),f(t,"bandwidth.css.font_family",r("bandwidth-font-",["arial","georgia","gotham","helvetica","lucida","tahoma","times","verdana"]),a),f("bandwidth-logo","bandwidth.logo_icon.base64_img",o("src"),d),g("bandwidth-text","color","bandwidth.css.text_color",l),g("bandwidth-border","border-color","bandwidth.css.border_color",l),f("bandwidth-banner","bandwidth.css.button_type",r("bandwidth-",["outline"]),a),g("bandwidth-button","color","bandwidth.css.button_text_color",l),g("bandwidth-button","background-color","bandwidth.css.button_background_color",l),g("bandwidth-button","border-color","bandwidth.css.button_border_color",l))},y.customizeBandwidthBannerText=function(e,t){v=e;var n=t?"bandwidth.bandwidth_limit_alert":"bandwidth.bandwidth_usage_alert";f("bandwidth-main-text",n+".text",i),f("bandwidth-disable-btn",n+".label_acknowledgement_text",i)}}function SheetLoader(e){function t(){var e;for(e in f)if(f.hasOwnProperty(e)&&"done"!==f[e].state)return!1;return!0}function n(e){var t;t={event:"tc-body-restored",reason:e,elapsed_ms:Date.now()-u,sheets:f,HIDE_TIMEOUT_MS:p},l&&(l.parentNode.removeChild(l),l=null),f={},_&&(clearTimeout(_),_=null),g=!0}function r(e){u=Date.now(),l=e.createElement("style"),l.innerHTML="body { visibility: hidden !important; }",e.body.appendChild(l),_=setTimeout(function(){_=null,n("timeout")},p)}function i(e,r){var i,o=getUidByNode(e);g||(i=f[o],i.state="done",i.success=r,i.elapsed_ms=Date.now()-i.start_time,t()&&e.ownerDocument.body&&n("all-sheets-complete"))}function o(e){var t=getUidByNode(e);f[t]={state:"pending",start_time:Date.now()},e.addEventListener("load",function(){i(e,!0)}),e.addEventListener("error",function(){i(e,!1)})}function a(e){var t=e,n=e.ownerDocument;for(assert(n.documentElement);t&&t!==n.documentElement;){if(t===n.head)return!0;t=t.parentNode}return!1}function s(e,t){return"link"===t&&e.rel&&"stylesheet"===e.rel.toLowerCase()&&a(e)}function c(n,i,a,c){var l,u=i.ownerDocument;n===window.top&&("body"===a?(assert(u.body),t()?g=!0:r(u),assert(d),l=e.callback.deregister(d),assert(l),d=null):s(i,a)&&o(i))}var l,d,u,f={},p=3e3,_=null,g=!1;d=e.callback.register("add-element",c),g=!1}function SurrogateView(e){function t(e){var t,n=g?g.document:null;n&&n.body&&(t=n.getElementById("view"),t||(t=n.createElement("img"),t.id="view",n.body.appendChild(t)),t.src=e,t.style.width=MetricsUtils.getVisualViewportMetrics().width+"px",t.style.height=MetricsUtils.getVisualViewportMetrics().height+"px")}function n(){b||(b=!0,e.surrogate_channel.send("get-screenshot",DEBUG?!1:y))}function r(e){try{return!e.document||e.closed}catch(t){return!0}}function i(e){return BrowserDetect.isIE()?void e():void g.requestAnimationFrame(e)}function o(e,t){return BrowserDetect.isIE()?setTimeout(e,t):g?g.setTimeout(e,t):void 0}function a(e,a){return!g||r(g)?void h.stop("tab connection lost?"):b?(b=!1,void i(function(){t((a?"data:image/jpeg;base64,":"data:image/png;base64,")+e),o(function(){n()},w)})):void m.warn({event:"unexpected-frame",action:"drop"})}function s(t){e.surrogate_channel&&e.surrogate_channel.send.apply(e.surrogate_channel,t)}function c(e){var t=["CM-mouse",e.type,e.clientX,e.clientY,e.button,Util.getMouseAndKeyboardModifiers(e,m),e.detail];s(t),("mousedown"===e.type||"mouseup"===e.type)&&e.preventDefault()}function l(t){var n=0,r=v.getKeyCode(t);s(["keyboard",e.fid,n,t.type,t.keyCode,t.charCode,r,t.shiftKey,t.ctrlKey,t.metaKey])}function d(e){var t=Math.round(e.deltaX),n=Math.round(e.deltaY),r=void 0===e.wheelDeltaX?-3*t:e.wheelDeltaX,i=void 0===e.wheelDeltaY?-3*n:e.wheelDeltaY;s(["CM-wheel",e.clientX,e.clientY,t,n,r,i,!0]),e.preventDefault()}function u(){h.stop("child unloaded")}function f(e){var t=e?EventListener.addListener:EventListener.removeListener;g&&(t(g.document,"mousemove",c,!1),t(g.document,"mousedown",c,!1),t(g.document,"mouseup",c,!1),t(g.document,"keydown",l,!1),t(g.document,"keypress",l,!1),t(g.document,"keyup",l,!1),t(g.document,"wheel",d,!1),t(g,"beforeunload",u,!1))}function p(){return g&&!r(g)?g:window.open("","sv_view_"+e.pairing_dict.tab_id)}function _(){var e=g.document;
e.title="Surrogate: "+document.title,e.body.style.margin="0px",e.body.style.padding="0px"}var g,h=this,m=new Logger("surrogate-view",{level:"info"}),v=new KeyMap,y=!0,w=40,b=!1;h.stop=function(t){e.pairing_dict.surrogate_view_active=!1,e.pairing.savePairingState(e.pairing_dict),b=!1,g&&(f(!1),r(g)||g.close(),g=null)},h.start=function(t){if(e.pairing_dict.surrogate_view_active=!0,e.pairing.savePairingState(e.pairing_dict),g=p(),!g)return m.error({event:"surrogate-view-start-failed",reason:"cannot get window handle, popup denied?"}),g;try{_()}catch(r){return void m.error({event:"surrogate-view-start-failed",reason:"init child failed, security violation?"})}f(!0),e.surrogate_channel.send("disable-hiding"),n()},e.callback.register("got-screenshot",a),e.callback.register("surrogate-channel-connected",function(){e.pairing_dict.surrogate_view_active&&(b=!1,h.start("resume after navigation"))})}function PrintHandler(e){function t(t,n){var r,i,o=document.createElement("form");o.method="POST",o.action=t,o.target=p,Util.forEachItem(n,function(e,t){i=document.createElement("input"),i.type="hidden",i.name=e,i.value=t,o.appendChild(i)}),document.body.appendChild(o),r=window.open("",p),r&&r.document.write("<p>"+e.localization.get("ID_PRINT_PREVIEW_STATUS")+"</p>"),o.submit(),document.body.removeChild(o)}function n(e){var t=e||window.event;return a.isPrintEnabled()&&80===t.keyCode&&t.ctrlKey?(t.keyCode=0,!1):void 0}function r(){var t;a.isPrintEnabled()&&(t=BrowserDetect.isMac()||BrowserDetect.isIOS()?e.localization.get("ID_PRINT_ALERT_MAC_TEXT"):e.localization.get("ID_PRINT_ALERT_TEXT"),a.isPrintPending()||e.ui_frame.call("showPrintAlert",t,e.localization.get("ID_PRINT_ALERT_TITLE")))}function i(){a.isPrintEnabled()&&(a.isPrintPending()||BrowserDetect.isIE()||BrowserDetect.isEdge()||(e.ui_frame.call("dismissPrintAlert"),window.focus(),document.body.focus()))}function o(){window.onbeforeprint=r,window.onafterprint=i}var a=this,s=!!document.attachEvent,c=!1,l=BrowserDetect.isEdge(),d=!1,u=!1,f=!1,p="print_pdf",_=80,g=112;a.setPrintPending=function(e){d=e},a.isPrintPending=function(){return d},a.isPrintEnabled=function(){return u},a.setPrintEnabled=function(e){u=e},a.handlePrint=function(n){var r,i="/r/print",o={cid:e.pairing_dict.cid,rid:e.pairing_dict.rid,tab_id:e.pairing_dict.tab_id};r=i+"?"+Util.buildQueryStr(o),r=e.url_builder.buildProtocolUrl(r),n.safe_rid=e.pairing_dict.safe_rid,n.tab_id=e.pairing_dict.tab_id,l?(t(r,n),a.setPrintPending(!1)):setTimeout(function(){e.ui_frame.call("showPrintPreview",r,n)},0)},a.handlePrintKeyEventIfNeeded=function(t,n){return a.isPrintEnabled()?"keydown"===t.type&&"print"===n?a.isPrintPending()?(t.preventDefault(),!0):(a.setPrintPending(!0),BrowserDetect.isIE11()&&(window.alert(e.localization.get("ID_PRINT_SHORTCUT_KEY_ALERT")),f=!0),e.ui_frame.call("showPrintOptions"),c?!0:(t.preventDefault(),t.stopImmediatePropagation?t.stopImmediatePropagation():t.stopPropagation(),!0)):!f||"keypress"!==t.type||t.keyCode!==g&&t.keyCode!==_?!1:(t.preventDefault(),f=!1,!0):!1},a.attachKeyEventHandler=function(e){s&&(e?c=document.attachEvent("onkeydown",n):c&&document.detachEvent("onkeydown",n))},o()}function FullscreenVideo(e){function t(t){var n=getFidByNode(t.target),r=getUidByNode(t.target);return s?void(s=!1):(t.target.webkitDisplayingFullscreen||(e.surrogate_channel.send("client-media",n,JSON.stringify([r,{type:"pause"}])),r=-1,a=setTimeout(function(){o=!1,a=null},2e3)),void e.surrogate_channel.send("fullscreen",n,t.target.webkitDisplayingFullscreen,r))}function n(t){var n=r.fid,i=r.uid,a=getNodeByUid(n,i);return a?(t?(a.webkitEnterFullscreen(),o=!0):e.surrogate_channel.send("fullscreen",n,!1,i),void(r=null)):void reportClientEvent("tc-fullscreen-no-node-error",{frame_id:n,node_id:i},!0)}var r,i=this,o=!1,a=null,s=!1;i.onSurrogateFullScreenChange=function(t,n,i){var c;if(a&&(clearTimeout(a),a=null),n){if(c=getNodeByUid(t,i),!c||"VIDEO"!==c.nodeName){if(!e.useRemotingV2())return;if(c=e.compositor.getActiveVideoNode(),!c)return;t=getFidByNode(c),i=getUidByNode(c),s=!0}if(!c.webkitSupportsFullscreen)return void e.surrogate_channel.send("fullscreen",t,!1,i);if(c.webkitDisplayingFullscreen)return;r||e.ui_frame.call("showFullscreenModal",t,i),r={fid:t,uid:i}}else o=!1},i.allowFullscreen=function(){n(!0)},i.blockFullscreen=function(){n(!1)},i.isFullscreen=function(){return o},i.installListeners=function(e){EventListener.addListener(e,"webkitbeginfullscreen",t,!1),EventListener.addListener(e,"webkitendfullscreen",t,!1)}}function FullscreenCustom(e){function t(t){return e.useRemotingV2()?document:getWindowByFid(t).document}function n(n){var r=e.useRemotingV2()?getTopFrameFid():getFidByNode(n.target),o=t(r),a=o[e.xbrowser.fullscreenElement];if(e.useRemotingV2()){if(a)return;i&&(window.scrollTo(i.x,i.y),i=null)}e.surrogate_channel.send("fullscreen",r,null!==a,a?getUidByNode(a):-1)}var r,i,o=this,a=[];o.onSurrogateFullScreenChange=function(n,i,o){var s=getNodeByUid(n,o),c=t(n);if(i)if(e.xbrowser.fullscreenchange){if(s&&c[e.xbrowser.fullscreenElement]===s)return;a.length>1&&a[1].fid===n&&a[1].uid===o?(a.shift(),e.xbrowser.exitFullscreen.call(c)):(r||e.ui_frame.call("showFullscreenModal",n,o),r={fid:n,uid:o})}else e.surrogate_channel.send("fullscreen",n,!1,-1);else e.xbrowser.exitFullscreen&&c[e.xbrowser.fullscreenElement]&&e.xbrowser.exitFullscreen.call(c),a=[]},o.allowFullscreen=function(){var t;return(t=e.useRemotingV2()?document.body:getNodeByUid(r.fid,r.uid))?(e.useRemotingV2()&&(window.scrollX>0||window.scrollY>0)&&(i={x:window.scrollX,y:window.scrollY}),e.xbrowser.requestFullscreen(t),a.unshift({fid:r.fid,uid:r.uid}),void(r=null)):void reportClientEvent("tc-fullscreen-no-node-error",{frame_id:r.fid,node_id:r.uid},!0)},o.blockFullscreen=function(){var t=getNodeByUid(r.fid,r.uid),n=getWindowByFid(r.fid).document,i=n[e.xbrowser.fullscreenElement];return t||e.useRemotingV2()?(e.surrogate_channel.send("fullscreen",r.fid,!1,i?getUidByNode(i):-1),void(r=null)):void reportClientEvent("tc-fullscreen-no-node-error",{frame_id:r.fid,node_id:r.uid},!0)},e.xbrowser.fullscreenchange&&EventListener.addListener(document,e.xbrowser.fullscreenchange,n,!1)}function Fullscreen(e){function t(){var e=document.createElement("video");return o=void 0!==e.webkitEnterFullscreen,e=null,o}function n(){r=!e.xbrowser.fullscreenchange&&t()?new FullscreenVideo(e):new FullscreenCustom(e),e.interp.registerOpcodeHandler(e.interp.OPCODES.FULLSCREEN_CHANGE,r.onSurrogateFullScreenChange)}var r,i=this,o=!1;i.allowFullscreen=function(){r.allowFullscreen()},i.blockFullscreen=function(){r.blockFullscreen()},i.isFullscreen=function(){return o?r.isFullscreen():void 0},i.installListeners=function(e){o&&r.installListeners(e)},n()}function MetricsObserver(e){function t(t){e.surrogate_channel&&e.surrogate_channel.send.apply(e.surrogate_channel,t)}function n(){var e,t=window.devicePixelRatio||1,n=Util.getPortraitScreenSize();_&&_.removeListener(g.onMediaQueryStateChanged),e="screen and (resolution: "+t+"dppx) and (min-device-width: "+n.width+"px) and (max-device-width: "+n.width+"px) and (min-device-height: "+n.height+"px) and (max-device-height: "+n.height+"px)",_=window.matchMedia(e),_.addListener(g.onMediaQueryStateChanged)}function r(e,t){return e.screen_orientation_type!==t.screen_orientation_type||e.screen_orientation_angle!==t.screen_orientation_angle}function i(e,t){return e.view_size.height>t.view_size.height}function o(t,n){return e.fullscreen.isFullscreen()&&i(t,n)&&!r(t,n)?!1:!0}function a(r){var i=p,a=MetricsUtils.getAllMetrics();r=r||"query-change",p&&JSON.stringify(a)===JSON.stringify(p)||o(p,a)&&(p=a,n(),t(["set-render-params",p]),e.callback.fire("metrics-changed",p,i))}function s(){a("orientation-change")}function c(){a("layout-viewport-change")}function l(){a("window-resize")}function d(){a("visual-viewport-change")}function u(){setInterval(function(){a("poll")},3e3),window.matchMedia&&n()}function f(){EventListener.addListener(window,"orientationchange",s,!1),EventListener.addListener(window,"resize",l,!1),window.visualViewport?(window.visualViewport.onresize=d,window.visualViewport.onscroll=d):BrowserDetect.isMobileSafari()&&EventListener.addListener(window,"scroll",d,!1),e.callback.register("layout-viewport-props-changed",c),p=MetricsUtils.getAllMetrics(),u()}var p,_,g=this;g.onMediaQueryStateChanged=function(){a("media-query")},g.checkForMetricsChange=a,f()}function onLatencyChange(e){var t,n,r="sv-pointer-progress",i="sv-pointer-wait",o=document.getElementById(r),a=document.getElementById(i),s=document.head||document.getElementsByTagName("head")[0];if(assert(e>=0&&2>=e),0===e)return o&&o.parentNode&&o.parentNode.removeChild(o),void(a&&a.parentNode&&a.parentNode.removeChild(a));if(1===e){if(a&&a.parentNode&&a.parentNode.removeChild(a),o)return}else if(o&&o.parentNode&&o.parentNode.removeChild(o),a)return;n="* {cursor:"+(1===e?"progress":"wait")+"} ",n+="input {cursor: progress}",t=document.createElement("style"),t.id=1===e?r:i,t.type="text/css",t.styleSheet?t.styleSheet.cssText=n:t.appendChild(document.createTextNode(n)),s.appendChild(t)}function startSurrogateChannelLoop(){var e=1,t=safeview.pairing_dict;return safeview.openChannel("surrogate",{use_websockets:safeview.perf.use_websockets&&("Explorer"!==browser.name||11===browser.version&&safeview.perf.use_websockets_on_ie11),service_prefix:"/r",query_params:{cid:t.cid,rid:t.rid,tab_id:t.tab_id||e},on_connect:function(e){safeview.callback.fire("surrogate-channel-connected")},on_disconnect:function(e){"client-close"!==e&&"client-detach"!==e&&safeview.reload("ping-404"===e?0:3e3)},on_recv:function(e){var t,n,r,i,o,a,s,c,l;if(i=new DataView(e,0,4).getUint32(0,!0))for(r=new DataView(e,4,i),l=4+i,o=0;i/5>o;o+=1){if(c=r.getUint32(5*o,!0),s=r.getUint8(5*o+4),t=new Uint8Array(e,l,c),s===MSG_KIND_DATA||s===MSG_KIND_CONTROL){if(window.TextDecoder)t=JSON.parse(new TextDecoder("utf-8").decode(t));else{for(n="",a=0;a<t.length;a+=1)n+=String.fromCharCode(t[a]);t=JSON.parse(decodeURIComponent(window.escape(n)))}assert(t instanceof Array&&t.length>=1,"Malformed command "+t)}if(l+=c,!safeview.interpret(s,t))break}},on_report:function(e,t){reportClientEvent(e,t)},url_builder:safeview.url_builder.buildProtocolUrl,ajax:safeview.serverCall,on_latency_change:safeview.onLatencyChange})}function setupImeImpl(e){e!==use_old_ime&&(e?(safeview.ime_helper=new ImeHelper(safeview),safeview.local_input=safeview.ime_helper):safeview.local_input=new LocalInput(safeview),use_old_ime=e)}function checkPairingResult(e){return e.error?("tab_limit"===e.error?safeview.ui_frame.call("showTabLimit"):"show_error_page"===e.error?safeview.ui_frame.call("showErrorPage",e.title,e.message,e.details):"access_denied_redirect"===e.error?window.location=e.redirect_url:safeview.showError(e.error,e.description),!1):e.block?(safeview.readonly.showBlocked(),!1):(safeview.http_alert.configHttpAlert(e),safeview.lecho_error_alert.config_alert(e),safeview.preload_indicator.configPreloadIndicator(e),e&&e.client_caps&&(safeview.perf=e.client_caps.perf,setupImeImpl(e.client_caps.use_old_ime),e.client_caps.local_echo&&(local_echo_enabled=e.client_caps.local_echo.enabled,local_echo_config=e.client_caps.local_echo)),!0)}function insertDomLoadedElement(e,t){var n,r=mf.document.body;assert("top"===safeview.role||"main"===safeview.role),r&&(n=mf.document.createElement("input"),n.type="hidden",n.value=JSON.stringify(e),n.id="__safely_dom_loaded",r.appendChild(n))}function CommFrameChannel(e){var t=this;t.send=function(){e.postToCommFrame({kind:"send",args:argumentsToArray(arguments)})},t.reattach=function(){e.postToCommFrame({kind:"reattach"})},t.close=function(t){e.postToCommFrame({kind:"close",reason:t})}}function FrameUpdateQueue(){var e=this,t={};e.queue=function(e,n){t[e]||(t[e]=[]),t[e].push(n)},e.deliver=function(e,n){var r;t[e]&&(r=t[e],delete t[e],n(r))},e.discard=function(e){var n=t[e];return n&&delete t[e],n},e.count=function(e){return t[e]?t[e].length:0},e.change_top_frame_fid=function(e){t[e]=t[-1],delete t[-1]}}function TopFrame(){function e(e){l.fid=e,__init_id_state(e)}function t(e,t,n){l.ctx_menu_mode||(l.ctx_menu_mode={}),l.ctx_menu_mode.backend_driven=t,l.ctx_menu_mode.native_menu_for_input=n}function n(){safeview.context_menu.display.apply(safeview.context_menu,arguments)}function r(e){l.allow_backend_dragdrop=!0}function i(e,t,n,r,i){var o,a=Util.getDoctypeDecl(window);return assert(i),l.fid=e,a===r?void l.postToCommFrame({kind:"tf_ready",doctype:Util.getDoctypeDecl(window)}):(o=safeview.tab_store.load(),o.is_pending_doctype_correction=!0,safeview.tab_store.save(o),void location.reload())}function o(){l.sc_delegate=new ServerCallDelegate(l),l.serverCall=l.sc_delegate.call,l.stats=new XFrameStats(l),l.interp=new Interpreter(l),l.xbrowser=new XBrowserHelpers,l.alert=new AlertSupport(l),l.cof=new CrossOriginFrame(l,l.url_builder.buildInspectURL("/safeview-template/cof_frame.html?v="+BUILD_ID)),l.cof.call(["setDebugFlag",window.DEBUG]),l.tab_store=new TabStorage,l.history=new HistorySupport(l),l.download=new DownloadSupport(l),l.ui_frame=new UIFrame(l),l.context_menu=new ContextMenu(l),l.media_objects=new MediaObjects(l),l.media_source_extensions=new MediaSourceExtensions(l),l.plugin=new PluginSupport(l),l.canvas=new CanvasSupport(l),l.selection=new Selection(l),l.tab=new TabSupport(l),l.voodoo=new BrowserVoodoo(l),l.readonly=new ReadonlySupport(l),l.http_alert=new HttpAlertSupport(l),l.preload_indicator=new PreloadIndicator(l),l.print_handler=new PrintHandler(l),l.local_events=new LocalEvents(l),l.local_input=new LocalInput(l),l.lecho_regulator=new LEchoRegulator(l),l.lecho_error_alert=new LEchoErrorAlert(l),l.text_monitor=new TextMonitor(l),l.dom_updater=new DOMUpdater(l),l.sheet_loader=new SheetLoader(l),l.exit_handler=new ExitHandler(l),l.fullscreen=new Fullscreen(l),l.interp.registerOpcodeHandler("set_doctype",i),l.interp.registerOpcodeHandler("set_top_fid",e),l.interp.registerOpcodeHandler("set_ctxmenu_mode",t),l.interp.registerOpcodeHandler("display_contextmenu",n),l.interp.registerOpcodeHandler("backend_dragdrop",r),l.callback.register("dom-loaded",function(e){l.ui_frame.load(),insertDomLoadedElement(e,d)}),l.callback.register("surrogate-channel-connected",function(){l.local_events.resize_event(null,null),l.local_events.install_event_listeners(mf.window,mf.document),l.surrogate_channel.send("rttpong",0,0,0)})}function a(){l.active_tab=new ActiveTab(l),l.policy=new PolicySupport(l),l.feedback_bar=new FeedbackBar(l,window,!0)}function s(e){var t,n,r=e.data;if(e.origin!==l.url_builder.getServiceDomain())return void reportErrorClientEvent("tc-commframe-invalid-domain",{expected:l.url_builder.getServiceDomain(),actual:e.origin,message:r.kind,frame:"top"});switch(r.kind){case"cf_ready":l.comm_frame=e.source,o(),t=new Pairing(l).loadPairingState(),n={kind:"start_pairing",tab_id:Util.getOrSetTabID(),url:Util.getRawPageUrl(),hid:l.history.getHID(),doctype:Util.getDoctypeDecl(window),tproxy_enabled:window.TPROXY_ENABLED,persisted_state:t,localization_data:l.localization.get_localization_data(),framing_status:Util.getFramingStatus()},window.performance&&window.performance.timing&&(n.nav_start_time=window.performance.timing.navigationStart),l.postToCommFrame(n);break;case"command":l.stats.start("time_tc_interpret_processing"),r.command_kind===MSG_KIND_CANVAS?l.interp.processOneCommand(r.command_kind,new DataView(r.command)):l.interp.processOneCommand(r.command_kind,r.command),l.stats.stop("time_tc_interpret_processing");break;case"pairing_dict":if(l.pairing_dict=r.pairing_dict,!checkPairingResult(l.pairing_dict))break;l.postToCommFrame({kind:"start_surrogate_channel_loop"}),new Pairing(l).savePairingState(l.pairing_dict),a();break;case"server_call_resp":l.sc_delegate.on_sc_result(e.source,e.origin,r);break;case"cb_reg":case"cb_dereg":case"cb_fired":l.callback.on_cb_msg(r);break;case"reload":r.reset_tab_store&&l.tab_store.clear(),location.reload(!0);break;case"show_msg_bar":Util.show_message_bar(r.text);break;case"show_embedded_error":Util.showEmbeddedError(r.title,r.body,r.extra,l.template);break;case"latency_changed":onLatencyChange(r.latency_level);break;default:l.cof.onReceiveMessage(e)}}function c(){var e;d.info({event:"tc-started",build_id:BUILD_ID}),e=document.createElement("iframe"),e.id="safeview-communication",e.name="comm",e.width=0,e.height=0,e.style.display="none",e.tabindex=-1,e.src=l.url_builder.buildServiceURL("/safeview-template/comm_frame.html/"+window.location.href),document.documentElement.appendChild(e)}var l=this,d=new Logger("main",{level:"info"});l.useRemotingV2=function(){return!1},l.init=function(){Util.parseConfig(),l.url_builder=new URLBuilder(l),mf={window:window,document:window.document},window.mf=mf,l.fid="-1",__init_id_state(l.fid),l.role="top",l.callback=new XFrameCallbackSupport(l),l.surrogate_channel=new CommFrameChannel(l),l.template=new Template(l),l.localization=new Localization(l),EventListener.addListener(window,"message",s,!1),EventListener.addListener(window,"load",c,!1)},l.postToCommFrame=function(e){assert(l.comm_frame),e.fid=l.fid,l.comm_frame.postMessage(JSON.stringify(e),l.url_builder.getServiceDomain())}}function SubFrame(){function e(e,t,n,r,o){var a,s=Util.getDoctypeDecl(window);return assert(!o),assert(e===i.fid),s===r&&window.location.origin===(window.TPROXY_ENABLED?n:i.url_builder.getServiceDomain())?void i.postToCommFrame({kind:"sf_ready",doctype:Util.getDoctypeDecl(window)}):(a=Util.compute_iframe_src(n,e,r),void window.location.replace(a))}function t(){i.sc_delegate=new ServerCallDelegate(i),i.serverCall=i.sc_delegate.call,i.template=new Template(i),i.stats=new XFrameStats(i),i.interp=new Interpreter(i),i.xbrowser=new XBrowserHelpers(i),i.url_builder=new URLBuilder(i),i.media_objects=new MediaObjects(i),i.media_source_extensions=new MediaSourceExtensions(i),i.plugin=new PluginSupport(i),i.canvas=new CanvasSupport(i),i.selection=new Selection(i),i.tab=new TabSupport(i),i.voodoo=new BrowserVoodoo(i),i.policy=new PolicySupport(i),i.print_handler=new PrintHandler(i),i.local_events=new LocalEvents(i),i.local_input=new LocalInput(i),i.lecho_regulator=new LEchoRegulator(i),i.lecho_error_alert=new LEchoErrorAlert(i),i.text_monitor=new TextMonitor(i),i.dom_updater=new DOMUpdater(i),i.fullscreen=new Fullscreen(i),i.interp.registerOpcodeHandler("set_doctype",e)}function n(e){var t=e.data;if(e.origin!==i.url_builder.getServiceDomain())return void reportErrorClientEvent("tc-commframe-invalid-domain",{expected:i.url_builder.getServiceDomain(),actual:e.origin,message:t.kind,sub_frame_fid:i.fid});switch(t.kind){case"command":t.command_kind===MSG_KIND_CANVAS?i.interp.processOneCommand(t.command_kind,new DataView(t.command)):i.interp.processOneCommand(t.command_kind,t.command);break;case"pairing_dict":i.pairing_dict=t.pairing_dict;break;case"server_call_resp":i.sc_delegate.on_sc_result(e.source,e.origin,t);break;default:assert(0)}}function r(){t(),i.comm_frame=window.top.frames.comm,i.postToCommFrame({kind:"sf_ready",fid:i.fid,doctype:Util.getDoctypeDecl(window)})}var i=this;i.useRemotingV2=function(){return!1},i.init=function(){Util.parseConfig(),i.role="sub",i.callback=new CallbackSupport(i),i.surrogate_channel=new CommFrameChannel(i),mf={window:window,document:window.document},window.mf=mf,i.fid=Util.getParam("fid"),__init_id_state(i.fid),window.TPROXY_ENABLED=1===parseInt(Util.getParam("tpe"),10),EventListener.addListener(window,"message",n,!1),EventListener.addListener(window,"load",r,!1)},i.postToCommFrame=function(e){assert(i.comm_frame),e.fid=i.fid,i.comm_frame.postMessage(JSON.stringify(e),i.url_builder.getServiceDomain())}}function CommFrame(){function e(e){var t,n=m[e];assert(n),n.match=!1,window.TPROXY_ENABLED?(t=n.origin_backend||n.origin_pairing,t&&t===n.origin&&(n.match=!0)):n.origin===window.location.origin&&(n.match=!0),n.doctype_backend&&n.doctype_backend!==n.doctype&&(n.match=!1),n.match&&e!==g.top_frame_fid&&g.postToFrame(e,{kind:"pairing_dict",pairing_dict:g.pairing_dict})}function t(t,n,r,i){var o;m[t]||(m[t]={}),o=m[t],o.origin_backend=n,o.doctype_backend=r,o.is_top_frame=i,e(t)}function n(t,n,r,i){var o;m[t]||(m[t]={}),o=m[t],o.frame=n,o.doctype=i,o.origin=r,e(t)}function r(e,t){delete e.match,delete e.doctype,delete e.origin,delete e.frame}function i(){g.server_call=new ServerCall(g),g.serverCall=g.server_call.call,g.sc_dispatcher=new ServerCallDispatcher(g),g.template=new Template(g),g.stats=new Stats(g),g.event_reporter=new ClientEventReporter(g),g.interp=new Interpreter(g),g.xbrowser=new XBrowserHelpers(g),g.url_builder=new URLBuilder(g),g.media_objects=new MediaObjects(g),g.media_source_extensions=new MediaSourceExtensions(g),g.selection=new Selection(g),g.tab=new TabSupport(g),g.update_queue=new FrameUpdateQueue,g.exit_handler=new ExitHandler(g),g.callback.register("frame-node-removed",function(e){delete m[e]})}function o(e,t,n,r){var i=new ParsedURL(n),o=i.origin;return r?t===o&&e===parent:t===window.location.origin&&e===parent}function a(e){function n(e){g.update_queue.change_top_frame_fid(e),m[-1]&&(m[e]=m[-1])}var r,i,o,a,s=e[0];switch(s){case"set_top_fid":r=e[1],g.top_frame_fid!==r&&(g.top_frame_fid=r,n(r)),t(r,void 0,void 0,!0);break;case"set_doctype":r=e[1],a=e[3],o=e[4],i=e[5],i&&g.top_frame_fid!==r&&(g.top_frame_fid=r,n(r)),t(r,a,o,i)}}function s(e,t){var n,i,o,a=g.top_frame_fid,s={kind:"command",command:t,command_kind:e},c=!1;switch(e===MSG_KIND_DATA||e===MSG_KIND_CONTROL?o=t[0]:e===MSG_KIND_CANVAS&&(n=new window.DataView(t.buffer,t.byteOffset,8),a=n.getUint32(0,!1),s.command=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)),("fupd"===o||"set_doctype"===o||"set_top_fid"===o)&&(a=t[1]),i=m[a],assert(i),o){case"set_top_fid":g.postToTopFrame(s),c=!0;break;case"set_doctype":i.frame&&(g.postToFrame(a,s,!0),t[5]||r(i,a),c=!0);break;case"fupd":i.match&&(g.postToFrame(a,s),c=!0);break;default:e===MSG_KIND_CANVAS?i.match&&(g.postToFrame(a,s,!1,[s.command]),c=!0):(g.postToTopFrame(s),c=!0)}return c||g.update_queue.queue(a,[e,t]),c}function c(e){var t=m[e];assert(t),g.update_queue.count(e)&&g.update_queue.deliver(e,function(e){var t;for(t=0;t<e.length;t+=1)s(e[t][0],e[t][1])})}function l(e){g.postToTopFrame({kind:"show_msg_bar",text:e})}function d(e){g.postToTopFrame({kind:"reload",reset_tab_store:e})}function u(e,t,n){g.postToTopFrame({kind:"show_embedded_error",title:e,body:t,extra:n})}function f(e,t){var n,r,i;switch(n=t.fid,t.kind){case"start_pairing":if(!o(e.source,e.origin,t.url,t.tproxy_enabled))return reportErrorClientEvent("tc-pairing-invalid-url",{top_frame_domain:e.origin,requested_url:t.url}),!1;break;case"send":case"server_call":case"client_report_msg":if(r=m[n],i=window.TPROXY_ENABLED?r.origin_backend||r.origin_pairing:g.url_builder.getServiceDomain(),!i||i!==e.origin)return reportErrorClientEvent("tc-domframe-invalid-domain",{expected:i,actual:e.origin}),!1}return!0}function p(e){var t,r,i,o;if(t=JSON.parse(e.data),f(e,t))switch(r=t.fid,m[r]||(m[r]={origin:e.origin,frame:e.source}),i=m[r],t.kind){case"start_pairing":window.TPROXY_ENABLED=t.tproxy_enabled,g.tab_store=new TabStorageBackedByLocalStorage(t.tab_id),g.localization=new Localization(g,t.localization_data),i.origin_pairing=e.origin,i.origin=e.origin,i.doctype=t.doctype,t.nav_start_time&&g.stats.setNavStartTime(t.nav_start_time),o=new Pairing(g),o.initPairingState(t.persisted_state),o.withSurrogateDo({on_complete:function(e){g.pairing_dict=e,g.postToTopFrame({kind:"pairing_dict",pairing_dict:g.pairing_dict})}},t.doctype,t.framing_status,t.url,t.hid||null);break;case"start_surrogate_channel_loop":g.surrogate_channel=startSurrogateChannelLoop();break;case"send":g.surrogate_channel.send.apply(this,t.args);break;case"close":g.surrogate_channel.close(t.reason);break;case"reattach":g.surrogate_channel.close(),g.surrogate_channel=startSurrogateChannelLoop();break;case"sf_ready":case"tf_ready":n(r,e.source,e.origin,t.doctype),c(r);break;case"server_call":g.sc_dispatcher.dispatch(r,t);break;case"cb_reg":case"cb_dereg":case"cb_fired":g.callback.on_cb_msg(t);break;case"client_report_msg":reportClientEvent(t.event,t.extrainfo,t.warn,t.always);break;case"stats":g.stats.on_xframe_stats_msg(t);break;default:assert(0,"Unknown message: "+t.kind)}}function _(){var e;for(e in v)v.hasOwnProperty(e)&&g.closeChannel(e)}var g=this,h=new Logger("main",{level:"info"}),m={},v={};g.useRemotingV2=function(){return!1},window.onload=function(){h.info("Comm frame for "+BUILD_ID+"."),EventListener.addListener(window,"message",p,!1),i(),parent.postMessage({kind:"cf_ready"},"*")},g.openChannel=function(e,t){var n=new Channel(e,t);return v[e]=n,n},g.closeChannel=function(e){var t=v[e];t.close(),delete v[e]},g.fatalError=function(e,t){h.error(t),DEBUG&&(_(),g.ui_frame.call("showCrashModal")),reportClientEvent(e,t)},g.finish=function(){_()},g.init=function(){Util.parseConfig(),g.role="comm",g.top_frame_fid="-1",g.callback=new XFrameCallbackSupport(g)},g.interpret=function(e,t){return e===MSG_KIND_CONTROL&&a(t),s(e,t),!0},g.reset=function(e){g.event_reporter.flush(),d(!0)},g.reload=function(e){var t;return reportClientEvent("tc-reload-started",{countdown_ms:e}),e?(t=new Countdown(e,l,function(){d(!1)},h),void t.restart()):void d(!1)},g.showError=function(e,t,n){reportErrorClientEvent("show-error-page",{title:e,body:t,extra:n}),g.event_reporter.flush(),u(e,t,n)},g.onLatencyChange=function(e){g.postToTopFrame({kind:"latency_changed",latency_level:e})},g.postToFrame=function(e,t,n,r){var i,o=m[e];return(i=n?o.origin:o.origin_backend||o.origin_pairing)?(window.TPROXY_ENABLED||(i=g.url_builder.getServiceDomain()),void o.frame.postMessage(t,i,r)):void reportErrorClientEvent("tc-domframe-domain-check",{fid:e})},g.postToTopFrame=function(e){g.postToFrame(g.top_frame_fid,e)}}function Safeview(e){function t(){A.callback=new CallbackSupport(A),A.callback.register("dom-loaded",function(e){A.ui_frame.load(),insertDomLoadedElement(e,T)}),A.callback.register("surrogate-channel-connected",function(){A.local_events.resize_event(null,null),A.surrogate_channel.send("rttpong",0,0,0)}),A.callback.register("dom-init",function(e,t){t||safeview.local_events.install_event_listeners(mf.window,mf.document)})}function n(e){A.fid=e,__init_id_state(e),A.update_queue.deliver(e,A.interpretQueued)}function r(e,t,n){A.ctx_menu_mode||(A.ctx_menu_mode={}),A.ctx_menu_mode.backend_driven=t,A.ctx_menu_mode.native_menu_for_input=n}function i(){safeview.context_menu.display.apply(safeview.context_menu,arguments)}function o(e){A.allow_backend_dragdrop=!0}function a(e){var t,n,r,i,o,a=!1;if(!local_echo_enabled)return void reportErrorClientEvent("tc-lecho-error-flag-mismatch",{detail:"The precheck failure message should not be sent from the backend because the lecho mode is not enabled."});for(t=0;t<e.length;t+=1)r=e[t][0],n=e[t][1],i=e[t][2],o=getNodeByUid(r,n),o?Util.can_element_use_lecho(o)&&A.lecho_regulator.input_elem_is_managed(r,n)&&o.value!==i&&(o.value=i,a=!0):reportErrorClientEvent("tc-lecho-error-missing-element",{detail:"The precheck failure message contains an input field that does not exist."});a?A.lecho_regulator.show_modal_alert():reportErrorClientEvent("tc-lecho-error-false-positive",{detail:"Precheck failed but thin-client does not detect any inconsistency."})}function s(e){switch(assert(void 0!==e),e){case U.kValueDeviceWidth:return"device-width";default:return e}}function c(){window.clearInterval(x),x=null}function l(e){var t=Date.now(),n=1e3;x=window.setInterval(function(){A.callback.fire("layout-viewport-props-changed",e),Date.now()-t>n&&c()},50)}function d(e,t){}function u(){A.server_call=new ServerCall(A),A.serverCall=A.server_call.call,A.template=new Template(A),A.stats=new Stats(A),window.performance&&window.performance.timing&&A.stats.setNavStartTime(window.performance.timing.navigationStart),A.event_reporter=new ClientEventReporter(A),A.interp=new Interpreter(A),A.xbrowser=new XBrowserHelpers(A),A.alert=new AlertSupport(A),A.url_builder=new URLBuilder(A),A.tab_store=new TabStorage,A.pairing=new Pairing(A),A.pairing_dict=A.pairing.loadPairingState(),A.cof=new CrossOriginFrame(A,A.url_builder.buildInspectURL("/safeview-template/cof_frame.html?v="+BUILD_ID)),A.cof.call(["setDebugFlag",window.DEBUG]),e.enable_active_tab&&(A.active_tab=new ActiveTab(A)),A.history=new HistorySupport(A),A.download=new DownloadSupport(A),A.upload=new UploadSupport(A),A.ui_frame=new UIFrame(A),A.context_menu=new ContextMenu(A),A.feedback_bar=new FeedbackBar(A,window,!0),A.media_objects=new MediaObjects(A),A.media_source_extensions=new MediaSourceExtensions(A),A.plugin=new PluginSupport(A),A.canvas=new CanvasSupport(A),A.selection=new Selection(A),A.tab=new TabSupport(A),A.voodoo=new BrowserVoodoo(A),A.policy=new PolicySupport(A),A.readonly=new ReadonlySupport(A),A.http_alert=new HttpAlertSupport(A),A.preload_indicator=new PreloadIndicator(A),A.print_handler=new PrintHandler(A),A.local_events=new LocalEvents(A),A.local_input=new LocalInput(A),A.lecho_regulator=new LEchoRegulator(A),A.lecho_error_alert=new LEchoErrorAlert(A),A.text_monitor=new TextMonitor(A),A.frame_loader=new FrameLoader(A),A.dom_updater=new DOMUpdater(A),A.ux=new UX(A,document),A.update_queue=new FrameUpdateQueue,A.sheet_loader=new SheetLoader(A),A.localization=new Localization(A),A.surrogate_view=new SurrogateView(A),A.exit_handler=new ExitHandler(A),A.fullscreen=new Fullscreen(A),A.perf=CLIENT_PERF,A.metrics_observer=new MetricsObserver(A),A.interp.registerOpcodeHandler("set_top_fid",n),A.interp.registerOpcodeHandler("set_ctxmenu_mode",r),A.interp.registerOpcodeHandler("precheck-failure",a),A.interp.registerOpcodeHandler("display_contextmenu",i),A.interp.registerOpcodeHandler("backend_dragdrop",o),A.interp.registerOpcodeHandler("rttping",function(e,t,n){safeview.rtt_timestamp=e,safeview.surrogate_channel.send("rttpong",e,t,n)}),A.interp.registerOpcodeHandler("lvpc",d),EventListener.addListener(window,"message",A.cof.onReceiveMessage,!1)}function f(e){var t,n={};if(checkPairingResult(e)){if(A.pairing_dict=e,window.TPROXY_ENABLED&&window.top!==window.self&&0===window.innerWidth&&0===window.innerHeight&&-1!==e.client_caps.framebust_domains.indexOf(window.location.hostname)){if(!e.client_caps.framebust_new_window)return void(window.top.location=window.location.href);window.open(window.location.href)}A.surrogate_channel=startSurrogateChannelLoop(),"http://__about_~_blank__"===Util.getRawPageUrl()&&safeview.surrogate_channel.send("get-persistent-policy"),(A.pairing_dict.client_caps||{}).check_cookie_consistency&&(n.through=!0,n.redirect_list=A.pairing_dict.rc_rlist,t=safeview.url_builder.getDomain("inspect"),t&&n.redirect_list&&-1===n.redirect_list.indexOf(t)&&(n.redirect_list+=","+t),n.login_url=A.pairing_dict.rc_url,n.transparent_mode=window.TPROXY_ENABLED,n.url=window.location.href,A.pairing.doCheckRequest(n))}}function p(e,t,n,r,i){var o=i?{e:i}:{},a={error_msg:e,url:t,line:n,column:r,stacktrace:printStackTrace(o),exception:i?i.toString():null};A.fatalError("tc-uncaught-exception",a)}function _(){var e;for(e in R)R.hasOwnProperty(e)&&A.closeChannel(e)}function g(e){safeview.surrogate_channel&&safeview.surrogate_channel.send.apply(safeview.surrogate_channel,e)}function h(e){var t=__randstr(16);g(["req-ack",t]),A.interp.registerOpcodeHandler("ack",function(n){n===t&&(A.interp.deregisterOpcodeHandler("ack"),e(t))})}function m(e){g(["srm",e==="2".charCodeAt(0)]),h(function(){location.reload()})}function v(e){if(e.ctrlKey&&e.altKey&&e.shiftKey&&"keydown"===e.type)switch(e.keyCode){case"1".charCodeAt(0):m(e.keyCode);break;case"2".charCodeAt(0):m(e.keyCode);break;case"S".charCodeAt(0):A.surrogate_view.start("keyboard shortcut")}}function y(e){var t={renderer:"",vendor:""},n=e.getExtension("WEBGL_debug_renderer_info");return n&&(t.renderer=e.getParameter(n.UNMASKED_RENDERER_WEBGL),t.vendor=e.getParameter(n.UNMASKED_VENDOR_WEBGL)),t}function w(e){return{glVersion:e.getParameter(e.VERSION),shadingLanguageVersion:e.getParameter(e.SHADING_LANGUAGE_VERSION),vendor:e.getParameter(e.VENDOR),renderer:e.getParameter(e.RENDERER),
card:y(e),antialias:e.getContextAttributes().antialias?"Available":"Not available",redBits:e.getParameter(e.RED_BITS),greenBits:e.getParameter(e.GREEN_BITS),blueBits:e.getParameter(e.BLUE_BITS),alphaBits:e.getParameter(e.ALPHA_BITS),depthBits:e.getParameter(e.DEPTH_BITS),stencilBits:e.getParameter(e.STENCIL_BITS),maxRenderBufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxCombinedTextureImageUnits:e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxCubeMapTextureSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxFragmentUniformVectors:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxVaryingVectors:e.getParameter(e.MAX_VARYING_VECTORS),maxVertexAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexUniformVectors:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),extensions:e.getSupportedExtensions()}}function b(e){var t,n;try{if(t=document.createElement("canvas"),t.width=1,t.height=1,document.body.appendChild(t),n=t.getContext(e,{stencil:!0}))return w(n)}catch(r){return null}finally{t&&t.parentNode&&t.parentNode.removeChild(t)}return null}function k(){for(var e,t,n=0,r=400*Math.pow(2,20),i=[];r>n&&(e=document.createElement("canvas"))&&(e.width=e.height=1024,t=e.getContext("2d"));)t.clearRect(0,0,1024,1024),i.push(e),n+=e.width*e.height*4;return i.forEach(function(e){e.width=e.height=0}),n}function S(){var e,t,n=["webgl","experimental-webgl","webgl2","experimental-webgl2"],r={};for(e=0;e<n.length;e+=1)r[n[e]]=Util.splunkify(b(n[e]));r.wasm="object"==typeof window.WebAssembly,navigator&&(r.nr_cores=navigator.hardwareConcurrency,r.device_memory_gb=navigator.deviceMemory,navigator.javaEnabled&&(r.java_enabled=navigator.javaEnabled()),r.do_not_track=navigator.doNotTrack,r.max_touch_points=navigator.maxTouchPoints,t=navigator.connection||navigator.mozConnection||navigator.webkitConnection,t&&(r.connection=Util.splunkify({downlink:t.downlink,effective_type:t.effectiveType,rtt:t.rtt,save_data:t.saveData})));try{r.avail_canvas_memory=k()}catch(i){}return r}function C(){A.cof.call(["getFeatureReport"],function(e){var t;e||(t=S(),reportClientEvent("tc-feature-report",t,!1),A.cof.call(["setFeatureReport",JSON.stringify(t)]))})}function E(){var n;e.parseConfig(),n=e.getContentWindow(),mf={window:n,document:n.document},window.mf=mf,t(),u(),EventListener.addListener(window,"keydown",v,!1),A.callback.register("dom-init",function(e){try{C()}catch(t){T.error({event:"tc-report-features-error",e:t})}return(L=e)?A.compositor?void T.info({event:"tc-r2-already-initialized"}):window.Compositor?void(A.compositor=new window.Compositor.LayerTreeHost(A)):void assert(0):void 0})}var x,A=this,T=new Logger("main",{level:"info"}),R={},D=function(){return window},L=!1,P={},U=Object.freeze({kValueDeviceWidth:-1});e=$.extend({parseConfig:Util.parseConfig,getContentWindow:D,enable_active_tab:!0},e||{}),A.role="main",A.setLayoutViewport=function(e){var t,n=[];assert("object"==typeof e),P&&JSON.stringify(P)===JSON.stringify(e)||(t=document.getElementById("svm"),t||(t=document.createElement("meta"),document.head.appendChild(t),t.id="svm"),t.setAttribute("name","viewport"),void 0!==e.width&&n.push("width="+s(e.width)),void 0!==e.initial_scale&&n.push("initial-scale="+e.initial_scale),void 0!==e.user_zoom&&n.push("user-scalable="+(e.user_zoom?1:0)),void 0!==e.minimum_scale&&n.push("minimum-scale="+e.minimum_scale),void 0!==e.maximum_scale&&n.push("maximum-scale="+e.maximum_scale),t.setAttribute("content",n.join(",")),P=e,x&&c(),l(e))},A.getLayoutViewport=function(){return Util.copyDict(P)},A.start=function(e){T.info({event:"tc-started",build_id:BUILD_ID}),e?f(e):A.pairing.withSurrogateDo({on_complete:f},Util.getDoctypeDecl(window),Util.getFramingStatus())},A.setPairing=function(e){A.pairing=e},window.onerror=function(e,t,n,r,i){function o(e){return e?e.toString():null}if("ResizeObserver loop limit exceeded"!==e)try{p(e,t,n,r,i)}catch(a){try{reportErrorClientEvent("double-fault",{error_msg:e,"first-exception":o(i),"second-exception":o(a)})}catch(s){window.triple_fault={error_msg:e,"first-exception":o(i),"second-exception":o(a),"third-exception":o(s)}}}},A.openChannel=function(e,t){var n=new Channel(e,t);return R[e]=n,n},A.closeChannel=function(e){var t=R[e];t.close(),delete R[e]},A.fatalError=function(e,t){DEBUG&&(_(),A.ui_frame.call("showCrashModal")),reportErrorClientEvent(e,t)},A.finish=function(){_(),A.local_events.uninstall_event_listeners(mf.window,mf.document),window.onerror=null},A.interpret=function(e,t){var n,r;if(!(e!==MSG_KIND_DATA&&e!==MSG_KIND_CONTROL||"fupd"!==t[0]&&"add_shadow_root"!==t[0])){if(n=t[1],A.frameset_wrapper&&isTopFrameFid(n)&&A.frameset_wrapper.is_pending()&&!L)return A.update_queue.queue(n,[e,t]),!0;if(A.dom_updater.has_pending_shadow_root(n))return A.update_queue.queue(n,[e,t]),!0;if(getWindowByFid(n)!==mf.window&&!safeview.frame_loader.isFrameReadyForUpdates(n)&&!L)return A.update_queue.queue(n,[e,t]),!0}return A.stats.start("time_tc_interpret_processing"),r=A.interp.processOneCommand(e,t),A.stats.stop("time_tc_interpret_processing"),r},A.interpretQueued=function(e){var t;for(t=0;t<e.length&&A.interpret(e[t][0],e[t][1]);t+=1);},A.reset=function(e){try{reportWarnClientEvent("tc-reset",{reason:e}),A.event_reporter&&A.event_reporter.flush(),A.tab_store&&A.tab_store.clear()}catch(t){}location.reload(!0)},A.reload=function(e){var t,n=!0;return reportClientEvent("tc-reload-started",{countdown_ms:e}),safeview.finish(),e?(t=new Countdown(e,Util.show_message_bar,function(){location.reload(n)},T),void t.restart()):void location.reload(n)},A.onLatencyChange=onLatencyChange,A.useRemotingV2=function(){return L},A.getLastMousePos=function(){return L?A.compositor.getLastMousePos():A.local_events.get_last_mouse_pos()},A.sendCommand=function(e){safeview.surrogate_channel&&safeview.surrogate_channel.send.apply(safeview.surrogate_channel,e)},A.isMobile=function(){return BrowserDetect.isMobile()},E()}function start(){var e,t,n=document.documentElement.getAttribute("sv_role"),r=Util.getParam("sv_itok");r&&(t=document.location.search.replace("sv_itok="+r,""),"?"===t&&(t=""),e=document.location.protocol+"//"+document.location.hostname+document.location.pathname+t+document.location.hash,window.history.state&&window.history.state.url&&(window.history.state.url=e),window.history.replaceState(window.history.state,"",e));try{window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""))}catch(i){}switch(n){case"main":safeview=new Safeview,safeview.itok=r,tc_kernel||(window.onload=function(){safeview.start()});break;case"cof-server":Util.parseConfig(),safeview=new CrossOriginFrameServer,safeview.init();break;case"top":safeview=new TopFrame,safeview.init();break;case"comm":Util.parseConfig(),safeview=new CommFrame,safeview.init();break;case"sub":safeview=new SubFrame,safeview.init();break;default:assert(0)}}var load_time=(new Date).getTime();!function(){var e,t=function(){},n=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],r=n.length,i=window.console=window.console||{};for(window.native_console={};r--;)e=n[r],window.native_console[e]=i[e],i[e]||(i[e]=t)}();var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(e){for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,n){if(-1!=n.indexOf(e[t].subString))return e[t].identity}else if(r)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Edge",identity:"Edge"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.userAgent,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer",versionSearch:"rv"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:navigator.userAgent,subString:"iPad",identity:"iOS"},{string:navigator.userAgent,subString:"iPod",identity:"iOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],isIE:function(){return"Explorer"===this.browser},isIE10:function(){return this.isIE()&&10===this.version},isIE11:function(){return this.isIE()&&11===this.version},isChrome:function(){return"Chrome"===this.browser},isAndroid:function(){return"Android"===this.OS},isAndroidChrome:function(){return this.isChrome()&&this.isAndroid()},isEdge:function(){return"Edge"===this.browser},isFirefox:function(){return"Firefox"===this.browser},isSafari:function(){return"Safari"===this.browser},isMobileSafari:function(){return this.isSafari()&&this.isIOS()},isMac:function(){return"Mac"===this.OS},isIOS:function(){return"iOS"===this.OS},isWindows:function(){return"Windows"===this.OS},getVersion:function(){return this.version},isMobile:function(){return this.isAndroid()||this.isIOS()},isDesktop:function(){return!this.isMobile()},supportsTouchEvents:function(){return void 0!==document.ontouchstart},supportsPassiveEventListeners:function(){if(void 0!==BrowserDetect.passive_option_supported)return BrowserDetect.passive_option_supported;BrowserDetect.passive_option_supported=!1;try{var e=Object.defineProperty({},"passive",{get:function(){BrowserDetect.passive_option_supported=!0}});window.addEventListener("fake",null,e)}catch(t){}return BrowserDetect.passive_option_supported}};BrowserDetect.init();var JSON;JSON||(JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,o,a,s=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,n=0;o>n;n+=1)a[n]=str(n,c)||"null";return i=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+s+"]":"["+a.join(",")+"]",gap=s,i}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)"string"==typeof rep[n]&&(r=rep[n],i=str(r,c),i&&a.push(quote(r)+(gap?": ":":")+i));else for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(i=str(r,c),i&&a.push(quote(r)+(gap?": ":":")+i));return i=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+s+"}":"{"+a.join(",")+"}",gap=s,i}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),void 0!==r?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.printStackTrace=t()}(this,function(){function e(t){t=t||{guess:!1};var n=t.e||null,r=!!t.guess,i=t.mode||null,o=new e.implementation,a=o.run(n,i);return r?o.guessAnonymousFunctions(a):a}return e.implementation=function(){},e.implementation.prototype={run:function(e,t){return e=e||this.createException(),t=t||this.mode(e),"other"===t?this.other(arguments.callee):this[t](e)},createException:function(){try{this.undef()}catch(e){return e}},mode:function(e){return"undefined"!=typeof window&&window.navigator.userAgent.indexOf("PhantomJS")>-1?"phantomjs":e.arguments&&e.stack?"chrome":e.stack&&e.sourceURL?"safari":e.stack&&e.number?"ie":e.stack&&e.fileName?"firefox":e.message&&e["opera#sourceloc"]?e.stacktrace?e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?"opera9":"opera10a":"opera9":e.message&&e.stack&&e.stacktrace?e.stacktrace.indexOf("called from line")<0?"opera10b":"opera11":e.stack&&!e.fileName?"chrome":"other"},instrumentFunction:function(t,n,r){t=t||window;var i=t[n];t[n]=function(){return r.call(this,e().slice(4)),t[n]._instrumented.apply(this,arguments)},t[n]._instrumented=i},deinstrumentFunction:function(e,t){e[t].constructor===Function&&e[t]._instrumented&&e[t]._instrumented.constructor===Function&&(e[t]=e[t]._instrumented)},chrome:function(e){return(e.stack+"\n").replace(/^[\s\S]+?\s+at\s+/," at ").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}() ($1)$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)").replace(/^(.+) \((.+)\)$/gm,"$1@$2").split("\n").slice(0,-1)},safari:function(e){return e.stack.replace(/\[native code\]\n/m,"").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},ie:function(e){return e.stack.replace(/^\s*at\s+(.*)$/gm,"$1").replace(/^Anonymous function\s+/gm,"{anonymous}() ").replace(/^(.+)\s+\((.+)\)$/gm,"$1@$2").split("\n").slice(1)},firefox:function(e){return e.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@").split("\n")},opera11:function(e){for(var t="{anonymous}",n=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,r=e.stacktrace.split("\n"),i=[],o=0,a=r.length;a>o;o+=2){var s=n.exec(r[o]);if(s){var c=s[4]+":"+s[1]+":"+s[2],l=s[3]||"global code";l=l.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,t),i.push(l+"@"+c+" -- "+r[o+1].replace(/^\s+/,""))}}return i},opera10b:function(e){for(var t=/^(.*)@(.+):(\d+)$/,n=e.stacktrace.split("\n"),r=[],i=0,o=n.length;o>i;i++){var a=t.exec(n[i]);if(a){var s=a[1]?a[1]+"()":"global code";r.push(s+"@"+a[2]+":"+a[3])}}return r},opera10a:function(e){for(var t="{anonymous}",n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=e.stacktrace.split("\n"),i=[],o=0,a=r.length;a>o;o+=2){var s=n.exec(r[o]);if(s){var c=s[3]||t;i.push(c+"()@"+s[2]+":"+s[1]+" -- "+r[o+1].replace(/^\s+/,""))}}return i},opera9:function(e){for(var t="{anonymous}",n=/Line (\d+).*script (?:in )?(\S+)/i,r=e.message.split("\n"),i=[],o=2,a=r.length;a>o;o+=2){var s=n.exec(r[o]);s&&i.push(t+"()@"+s[2]+":"+s[1]+" -- "+r[o+1].replace(/^\s+/,""))}return i},phantomjs:function(e){for(var t="{anonymous}",n=/(\S+) \((\S+)\)/i,r=e.stack.split("\n"),i=[],o=1,a=r.length;a>o;o++){r[o]=r[o].replace(/^\s+at\s+/gm,"");var s=n.exec(r[o]);s?i.push(s[1]+"()@"+s[2]):i.push(t+"()@"+r[o])}return i},other:function(e){for(var t,n,r="{anonymous}",i=/function(?:\s+([\w$]+))?\s*\(/,o=[],a=10,s=Array.prototype.slice;e&&o.length<a;){t=i.test(e.toString())?RegExp.$1||r:r;try{n=s.call(e.arguments||[])}catch(c){n=["Cannot access arguments: "+c]}o[o.length]=t+"("+this.stringifyArguments(n)+")";try{e=e.caller}catch(c){o[o.length]="Cannot access caller: "+c;break}}return o},stringifyArguments:function(e){for(var t=[],n=Array.prototype.slice,r=0;r<e.length;++r){var i=e[r];void 0===i?t[r]="undefined":null===i?t[r]="null":i.constructor&&(i.constructor===Array?i.length<3?t[r]="["+this.stringifyArguments(i)+"]":t[r]="["+this.stringifyArguments(n.call(i,0,1))+"..."+this.stringifyArguments(n.call(i,-1))+"]":i.constructor===Object?t[r]="#object":i.constructor===Function?t[r]="#function":i.constructor===String?t[r]='"'+i+'"':i.constructor===Number?t[r]=i:t[r]="?")}return t.join(",")},sourceCache:{},ajax:function(e){var t=this.createXMLHTTPObject();if(t)try{return t.open("GET",e,!1),t.send(null),t.responseText}catch(n){}return""},createXMLHTTPObject:function(){for(var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],n=0;n<t.length;n++)try{return e=t[n](),this.createXMLHTTPObject=t[n],e}catch(r){}},isSameDomain:function(e){return"undefined"!=typeof location&&-1!==e.indexOf(location.hostname)},getSource:function(e){return e in this.sourceCache||(this.sourceCache[e]=this.ajax(e).split("\n")),this.sourceCache[e]},guessAnonymousFunctions:function(e){for(var t=0;t<e.length;++t){var n=/\{anonymous\}\(.*\)@(.*)/,r=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,i=e[t],o=n.exec(i);if(o){var a=r.exec(o[1]);if(a){var s=a[1],c=a[2],l=a[3]||0;if(s&&this.isSameDomain(s)&&c){var d=this.guessAnonymousFunction(s,c,l);e[t]=i.replace("{anonymous}",d)}}}}return e},guessAnonymousFunction:function(e,t,n){var r;try{r=this.findFunctionName(this.getSource(e),t)}catch(i){r="getSource failed with url: "+e+", exception: "+i.toString()}return r},findFunctionName:function(e,t){for(var n,r,i,o=/function\s+([^(]*?)\s*\(([^)]*)\)/,a=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,s=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,c="",l=Math.min(t,20),d=0;l>d;++d)if(n=e[t-d-1],i=n.indexOf("//"),i>=0&&(n=n.substr(0,i)),n){if(c=n+c,r=a.exec(c),r&&r[1])return r[1];if(r=o.exec(c),r&&r[1])return r[1];if(r=s.exec(c),r&&r[1])return r[1]}return"(?)"}},e});var DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0;diff_match_patch.Diff,diff_match_patch.prototype.diff_main=function(e,t,n,r){"undefined"==typeof r&&(r=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var i=r;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[[DIFF_EQUAL,e]]:[];"undefined"==typeof n&&(n=!0);var o=n,a=this.diff_commonPrefix(e,t),s=e.substring(0,a);e=e.substring(a),t=t.substring(a),a=this.diff_commonSuffix(e,t);var c=e.substring(e.length-a);e=e.substring(0,e.length-a),t=t.substring(0,t.length-a);var l=this.diff_compute_(e,t,o,i);return s&&l.unshift([DIFF_EQUAL,s]),c&&l.push([DIFF_EQUAL,c]),this.diff_cleanupMerge(l),l},diff_match_patch.prototype.diff_compute_=function(e,t,n,r){var i;if(!e)return[[DIFF_INSERT,t]];if(!t)return[[DIFF_DELETE,e]];var o=e.length>t.length?e:t,a=e.length>t.length?t:e,s=o.indexOf(a);if(-1!=s)return i=[[DIFF_INSERT,o.substring(0,s)],[DIFF_EQUAL,a],[DIFF_INSERT,o.substring(s+a.length)]],e.length>t.length&&(i[0][0]=i[2][0]=DIFF_DELETE),i;if(1==a.length)return[[DIFF_DELETE,e],[DIFF_INSERT,t]];var c=this.diff_halfMatch_(e,t);if(c){var l=c[0],d=c[1],u=c[2],f=c[3],p=c[4],_=this.diff_main(l,u,n,r),g=this.diff_main(d,f,n,r);return _.concat([[DIFF_EQUAL,p]],g)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,r):this.diff_bisect_(e,t,r)},diff_match_patch.prototype.diff_lineMode_=function(e,t,n){var r=this.diff_linesToChars_(e,t);e=r.chars1,t=r.chars2;var i=r.lineArray,o=this.diff_main(e,t,!1,n);this.diff_charsToLines_(o,i),this.diff_cleanupSemantic(o),o.push([DIFF_EQUAL,""]);for(var a=0,s=0,c=0,l="",d="";a<o.length;){switch(o[a][0]){case DIFF_INSERT:c++,d+=o[a][1];break;case DIFF_DELETE:s++,l+=o[a][1];break;case DIFF_EQUAL:if(s>=1&&c>=1){o.splice(a-s-c,s+c),a=a-s-c;for(var r=this.diff_main(l,d,!1,n),u=r.length-1;u>=0;u--)o.splice(a,0,r[u]);a+=r.length}c=0,s=0,l="",d=""}a++}return o.pop(),o},diff_match_patch.prototype.diff_bisect_=function(e,t,n){for(var r=e.length,i=t.length,o=Math.ceil((r+i)/2),a=o,s=2*o,c=new Array(s),l=new Array(s),d=0;s>d;d++)c[d]=-1,l[d]=-1;c[a+1]=0,l[a+1]=0;for(var u=r-i,f=u%2!=0,p=0,_=0,g=0,h=0,m=0;o>m&&!((new Date).getTime()>n);m++){for(var v=-m+p;m-_>=v;v+=2){var y,w=a+v;y=v==-m||v!=m&&c[w-1]<c[w+1]?c[w+1]:c[w-1]+1;for(var b=y-v;r>y&&i>b&&e.charAt(y)==t.charAt(b);)y++,b++;if(c[w]=y,y>r)_+=2;else if(b>i)p+=2;else if(f){var k=a+u-v;if(k>=0&&s>k&&-1!=l[k]){var S=r-l[k];if(y>=S)return this.diff_bisectSplit_(e,t,y,b,n)}}}for(var C=-m+g;m-h>=C;C+=2){var S,k=a+C;S=C==-m||C!=m&&l[k-1]<l[k+1]?l[k+1]:l[k-1]+1;for(var E=S-C;r>S&&i>E&&e.charAt(r-S-1)==t.charAt(i-E-1);)S++,E++;if(l[k]=S,S>r)h+=2;else if(E>i)g+=2;else if(!f){var w=a+u-C;if(w>=0&&s>w&&-1!=c[w]){var y=c[w],b=a+y-w;if(S=r-S,y>=S)return this.diff_bisectSplit_(e,t,y,b,n)}}}}return[[DIFF_DELETE,e],[DIFF_INSERT,t]]},diff_match_patch.prototype.diff_bisectSplit_=function(e,t,n,r,i){var o=e.substring(0,n),a=t.substring(0,r),s=e.substring(n),c=t.substring(r),l=this.diff_main(o,a,!1,i),d=this.diff_main(s,c,!1,i);return l.concat(d)},diff_match_patch.prototype.diff_linesToChars_=function(e,t){function n(e){for(var t="",n=0,o=-1,a=r.length;o<e.length-1;){o=e.indexOf("\n",n),-1==o&&(o=e.length-1);var s=e.substring(n,o+1);n=o+1,(i.hasOwnProperty?i.hasOwnProperty(s):void 0!==i[s])?t+=String.fromCharCode(i[s]):(t+=String.fromCharCode(a),i[s]=a,r[a++]=s)}return t}var r=[],i={};r[0]="";var o=n(e),a=n(t);return{chars1:o,chars2:a,lineArray:r}},diff_match_patch.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var r=e[n][1],i=[],o=0;o<r.length;o++)i[o]=t[r.charCodeAt(o)];e[n][1]=i.join("")}},diff_match_patch.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,o=0;i>n;)e.substring(o,i)==t.substring(o,i)?(n=i,o=n):r=i,i=Math.floor((r-n)/2+n);return i},diff_match_patch.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,o=0;i>n;)e.substring(e.length-i,e.length-o)==t.substring(t.length-i,t.length-o)?(n=i,o=n):r=i,i=Math.floor((r-n)/2+n);return i},diff_match_patch.prototype.diff_commonOverlap_=function(e,t){var n=e.length,r=t.length;if(0==n||0==r)return 0;n>r?e=e.substring(n-r):r>n&&(t=t.substring(0,n));var i=Math.min(n,r);if(e==t)return i;for(var o=0,a=1;;){var s=e.substring(i-a),c=t.indexOf(s);if(-1==c)return o;a+=c,(0==c||e.substring(i-a)==t.substring(0,a))&&(o=a,a++)}},diff_match_patch.prototype.diff_halfMatch_=function(e,t){function n(e,t,n){for(var r,i,o,s,c=e.substring(n,n+Math.floor(e.length/4)),l=-1,d="";-1!=(l=t.indexOf(c,l+1));){var u=a.diff_commonPrefix(e.substring(n),t.substring(l)),f=a.diff_commonSuffix(e.substring(0,n),t.substring(0,l));d.length<f+u&&(d=t.substring(l-f,l)+t.substring(l,l+u),r=e.substring(0,n-f),i=e.substring(n+u),o=t.substring(0,l-f),s=t.substring(l+u))}return 2*d.length>=e.length?[r,i,o,s,d]:null}if(this.Diff_Timeout<=0)return null;var r=e.length>t.length?e:t,i=e.length>t.length?t:e;if(r.length<4||2*i.length<r.length)return null;var o,a=this,s=n(r,i,Math.ceil(r.length/4)),c=n(r,i,Math.ceil(r.length/2));if(!s&&!c)return null;o=c?s&&s[4].length>c[4].length?s:c:s;var l,d,u,f;e.length>t.length?(l=o[0],d=o[1],u=o[2],f=o[3]):(u=o[0],f=o[1],l=o[2],d=o[3]);var p=o[4];return[l,d,u,f,p]},diff_match_patch.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],r=0,i=null,o=0,a=0,s=0,c=0,l=0;o<e.length;)e[o][0]==DIFF_EQUAL?(n[r++]=o,a=c,s=l,c=0,l=0,i=e[o][1]):(e[o][0]==DIFF_INSERT?c+=e[o][1].length:l+=e[o][1].length,i&&i.length<=Math.max(a,s)&&i.length<=Math.max(c,l)&&(e.splice(n[r-1],0,[DIFF_DELETE,i]),e[n[r-1]+1][0]=DIFF_INSERT,r--,r--,o=r>0?n[r-1]:-1,a=0,s=0,c=0,l=0,i=null,t=!0)),o++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),o=1;o<e.length;){if(e[o-1][0]==DIFF_DELETE&&e[o][0]==DIFF_INSERT){var d=e[o-1][1],u=e[o][1],f=this.diff_commonOverlap_(d,u),p=this.diff_commonOverlap_(u,d);f>=p?(f>=d.length/2||f>=u.length/2)&&(e.splice(o,0,[DIFF_EQUAL,u.substring(0,f)]),e[o-1][1]=d.substring(0,d.length-f),e[o+1][1]=u.substring(f),o++):(p>=d.length/2||p>=u.length/2)&&(e.splice(o,0,[DIFF_EQUAL,d.substring(0,p)]),e[o-1][0]=DIFF_INSERT,e[o-1][1]=u.substring(0,u.length-p),e[o+1][0]=DIFF_DELETE,e[o+1][1]=d.substring(p),o++),o++}o++}},diff_match_patch.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),r=t.charAt(0),i=n.match(diff_match_patch.nonAlphaNumericRegex_),o=r.match(diff_match_patch.nonAlphaNumericRegex_),a=i&&n.match(diff_match_patch.whitespaceRegex_),s=o&&r.match(diff_match_patch.whitespaceRegex_),c=a&&n.match(diff_match_patch.linebreakRegex_),l=s&&r.match(diff_match_patch.linebreakRegex_),d=c&&e.match(diff_match_patch.blanklineEndRegex_),u=l&&t.match(diff_match_patch.blanklineStartRegex_);return d||u?5:c||l?4:i&&!a&&s?3:a||s?2:i||o?1:0}for(var n=1;n<e.length-1;){if(e[n-1][0]==DIFF_EQUAL&&e[n+1][0]==DIFF_EQUAL){var r=e[n-1][1],i=e[n][1],o=e[n+1][1],a=this.diff_commonSuffix(r,i);if(a){var s=i.substring(i.length-a);r=r.substring(0,r.length-a),i=s+i.substring(0,i.length-a),o=s+o}for(var c=r,l=i,d=o,u=t(r,i)+t(i,o);i.charAt(0)===o.charAt(0);){r+=i.charAt(0),i=i.substring(1)+o.charAt(0),o=o.substring(1);var f=t(r,i)+t(i,o);f>=u&&(u=f,c=r,l=i,d=o)}e[n-1][1]!=c&&(c?e[n-1][1]=c:(e.splice(n-1,1),n--),e[n][1]=l,d?e[n+1][1]=d:(e.splice(n+1,1),n--))}n++}},diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,diff_match_patch.whitespaceRegex_=/\s/,diff_match_patch.linebreakRegex_=/[\r\n]/,diff_match_patch.blanklineEndRegex_=/\n\r?\n$/,diff_match_patch.blanklineStartRegex_=/^\r?\n\r?\n/,diff_match_patch.prototype.diff_cleanupMerge=function(e){e.push([DIFF_EQUAL,""]);for(var t,n=0,r=0,i=0,o="",a="";n<e.length;)switch(e[n][0]){case DIFF_INSERT:i++,a+=e[n][1],n++;break;case DIFF_DELETE:r++,o+=e[n][1],n++;break;case DIFF_EQUAL:r+i>1?(0!==r&&0!==i&&(t=this.diff_commonPrefix(a,o),0!==t&&(n-r-i>0&&e[n-r-i-1][0]==DIFF_EQUAL?e[n-r-i-1][1]+=a.substring(0,t):(e.splice(0,0,[DIFF_EQUAL,a.substring(0,t)]),n++),a=a.substring(t),o=o.substring(t)),t=this.diff_commonSuffix(a,o),0!==t&&(e[n][1]=a.substring(a.length-t)+e[n][1],a=a.substring(0,a.length-t),o=o.substring(0,o.length-t))),0===r?e.splice(n-i,r+i,[DIFF_INSERT,a]):0===i?e.splice(n-r,r+i,[DIFF_DELETE,o]):e.splice(n-r-i,r+i,[DIFF_DELETE,o],[DIFF_INSERT,a]),n=n-r-i+(r?1:0)+(i?1:0)+1):0!==n&&e[n-1][0]==DIFF_EQUAL?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,i=0,r=0,o="",a=""}""===e[e.length-1][1]&&e.pop();var s=!1;for(n=1;n<e.length-1;)e[n-1][0]==DIFF_EQUAL&&e[n+1][0]==DIFF_EQUAL&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),s=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),s=!0)),n++;s&&this.diff_cleanupMerge(e)},this.diff_match_patch=diff_match_patch,this.DIFF_DELETE=DIFF_DELETE,this.DIFF_INSERT=DIFF_INSERT,this.DIFF_EQUAL=DIFF_EQUAL;var VncHelper={};Array.prototype.push8=function(e){this.push(255&e)},Array.prototype.push16=function(e){this.push(e>>8&255,255&e)},Array.prototype.push32=function(e){this.push(e>>24&255,e>>16&255,e>>8&255,255&e)},Array.prototype.map||(Array.prototype.map=function(e){var t=this.length;if("function"!=typeof e)throw new TypeError;for(var n=new Array(t),r=arguments[1],i=0;t>i;i++)i in this&&(n[i]=e.call(r,this[i],i,this));return n}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=t);t>n;n++)if(n in this&&this[n]===e)return n;return-1}),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),VncHelper._log_level="warn",VncHelper.init_logging=function(e){switch("undefined"==typeof e?e=VncHelper._log_level:VncHelper._log_level=e,"undefined"==typeof window.console&&("undefined"!=typeof window.opera?window.console={log:window.opera.postError,warn:window.opera.postError,error:window.opera.postError}:window.console={log:function(e){},warn:function(e){},error:function(e){}}),VncHelper.Debug=VncHelper.Info=VncHelper.Warn=VncHelper.Error=function(e){},e){case"debug":VncHelper.Debug=function(e){console.log(e)};case"info":VncHelper.Info=function(e){console.log(e)};case"warn":VncHelper.Warn=function(e){console.warn(e)};case"error":VncHelper.Error=function(e){console.error(e)};case"none":break;default:throw"invalid logging type '"+e+"'"}},VncHelper.get_logging=function(){return VncHelper._log_level},VncHelper.init_logging(),VncHelper.conf_default=function(e,t,n,r,i,o,a,s){var c,l;c=function(t){return o in{arr:1,array:1}&&"undefined"!=typeof t?e[r][t]:e[r]},l=function(t,n){o in{"boolean":1,bool:1}?t=!t||t in{0:1,no:1,"false":1}?!1:!0:o in{integer:1,"int":1}?t=parseInt(t,10):"str"===o?t=String(t):"func"===o&&(t||(t=function(){})),"undefined"!=typeof n?e[r][n]=t:e[r]=t},t[r+"_description"]=s,"undefined"==typeof t["get_"+r]&&(t["get_"+r]=c),"undefined"==typeof t["set_"+r]&&(t["set_"+r]=function(t,n){if(i in{RO:1,ro:1})throw r+" is read-only";if(i in{WO:1,wo:1}&&"undefined"!=typeof e[r])throw r+" can only be set once";l(t,n)}),"undefined"!=typeof n[r]?a=n[r]:o in{arr:1,array:1}&&!(a instanceof Array)&&(a=[]),l(a)},VncHelper.conf_defaults=function(e,t,n,r){var i;for(i=0;i<r.length;i++)VncHelper.conf_default(e,t,n,r[i][0],r[i][1],r[i][2],r[i][3],r[i][4])},VncHelper.decodeUTF8=function(e){return decodeURIComponent(escape(e))},VncHelper.set_include_uri=function(e){VncHelper.get_include_uri=function(){return e}},VncHelper.get_include_uri=function(){return"/safeview-static/lib/noVNC/include/"},VncHelper._loading_scripts=[],VncHelper._pending_scripts=[],VncHelper.load_scripts=function(e){for(var t,n=document.getElementsByTagName("head")[0],r=VncHelper._loading_scripts,i=VncHelper._pending_scripts,o=0;o<e.length;o++)t=document.createElement("script"),
t.type="text/javascript",t.src=VncHelper.get_include_uri()+e[o],t.onload=t.onreadystatechange=function(e){for(;r.length>0&&("loaded"===r[0].readyState||"complete"===r[0].readyState);){var t=r.shift();n.appendChild(t)}(!this.readyState||VncHelper.Engine.presto&&"loaded"===this.readyState||"complete"===this.readyState)&&i.indexOf(this)>=0&&(this.onload=this.onreadystatechange=null,i.splice(i.indexOf(this),1),0===i.length&&window.onscriptsload&&window.onscriptsload())},VncHelper.Engine.trident?r.push(t):(t.async=!1,n.appendChild(t)),i.push(t)},VncHelper.getPosition=function(){function e(e,t,n){if(t.currentStyle)var r=t.currentStyle[n];else if(e.getComputedStyle)var r=e.getComputedStyle(t,null)[n];return r}function t(e){var t=0,n=0,r=e.document.getElementsByTagName("html")[0];return t=r.scrollTop&&e.document.documentElement.scrollTop?r.scrollTop:r.scrollTop||e.document.documentElement.scrollTop?r.scrollTop+e.document.documentElement.scrollTop:e.document.body.scrollTop?e.document.body.scrollTop:0,n=r.scrollLeft&&e.document.documentElement.scrollLeft?r.scrollLeft:r.scrollLeft||e.document.documentElement.scrollLeft?r.scrollLeft+e.document.documentElement.scrollLeft:e.document.body.scrollLeft?e.document.body.scrollLeft:0,[n,t]}return function(n,r){for(var i=0,o=0,a=r,s=!1;(a=a.parentNode)&&a!=n.document&&a!=n.document.body;)i-=a.scrollLeft||0,o-=a.scrollTop||0,"fixed"==e(n,a,"position")&&(s=!0);if(s&&!window.opera){var c=t(n);i+=c[0],o+=c[1]}do i+=r.offsetLeft,o+=r.offsetTop;while(r=r.offsetParent);return{x:i,y:o}}}(),VncHelper.getEventPosition=function(e,t,n,r){var i,o,a,s;i=t?t:e.event,i=i.changedTouches?i.changedTouches[0]:i.touches?i.touches[0]:i,i.pageX||i.pageY?(o=i.pageX,a=i.pageY):(i.clientX||i.clientY)&&(o=i.clientX+e.document.body.scrollLeft+e.document.documentElement.scrollLeft,a=i.clientY+e.document.body.scrollTop+e.document.documentElement.scrollTop),s=VncHelper.getPosition(e,n),"undefined"==typeof r&&(r=1);var c=o-s.x,l=a-s.y,d=Math.max(Math.min(c,n.width-1),0),u=Math.max(Math.min(l,n.height-1),0);return{x:d/r,y:u/r,realx:c/r,realy:l/r}},VncHelper.addEvent=function(e,t,n){if(e.attachEvent){var r=e.attachEvent("on"+t,n);return r}if(e.addEventListener)return e.addEventListener(t,n,!1),!0;throw"Handler could not be attached"},VncHelper.removeEvent=function(e,t,n){if(e.detachEvent){var r=e.detachEvent("on"+t,n);return r}if(e.removeEventListener)return e.removeEventListener(t,n,!1),!0;throw"Handler could not be removed"},VncHelper.stopEvent=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1},VncHelper.Features={xpath:!!document.evaluate,air:!!window.runtime,query:!!document.querySelector},VncHelper.Engine={presto:function(){return window.opera?!0:!1}(),trident:function(){return window.ActiveXObject?window.XMLHttpRequest?document.querySelectorAll?6:5:4:!1}(),webkit:function(){try{return navigator.taintEnabled?!1:VncHelper.Features.xpath?VncHelper.Features.query?525:420:419}catch(e){return!1}}(),gecko:function(){return document.getBoxObjectFor||null!=window.mozInnerScreenX?document.getElementsByClassName?19:18:!1}()},VncHelper.Engine.webkit&&(VncHelper.Engine.webkit=function(e){var t=new RegExp("WebKit/([0-9.]*) ");return e=(navigator.userAgent.match(t)||["",e])[1],parseFloat(e,10)}(VncHelper.Engine.webkit)),VncHelper.getFlashVer=function(){var e,t;if(VncHelper.flash_version)return VncHelper.flash_version;try{e=navigator.plugins["Shockwave Flash"].description}catch(n){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(r){e="0 r0"}}return t=e.match(/\d+/g),VncHelper.flash_version={version:parseInt(t[0]||"0."+t[1],10)||0,build:parseInt(t[2],10)||0},VncHelper.flash_version};var Websock_native;window.WebSocket&&!window.WEB_SOCKET_FORCE_FLASH?Websock_native=!0:window.MozWebSocket&&!window.WEB_SOCKET_FORCE_FLASH?(Websock_native=!0,window.WebSocket=window.MozWebSocket):Websock_native=!1;var WebUtil={},$D;window.$D||(window.$D=function(e){return document.getElementById?document.getElementById(e):document.all?document.all[e]:document.layers?document.layers[e]:void 0}),WebUtil.init_logging=function(e){"undefined"!=typeof e?VncHelper._log_level=e:VncHelper._log_level=(document.location.href.match(/logging=([A-Za-z0-9\._\-]*)/)||["",VncHelper._log_level])[1],VncHelper.init_logging()},WebUtil.dirObj=function(e,t,n){var r,i="",o="";t||(t=2),n||(n="");for(r in e)t>1&&"object"==typeof e[r]?i+=WebUtil.dirObj(e[r],t-1,n+"."+r):(o="undefined"==typeof e[r]?"undefined":e[r].toString().replace("\n"," "),o.length>30&&(o=o.substr(0,30)+"..."),i+=n+"."+r+": "+o+"\n");return i},WebUtil.getQueryVar=function(e,t){var n=new RegExp(".*[?&]"+e+"=([^&#]*)"),r=document.location.href.match(n);return"undefined"==typeof t&&(t=null),r?decodeURIComponent(r[1]):t},WebUtil.createCookie=function(e,t,n){var r,i,o;n?(r=new Date,r.setTime(r.getTime()+24*n*60*60*1e3),i="; expires="+r.toGMTString()):i="",o="https:"===document.location.protocol?"; secure":"",document.cookie=e+"="+t+i+"; path=/"+o},WebUtil.readCookie=function(e,t){var n,r,i=e+"=",o=document.cookie.split(";");for(n=0;n<o.length;n+=1){for(r=o[n];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(i))return r.substring(i.length,r.length)}return"undefined"!=typeof t?t:null},WebUtil.eraseCookie=function(e){WebUtil.createCookie(e,"",-1)},WebUtil.initSettings=function(e){var t=Array.prototype.slice.call(arguments,1);window.chrome&&window.chrome.storage?window.chrome.storage.sync.get(function(n){WebUtil.settings=n,console.log(WebUtil.settings),e&&e.apply(this,t)}):e&&e.apply(this,t)},WebUtil.writeSetting=function(e,t){window.chrome&&window.chrome.storage?WebUtil.settings[e]!==t&&(WebUtil.settings[e]=t,window.chrome.storage.sync.set(WebUtil.settings)):localStorage.setItem(e,t)},WebUtil.readSetting=function(e,t){var n;return n=window.chrome&&window.chrome.storage?WebUtil.settings[e]:localStorage.getItem(e),"undefined"==typeof n&&(n=null),null===n&&void 0!==typeof t?t:n},WebUtil.eraseSetting=function(e){window.chrome&&window.chrome.storage?(window.chrome.storage.sync.remove(e),delete WebUtil.settings[e]):localStorage.removeItem(e)},WebUtil.getStylesheets=function(){var e,t,n=[];for(t=document.getElementsByTagName("link"),e=0;e<t.length;e+=1)t[e].title&&t[e].rel.toUpperCase().indexOf("STYLESHEET")>-1&&n.push(t[e]);return n},WebUtil.selectStylesheet=function(e){var t,n,r=WebUtil.getStylesheets();for("undefined"==typeof e&&(e="default"),t=0;t<r.length;t+=1)n=r[t],n.title===e?(VncHelper.Debug("Using stylesheet "+e),n.disabled=!1):n.disabled=!0;return e};var Base64={toBase64Table:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),base64Pad:"=",encode:function(e){var t="",n=Base64.toBase64Table,r=e.length,i=r%3,o=0,a=0;for(o=0;r-2>o;o+=3)t+=n[e[o]>>2],t+=n[((3&e[o])<<4)+(e[o+1]>>4)],t+=n[((15&e[o+1])<<2)+(e[o+2]>>6)],t+=n[63&e[o+2]];return 2===i?(a=r-i,t+=n[e[a]>>2],t+=n[((3&e[a])<<4)+(e[a+1]>>4)],t+=n[(15&e[a+1])<<2],t+=n[64]):1===i&&(a=r-i,t+=n[e[a]>>2],t+=n[(3&e[a])<<4],t+=n[64],t+=n[64]),t},toBinaryTable:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],decode:function(e,t){t="undefined"!=typeof t?t:0;var n,r,i,o,a,s,c=Base64.toBinaryTable,l=Base64.base64Pad,d=0,u=0,f=e.indexOf("=")-t;for(0>f&&(f=e.length-t),r=3*(f>>2)+Math.floor(f%4/1.5),n=new Array(r),i=0,o=t;o<e.length;o++)a=c[127&e.charCodeAt(o)],s=e.charAt(o)===l,-1!==a?(u=u<<6|a,d+=6,d>=8&&(d-=8,s||(n[i++]=u>>d&255),u&=(1<<d)-1)):console.error("Illegal character code "+e.charCodeAt(o)+" at position "+o);if(d)throw{name:"Base64-Error",message:"Corrupted base64 string"};return n}},tinf,keysyms=function(){function e(e){return e?{keysym:e,keyname:t?t[e]:e}:void 0}var t=null,n={32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,160:160,161:161,162:162,163:163,164:164,165:165,166:166,167:167,168:168,169:169,170:170,171:171,172:172,173:173,174:174,175:175,176:176,177:177,178:178,179:179,180:180,181:181,182:182,183:183,184:184,185:185,186:186,187:187,188:188,189:189,190:190,191:191,192:192,193:193,194:194,195:195,196:196,197:197,198:198,199:199,200:200,201:201,202:202,203:203,204:204,205:205,206:206,207:207,208:208,209:209,210:210,211:211,212:212,213:213,214:214,215:215,216:216,217:217,218:218,219:219,220:220,221:221,222:222,223:223,224:224,225:225,226:226,227:227,228:228,229:229,230:230,231:231,232:232,233:233,234:234,235:235,236:236,237:237,238:238,239:239,240:240,241:241,242:242,243:243,244:244,245:245,246:246,247:247,248:248,249:249,250:250,251:251,252:252,253:253,254:254,255:255,256:960,257:992,258:451,259:483,260:417,261:433,262:454,263:486,264:710,265:742,266:709,267:741,268:456,269:488,270:463,271:495,272:464,273:496,274:938,275:954,278:972,279:1004,280:458,281:490,282:460,283:492,284:728,285:760,286:683,287:699,288:725,289:757,290:939,291:955,292:678,293:694,294:673,295:689,296:933,297:949,298:975,299:1007,300:16777516,301:16777517,302:967,303:999,304:681,305:697,308:684,309:700,310:979,311:1011,312:930,313:453,314:485,315:934,316:950,317:421,318:437,321:419,322:435,323:465,324:497,325:977,326:1009,327:466,328:498,330:957,331:959,332:978,333:1010,336:469,337:501,338:5052,339:5053,340:448,341:480,342:931,343:947,344:472,345:504,346:422,347:438,348:734,349:766,350:426,351:442,352:425,353:441,354:478,355:510,356:427,357:443,358:940,359:956,360:989,361:1021,362:990,363:1022,364:733,365:765,366:473,367:505,368:475,369:507,370:985,371:1017,372:16777588,373:16777589,374:16777590,375:16777591,376:5054,377:428,378:444,379:431,380:447,381:430,382:446,399:16777615,402:2294,415:16777631,416:16777632,417:16777633,431:16777647,432:16777648,437:16777653,438:16777654,439:16777655,466:16777681,486:16777702,487:16777703,601:16777817,629:16777845,658:16777874,711:439,728:418,729:511,731:434,733:445,901:1966,902:1953,904:1954,905:1955,906:1956,908:1959,910:1960,911:1963,912:1974,913:1985,914:1986,915:1987,916:1988,917:1989,918:1990,919:1991,920:1992,921:1993,922:1994,923:1995,924:1996,925:1997,926:1998,927:1999,928:2e3,929:2001,931:2002,932:2004,933:2005,934:2006,935:2007,936:2008,937:2009,938:1957,939:1961,940:1969,941:1970,942:1971,943:1972,944:1978,945:2017,946:2018,947:2019,948:2020,949:2021,950:2022,951:2023,952:2024,953:2025,954:2026,955:2027,956:2028,957:2029,958:2030,959:2031,960:2032,961:2033,962:2035,963:2034,964:2036,965:2037,966:2038,967:2039,968:2040,969:2041,970:1973,971:1977,972:1975,973:1976,974:1979,1025:1715,1026:1713,1027:1714,1028:1716,1029:1717,1030:1718,1031:1719,1032:1720,1033:1721,1034:1722,1035:1723,1036:1724,1038:1726,1039:1727,1040:1761,1041:1762,1042:1783,1043:1767,1044:1764,1045:1765,1046:1782,1047:1786,1048:1769,1049:1770,1050:1771,1051:1772,1052:1773,1053:1774,1054:1775,1055:1776,1056:1778,1057:1779,1058:1780,1059:1781,1060:1766,1061:1768,1062:1763,1063:1790,1064:1787,1065:1789,1066:1791,1067:1785,1068:1784,1069:1788,1070:1760,1071:1777,1072:1729,1073:1730,1074:1751,1075:1735,1076:1732,1077:1733,1078:1750,1079:1754,1080:1737,1081:1738,1082:1739,1083:1740,1084:1741,1085:1742,1086:1743,1087:1744,1088:1746,1089:1747,1090:1748,1091:1749,1092:1734,1093:1736,1094:1731,1095:1758,1096:1755,1097:1757,1098:1759,1099:1753,1100:1752,1101:1756,1102:1728,1103:1745,1105:1699,1106:1697,1107:1698,1108:1700,1109:1701,1110:1702,1111:1703,1112:1704,1113:1705,1114:1706,1115:1707,1116:1708,1118:1710,1119:1711,1168:1725,1169:1709,1170:16778386,1171:16778387,1174:16778390,1175:16778391,1178:16778394,1179:16778395,1180:16778396,1181:16778397,1186:16778402,1187:16778403,1198:16778414,1199:16778415,1200:16778416,1201:16778417,1202:16778418,1203:16778419,1206:16778422,1207:16778423,1208:16778424,1209:16778425,1210:16778426,1211:16778427,1240:16778456,1241:16778457,1250:16778466,1251:16778467,1256:16778472,1257:16778473,1262:16778478,1263:16778479,1329:16778545,1330:16778546,1331:16778547,1332:16778548,1333:16778549,1334:16778550,1335:16778551,1336:16778552,1337:16778553,1338:16778554,1339:16778555,1340:16778556,1341:16778557,1342:16778558,1343:16778559,1344:16778560,1345:16778561,1346:16778562,1347:16778563,1348:16778564,1349:16778565,1350:16778566,1351:16778567,1352:16778568,1353:16778569,1354:16778570,1355:16778571,1356:16778572,1357:16778573,1358:16778574,1359:16778575,1360:16778576,1361:16778577,1362:16778578,1363:16778579,1364:16778580,1365:16778581,1366:16778582,1370:16778586,1371:16778587,1372:16778588,1373:16778589,1374:16778590,1377:16778593,1378:16778594,1379:16778595,1380:16778596,1381:16778597,1382:16778598,1383:16778599,1384:16778600,1385:16778601,1386:16778602,1387:16778603,1388:16778604,1389:16778605,1390:16778606,1391:16778607,1392:16778608,1393:16778609,1394:16778610,1395:16778611,1396:16778612,1397:16778613,1398:16778614,1399:16778615,1400:16778616,1401:16778617,1402:16778618,1403:16778619,1404:16778620,1405:16778621,1406:16778622,1407:16778623,1408:16778624,1409:16778625,1410:16778626,1411:16778627,1412:16778628,1413:16778629,1414:16778630,1415:16778631,1417:16778633,1418:16778634,1488:3296,1489:3297,1490:3298,1491:3299,1492:3300,1493:3301,1494:3302,1495:3303,1496:3304,1497:3305,1498:3306,1499:3307,1500:3308,1501:3309,1502:3310,1503:3311,1504:3312,1505:3313,1506:3314,1507:3315,1508:3316,1509:3317,1510:3318,1511:3319,1512:3320,1513:3321,1514:3322,1548:1452,1563:1467,1567:1471,1569:1473,1570:1474,1571:1475,1572:1476,1573:1477,1574:1478,1575:1479,1576:1480,1577:1481,1578:1482,1579:1483,1580:1484,1581:1485,1582:1486,1583:1487,1584:1488,1585:1489,1586:1490,1587:1491,1588:1492,1589:1493,1590:1494,1591:1495,1592:1496,1593:1497,1594:1498,1600:1504,1601:1505,1602:1506,1603:1507,1604:1508,1605:1509,1606:1510,1607:1511,1608:1512,1609:1513,1610:1514,1611:1515,1612:1516,1613:1517,1614:1518,1615:1519,1616:1520,1617:1521,1618:1522,1619:16778835,1620:16778836,1621:16778837,1632:16778848,1633:16778849,1634:16778850,1635:16778851,1636:16778852,1637:16778853,1638:16778854,1639:16778855,1640:16778856,1641:16778857,1642:16778858,1648:16778864,1657:16778873,1662:16778878,1670:16778886,1672:16778888,1681:16778897,1688:16778904,1700:16778916,1705:16778921,1711:16778927,1722:16778938,1726:16778942,1729:16778945,1740:16778956,1746:16778962,1748:16778964,1776:16778992,1777:16778993,1778:16778994,1779:16778995,1780:16778996,1781:16778997,1782:16778998,1783:16778999,1784:16779e3,1785:16779001,3458:16780674,3459:16780675,3461:16780677,3462:16780678,3463:16780679,3464:16780680,3465:16780681,3466:16780682,3467:16780683,3468:16780684,3469:16780685,3470:16780686,3471:16780687,3472:16780688,3473:16780689,3474:16780690,3475:16780691,3476:16780692,3477:16780693,3478:16780694,3482:16780698,3483:16780699,3484:16780700,3485:16780701,3486:16780702,3487:16780703,3488:16780704,3489:16780705,3490:16780706,3491:16780707,3492:16780708,3493:16780709,3494:16780710,3495:16780711,3496:16780712,3497:16780713,3498:16780714,3499:16780715,3500:16780716,3501:16780717,3502:16780718,3503:16780719,3504:16780720,3505:16780721,3507:16780723,3508:16780724,3509:16780725,3510:16780726,3511:16780727,3512:16780728,3513:16780729,3514:16780730,3515:16780731,3517:16780733,3520:16780736,3521:16780737,3522:16780738,3523:16780739,3524:16780740,3525:16780741,3526:16780742,3530:16780746,3535:16780751,3536:16780752,3537:16780753,3538:16780754,3539:16780755,3540:16780756,3542:16780758,3544:16780760,3545:16780761,3546:16780762,3547:16780763,3548:16780764,3549:16780765,3550:16780766,3551:16780767,3570:16780786,3571:16780787,3572:16780788,3585:3489,3586:3490,3587:3491,3588:3492,3589:3493,3590:3494,3591:3495,3592:3496,3593:3497,3594:3498,3595:3499,3596:3500,3597:3501,3598:3502,3599:3503,3600:3504,3601:3505,3602:3506,3603:3507,3604:3508,3605:3509,3606:3510,3607:3511,3608:3512,3609:3513,3610:3514,3611:3515,3612:3516,3613:3517,3614:3518,3615:3519,3616:3520,3617:3521,3618:3522,3619:3523,3620:3524,3621:3525,3622:3526,3623:3527,3624:3528,3625:3529,3626:3530,3627:3531,3628:3532,3629:3533,3630:3534,3631:3535,3632:3536,3633:3537,3634:3538,3635:3539,3636:3540,3637:3541,3638:3542,3639:3543,3640:3544,3641:3545,3642:3546,3647:3551,3648:3552,3649:3553,3650:3554,3651:3555,3652:3556,3653:3557,3654:3558,3655:3559,3656:3560,3657:3561,3658:3562,3659:3563,3660:3564,3661:3565,3664:3568,3665:3569,3666:3570,3667:3571,3668:3572,3669:3573,3670:3574,3671:3575,3672:3576,3673:3577,4304:16781520,4305:16781521,4306:16781522,4307:16781523,4308:16781524,4309:16781525,4310:16781526,4311:16781527,4312:16781528,4313:16781529,4314:16781530,4315:16781531,4316:16781532,4317:16781533,4318:16781534,4319:16781535,4320:16781536,4321:16781537,4322:16781538,4323:16781539,4324:16781540,4325:16781541,4326:16781542,4327:16781543,4328:16781544,4329:16781545,4330:16781546,4331:16781547,4332:16781548,4333:16781549,4334:16781550,4335:16781551,4336:16781552,4337:16781553,4338:16781554,4339:16781555,4340:16781556,4341:16781557,4342:16781558,7682:16784898,7683:16784899,7690:16784906,7691:16784907,7710:16784926,7711:16784927,7734:16784950,7735:16784951,7744:16784960,7745:16784961,7766:16784982,7767:16784983,7776:16784992,7777:16784993,7786:16785002,7787:16785003,7808:16785024,7809:16785025,7810:16785026,7811:16785027,7812:16785028,7813:16785029,7818:16785034,7819:16785035,7840:16785056,7841:16785057,7842:16785058,7843:16785059,7844:16785060,7845:16785061,7846:16785062,7847:16785063,7848:16785064,7849:16785065,7850:16785066,7851:16785067,7852:16785068,7853:16785069,7854:16785070,7855:16785071,7856:16785072,7857:16785073,7858:16785074,7859:16785075,7860:16785076,7861:16785077,7862:16785078,7863:16785079,7864:16785080,7865:16785081,7866:16785082,7867:16785083,7868:16785084,7869:16785085,7870:16785086,7871:16785087,7872:16785088,7873:16785089,7874:16785090,7875:16785091,7876:16785092,7877:16785093,7878:16785094,7879:16785095,7880:16785096,7881:16785097,7882:16785098,7883:16785099,7884:16785100,7885:16785101,7886:16785102,7887:16785103,7888:16785104,7889:16785105,7890:16785106,7891:16785107,7892:16785108,7893:16785109,7894:16785110,7895:16785111,7896:16785112,7897:16785113,7898:16785114,7899:16785115,7900:16785116,7901:16785117,7902:16785118,7903:16785119,7904:16785120,7905:16785121,7906:16785122,7907:16785123,7908:16785124,7909:16785125,7910:16785126,7911:16785127,7912:16785128,7913:16785129,7914:16785130,7915:16785131,7916:16785132,7917:16785133,7918:16785134,7919:16785135,7920:16785136,7921:16785137,7922:16785138,7923:16785139,7924:16785140,7925:16785141,7926:16785142,7927:16785143,7928:16785144,7929:16785145,8194:2722,8195:2721,8196:2723,8197:2724,8199:2725,8200:2726,8201:2727,8202:2728,8210:2747,8211:2730,8212:2729,8213:1967,8215:3295,8216:2768,8217:2769,8218:2813,8220:2770,8221:2771,8222:2814,8224:2801,8225:2802,8226:2790,8229:2735,8230:2734,8240:2773,8242:2774,8243:2775,8248:2812,8254:1150,8304:16785520,8308:16785524,8309:16785525,8310:16785526,8311:16785527,8312:16785528,8313:16785529,8320:16785536,8321:16785537,8322:16785538,8323:16785539,8324:16785540,8325:16785541,8326:16785542,8327:16785543,8328:16785544,8329:16785545,8352:16785568,8353:16785569,8354:16785570,8355:16785571,8356:16785572,8357:16785573,8358:16785574,8359:16785575,8360:16785576,8361:3839,8362:16785578,8363:16785579,8364:8364,8453:2744,8470:1712,8471:2811,8478:2772,8482:2761,8531:2736,8532:2737,8533:2738,8534:2739,8535:2740,8536:2741,8537:2742,8538:2743,8539:2755,8540:2756,8541:2757,8542:2758,8592:2299,8593:2300,8594:2301,8595:2302,8658:2254,8660:2253,8706:2287,8709:16785925,8711:2245,8712:16785928,8713:16785929,8715:16785931,8728:3018,8730:2262,8731:16785947,8732:16785948,8733:2241,8734:2242,8743:2270,8744:2271,8745:2268,8746:2269,8747:2239,8748:16785964,8749:16785965,8756:2240,8757:16785973,8764:2248,8771:2249,8773:16785992,8775:16785991,8800:2237,8801:2255,8802:16786018,8803:16786019,8804:2236,8805:2238,8834:2266,8835:2267,8866:3068,8867:3036,8868:3010,8869:3022,8968:3027,8970:3012,8981:2810,8992:2212,8993:2213,9109:3020,9115:2219,9117:2220,9118:2221,9120:2222,9121:2215,9123:2216,9124:2217,9126:2218,9128:2223,9132:2224,9143:2209,9146:2543,9147:2544,9148:2546,9149:2547,9225:2530,9226:2533,9227:2537,9228:2531,9229:2532,9251:2732,9252:2536,9472:2211,9474:2214,9484:2210,9488:2539,9492:2541,9496:2538,9500:2548,9508:2549,9516:2551,9524:2550,9532:2542,9618:2529,9642:2791,9643:2785,9644:2779,9645:2786,9646:2783,9647:2767,9650:2792,9651:2787,9654:2781,9655:2765,9660:2793,9661:2788,9664:2780,9665:2764,9670:2528,9675:2766,9679:2782,9702:2784,9734:2789,9742:2809,9747:2762,9756:2794,9758:2795,9792:2808,9794:2807,9827:2796,9829:2798,9830:2797,9837:2806,9839:2805,10003:2803,10007:2804,10013:2777,10016:2800,10216:2748,10217:2750,10240:16787456,10241:16787457,10242:16787458,10243:16787459,10244:16787460,10245:16787461,10246:16787462,10247:16787463,10248:16787464,10249:16787465,10250:16787466,10251:16787467,10252:16787468,10253:16787469,10254:16787470,10255:16787471,10256:16787472,10257:16787473,10258:16787474,10259:16787475,10260:16787476,10261:16787477,10262:16787478,10263:16787479,10264:16787480,10265:16787481,10266:16787482,10267:16787483,10268:16787484,10269:16787485,10270:16787486,10271:16787487,10272:16787488,10273:16787489,10274:16787490,10275:16787491,10276:16787492,10277:16787493,10278:16787494,10279:16787495,10280:16787496,10281:16787497,10282:16787498,10283:16787499,10284:16787500,10285:16787501,10286:16787502,10287:16787503,10288:16787504,10289:16787505,10290:16787506,10291:16787507,10292:16787508,10293:16787509,10294:16787510,10295:16787511,10296:16787512,10297:16787513,10298:16787514,10299:16787515,10300:16787516,10301:16787517,10302:16787518,10303:16787519,10304:16787520,10305:16787521,10306:16787522,10307:16787523,10308:16787524,10309:16787525,10310:16787526,10311:16787527,10312:16787528,10313:16787529,10314:16787530,10315:16787531,10316:16787532,10317:16787533,10318:16787534,10319:16787535,10320:16787536,10321:16787537,10322:16787538,10323:16787539,10324:16787540,10325:16787541,10326:16787542,10327:16787543,10328:16787544,10329:16787545,10330:16787546,10331:16787547,10332:16787548,10333:16787549,10334:16787550,10335:16787551,10336:16787552,10337:16787553,10338:16787554,10339:16787555,10340:16787556,10341:16787557,10342:16787558,10343:16787559,10344:16787560,10345:16787561,10346:16787562,10347:16787563,10348:16787564,10349:16787565,10350:16787566,10351:16787567,10352:16787568,10353:16787569,10354:16787570,10355:16787571,10356:16787572,10357:16787573,10358:16787574,10359:16787575,10360:16787576,10361:16787577,10362:16787578,10363:16787579,10364:16787580,10365:16787581,10366:16787582,10367:16787583,10368:16787584,10369:16787585,10370:16787586,10371:16787587,10372:16787588,10373:16787589,10374:16787590,10375:16787591,10376:16787592,10377:16787593,10378:16787594,10379:16787595,10380:16787596,10381:16787597,10382:16787598,10383:16787599,10384:16787600,10385:16787601,10386:16787602,10387:16787603,10388:16787604,10389:16787605,10390:16787606,10391:16787607,10392:16787608,10393:16787609,10394:16787610,10395:16787611,10396:16787612,10397:16787613,10398:16787614,10399:16787615,10400:16787616,10401:16787617,10402:16787618,10403:16787619,10404:16787620,10405:16787621,10406:16787622,10407:16787623,10408:16787624,10409:16787625,10410:16787626,10411:16787627,10412:16787628,10413:16787629,10414:16787630,10415:16787631,10416:16787632,10417:16787633,10418:16787634,10419:16787635,10420:16787636,10421:16787637,10422:16787638,10423:16787639,10424:16787640,10425:16787641,10426:16787642,10427:16787643,10428:16787644,10429:16787645,10430:16787646,10431:16787647,10432:16787648,10433:16787649,10434:16787650,10435:16787651,10436:16787652,10437:16787653,10438:16787654,10439:16787655,10440:16787656,10441:16787657,10442:16787658,10443:16787659,10444:16787660,10445:16787661,10446:16787662,10447:16787663,10448:16787664,10449:16787665,10450:16787666,10451:16787667,10452:16787668,10453:16787669,10454:16787670,10455:16787671,10456:16787672,10457:16787673,10458:16787674,10459:16787675,10460:16787676,10461:16787677,10462:16787678,10463:16787679,10464:16787680,10465:16787681,10466:16787682,10467:16787683,10468:16787684,10469:16787685,10470:16787686,10471:16787687,10472:16787688,10473:16787689,10474:16787690,10475:16787691,10476:16787692,10477:16787693,10478:16787694,10479:16787695,10480:16787696,10481:16787697,10482:16787698,10483:16787699,10484:16787700,10485:16787701,10486:16787702,10487:16787703,10488:16787704,10489:16787705,10490:16787706,10491:16787707,10492:16787708,10493:16787709,10494:16787710,10495:16787711,12289:1188,12290:1185,12300:1186,12301:1187,12443:1246,12444:1247,12449:1191,12450:1201,12451:1192,12452:1202,12453:1193,12454:1203,12455:1194,12456:1204,12457:1195,12458:1205,12459:1206,12461:1207,12463:1208,12465:1209,12467:1210,12469:1211,12471:1212,12473:1213,12475:1214,12477:1215,12479:1216,12481:1217,12483:1199,12484:1218,12486:1219,12488:1220,12490:1221,12491:1222,12492:1223,12493:1224,12494:1225,12495:1226,12498:1227,12501:1228,12504:1229,12507:1230,12510:1231,12511:1232,12512:1233,12513:1234,12514:1235,12515:1196,12516:1236,12517:1197,12518:1237,12519:1198,12520:1238,12521:1239,12522:1240,12523:1241,12524:1242,12525:1243,12527:1244,12530:1190,12531:1245,12539:1189,12540:1200};return{fromUnicode:function(t){return e(n[t])},lookup:e}}(),XK_VoidSymbol=16777215,XK_BackSpace=65288,XK_Tab=65289,XK_Linefeed=65290,XK_Clear=65291,XK_Return=65293,XK_Pause=65299,XK_Scroll_Lock=65300,XK_Sys_Req=65301,XK_Escape=65307,XK_Delete=65535,XK_Home=65360,XK_Left=65361,XK_Up=65362,XK_Right=65363,XK_Down=65364,XK_Prior=65365,XK_Page_Up=65365,XK_Next=65366,XK_Page_Down=65366,XK_End=65367,XK_Begin=65368,XK_Select=65376,XK_Print=65377,XK_Execute=65378,XK_Insert=65379,XK_Undo=65381,XK_Redo=65382,XK_Menu=65383,XK_Find=65384,XK_Cancel=65385,XK_Help=65386,XK_Break=65387,XK_Mode_switch=65406,XK_script_switch=65406,XK_Num_Lock=65407,XK_KP_Space=65408,XK_KP_Tab=65417,XK_KP_Enter=65421,XK_KP_F1=65425,XK_KP_F2=65426,XK_KP_F3=65427,XK_KP_F4=65428,XK_KP_Home=65429,XK_KP_Left=65430,XK_KP_Up=65431,XK_KP_Right=65432,XK_KP_Down=65433,XK_KP_Prior=65434,XK_KP_Page_Up=65434,XK_KP_Next=65435,XK_KP_Page_Down=65435,XK_KP_End=65436,XK_KP_Begin=65437,XK_KP_Insert=65438,XK_KP_Delete=65439,XK_KP_Equal=65469,XK_KP_Multiply=65450,XK_KP_Add=65451,XK_KP_Separator=65452,XK_KP_Subtract=65453,XK_KP_Decimal=65454,XK_KP_Divide=65455,XK_KP_0=65456,XK_KP_1=65457,XK_KP_2=65458,XK_KP_3=65459,XK_KP_4=65460,XK_KP_5=65461,XK_KP_6=65462,XK_KP_7=65463,XK_KP_8=65464,XK_KP_9=65465,XK_F1=65470,XK_F2=65471,XK_F3=65472,XK_F4=65473,XK_F5=65474,XK_F6=65475,XK_F7=65476,XK_F8=65477,XK_F9=65478,XK_F10=65479,XK_F11=65480,XK_L1=65480,XK_F12=65481,XK_L2=65481,XK_F13=65482,XK_L3=65482,XK_F14=65483,XK_L4=65483,XK_F15=65484,XK_L5=65484,XK_F16=65485,XK_L6=65485,XK_F17=65486,XK_L7=65486,XK_F18=65487,XK_L8=65487,XK_F19=65488,XK_L9=65488,XK_F20=65489,XK_L10=65489,XK_F21=65490,XK_R1=65490,XK_F22=65491,XK_R2=65491,XK_F23=65492,XK_R3=65492,XK_F24=65493,XK_R4=65493,XK_F25=65494,XK_R5=65494,XK_F26=65495,XK_R6=65495,XK_F27=65496,XK_R7=65496,XK_F28=65497,XK_R8=65497,XK_F29=65498,XK_R9=65498,XK_F30=65499,XK_R10=65499,XK_F31=65500,XK_R11=65500,XK_F32=65501,XK_R12=65501,XK_F33=65502,XK_R13=65502,XK_F34=65503,XK_R14=65503,XK_F35=65504,XK_R15=65504,XK_Shift_L=65505,XK_Shift_R=65506,XK_Control_L=65507,XK_Control_R=65508,XK_Caps_Lock=65509,XK_Shift_Lock=65510,XK_Meta_L=65511,XK_Meta_R=65512,XK_Alt_L=65513,XK_Alt_R=65514,XK_Super_L=65515,XK_Super_R=65516,XK_Hyper_L=65517,XK_Hyper_R=65518,XK_space=32,XK_exclam=33,XK_quotedbl=34,XK_numbersign=35,XK_dollar=36,XK_percent=37,XK_ampersand=38,XK_apostrophe=39,XK_quoteright=39,XK_parenleft=40,XK_parenright=41,XK_asterisk=42,XK_plus=43,XK_comma=44,XK_minus=45,XK_period=46,XK_slash=47,XK_0=48,XK_1=49,XK_2=50,XK_3=51,XK_4=52,XK_5=53,XK_6=54,XK_7=55,XK_8=56,XK_9=57,XK_colon=58,XK_semicolon=59,XK_less=60,XK_equal=61,XK_greater=62,XK_question=63,XK_at=64,XK_A=65,XK_B=66,XK_C=67,XK_D=68,XK_E=69,XK_F=70,XK_G=71,XK_H=72,XK_I=73,XK_J=74,XK_K=75,XK_L=76,XK_M=77,XK_N=78,XK_O=79,XK_P=80,XK_Q=81,XK_R=82,XK_S=83,XK_T=84,XK_U=85,XK_V=86,XK_W=87,XK_X=88,XK_Y=89,XK_Z=90,XK_bracketleft=91,XK_backslash=92,XK_bracketright=93,XK_asciicircum=94,XK_underscore=95,XK_grave=96,XK_quoteleft=96,XK_a=97,XK_b=98,XK_c=99,XK_d=100,XK_e=101,XK_f=102,XK_g=103,XK_h=104,XK_i=105,XK_j=106,XK_k=107,XK_l=108,XK_m=109,XK_n=110,XK_o=111,XK_p=112,XK_q=113,XK_r=114,XK_s=115,XK_t=116,XK_u=117,XK_v=118,XK_w=119,XK_x=120,XK_y=121,XK_z=122,XK_braceleft=123,XK_bar=124,XK_braceright=125,XK_asciitilde=126,XK_nobreakspace=160,XK_exclamdown=161,XK_cent=162,XK_sterling=163,XK_currency=164,XK_yen=165,XK_brokenbar=166,XK_section=167,XK_diaeresis=168,XK_copyright=169,XK_ordfeminine=170,XK_guillemotleft=171,XK_notsign=172,XK_hyphen=173,XK_registered=174,XK_macron=175,XK_degree=176,XK_plusminus=177,XK_twosuperior=178,XK_threesuperior=179,XK_acute=180,XK_mu=181,XK_paragraph=182,XK_periodcentered=183,XK_cedilla=184,XK_onesuperior=185,XK_masculine=186,XK_guillemotright=187,XK_onequarter=188,XK_onehalf=189,XK_threequarters=190,XK_questiondown=191,XK_Agrave=192,XK_Aacute=193,XK_Acircumflex=194,XK_Atilde=195,XK_Adiaeresis=196,XK_Aring=197,XK_AE=198,XK_Ccedilla=199,XK_Egrave=200,XK_Eacute=201,XK_Ecircumflex=202,XK_Ediaeresis=203,XK_Igrave=204,XK_Iacute=205,XK_Icircumflex=206,XK_Idiaeresis=207,XK_ETH=208,XK_Eth=208,XK_Ntilde=209,XK_Ograve=210,XK_Oacute=211,XK_Ocircumflex=212,XK_Otilde=213,XK_Odiaeresis=214,XK_multiply=215,XK_Oslash=216,XK_Ooblique=216,XK_Ugrave=217,XK_Uacute=218,XK_Ucircumflex=219,XK_Udiaeresis=220,XK_Yacute=221,XK_THORN=222,XK_Thorn=222,XK_ssharp=223,XK_agrave=224,XK_aacute=225,XK_acircumflex=226,XK_atilde=227,XK_adiaeresis=228,XK_aring=229,XK_ae=230,XK_ccedilla=231,XK_egrave=232,XK_eacute=233,XK_ecircumflex=234,XK_ediaeresis=235,XK_igrave=236,XK_iacute=237,XK_icircumflex=238,XK_idiaeresis=239,XK_eth=240,XK_ntilde=241,XK_ograve=242,XK_oacute=243,XK_ocircumflex=244,XK_otilde=245,XK_odiaeresis=246,XK_division=247,XK_oslash=248,XK_ooblique=248,XK_ugrave=249,XK_uacute=250,XK_ucircumflex=251,XK_udiaeresis=252,XK_yacute=253,XK_thorn=254,XK_ydiaeresis=255,kbdUtil=function(){function e(e){var t={536:350,537:351,538:354,539:355},n=t[e];return n?n:e}function t(){return navigator&&!!/mac/i.exec(navigator.platform)}function n(){return navigator&&!!/win/i.exec(navigator.platform)}function r(){return navigator&&!!/linux/i.exec(navigator.platform)}function i(e,t){var n={};for(var r in t)65505!==parseInt(r)&&(n[r]=t[r]);var i=0;for(var a in t)n[a]&&++i;return o(e,n)?i>e.length:i>0}function o(e,t){if(0===e.length)return!1;for(var n=0;n<e.length;++n)if(!t[e[n]])return!1;return!0}function a(e){function a(e,t){function n(e){return{keysym:keysyms.lookup(e),type:_[e]?"keydown":"keyup"}}var r=[];return void 0!==e.ctrlKey&&e.ctrlKey!==_[l]&&t!==l&&(_[l]=e.ctrlKey,r.push(n(l))),void 0!==e.altKey&&e.altKey!==_[d]&&t!==d&&(_[d]=e.altKey,r.push(n(d))),void 0!==e.altGraphKey&&e.altGraphKey!==_[u]&&t!==u&&(_[u]=e.altGraphKey,r.push(n(u))),void 0!==e.shiftKey&&e.shiftKey!==_[f]&&t!==f&&(_[f]=e.shiftKey,r.push(n(f))),void 0!==e.metaKey&&e.metaKey!==_[p]&&t!==p&&(_[p]=e.metaKey,r.push(n(p))),r}function s(e,t){var n=c(e),r=n?n.keysym:null;return null!==r&&void 0!==_[r]&&(_[r]=t),a(e,r)}var l=65507,d=65513,u=65027,f=65505,p=65511;e||(e=t()?[d]:n()?[d,l]:r()?[u]:[]);var _={};return _[l]=!1,_[d]=!1,_[u]=!1,_[f]=!1,
_[p]=!1,{keydown:function(e){return s(e,!0)},keyup:function(e){return s(e,!1)},syncAny:function(e){return a(e)},hasShortcutModifier:function(){return i(e,_)},activeCharModifier:function(){return o(e,_)?e:null}}}function s(e){return"keyCode"in e&&"key"in e?e.key+":"+e.keyCode:"keyCode"in e?e.keyCode:e.key}function c(t){var n;if(t["char"]&&1===t["char"].length?n=t["char"].charCodeAt():t.charCode?n=t.charCode:t.keyCode&&"keypress"===t.type&&(n=t.keyCode),n){var r=keysyms.fromUnicode(e(n));if(r)return r}return t.keyCode?keysyms.lookup(l(t.keyCode,t.shiftKey)):t.which?keysyms.lookup(l(t.which,t.shiftKey)):null}function l(e,t){if("number"!=typeof e)return null;if(e>=48&&57>=e)return e;if(e>=65&&90>=e)return t?e:e+32;if(e>=96&&105>=e)return 65456+(e-96);switch(e){case 32:return 32;case 106:return 65450;case 107:return 65451;case 108:return 65452;case 109:return 65453;case 110:return 65454;case 111:return 65455;case 187:return 43;case 188:return 44;case 189:return 45;case 190:return 46}return d({keyCode:e})}function d(e){if(!e.keyCode)return null;var t=e.keyCode;if(t>=112&&135>=t)return 65470+t-112;switch(t){case 8:return 65288;case 13:return 65293;case 9:return 65289;case 27:return 65307;case 46:return 65535;case 36:return 65360;case 35:return 65367;case 33:return 65365;case 34:return 65366;case 45:return 65379;case 37:return 65361;case 38:return 65362;case 39:return 65363;case 40:return 65364;case 16:return 65505;case 17:return 65507;case 18:return 65513;case 224:return 65031;case 225:return 65027;case 91:return 65516;case 92:return 65517;case 93:return 65383;default:return null}}return{hasShortcutModifier:i,hasCharModifier:o,ModifierSync:a,getKey:s,getKeysym:c,keysymFromKeyCode:l,nonCharacterKey:d,substituteCodepoint:e}}();SoftAssertException.prototype.toString=function(){return"SoftAssertException: "+this.message},AssertUnimplementedException.prototype.toString=function(){return"AssertUnimplementedException: "+this.message};var assert_msg_count={},Util={};Function.prototype.curry=function(){var e=this,t=Array.prototype.slice.call(arguments);return function(){return e.apply(this,t.concat(Array.prototype.slice.call(arguments)))}},Util.parseConfig=function(){var e,t,n=document.getElementsByTagName("safeview-info")[0],r=n.getAttribute("session-info"),i=Util.b64Decode(r),o=JSON.parse(i);o.hasOwnProperty("DEBUG")||(window.DEBUG=!1);for(e in o)o.hasOwnProperty(e)&&(t=o[e],window[e]=t);o.hasOwnProperty("INSPECT_DOMAIN")||(window.INSPECT_DOMAIN=window.CLUSTER_DOMAIN)},Util.parseURL=function(e){var t=document.createElement("a");return t.href=e,t},Util.hashCode=function(e){var t,n,r=0;if(!e||0===e.length)return r;for(t=0;t<e.length;t+=1)n=e.charCodeAt(t),r=(r<<5)-r+n,r&=r;return r},Util.isIpAddress=function(e){return 0===e.search(/^(\d{1,3}\.){3}\d{1,3}$/)},Util.getScrollbarThickness=function(){function e(e,t){var n,r,i=document.createElement("div"),o=document.createElement("div");return i.style.visibility="hidden",i.style[e]="100px",document.body.appendChild(i),n=i[t],i.style.overflow="scroll",o.style[e]="100%",i.appendChild(o),r=o[t],i.parentNode.removeChild(i),n-r}return Util.cached_thickness?Util.cached_thickness:(Util.cached_thickness=[e("width","offsetWidth"),e("height","offsetHeight")],Util.cached_thickness)},Util.getDeviceScaleFactor=function(){var e=window.devicePixelRatio||1;return e-Math.floor(e)<.1?e:Math.ceil(e)},Util.getScreenOrientationType=function(){if(void 0===window.orientation)return"portrait";switch(window.orientation){case 0:case 180:return"portrait";case 90:case-90:return"landscape";default:return assert(0),"portrait"}},Util.getScreenOrientationAngle=function(){return"number"==typeof window.orientation?window.orientation:0},Util.getPortraitScreenSize=function(){return BrowserDetect.isSafari()||"portrait"===Util.getScreenOrientationType()?{width:window.screen.width,height:window.screen.height}:{width:window.screen.height,height:window.screen.width}},Util.getDeviceMetrics=function(){return{screen_size:Util.getPortraitScreenSize(),screen_orientation_type:Util.getScreenOrientationType(),screen_orientation_angle:Util.getScreenOrientationAngle(),device_scale_factor:window.debug_dsf||Util.getDeviceScaleFactor(),scrollbar_thickness:Util.getScrollbarThickness(),enable_touch_events:void 0!==document.ontouchstart,max_touch_points:void 0!==navigator.maxTouchPoints?navigator.maxTouchPoints:2,mobile:BrowserDetect.isMobile()}},Util.getDoctypeDecl=function(e){var t,n=e.document.doctype;return n?(t="<!DOCTYPE "+n.name,n.publicId?(t+=' PUBLIC "'+n.publicId+'"',n.systemId&&(t+=' "'+n.systemId+'"')):n.systemId&&(t+=' SYSTEM "'+n.systemId+'"'),t+=">"):t="",t},Util.persistentPolicy=function(){var e=window.history.state||{};return e.persistent_policy||{}},Util.getRawPageUrl=function(){var e,t,n;return window.TPROXY_ENABLED?location.href:(e=new RegExp(".+?://.+?/(.+)"),t=e.exec(location.href),assert(2===t.length),n=t[1],new RegExp("ftp://|http(s)?://","i").test(n)||(n="http://"+n),n)},Util.getLanguage=function(){return navigator.userAgent.indexOf("MSIE 10.0")>=0?window.navigator.browserLanguage:window.navigator.language},Util.getLanguages=function(){return window.navigator.languages?window.navigator.languages.join():""},Util.b64_chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Util.b64Decode=function(e,t){var n,r,i,o,a,s,c,l="",d=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<e.length;)o=Util.b64_chars.indexOf(e.charAt(d++)),a=Util.b64_chars.indexOf(e.charAt(d++)),s=Util.b64_chars.indexOf(e.charAt(d++)),c=Util.b64_chars.indexOf(e.charAt(d++)),n=o<<2|a>>4,r=(15&a)<<4|s>>2,i=(3&s)<<6|c,l+=String.fromCharCode(n),64!==s&&(l+=String.fromCharCode(r)),64!==c&&(l+=String.fromCharCode(i));return t||(l=Util.utf8Decode(l)),l},Util.utf8Decode=function(e){for(var t,n,r,i="",o=0;o<e.length;)t=e.charCodeAt(o),128>t?(i+=String.fromCharCode(t),o++):t>191&&224>t?(n=e.charCodeAt(o+1),i+=String.fromCharCode((31&t)<<6|63&n),o+=2):(n=e.charCodeAt(o+1),r=e.charCodeAt(o+2),i+=String.fromCharCode((15&t)<<12|(63&n)<<6|63&r),o+=3);return i},Util.getFramingStatus=function(){if(window.top===window)return 0;try{if(window.parent.location.host===window.location.host)return 2}catch(e){}return 1},Util.getParam=function(e){var t,n,r=window.location.search.substr(1).split("&");for(t=0;t<r.length;t+=1)if(n=r[t].split("="),n[0]===e)return decodeURIComponent(r[t].slice(r[t].indexOf("=")+1));return null};var ONE_LEVEL_TLDS=["com","org","int","net","edu","gov","mil"];Util.input_text_types={text:1,password:1,search:1,email:1,url:1,tel:1,number:1},Util.input_text_types_strict={text:1,password:1,search:1,email:1,url:1,tel:1},"function"!=typeof String.prototype.startswith&&(String.prototype.startswith=function(e){return 0===this.indexOf(e)}),"function"!=typeof String.prototype.endswith&&(String.prototype.endswith=function(e){return this.substring(this.length-e.length)===e}),Util.show_message_bar=function(e){var t,n,r=document.getElementById("__safly_message_bar");safeview.pairing_dict&&safeview.pairing_dict.client_caps&&safeview.pairing_dict.client_caps.enable_reconnect_banner&&(r||(r=document.createElement("div"),r.id="__safly_message_bar",r.style.cursor="pointer",r.style.display="none",r.style.position="fixed",r.style.top=0,r.style.left="27%",r.style.right="27%",r.style.margin="auto",r.style.padding="3px",r.style.width="35%",r.style.background="#fc0",r.style.textAlign="center",r.style.font="12px arial, sans-serif",r.style.opacity="0.9",r.style.zIndex="100000000000",r.style.borderBottomLeftRadius="5px",r.style.borderBottomRightRadius="5px",r.style.verticalAlign="middle",t=document.body,t||(n=document.getElementsByTagName("html")[0],n||(n=document.createElement("html"),document.appendChild(n)),t=document.createElement("body"),n.appendChild(t),assert(document.body)),t.appendChild(r)),r.innerText=e,r.style.display="block")},Util.hide_message_bar=function(){var e=document.getElementById("__safly_message_bar");e&&(e.style.display="none")},Util.conf_default=function(e,t,n,r,i,o,a,s){var c,l;c=function(t){return{arr:1,array:1}.hasOwnProperty(o)&&void 0!==t?e[r][t]:e[r]},l=function(t,n){({"boolean":1,bool:1}).hasOwnProperty(o)?t=!t||{0:1,no:1,"false":1}.hasOwnProperty(t)?!1:!0:{integer:1,"int":1}.hasOwnProperty(o)?t=parseInt(t,10):"func"===o&&(t||(t=function(){})),void 0!==n?e[r][n]=t:e[r]=t},t[r+"_description"]=s,void 0===t["get_"+r]&&(t["get_"+r]=c),void 0===t["set_"+r]&&(t["set_"+r]=function(t,n){if({RO:1,ro:1}.hasOwnProperty(i))throw new Error(r+" is read-only");if({WO:1,wo:1}.hasOwnProperty(i)&&void 0!==e[r])throw new Error(r+" can only be set once");l(t,n)}),void 0!==n[r]?a=n[r]:!{arr:1,array:1}.hasOwnProperty(o)||a instanceof Array||(a=[]),l(a)},Util.conf_defaults=function(e,t,n,r){var i;for(i=0;i<r.length;i+=1)Util.conf_default(e,t,n,r[i][0],r[i][1],r[i][2],r[i][3],r[i][4])},Util.objectPrototypeToString=Object.prototype.toString,Util.is_string=function(e){return"[object String]"===Util.objectPrototypeToString.call(e)},Util.is_valid_number=function(e){return Number.isFinite?Number.isFinite(e):isFinite(e)},Util.string_rpad=function(e,t){var n,r;for(n=Math.max(t-e.length,0),r=0;n>r;r+=1)e+=" ";return e},Util.string_shorten=function(e,t,n){return n=n||"",n.length>t&&(n=n.substring(0,t)),e.length<=t?e:e.substring(0,t-n.length)+n},Util.fit_string_in_fixed_len_field=function(e,t,n){return Util.string_rpad(Util.string_shorten(e,t,n),t)},Util.getPosition=function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;while(e);return{x:t,y:n}},Util.getTopWindowMousePosition=function(e){for(var t,n={x:e.clientX,y:e.clientY},r=e.target;;){if(r=r.ownerDocument,r=r.defaultView||r.parentWindow,r=r.frameElement,!r)break;t=r.getBoundingClientRect(),n.x+=t.left,n.y+=t.top}return n},Util.getTopWindowPosition=function(e){for(var t,n={x:0,y:0};e;)t=e.getBoundingClientRect(),n.x+=t.left,n.y+=t.top,e=e.ownerDocument,e=e.defaultView||e.parentWindow,e=e.frameElement;return n.x+=document.body.scrollLeft+document.documentElement.scrollLeft,n.y+=document.body.scrollTop+document.documentElement.scrollTop,n},Util.getEventPosition=function(e,t,n){var r,i,o,a;return r=e||window.event,r.pageX||r.pageY?(i=r.pageX,o=r.pageY):(r.clientX||r.clientY)&&(i=r.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,o=r.clientY+document.body.scrollTop+document.documentElement.scrollTop),a=Util.getPosition(t),void 0===n&&(n=1),{x:(i-a.x)/n,y:(o-a.y)/n}},Util.getScreenWidth=function(){return document.documentElement.clientWidth},Util.getScreenHeight=function(){return document.documentElement.clientHeight},Util.htmlMsg=function(e){return"<!DOCTYPE html><html><body>"+e+"</body></html>"},Util.isSameDomain=function(e,t){var n=Util.parseURL(e).hostname,r=Util.parseURL(t).hostname,i=n.split("."),o=r.split(".");return JSON.stringify(i.slice(-2))!==JSON.stringify(o.slice(-2))?!1:i.slice(-2)[0].length>3||i.length<3||o.length<3||ONE_LEVEL_TLDS.indexOf(i.slice(-1)[0])>=0||i.slice(-3)[0]===o.slice(-3)[0]},Util.makeSet=function(e){var t,n={};for(t=0;t<e.length;t+=1)n[e[t]]=1;return n},Util.buildQueryStr=function(e){var t,n="";if(e)for(t in e)e.hasOwnProperty(t)&&(n+="&"+t+"="+e[t]);return n};var PREFIX="sv_tab_id:";Util.getOrSetTabID=function(){var e;return assert(window.localStorage),assert("string"==typeof window.name),__startswith(window.name,PREFIX)?window.name.substr(PREFIX.length):(e=__randstr(16),window.name=PREFIX+e,window.history.replaceState&&window.history.replaceState(window.history.state,document.title,window.location.href),e)},Util.safeCreateWebSocket=function(e,t){var n=null;e=new ParsedURL(e).withTrackingLabel();try{window.WebSocket?n=new window.WebSocket(e):window.MozWebSocket&&(n=new window.MozWebSocket(e))}catch(r){if(t)throw r;reportClientEvent("tc-websocket-create-failed",{request_url:e})}return n},Util.hasHTML5Support=function(){return!(!window.history.pushState||!window.history.replaceState)},Util.get_node_tag=function(e){soft_assert(e);var t=e.localName||e.nodeName;return t=t?t.toLowerCase():t},Util.getDoctypeDecl=function(e){var t,n=e.document.doctype;return n?(t="<!DOCTYPE "+n.name,n.publicId?(t+=' PUBLIC "'+n.publicId+'"',n.systemId&&(t+=' "'+n.systemId+'"')):n.systemId&&(t+=' SYSTEM "'+n.systemId+'"'),t+=">"):t="",t},Util.is_element_input_text=function(e){var t=Util.get_node_tag(e);return"textarea"===t||"input"===t&&Util.input_text_types.hasOwnProperty(e.type)},Util.is_frame_node_name=function(e){return"iframe"===e||"frame"===e},Util.is_frame_node=function(e){return Util.is_frame_node_name(e.localName)},Util.is_autofill_target=function(e){var t=Util.get_node_tag(e);return"input"===t&&Util.is_element_input_text(e)},Util.can_element_use_lecho=function(e){var t=Util.get_node_tag(e);return"input"===t&&Util.input_text_types_strict.hasOwnProperty(e.type)},Util.is_node_likely_anchor_tag=function(e){return!!e.href},Util.compute_iframe_src=function(e,t,n){var r,i,o="/safeview-redirect/sub_frame.html";return window.TPROXY_ENABLED?(i=new ParsedURL(e),r=i.origin+o+"?tpe=1"):r=o+"?tpe=0",r+="&fid="+t,n&&(r+="&dt="+encodeURIComponent(Util.b64Encode(n))),r},Util.is_elem_editable=function(e){var t=Util.get_node_tag(e);return(e.isContentEditable||"on"===e.ownerDocument.designMode)&&"textarea"!==t&&"input"!==t},Util.findPredicateOnBranch=function(e,t){for(var n=e;n;){if(t(n))return n;n=n.parentNode}return null},Util.now=function(){return window.performance?Number(window.performance.now()).toFixed():Date.now()},Util.rewriteRawHref=function(e){return window.TPROXY_ENABLED?e:"/"+e},Util.is_in_iframe=function(){try{return window.self!==window.top}catch(e){return!0}},Util.getCookie=function(e){var t={};if(e)return document.cookie.split(";").forEach(function(e){e=e.trim().split("="),t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}),t[e]},Util.setCookie=function(e,t,n,r,i,o){var a=[encodeURIComponent(e)+"="+encodeURIComponent(t)];return e?(n&&a.push("expires="+n.toUTCString()),r&&a.push("path="+r),i&&a.push("domain="+i),o&&a.push("secure"),document.cookie=a.join("; "),!0):!1},Util.forEachItem=function(e,t){var n;assert("object"==typeof e),assert("function"==typeof t);for(n in e)if(e.hasOwnProperty(n)&&t(n,e[n]))return},Util.isDictEmpty=function(e){var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},Util.dictValues=function(e){var t=[];return Object.values?Object.values(e):(Util.forEachItem(e,function(e,n){t.push(n)}),t)},Util.copyDict=function(e){var t={};return Util.forEachItem(e,function(e,n){t[e]=n}),t},Util.getImageFromU8Array=function(e,t){function n(e){assert(i.src),window.URL.revokeObjectURL(i.src),i.onload=i.onerror=null,t(i,e)}var r=new window.Blob([e]),i=new Image;assert(t),i.onload=n.curry(!0),i.onerror=n.curry(!1),i.src=window.URL.createObjectURL(r)},Util.getImageFromURL=function(e,t){function n(e){assert(r.src),r.onload=r.onerror=null,t(r,e)}var r=new Image;assert(t),r.onload=n.curry(!0),r.onerror=n.curry(!1),r.src=e},Util.Uint8ArrayToBase64=function(e){var t,n,r=[];for(t=0;t<e.length;t+=1)r.push(String.fromCharCode(e[t]));return n=r.join(""),window.btoa(n)},Util.elementIntersectsViewport=function(e){var t=e.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,r=window.innerWidth||document.documentElement.clientWidth;return!(t.left>=r||t.right<=0||t.top>=n||t.bottom<=0)},Util.elementIsInsideViewport=function(e){var t,n=window.innerHeight||document.documentElement.clientHeight,r=window.innerWidth||document.documentElement.clientWidth;return e.getBoundingClientRect?(t=e.getBoundingClientRect(),t.top>=0&&t.left>=0&&t.bottom<=n&&t.right<=r):!0},Util.isIframeReady=function(e){var t=e.contentWindow;return t&&t.document&&"complete"===t.document.readyState},Util.IsEventTargetForeign=function(e,t){return assert(e),t&&"resize"===t.type?!1:getUidByNode(e)?!1:!0},Util.calculateMouseMovement=function(e){return calculateMovement(e,"last_mouse_pos")},Util.calculateDragMovement=function(e){return calculateMovement(e,"last_drag_pos")},Util.makePasteDataList=function(e,t){var n,r,i,o,a=[];if(e.clipboardData&&e.clipboardData.getData)for(n=e.clipboardData,i=0;i<n.types.length;i+=1)r=n.types[i],"text/plain"===r||"text/html"===r?a.push(n.getData(r)):a.push(""),a.push(r);else t.clipboardData&&t.clipboardData.getData&&(o=t.clipboardData.getData("Text"),o&&(a.push(o),a.push("text/plain")));return a},Util.getButtonModifiers=function(e,t){if(void 0!==e.buttons)return e.buttons;switch(e.which){case 0:return 0;case 1:return 1;case 2:return 4;case 3:return 2;default:return t.error({event:"tc-unknown-button",which:e.which}),0}},Util.getMouseAndKeyboardModifiers=function(e,t){var n=Util.getButtonModifiers(e,t);return assert(void 0!==e.shiftKey),assert(void 0!==e.ctrlKey),assert(void 0!==e.altKey),assert(void 0!==e.metaKey),e.shiftKey&&(n|=32),e.ctrlKey&&(n|=64),e.altKey&&(n|=128),e.metaKey&&(n|=256),n},Util.getRelativeMouseCoords=function(e,t){var n;return e=3===e.nodeType?e.parentNode:e,n=e.getBoundingClientRect(),n.left>0&&n.top>0?{x:t.clientX-n.left,y:t.clientY-n.top,relative_to_target:!0}:{x:t.clientX,y:t.clientY,relative_to_target:!1}},Util.gen_dragdrop_file_list=function(e){function t(e){return{name:e.name,type:e.type}}var n,r,i,o=[];if(e.items)for(n=0;n<e.items.length;n++)i=e.items[n],"file"===i.kind&&(r=i.getAsFile(),o.push(r?t(r):{type:i.type}));else{for(n=0;n<e.files.length;n++)o.push(t(e.files[n]));0===o.length&&(e.types.contains&&e.types.contains("Files")||(e.types.indexOf&&e.types.indexOf("Files"))>=0)&&(o=[{type:"text/plain"}])}return o},Util.debug_print_selection=function(e,t){function n(e){var t;return t=1===e.nodeType?"node_type:element_node, node_name:"+e.nodeName+", text_content:"+e.textContent:3===e.nodeType?"node_type:text_node, node_value:"+e.nodeValue:"Unexpected node type in selection, node_type:"+e.nodeType}var r,i,o,a,s,c;if(e.anchorNode&&e.focusNode&&(r="anchorNode={"+n(e.anchorNode)+"}, focusNode={"+n(e.focusNode)+"}, anchorOffset="+e.anchorOffset+", focusOffset="+e.focusOffset+", isCollapsed="+e.isCollapsed+", rangeCount="+e.rangeCount,i=e.getRangeAt(0),o="startContainer={"+n(i.startContainer)+"}, endContainer={"+n(i.endContainer)+"}, startOffset="+i.startOffset+", endOffset="+i.endOffset,s=e.focusNode,1===s.nodeType))for(a=0;a<s.childNodes.length;a+=1)c=s.childNodes[a],1===c.nodeType||3===c.nodeType},Util.ensureElementPresent=function(e){var t,n=document[e];n||(t=document.getElementsByTagName("html")[0],t||(t=document.createElement("html"),document.appendChild(t)),n=document.createElement(e),t.appendChild(n),assert(document[e]))},Util.splunkify=function(e){return JSON.stringify(e).replace(/\"/g,"'")},Util.buildLoginForm=function(e,t){function n(e,t){var n=document.createElement("input");n.type="hidden",n.name=e,n.value=t,r.appendChild(n)}var r,i,o;for(r=document.createElement("form"),r.action=e.login_url,n("url",t),o=["through","entry_mode","redirect_list","prepend","doc_headers","inspect_host"],i=0;i<o.length;i++)e[o[i]]&&n(o[i],e[o[i]]);return r},Util.submitLoginForm=function(e,t){t&&(e.target=t),e.method="POST",document.body.appendChild(e),e.submit()},Util.b64Encode=function(e,t){var n,r,i,o,a,s,c,l="",d=0;for(t||(e=Util.utf8Encode(e));d<e.length;)n=e.charCodeAt(d++),r=e.charCodeAt(d++),i=e.charCodeAt(d++),o=n>>2,a=(3&n)<<4|r>>4,s=(15&r)<<2|i>>6,c=63&i,isNaN(r)?s=c=64:isNaN(i)&&(c=64),l=l+Util.b64_chars.charAt(o)+Util.b64_chars.charAt(a)+Util.b64_chars.charAt(s)+Util.b64_chars.charAt(c);return l},Util.utf8Encode=function(e){var t,n,r="";for(e=e.replace(/\r\n/g,"\n"),t=0;t<e.length;t++)n=e.charCodeAt(t),128>n?r+=String.fromCharCode(n):n>127&&2048>n?(r+=String.fromCharCode(n>>6|192),r+=String.fromCharCode(63&n|128)):(r+=String.fromCharCode(n>>12|224),r+=String.fromCharCode(n>>6&63|128),r+=String.fromCharCode(63&n|128));return r},Util.is_korean_char=function(e){var t=e.charCodeAt(0);return t>=44032&&55203>=t||t>=4352&&4607>=t||t>=12592&&12687>=t||t>=43360&&43391>=t||t>=55216&&55295>=t},Util.isTabVisible=function(){return"hidden"!==document.visibilityState},Util.showEmbeddedError=function(e,t,n,r){document.getElementsByTagName("sv_error_page").length||(document.body.innerHTML=r.get("error-template")),document.getElementById("error-title").textContent=e,document.getElementById("error-description").textContent=t,document.getElementById("spinner").style.display="none"},Util.showError=function(e,t,n,r){reportWarnClientEvent("tc-main-show-error-page",{title:e,body:t,extra:n}),safeview&&safeview.event_reporter&&safeview.event_reporter.flush(),Util.showEmbeddedError(e,t,n,r)},Util.endsWith=function(e,t){return t.length>e.length?!1:e.substr(-t.length)===t};var EventListener=new EventListenerModule,browser={name:BrowserDetect.browser,version:BrowserDetect.version,os:BrowserDetect.OS},uidToNode={},fidToWindow={},fidToIframeNode={},uidToFid={},main_frame_fid=null,ScrollControl={initialMode:"TC",tuneScrollMargin:6},sv_flash_version_required="11.0.0.0",COF_MPFD_MAX_SIZE=209715200,fileChooserTargetFid=null,fileChooserTargetUid=null,fileChooserTargetNode=null,MetricsUtilsClass=function(){function e(){if(!document.body){var e=document.createElement("body");document.documentElement.appendChild(e),assert(document.body)}}function t(){return"portrait"===Util.getScreenOrientationType()?Util.getPortraitScreenSize().width:Util.getPortraitScreenSize().height}function n(){var e=window.visualViewport;return e?e.scale:BrowserDetect.isMobileSafari()?"portrait"===Util.getScreenOrientationType()?Util.getPortraitScreenSize().width/window.innerWidth:Util.getPortraitScreenSize().height/window.innerWidth:1}function r(){var t,n,r=document.createElement("div"),i=document.createElement("div");return assert_unimplemented(!BrowserDetect.isMobile()||BrowserDetect.isMobileSafari()||BrowserDetect.isAndroidChrome()),i.style.position=r.style.position="absolute",i.style.top=r.style.top="0px",i.style.left=r.style.left="0px",i.style.width=r.style.width="100%",r.style.height="100vh",i.style.height="100%",e(),document.body.appendChild(r),document.body.appendChild(i),t=r.getBoundingClientRect(),n=i.getBoundingClientRect(),assert(t.width===n.width),r.parentNode.removeChild(r),i.parentNode.removeChild(i),{max_height:Math.ceil(t.height),min_height:Math.ceil(n.height),width:Math.ceil(t.width)}}function i(){var e,n,i=r(),o=i.width/t();return BrowserDetect.isMobileSafari()?(n=i.max_height<i.min_height?i.max_height:i.max_height/o,e=i.min_height/o,assert(n>=e),{max:Math.ceil(n),min:Math.ceil(e)}):{max:Math.ceil(i.max_height/o),min:Math.ceil(i.min_height/o)}}function o(){var e;return BrowserDetect.isDesktop()?0:(e=i(),Math.max(0,Math.round(e.max-e.min)))}function a(){var e,t,r=window.visualViewport,o=n(),a=5;if(BrowserDetect.isDesktop())return!1;if(r)e=r.height*o;else{if(!BrowserDetect.isMobileSafari())return!1;e=window.innerHeight*o}return t=i(),Math.abs(t.min-e)<a}function s(){var e=0,t=0;return assert(!BrowserDetect.isMobile()),window.innerWidth?(e=window.innerWidth,t=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):document.body&&(e=document.body.clientWidth,t=document.body.clientHeight),assert("number"==typeof e&&"number"==typeof t),{x:0,y:0,width:e,height:t,scale:n()}}function c(){var e,n={};return BrowserDetect.isMobile()?(assert(BrowserDetect.isMobileSafari()||BrowserDetect.isAndroidChrome()),n.width=t(),e=i(),n.height=a()?e.min:e.max,n):s()}function l(t,n){var r,i=document.createElement("div");return assert("fixed"===t||"absolute"===t),i.style.position=t,i.style.left=n.x+"px",i.style.top=n.y+"px",i.style.width="1px",i.style.height="1px",e(),document.body.appendChild(i),r=i.getBoundingClientRect(),i.parentNode.removeChild(i),{x:r.x,y:r.y}}function d(){var e=l("fixed",{x:0,y:0}),t=l("absolute",{x:window.scrollX,y:window.scrollY});return assert(BrowserDetect.isMobileSafari()),1===n()?{x:0,y:0}:{x:t.x-e.x,y:t.y-e.y,scroll_bounds:t,fixed_bounds:e}}function u(){var e=l("fixed",{x:0,y:0}),t=l("absolute",{x:0,y:0});return{x:e.x-t.x,y:e.y-t.y}}function f(){var e,t,r=window.visualViewport;return r?(t=r.scale,{x:r.offsetLeft,y:r.offsetTop,width:r.width*t,height:r.height*t,scale:r.scale}):BrowserDetect.isMobileSafari()?(t=n(),e=d(),{x:e.x,y:e.y,width:window.innerWidth*t,height:window.innerHeight*t,scale:n()}):(assert(!BrowserDetect.isMobile()),s())}function p(){var e=Util.getDeviceMetrics();return e.view_size=c(),e.visual_viewport=f(),e.controls_height=o(),e.controls_visible=a(),e}var _=this;_.clientToViewportCoords=function(e,t){var n,r,i=_.getVisualViewportScale();return BrowserDetect.isMobileSafari()?n={x:e*i,y:t*i}:BrowserDetect.isAndroidChrome()?(r=window.visualViewport,n={x:(e-r.offsetLeft)*i,y:(t-r.offsetTop)*i}):assert(0),assert("number"==typeof n.x&&"number"==typeof n.y),n},_.getLayoutViewportBounds=r,_.getMinMaxVisualViewportHeight=i,_.getVisualViewportMetrics=f,_.getVisualViewportScale=n,_.getAllMetrics=p,_.getDocumentScrollPos=u,_.getVisualViewportOffsetSafari=d},MetricsUtils=new MetricsUtilsClass,Resource=Object.freeze({videoDataUri:"data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAwJtZGF0AAACrQYF//+p3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjYzOCA3NTk5MjEwIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNSAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTEgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTIgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD00MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIzLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAfZYiEABX//vfJ78Cm69vetb+Tz0j4e8ZQD6wZq+vdsQAAAApBmiNsQS/+tTlYAAAACEGeQniCXwN/AAAACAGeYXRBLwN+AAADQ21vb3YAAABsbXZoZAAAAAAAAAAAAAAAAAAAA+gAAAfQAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAJtdHJhawAAAFx0a2hkAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAfQAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAA4AAAAKgAAAAAAJGVkdHMAAAAcZWxzdAAAAAAAAAABAAAH0AAAQAAAAQAAAAAB5W1kaWEAAAAgbWRoZAAAAAAAAAAAAAAAAAAAQAAAAIAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAZBtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAFQc3RibAAAAJhzdHNkAAAAAAAAAAEAAACIYXZjMQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAA4ACoASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAADJhdmNDAWQACv/hABlnZAAKrNlEflkwEQAAAwABAAADAAQPEiWWAQAGaOvjyyLAAAAAGHN0dHMAAAAAAAAAAQAAAAQAACAAAAAAFHN0c3MAAAAAAAAAAQAAAAEAAAAwY3R0cwAAAAAAAAAEAAAAAQAAQAAAAAABAACAAAAAAAEAAEAAAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAQAAAABAAAAJHN0c3oAAAAAAAAAAAAAAAQAAALUAAAADgAAAAwAAAAMAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjIzLjEwMQ=="});!function(e){function t(e){for(var t,n=e.length,r=-1,i="";++r<n;)t=e[r],t>65535&&(t-=65536,i+=l(t>>>10&1023|55296),t=56320|1023&t),i+=l(t);return i}function n(e){if(e>=55296&&57343>=e)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function r(){if(c>=s)throw Error("Invalid byte index");var e=255&a[c];if(c++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function i(){var e,t,i,o,l;if(c>s)throw Error("Invalid byte index");if(c==s)return!1;if(e=255&a[c],c++,0==(128&e))return e;if(192==(224&e)){if(t=r(),l=(31&e)<<6|t,l>=128)return l;throw Error("Invalid continuation byte")}if(224==(240&e)){if(t=r(),i=r(),l=(15&e)<<12|t<<6|i,l>=2048)return n(l),l;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=r(),i=r(),o=r(),l=(7&e)<<18|t<<12|i<<6|o,l>=65536&&1114111>=l))return l;throw Error("Invalid UTF-8 detected")}function o(e){a=e,s=a.length,c=0;for(var n,r=[];(n=i())!==!1;)r.push(n);return t(r)}var a,s,c,l=String.fromCharCode;e.decodeByteArray=o}(this.utf8={}),Function.prototype.curry||(Function.prototype.curry=function(){var e=this,t=Array.prototype.slice.call(arguments);return function(){return e.apply(this,t.concat(Array.prototype.slice.call(arguments)))}});var Sk={Verb:Object.freeze({Save:0,SaveLayer:1,Restore:2,Concat:3,ClipRect:4,ClipRRect:5,ClipPath:6,ClipRegion:7,DrawArc:8,DrawAtlas:9,DrawDRRect:10,DrawText:11,DrawPosText:12,DrawPosTextH:13,DrawRegion:14,DrawTextOnPath:15,DrawTextBlob:16,DrawTextRSXform:17,DrawPatch:18,DrawPaint:19,DrawPoints:20,DrawRect:21,DrawPath:22,DrawOval:23,DrawRRect:24,DrawImage:25,DrawImageRect:26,DrawImageNine:27,DrawImageLattice:28,DrawVertices:29,DrawPicture:30,DrawAnnotation:31,DefineImage:32,DefineImageURL:33,DefinePath:34,DefineGlyph:35,DefineTextBlob:36,DefinePaint:37,DefinePicture:38,DefineRasterPicture:39,DefineDrawOps:40,EndDefinitions:41}),HT:{ElementType:Object.freeze({kUnknown:0,kFormControl:1}),FormControlElement:Object.freeze({Type:{kUnknown:0,kInput:1,kTextArea:2,kSelect:3,kContentEditable:4},Flags:{kDisabled:1,kReadOnly:2,kAutoComplete:4,kSupportsFocus:8,kAutoCapitalize:16,kRequired:32}}),InputElement:Object.freeze({Type:{kUnknown:0,kEmail:1,kFile:2,kMonth:3,kNumber:4,kPassword:5,kSearch:6,kTel:7,kText:8,kTime:9,kUrl:10,kWeek:11,kRange:12},Flags:{kAutoComplete:1}}),SelectItem:Object.freeze({Type:{kUnknown:0,kSeparator:1,kGroup:2,kOption:3},Flags:{kChecked:1,kEnabled:2,kInGroup:4}})},SaveLayerMask:Object.freeze({Flags:255,HasBounds:256,HasPaint:512,HasBackdrop:1024,DontClipToLayer:2048,HasClipMask:4096,HasClipMatrix:8192,ClipIntersectsBounds:16384}),TypeMask:Object.freeze({SetMatrix:16,Float16:32}),MatrixMask:Object.freeze({Translate:1,Scale:2,Affine:4,Perspective:8}),DrawImageMask:Object.freeze({HasPaint:1}),DrawImageRectMask:Object.freeze({Constraint:1,HasPaint:2,HasSrcRect:4}),DrawPictureMask:Object.freeze({HasMatrix:1<<21,HasPaint:1<<22}),ClipOp:Object.freeze({kDifference:0,kIntersect:1}),PathDirection:Object.freeze({kCW_Direction:0,kCCW_Direction:1}),FillRule:Object.freeze({kWinding:0,kEvenOdd:1,kInverseWinding:2,kInverseEvenOdd:3}),GlyphPositioning:Object.freeze({kDefault:0,kHorizontal:1,kFull:2}),NonDef:Object.freeze({kTextSize:1,kTextScaleX:2,kTextSkewX:4,kStrokeWidth:8,kStrokeMiter:16,kColor:32,kTypeface:64,kPathEffect:128,kShader:256,kMaskFilter:512,kColorFilter:1024,kRasterizer:2048,kImageFilter:4096,kDrawLooper:8192}),Color:Object.freeze({BLACK:4278190080,RED:4294901760,getAlpha:function(e){return e>>24&255},isTransparent:function(e){return 0===this.getAlpha(e)}}),GradientShader:Object.freeze({kHasPosition:2147483648,kHasLocalMatrix:1073741824,kHasColorSpace:536870912,kTileModeShift:8,kTileModeMask:15,kGradFlagsShift:0,kGradFlagsMask:255}),BlendMode:Object.freeze({kClear:0,kSrc:1,kDst:2,kSrcOver:3,kDstOver:4,kSrcIn:5,kDstIn:6,kSrcOut:7,kDstOut:8,kSrcATop:9,kDstATop:10,kXor:11,kPlus:12,kModulate:13,kScreen:14,kOverlay:15,kDarken:16,kLighten:17,kColorDodge:18,kColorBurn:19,kHardLight:20,kSoftLight:21,kDifference:22,kExclusion:23,kMultiply:24,kHue:25,kSaturation:26,kColor:27,kLuminosity:28}),PaintUsage:Object.freeze({kText:1,kGeometry:2,kImage:4,kPaint:8,kAll:4294967295}),TileMode:Object.freeze({kClamp:0,kRepeat:1}),PathVerb:Object.freeze({kMove:0,kLine:1,kQuad:2,kConic:3,kCubic:4,kClose:5}),RRectType:Object.freeze({kEmpty:0,kRect:1,kOval:2,kSimple:3,kNinePatch:4,kComplex:5,kLast:6}),FilterQuality:Object.freeze({kNone:0,kLow:1,kMedium:2,kHigh:3}),DefineImageExtra:Object.freeze({kHintLoadSync:1,kGIForWEBP:2}),PictureFlags:Object.freeze({kHasText:1,kHasPaths:2,kHasPictures:4,kHasImages:8,kHasFillGeometry:16,kHintDoNotCache:32,kHintDoNotRasterCache:64}),DebugFlags:Object.freeze({kDebugEnabled:1,kHighlightRasterCacheItems:2}),setDebugEnabled:function(e){e?this.debugFlags|=Sk.DebugFlags.kDebugEnabled:this.debugFlags&=~Sk.DebugFlags.kDebugEnabled;
},isDebugEnabled:function(){return!!(this.debugFlags&Sk.DebugFlags.kDebugEnabled)},setDebugFlags:function(e){this.debugFlags=e},getDebugFlags:function(){return this.debugFlags},setImageQuality:function(e,t){this.imageQuality=[t||e,e]},getImageQuality:function(){return this.imageQuality},setSubPixelPrecision:function(e){e!==this.subPixelPrecision&&(this.subPixelPrecision=Math.min(1,Math.max(e,1/64)),Sk.StrikeAtlasCache.flush())},getSubPixelPrecision:function(){return this.subPixelPrecision},init:function(e){var t;Sk.assert(Sk.maxRasterArea<=Sk.maxPlatformCanvasArea),Sk.assert(e);for(key in e)e.hasOwnProperty(key)&&(t=e[key],Sk.assert(t>0),this.canvasMemoryLimit[key]=t,this.canvasMemoryUsage[key]=0);Sk.StrikeAtlasCache=new Sk.StrikeAtlasCacheClass,Sk.RasterCache=new Sk.RasterCacheClass},fini:function(){var e;for(e in Sk.htmlCanvasDeviceById)Sk.htmlCanvasDeviceById.hasOwnProperty(e)&&Sk.htmlCanvasDeviceById[e].release()},flushCaches:function(){Sk.StrikeAtlasCache.flush(),Sk.RasterCache.flush()},decodeUTF8ByteArray:function(e){return window.TextDecoder?new window.TextDecoder("utf-8").decode(e):window.utf8.decodeByteArray(e)},nextCanvasId:0,nextHTMLCanvasDeviceId:0,nextRecordingId:0,nextImageId:0,debugFlags:0,subPixelPrecision:.5,maxSubPixelPrecision:1/64,maxPlatformCanvasArea:16777216,maxRasterArea:262144,imageQuality:[.8,.6],defaultMaxImageLoadRetries:3,defaultMaxConcurrentImageLoads:3,canvasMemoryUsage:{},canvasMemoryLimit:{},rasterCacheUseThreshold:2,htmlCanvasDeviceById:{}};Sk.Util={copyDict:function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n},updateDict:function(e,t){for(key in t)t.hasOwnProperty(key)&&(e[key]=t[key])},getImageFromU8Array:function(e,t){function n(e){Sk.assert(i.src),window.URL.revokeObjectURL(i.src),i.onload=i.onerror=null,t(i,e)}var r=new window.Blob([e],{type:"image/*"}),i=new Image;Sk.assert(t),i.onload=n.curry(!0),i.onerror=n.curry(!1),i.src=window.URL.createObjectURL(r)},setImageSmoothingEnabled:function(e,t){function n(){var t,n=["imageSmoothingEnabled","webkitImageSmoothingEnabled","msImageSmoothingEnabled","mozImageSmoothingEnabled"];for(t=0;t<n.length;t+=1)if(void 0!==e[n[t]])return n[t];return null}Sk.imageSmoothingVar||(Sk.imageSmoothingVar=n()),Sk.imageSmoothingVar&&(e[Sk.imageSmoothingVar]=t)}},Sk.Logger=function(e){function t(e,t){var n=t;"object"==typeof t&&(n=JSON.stringify(t)),console[e](n)}var n=this;n.debug=function(e){},n.info=function(e){t("log",e)},n.warn=function(e){t("warn",e)},n.error=function(e){t("error",e)}},Sk.fatal=function(e,t){throw{event:"fatal-error",error:e,details:t?JSON.stringify(t):void 0}},Sk.assert=function(e,t){if(!e)throw"string"!=typeof t&&(t=JSON.stringify(t)),{event:"assert-failed",details:t,stack:window.Error?window.Error().stack:void 0}},Sk.assertUnimplemented=function(){},Sk.LRU=function(e,t){function n(e){e!==o&&(e.newer&&(e===i&&(i=e.newer),e.newer.older=e.older),e.older&&(e.older.newer=e.newer),e.newer=null,e.older=o,o&&(o.newer=e),o=e)}function r(){Sk.assert("number"==typeof e&&e>0)}var i,o,a=this,s=(new Sk.Logger("sk-lru",{level:"info"}),{}),c=0,l=0;a.size=function(){return Sk.assert(c>=0),c},a.cost=function(){return Sk.assert(l>=0),l},a.forEachEntry=function(e){var t;for(t in s)s.hasOwnProperty(t)&&e(t,s[t])},a.updateCost=function(t,n){var r=s[t];if(!r)throw"key not found";for(l-=r.cost,r.cost=n,l+=r.cost;l>e&&a.shift(););},a.reserve=function(t){for(Sk.assert(t>=0),Sk.assert(e>=l);l+t>e;)if(!a.shift())return!1;return!0},a.add=function(t,n,r){var d=s[t];if(d)throw"entry already exists";if((void 0===r||null===r)&&(r=1),Sk.assert(r>=0),r>e)return null;for(s[t]=d={key:t,value:n,cost:r},o?(o.newer=d,d.older=o):i=d,o=d,c+=1,l+=r;l>e;)a.shift();return d},a.peek=function(e){return s[e]},a.get=function(e){var t=s[e];if(t)return n(t),t},a.detach=function(e){var t=s[e];if(t)return t.newer&&t.older?(t.older.newer=t.newer,t.newer.older=t.older):t.newer?(t.newer.older=null,i=t.newer):t.older?(t.older.newer=null,o=t.older):i=o=null,delete s[e],c-=1,l-=t.cost,t},a.remove=function(e){var n=a.detach(e);if(n)return t&&t(n),n},a.shift=function(){return i?a.remove(i.key):null},a.clear=function(){for(;a.shift(););Sk.assert(0===c),Sk.assert(0===l),Sk.assert(!i&&!o)},r()},Sk.Matrix={isValid:function(e){return"object"==typeof e&&9===e.length},identity:function(){var e=[];return mat3.identity(e),e},fromMat2D:function(e){var t=[];return Sk.assert(6===e.length),mat3.fromMat2d(t,e),t},toMat2D:function(e){Sk.assert(this.isValid(e));var t=[];return t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t[4]=e[6],t[5]=e[7],t},makeScale:function(e,t){var n=[];return Sk.assert("number"==typeof e&&"number"==typeof t),mat3.fromScaling(n,[e,t])},multiply:function(e,t){var n=[];return Sk.assert(9===e.length),Sk.assert(9===t.length),mat3.multiply(n,e,t),n},postScale:function(e,t,n){var r=[];return mat3.multiply(r,this.makeScale(t,n),e),r},copy:function(e,t){Sk.assert(9===e.length),Sk.assert(9===t.length),mat3.copy(e,t)},getScaleX:function(e){return e[0]},getScaleY:function(e){return e[4]},getSkewX:function(e){return e[3]},getSkewY:function(e){return e[1]},setTranslate:function(e,t,n){Sk.assert(9===e.length),e[6]=t,e[7]=n},hasPerspective:function(e){return Sk.assert(9===e.length),0!==e[2]||0!==e[5]||1!==e[8]},getScaleSkewKey:function(e){function t(e){return Math.round(1024*e)/1024}return""+t(Sk.Matrix.getScaleX(e))+t(Sk.Matrix.getSkewX(e))+t(Sk.Matrix.getSkewY(e))+t(Sk.Matrix.getScaleY(e))},asString:function(e){return e.join(":")},getDecomposedScale:function(e){var t,n;return Sk.assert(9===e.length),0===Sk.Matrix.getSkewX(e)&&0===Sk.Matrix.getSkewY(e)?(t=Sk.Matrix.getScaleX(e),n=Sk.Matrix.getScaleY(e)):Sk.Matrix.hasPerspective(e)?t=n=1:(t=vec2.length([Sk.Matrix.getScaleX(e),Sk.Matrix.getSkewY(e)]),n=vec2.length([Sk.Matrix.getSkewX(e),Sk.Matrix.getScaleY(e)])),[t,n]},mapVector:function(e,t,n){var r,i=[],o=[];return Sk.assert(9===e.length),Sk.assert(3===t.length),void 0!==n?(i=vec3.transformMat3(i,t,e),r=[i[0]/i[2],i[1]/i[2]],vec2.subtract(r,r,n)):(mat3.copy(o,e),Sk.Matrix.setTranslate(o,0,0),i=vec3.transformMat3(i,t,o),r=[i[0]/i[2],i[1]/i[2]]),r},mapRadius:function(e,t){var n,r,i,o,a=[t,0,1],s=[0,t,1];return Sk.assert(9===e.length),Sk.Matrix.hasPerspective(e)&&(o=vec3.transformMat3(o,[0,0,1],e),i=[o[0]/o[2],o[1]/o[2]]),n=Sk.Matrix.mapVector(e,a,i),r=Sk.Matrix.mapVector(e,s,i),Math.sqrt(vec2.length(n)*vec2.length(r))},mapPoints:function(e,t){var n,r,i,o,a=[];for(n=0;n<t.length;n+=1)r=t[n],i=[r[0],r[1],1],o=[],vec3.transformMat3(o,i,e),a.push([o[0],o[1]]);return a},mapRect:function(e,t){return Sk.Rect.bboxRect(Sk.Matrix.mapPoints(e,Sk.Rect.toQuad(t)))},isValid:function(e){return"object"==typeof e&&9===e.length}},Sk.Paint=new function(){var e=this;e.Flags=Object.freeze({kAntiAlias:1,kDither:4,kFakeBoldText:32,kLinearText:64,kSubpixelText:128,kDevKernText:256,kLCDRenderText:512,kEmbeddedBitmapText:1024,kAutoHinting:2048,kVerticalText:4096,kAllFlags:65535}),e.Align=Object.freeze({kLeft:0,kCenter:1,kRight:2}),e.Hinting=Object.freeze({kNo:0,kSlight:1,kNormal:2,kFull:3}),e.Style=Object.freeze({kFill_Style:0,kStroke_Style:1,kStrokeAndFill_Style:2}),e.Cap=Object.freeze({kButt:0,kRound:1,kSquare:2}),e.Join=Object.freeze({kMiter:0,kRound:1,kBevel:2}),e.TextEncoding=Object.freeze({kUTF8:0,kUTF16:1,kUTF32:2,kGlyphID:3}),e.skColorToCSSColor=function(e){var t=e>>16&255,n=e>>8&255,r=255&e,i=e>>24&255,o=t+","+n+","+r+","+i/255;return"rgba("+o+")"},e.skColorToCanvasAlpha=function(e){return(e>>24&255)/255},e.skFillRuleToCanvasFillRule=function(e){switch(e){case Sk.FillRule.kWinding:return"nonzero";case Sk.FillRule.kEvenOdd:return"evenodd";default:return"nonzero"}},e.skFilterQualityToCanvasFilterQuality=function(e){switch(e){case Sk.FilterQuality.kNone:return"none";case Sk.FilterQuality.kLow:return"low";case Sk.FilterQuality.kMedium:return"medium";case Sk.FilterQuality.kHigh:return"high"}return Sk.assert(0),null},e.skBlendModeToCompositeOp=function(e){switch(e){case Sk.BlendMode.kClear:return"clear";case Sk.BlendMode.kSrc:return"copy";case Sk.BlendMode.kSrcOver:return"source-over";case Sk.BlendMode.kDstOver:return"destination-over";case Sk.BlendMode.kSrcIn:return"source-in";case Sk.BlendMode.kDstIn:return"destination-in";case Sk.BlendMode.kSrcOut:return"source-out";case Sk.BlendMode.kDstOut:return"destination-out";case Sk.BlendMode.kSrcATop:return"source-atop";case Sk.BlendMode.kDstATop:return"destination-atop";case Sk.BlendMode.kXor:return"xor";case Sk.BlendMode.kPlus:return"screen";case Sk.BlendMode.kScreen:return"screen";case Sk.BlendMode.kOverlay:return"overlay";case Sk.BlendMode.kDarken:return"darken";case Sk.BlendMode.kLighten:return"lighten";case Sk.BlendMode.kColorDodge:return"color-dodge";case Sk.BlendMode.kColorBurn:return"color-burn";case Sk.BlendMode.kHardLight:return"hard-light";case Sk.BlendMode.kSoftLight:return"soft-light";case Sk.BlendMode.kDifference:return"difference";case Sk.BlendMode.kExclusion:return"exclusion";case Sk.BlendMode.kMultiply:return"multiply";case Sk.BlendMode.kHue:return"hue";case Sk.BlendMode.kSaturation:return"saturation";case Sk.BlendMode.kColor:return"color";case Sk.BlendMode.kLuminosity:return"luminosity";default:return Sk.assertUnimplemented({event:"unknown-sk-blend-mode",blend_mode:e}),"source-over"}},e.skStrokeCapToCanvasLineCap=function(t){switch(t){case e.Cap.kButt:return"butt";case e.Cap.kRound:return"round";case e.Cap.kSquare:return"square";default:return Sk.assertUnimplemented({event:"unknown-stroke-cap",cap:t}),"butt"}},e.skStrokeJoinToCanvasLineJoin=function(t){switch(t){case e.Join.kMiter:return"miter";case e.Join.kRound:return"round";case e.Join.kBevel:return"bevel";default:return Sk.assertUnimplemented({event:"unknown-stroke-join",join:t}),"miter"}},e.populatePaintStrings=function(t){return t.filterQualityStr=e.skFilterQualityToCanvasFilterQuality(t.filterQuality),t.strokeCapStr=e.skStrokeCapToCanvasLineCap(t.strokeCap),t.strokeJoinStr=e.skStrokeJoinToCanvasLineJoin(t.strokeJoin),t.blendModeStr=e.skBlendModeToCompositeOp(t.blendMode),t.cssColor=e.skColorToCSSColor(t.color),t.alphaFloat=e.skColorToCanvasAlpha(t.color),t},e.Default=Object.freeze(e.populatePaintStrings({color:4278190080,blendMode:Sk.BlendMode.kSrcOver,filterQuality:Sk.FilterQuality.kNone,style:0,strokeWidth:0,strokeMiter:4,strokeCap:0,strokeJoin:0})),e.makePaint=function(t){var n=Sk.Util.copyDict(e.Default);return Sk.Util.updateDict(n,t),Object.freeze(e.populatePaintStrings(n))},e.kTextFields=Object.freeze(["flags","typeface","textSize","textScaleX","textSkewX","textAlign","hinting","textEncoding"]),e.isValidTextPaint=function(t){var n;for(n=0;n<e.kTextFields.length;n+=1)if(void 0===t[e.kTextFields[n]])return!1;return!0},e.flagsToString=function(t){var n,r=[];for(n in e.Flags)e.Flags.hasOwnProperty(n)&&t.flags&e.Flags[n]&&r.push(n);return r},e.buildTypefaceDescriptor=function(e){var t=""+e.flags+e.textSize+e.textScaleX+e.textSkewX+e.textAlign+e.hinting+e.textEncoding+e.color+e.style+e.strokeWidth+e.strokeMiter;return e.typeface&&(t+=e.typeface.id),t},e.applyTextRunPaint=function(t,n){var r,i=e.kTextFields;for(Sk.assert(e.isValidTextPaint(n)),r=0;r<i.length;r+=1)t[i[r]]=n[i[r]];t.typeface_desc=e.buildTypefaceDescriptor(t)},e.isValid=function(t){function n(e,t){var n;for(n in e)if(e.hasOwnProperty(n)&&e[n]===t)return!0;return!1}return n(e.Style,t.style)&&n(e.Align,t.textAlign)&&n(e.Hinting,t.hinting)&&n(e.TextEncoding,t.textEncoding)},e.kCanonicalTextSizeForPaths=64},Sk.Point={fromXY:function(e,t){return[e,t]},isValid:function(e){return"object"==typeof e&&2===e.length}},Sk.Quad=new function(){var e=this;e.isRect=function(e){return e[0][0]===e[3][0]&&e[1][0]===e[2][0]&&e[0][1]===e[1][1]&&e[2][1]===e[3][1]}},Sk.Region=new function(){var e=this;new Sk.Logger("region",{level:"info"});e.makeEmpty=function(){return[]},e.makeRect=function(e){return[e]},e.makeCopy=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(Sk.Rect.makeCopy(e[t]));return n},e.isEmpty=function(e){return 0===e.length},e.addRect=function(e,t){var n,t,r=!0;if(Sk.assert(Sk.Rect.isValid(t)),Sk.Rect.isEmpty(t))return e;for(n=0;n<e.length;n+=1)if(Sk.Rect.intersects(t,e[n])){r=!1,Sk.Rect.join(e[n],t);break}return r&&e.push(t),e},e.subtractRect=function(e,t){var n,r,i;for(Sk.assert(Sk.Rect.isValid(t)),n=e.length-1;n>=0;n-=1)if(r=e[n],Sk.Rect.contains(t,r))e.splice(n,1);else if(i=Sk.Rect.intersection(r,t),!Sk.Rect.isEmpty(i)){var o=Sk.Rect.getLeft(r),a=Sk.Rect.getTop(r),s=Sk.Rect.getRight(r),c=Sk.Rect.getBottom(r),l=Sk.Rect.getLeft(i),d=Sk.Rect.getTop(i),u=Sk.Rect.getRight(i),f=Sk.Rect.getBottom(i),p=[Sk.Rect.fromLTRB(o,a,l,c),Sk.Rect.fromLTRB(l,a,u,d),Sk.Rect.fromLTRB(l,f,u,c),Sk.Rect.fromLTRB(u,a,s,c)];e.splice(n,1),p.forEach(function(t){Sk.Rect.isEmpty(t)||e.push(t)})}return e},e.addRegion=function(t,n){var r;for(r=0;r<n.length;r+=1)e.addRect(t,n[r])},e.getBoundingRect=function(e){var t,n=Sk.Rect.makeEmpty();for(t=0;t<e.length;t+=1)Sk.Rect.join(n,e[t]);return n},e.iterateSafeFromUpdate=function(t,n){var r,i=e.makeCopy(t);for(r=0;r<i.length;r+=1)n(i[r])}},Sk.Rect={toXYWH:function(e){Sk.assert(this.isValid(e));var t=e[0],n=e[1],r=e[2]-e[0],i=e[3]-e[1];return[t,n,r,i]},toQuad:function(e){var t=[];return t.push([e[0],e[1]]),t.push([e[2],e[1]]),t.push([e[2],e[3]]),t.push([e[0],e[3]]),t},toString:function(e){return e[0]+":"+e[1]+":"+e[2]+":"+e[3]},toCSSStyle:function(e,t){t.left=Sk.Rect.getLeft(e)+"px",t.top=Sk.Rect.getTop(e)+"px",t.width=Sk.Rect.getWidth(e)+"px",t.height=Sk.Rect.getHeight(e)+"px"},fromQuad:function(e){return this.bboxRect(e)},fromXYWH:function(e,t,n,r){return[e,t,e+n,t+r]},fromWH:function(e,t){return[0,0,e,t]},fromLTRB:function(e,t,n,r){return[e,t,n,r]},fromRect:function(e){return[e[0],e[1],e[2],e[3]]},set:function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},setXYWH:function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=t+r,e[3]=n+i,e},setEmpty:function(e){return e[0]=e[1]=e[2]=e[3]=0,e},bboxRect:function(e){var t,n,r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(Sk.assert(r&&o&&i&&a),!e.length)return[0,0,0,0];for(t=0;t<e.length;t+=1)n=e[t],r=Math.min(r,n[0]),o=Math.min(o,n[1]),i=Math.max(i,n[0]),a=Math.max(a,n[1]);return[r,o,i,a]},roundOut:function(e){return this.fromLTRB(Math.floor(e[0]),Math.floor(e[1]),Math.ceil(e[2]),Math.ceil(e[3]))},roundOut0:function(e){return Sk.assert(this.isValid(e)),e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3]),e},makeCopy:function(e){return[e[0],e[1],e[2],e[3]]},makeEmpty:function(){return[0,0,0,0]},makeLargest:function(){return[-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE]},makeOffset:function(e,t,n){return this.set(e,e[0]+t,e[1]+n,e[2]+t,e[3]+n)},moveToOrigin:function(e){return this.makeOffset(e,-this.getX(e),-this.getY(e))},isEmpty:function(e){return Sk.assert(4===e.length),e[2]-e[0]<=0||e[3]-e[1]<=0},isValid:function(e){return"object"==typeof e&&4===e.length},isIntRect:function(e){return Sk.Rect.equals(e,Sk.Rect.roundOut(e))},isSizeEqual:function(e,t){return Sk.Rect.getWidth(e)===Sk.Rect.getWidth(t)&&Sk.Rect.getHeight(e)===Sk.Rect.getHeight(t)},getArea:function(e){return Sk.Rect.getWidth(e)*Sk.Rect.getHeight(e)},getX:function(e){return e[0]},getY:function(e){return e[1]},getLeft:function(e){return this.getX(e)},getTop:function(e){return this.getY(e)},getRight:function(e){return e[2]},getBottom:function(e){return e[3]},getWidth:function(e){return e[2]-e[0]},getHeight:function(e){return e[3]-e[1]},getOvalRadii:function(e){var t,n;return Sk.assert(this.isValid(e)),t=this.getWidth(e)/2,n=this.getHeight(e)/2,[t,n,t,n,t,n,t,n]},getCenter:function(e){return[this.getX(e)+this.getWidth(e)/2,this.getY(e)+this.getHeight(e)/2]},resize:function(e,t){return[e[0]-t,e[1]-t,e[2]+t,e[3]+t]},equals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},isEqual:function(e,t){return this.equals(e,t)},intersects:function(e,t){return Sk.assert(this.isValid(e)),Sk.assert(this.isValid(t)),this.getLeft(e)<=this.getRight(t)&&this.getRight(e)>=this.getLeft(t)&&this.getTop(e)<=this.getBottom(t)&&this.getBottom(e)>=this.getTop(t)},intersection:function(e,t){var n,r,i,o;return Sk.assert(this.isValid(e)&&this.isValid(t),{a:e,b:t}),Sk.Rect.isEmpty(e)||Sk.Rect.isEmpty(t)?n=r=i=o=0:(n=Math.max(Sk.Rect.getX(e),Sk.Rect.getX(t)),r=Math.max(Sk.Rect.getY(e),Sk.Rect.getY(t)),i=Math.min(Sk.Rect.getRight(e),Sk.Rect.getRight(t)),o=Math.min(Sk.Rect.getBottom(e),Sk.Rect.getBottom(t))),(n>=i||r>=o)&&(n=r=i=o=0),this.fromXYWH(n,r,i-n,o-r)},contains:function(e,t){return Sk.assert(this.isValid(e)&&this.isValid(t)),Sk.Rect.getX(t)>=Sk.Rect.getX(e)&&Sk.Rect.getRight(t)<=Sk.Rect.getRight(e)&&Sk.Rect.getY(t)>=Sk.Rect.getY(e)&&Sk.Rect.getBottom(t)<=Sk.Rect.getBottom(e)},containsPoint:function(e,t){return Sk.assert("number"==typeof t.x&&"number"==typeof t.y),this.contains(e,this.fromXYWH(t.x,t.y,0,0))},join:function(e,t){return Sk.assert(this.isValid(e)&&this.isValid(t)),this.getLeft(t)>=this.getRight(t)||this.getTop(t)>=this.getBottom(t)?e:this.getLeft(e)>=this.getRight(e)||this.getTop(e)>=this.getBottom(e)?this.set(e,this.getLeft(t),this.getTop(t),this.getRight(t),this.getBottom(t)):this.set(e,Math.min(this.getLeft(e),this.getLeft(t)),Math.min(this.getTop(e),this.getTop(t)),Math.max(this.getRight(e),this.getRight(t)),Math.max(this.getBottom(e),this.getBottom(t)))},subtract:function(e,t){var n=this.getX(e),r=this.getY(e),i=this.getRight(e),o=this.getBottom(e);return this.intersects(e,t)?this.contains(t,e)?this.set(e,0,0,0,0):(Sk.Rect.getY(t)<=r&&Sk.Rect.getBottom(t)>=o?Sk.Rect.getX(t)<=n?n=Sk.Rect.getRight(t):Sk.Rect.getRight(t)>=i&&(i=Sk.Rect.getX(t)):Sk.Rect.getX(t)<=n&&Sk.Rect.getRight(t)>=i&&(Sk.Rect.getY(t)<=r?r=Sk.Rect.getBottom(t):Sk.Rect.getBottom(t)>=o&&(o=Sk.Rect.getY(t))),this.set(e,n,r,i,o)):e},scaleXY:function(e,t,n){return 1===t&&1===n?Sk.Rect.makeCopy(e):Sk.Matrix.mapRect(Sk.Matrix.makeScale(t,n),e)},scale:function(e,t){return this.scaleXY(e,t,t)},translate:function(e,t,n){return Sk.assert("number"==typeof t),Sk.assert("number"==typeof n),e[this.LEFT]+=t,e[this.RIGHT]+=t,e[this.TOP]+=n,e[this.BOTTOM]+=n,e},LEFT:0,TOP:1,RIGHT:2,BOTTOM:3},Sk.Radii={isValid:function(e){return e&&8===e.length},getUpperLeftX:function(e){return e[0]},getUpperLeftY:function(e){return e[1]},getUpperRightX:function(e){return e[2]},getUpperRightY:function(e){return e[3]},getLowerRightX:function(e){return e[4]},getLowerRightY:function(e){return e[5]},getLowerLeftX:function(e){return e[6]},getLowerLeftY:function(e){return e[7]},resize:function(e,t){var n,r=[];if(!this.isValid(e))return e;for(n=0;n<e.length;n++)r.push(e[n]+t);return r}},Sk.Conic={isValid:function(e){return 7===e.length},chop:function(e){var t=1,n=.5,r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],d=t/(t+l),u=Math.sqrt(n+l*n),f=l*o,p=l*a,_=(r+f+f+s)*d*n,g=(i+p+p+c)*d*n,h=(r+f)*d,m=(i+p)*d,v=(f+s)*d,y=(p+c)*d,w=[];return w[0]=[r,i,0,0,0,0,u],w[0][2]=h,w[0][3]=m,w[0][4]=_,w[0][5]=g,w[1]=[0,0,0,0,s,c,u],w[1][0]=_,w[1][1]=g,w[1][2]=v,w[1][3]=y,w},getP0X:function(e){return Sk.assert(this.isValid(e)),e[0]},getP0Y:function(e){return Sk.assert(this.isValid(e)),e[1]},getP1X:function(e){return Sk.assert(this.isValid(e)),e[2]},getP1Y:function(e){return Sk.assert(this.isValid(e)),e[3]},getP2X:function(e){return Sk.assert(this.isValid(e)),e[4]},getP2Y:function(e){return Sk.assert(this.isValid(e)),e[5]},setP0X:function(e,t){Sk.assert(this.isValid(e)),e[0]=t},setP0Y:function(e,t){Sk.assert(this.isValid(e)),e[1]=t},setP1X:function(e,t){Sk.assert(this.isValid(e)),e[2]=t},setP1Y:function(e,t){Sk.assert(this.isValid(e)),e[3]=t},setP2X:function(e,t){Sk.assert(this.isValid(e)),e[4]=t},setP2Y:function(e,t){Sk.assert(this.isValid(e)),e[5]=t},between:function(e,t,n){return 0>=(e-t)*(n-t)},subdivide:function(e,t,n){var r,i,o,a,s=[];return Sk.assert(n>=0),0===n?(t.push(this.getP1X(e)),t.push(this.getP1Y(e)),t.push(this.getP2X(e)),void t.push(this.getP2Y(e))):(s=this.chop(e),Sk.assert(2===s.length),r=this.getP0Y(e),i=this.getP2Y(e),this.between(r,this.getP1Y(e),i)&&(o=this.getP2Y(s[0]),this.between(r,o,i)||(a=Math.abs(o-r)<Math.abs(o-i)?r:i,this.setP2Y(s[0],a),this.setP0Y(s[1],a)),this.between(r,this.getP1Y(s[0]),this.getP2Y(s[0]))||this.setP1Y(s[0],r),this.between(this.getP0Y(s[1]),this.getP1Y(s[1]),i)||this.setP1Y(s[1],i),Sk.assert(this.between(r,this.getP1Y(s[0]),this.getP2Y(s[0]))),Sk.assert(this.between(this.getP1Y(s[0]),this.getP2Y(s[0]),this.getP1Y(s[1]))),Sk.assert(this.between(this.getP2Y(s[0]),this.getP1Y(s[1]),i))),--n,this.subdivide(s[0],t,n),void this.subdivide(s[1],t,n))},convertConicToQuads:function(e,t){var n=[];return Sk.assert(1===t),n.push(this.getP0X(e)),n.push(this.getP0Y(e)),this.subdivide(e,n,t),Sk.assert(n.length==2*(2*(1<<t)+1)),n}},Sk.ImageLoader=function(e,t,n){function r(e){return"blob:"===e.slice(0,5)}function i(e,i,s){var c=n;return Sk.assert(i.src&&i.completion_cb),e=e&&i.complete,r(i.src)?window.URL.revokeObjectURL(i.src):(f-=1,a()),i.onload=i.onerror=null,e?void i.completion_cb(!0,i):s?(void 0===c&&(c=1e3*Math.pow(2,Math.max(0,t-s))),l.warn({event:"image-load-needs-retry",src:i.src,retries_left:s,delay_ms:c}),void setTimeout(function(){o(i.src,i.completion_cb,s-1)},c)):(l.error({event:"image-load-failed",src:i.src}),void i.completion_cb(!1,i))}function o(e,n,o){var a=new Image;Sk.assert(e&&n),a.completion_cb=n,void 0===o&&(o=t),a.onload=i.curry(!0,a,o),a.onerror=i.curry(!1,a,o),a.src=e,r(e)||(f+=1,p+=1)}function a(){var t,n,r,i=e(u,p),s=!1;for(Sk.assert(i),c&&(clearTimeout(c),c=null),n=0;n<u.length;n+=1){for(r="number"==typeof i[n]?i[n]:Sk.defaultMaxConcurrentImageLoads;u[n].length&&r>f;)t=u[n].shift(),o(t[0],t[1]);u[n].length&&(s=!0)}s&&!c&&(c=setTimeout(function(){a()},200))}function s(){Sk.assert(e),void 0===t&&(t=Sk.defaultMaxImageLoadRetries),Sk.assert(void 0!==t)}var c,l=new Sk.Logger("sk-image-loader",{level:"info"}),d=this,u=[[],[]],f=0,p=0;d.submit=function(e,t,n){Sk.assert(t<=u.length),u[t].push([e,n]),a()},s()},Sk.Image=function(e,t,n,r,i){function o(e){var t,n;m=p.kCompleted,v=e;for(t in h)h.hasOwnProperty(t)&&(n=h[t],delete h[t],n(f))}function a(e){return"blob:"===e.slice(0,5)}function s(e,n,r){return Sk.assert("number"==typeof e&&r.src&&r.complete),a(r.src)&&window.URL.revokeObjectURL(r.src),n?(Sk.assert(!_[e]),_[e]=r,g+=1,void(g===t&&o(!0))):(u.error({event:"image-load-failed",frame_idx:e,image:f.asDict()}),void o(!1))}function c(e,t){var o=t,c=r;Sk.assert(t),_[e]||(0===e&&(c=n),a(t)||(o=t+"?fi="+e+"&q="+c),i.submit(o,0===e?0:1,s.curry(e)))}function l(){Sk.assert(r>=0&&1>=r),Sk.assert(i),a(e)&&(t=1),d=Sk.nextImageId,Sk.nextImageId+=1}var d,u=new Sk.Logger("sk-image",{level:"info"}),f=this,p={kNotStarted:0,kStarted:1,kCompleted:2},_={},g=0,h={},m=p.kNotStarted,v=!0;f.setCompletionCallback=function(e,t){Sk.assert(t),Sk.assert(void 0!==e),h[e]=t},f.startLoading=function(n){var r;if(m!==p.kNotStarted)throw"load already pending or completed";if(m=p.kStarted,n&&f.setCompletionCallback("startLoading",n),a(e))Sk.assert(1===t),c(0,e);else for(r=0;t>r;r+=1)c(r,e)},f.isComplete=function(){return m===p.kCompleted},f.isSuccess=function(){return!!v},f.asDict=function(){return{id:d,url:e,frame_count:t,load_state:m,load_success:v,nr_frames_loaded:g}},f.getFrame=function(t){return Sk.assert(void 0!==t&&t>=0),f.isSuccess()?(a(e)&&(t=0),Sk.assert(!f.isComplete()||_[t],{missing_frame:t,image:f.asDict()}),_[t]):null},l()},Sk.AtlasTexture=function(e,t){function n(){if(e=Math.ceil(e),t=Math.ceil(t),!(e*t))throw"invalid plot dims";r=Math.floor(l/e),i=Math.floor(d/t),Sk.assert(r>=1&&i>=1),o=Sk.Rect.fromWH(e*r,t*i),Sk.assert(Sk.Rect.isValid(o),{bounds:o}),s=r*i,a=new Sk.HTMLCanvasDevice("atlas-tex",o,{x:0,y:0},1)}var r,i,o,a,s,c=(new Sk.Logger("atlas-texture",{level:"info"}),this),l=Math.max(256,Math.ceil(e)),d=Math.max(256,Math.ceil(t)),u=0;c.hasSpace=function(){return s-u>0},c.getDevice=function(){return a},c.allocPlot=function(){var n,i,o=u;if(o===s)throw"atlas texture is out of space";return u+=1,n=Math.floor(o/r),i=o%r,Sk.Rect.fromXYWH(i*e,n*t,e,t)},c.release=function(){a.release(),a=null,s=0},c.memoryUsedInBytes=function(){return a.getMemoryUsage()},c.tryAlloc=function(){return a.tryAlloc()},n()},Sk.Atlas=function(e){var t=(new Sk.Logger("atlas",{level:"info"}),this),n=[];t.allocPlot=function(){var t=n[n.length-1];if(!t||!t.hasSpace()){if(t=new Sk.AtlasTexture(Sk.Rect.getWidth(e),Sk.Rect.getHeight(e)),!t.tryAlloc())return null;n.push(t)}return{device:t.getDevice(),bounds:t.allocPlot()}},t.release=function(){var e;for(e=0;e<n.length;e+=1)n[e].release();n=null},t.memoryUsedInBytes=function(){var e,t=0;for(e=0;e<n.length;e+=1)t+=n[e].memoryUsedInBytes();return t},Sk.assert(Sk.Rect.isValid(e)&&!Sk.Rect.isEmpty(e),{bounds:e})},Sk.StrikeAtlas=function(e,t){function n(t){var n=e.paint.strokeWidth||1;return Sk.Rect.moveToOrigin(Sk.Rect.roundOut0(Sk.Rect.resize(Sk.Rect.scaleXY(t,f[0],f[1]),+n)))}function r(t,r,i,o){var a=Sk.Rect.roundOut0(Sk.Rect.scale(r.bounds,d)),s=n(a),c=t.device;return c.save(),c.translate(Sk.Rect.getX(t.bounds),Sk.Rect.getY(t.bounds)),c.scale(f[0],f[1]),c.translate(-Sk.Rect.getX(a)+i,-Sk.Rect.getY(a)+o),c.scale(d,d),c.drawPath(r.path,e.paint,void 0,void 0,!0),c.restore(),{device:c,r_scaled_bounds:a,src_rect:Sk.Rect.makeOffset(Sk.Rect.makeCopy(s),Sk.Rect.getX(t.bounds),Sk.Rect.getY(t.bounds)),dst_rect:Sk.Rect.scaleXY(s,1/f[0],1/f[1])}}function i(e){var n=100*t;return Math.round(100*e/n)*n/100}function o(){var n=Sk.Rect.roundOut0(Sk.Rect.scaleXY(e.paint.typeface.fontBounds,f[0],f[1]));Sk.assert(Sk.Strike.isValid(e)),p.hit_count=0,p.miss_count=0,p.lookups_by_glyph_id={},a=new Sk.Atlas(n),t<Sk.maxSubPixelPrecision&&s.error({event:"ineffective-subpixel-precision",precision:t,max:Sk.maxSubPixelPrecision}),t=Math.min(1,Math.max(t,Sk.maxSubPixelPrecision))}var a,s=new Sk.Logger("glyph-atlas",{level:"info"}),c=this,l={},d=e.paint.textSize/Sk.Paint.kCanonicalTextSizeForPaths,u=Sk.Matrix.getDecomposedScale(e.device_matrix),f=[u[0]*e.dsf,u[1]*e.dsf],p=([d*f[0],d*f[1]],{});c.getGlyphBitmap=function(e,t,n){var o,s,c;return t=t?i(t):t,n=n?i(n):n,o=e.id+":"+t+":"+n,p.lookups_by_glyph_id.hasOwnProperty(e.id)?p.lookups_by_glyph_id[e.id]+=1:p.lookups_by_glyph_id[e.id]=1,(s=l[o])?(p.hit_count+=1,s):(c=a.allocPlot())?(s=r(c,e,t,n),l[o]=s,p.miss_count+=1,s):null},c.release=function(){a.release(),a=null,l=null},c.memoryUsedInBytes=function(){return a.memoryUsedInBytes()},c.getStrike=function(){return e},o()},Sk.Strike={make:function(e,t,n){return{paint:e,device_matrix:t,dsf:n}},getKey:function(e){return Sk.assert(this.isValid(e)),e.paint.typeface_desc+":"+Sk.Matrix.getScaleSkewKey(e.device_matrix)+":"+e.dsf},isValid:function(e){return Sk.Paint.isValidTextPaint(e.paint)&&Sk.Matrix.isValid(e.device_matrix)&&"number"==typeof e.dsf&&e.dsf>=0}},Sk.StrikeAtlasCacheClass=function(){var e=this,t=(new Sk.Logger("strike-atlas-cache",{level:"info"}),Sk.canvasMemoryLimit["atlas-tex"]),n=new Sk.LRU(t,function(e){e.value.release()});e.getOrCreate=function(e){var t=Sk.Strike.getKey(e),r=n.detach(t);return r?r.value:new Sk.StrikeAtlas(e,Sk.subPixelPrecision)},e.put=function(e){n.add(Sk.Strike.getKey(e.getStrike()),e,e.memoryUsedInBytes())},e.flush=function(){n.clear()},e.memoryUsedInBytes=function(){return n.cost()}},Sk.TextBlobIterator=function(){function e(e){var t,n,r=e.glyph_reader,i={};switch(e.positioning){case Sk.GlyphPositioning.kDefault:case Sk.GlyphPositioning.kHorizontal:t=r.readFloat32(),n=e.offset[1];break;case Sk.GlyphPositioning.kFull:t=r.readFloat32(),n=r.readFloat32();break;default:Sk.assert(0)}return i.x_pos=t,i.y_pos=n,i.glyph=r.readGlyphByIndex(),i}var t=this;t.forEachGlyph=function(t,n,r,i){var o,a,s=t.glyph_reader;for(Sk.assert(t&&i),s.reset(),o=0;o<t.glyph_count;o+=1)a=e(t),i(a.glyph,n+a.x_pos,r+a.y_pos)},t.readGlyphAtIndex=function(t,n){var r=t.glyph_reader,i=t.positioning===Sk.GlyphPositioning.kFull?8:4;return i+=4,r.reset(),r.skip(n*i),e(t)},t.forEachRun=function(e,n,r){var i,o,a=Sk.Util.copyDict(n);for(i=0;i<e.runs.length;i+=1)o=e.runs[i],Sk.Paint.applyTextRunPaint(a,o.paint),r(t,o,a)}},Sk.HTMLCanvasDevice=function(e,t,n,r){function i(e){Sk.fatal("HTMLCanvasDeviceError",e)}function o(e,t){var n,r=e.createLinearGradient(t.start[0],t.start[1],t.end[0],t.end[1]),i=1/(t.colors.length-1);for(n=0;n<t.colors.length;n+=1)r.addColorStop(t.position?t.position[n]:i*n,Sk.Paint.skColorToCSSColor(t.colors[n]));return r}function a(e,t){var n,r=e.createRadialGradient(t.center[0],t.center[1],0,t.center[0],t.center[1],t.radius),i=1/(t.colors.length-1);for(n=0;n<t.colors.length;n+=1)r.addColorStop(t.position?t.position[n]:i*n,Sk.Paint.skColorToCSSColor(t.colors[n]));return r}function s(e,t){return t.linear_gradient?o(e,t.linear_gradient):t.radial_gradient?a(e,t.radial_gradient):null}function c(e){var t=e.blendModeStr;Sk.assert(void 0!==e.blendMode),"clear"===t?(P.globalCompositeOperation="copy",P.fillStyle=P.strokeStyle="rgba(0, 0, 0, 0)",Sk.assert("copy"===P.globalCompositeOperation)):(P.globalCompositeOperation=t,P.globalCompositeOperation!==t&&(P.globalCompositeOperation="source-over",Sk.assert("source-over"===P.globalCompositeOperation)))}function l(e,t){return"repeat"}function d(e){var t,n=e.shader.image,r=s(P,e.shader);r?P.fillStyle=P.strokeStyle=r:n?(t=n.image,t.getFrame(0)?P.fillStyle=P.strokeStyle=P.createPattern(t.getFrame(0),l(n.tile_mode_x,n.tile_mode_y)):P.fillStyle=P.strokeStyle=Sk.isDebugEnabled()?"green":"rgba(0, 0, 0, 0)",t.isComplete()||U.setNeedsRedrawOnLoad(t,Sk.Rect.makeLargest())):Sk.assertUnimplemented({event:"unknown-shader",paint:e}),Sk.assert(P.fillStyle&&P.strokeStyle),P.globalAlpha=e.alphaFloat}function u(e,t,n){return[Sk.Rect.getLeft(e)+n[0]-t-1,Sk.Rect.getTop(e)+n[1]-t-1,Sk.Rect.getRight(e)+n[0]+t+1,Sk.Rect.getBottom(e)+n[1]+t+1]}function f(e,t,n){Sk.assert(2===n.length),P.shadowColor=Sk.Paint.skColorToCSSColor(e.color),P.shadowBlur=t*r,P.shadowOffsetX=e.offset[0]*r*n[0],P.shadowOffsetY=e.offset[1]*r*n[1]}function p(e,t){var n,i,o,a,s,c,l,d=t,p=0;if(e.draw_looper){if(n=e.draw_looper.layer,a=U?U.getCTM():Sk.Matrix.identity(),s=Sk.Matrix.getDecomposedScale(a),n.post_translate?(c=n.sigma,n.offset[0]/=s[0],n.offset[1]/=s[1]):c=Sk.Matrix.mapRadius(a,n.sigma),i=0,c>.5&&(i=(c-.5)/.288675),!t||!n.shadow_only)return f(n,i,s),void(n.shadow_only=!1);e.style&&e.style!==Sk.Paint.Style.kFill_Style&&e.strokeWidth>1&&(d=Sk.Rect.resize(t,e.strokeWidth/2)),o=u(d,i,n.offset),P.save(),P.beginPath(),P.rect.apply(P,Sk.Rect.toXYWH(o)),P.closePath(),l=P.strokeStyle,P.strokeStyle="rgba(0,0,0,0)",P.stroke(),P.clip(),P.strokeStyle=l,f(n,i,s),Sk.Rect.intersects(d,o)&&(p=Math.max(Sk.Rect.getRight(d)-Sk.Rect.getLeft(o),Sk.Rect.getRight(o)-Sk.Rect.getLeft(d)),0===p&&(p=Sk.Rect.getWidth(d)),p+=1,P.shadowOffsetX-=p*r*s[0],P.translate(p,0))}}function _(e){var t;e.draw_looper&&(t=e.draw_looper.layer,t.shadow_only&&P.restore())}function g(e,t){var n,r=e.strokeWidth;if(Sk.assert(t),t&(Sk.PaintUsage.kGeometry|Sk.PaintUsage.kPaint)){if(e.shader)try{d(e)}catch(i){B.error({event:"apply-shader-error",paint:e})}else e.style===Sk.Paint.Style.kFill_Style?P.fillStyle=e.cssColor:e.style===Sk.Paint.Style.kStroke_Style?P.strokeStyle=e.cssColor:P.fillStyle=P.strokeStyle=e.cssColor;t&Sk.PaintUsage.kText&&(n=e.textSize/Sk.Paint.kCanonicalTextSizeForPaths,r/=n?n:1),r!==Sk.Paint.Default.strokeWidth&&(P.lineWidth=r),e.strokeMiter!==Sk.Paint.Default.strokeMiter&&(P.miterLimit=e.strokeMiter),e.strokeCap!==Sk.Paint.Default.strokeCap&&(P.lineCap=e.strokeCapStr),e.strokeJoin!==Sk.Paint.Default.strokeJoin&&(P.lineJoin=e.strokeJoinStr)}t&Sk.PaintUsage.kImage&&(Sk.assert(void 0!==e.color),Sk.assert(void 0!==e.filterQuality,{paint:e}),P.globalAlpha=e.alphaFloat,e.filterQuality!==Sk.FilterQuality.kNone?(Sk.assert("none"!==e.filterQualityStr,{fq:e.filterQuality}),Sk.Util.setImageSmoothingEnabled(P,!0),void 0!==P.imageSmoothingQuality&&(P.imageSmoothingQuality=e.filterQualityStr)):Sk.Util.setImageSmoothingEnabled(P,!1)),Sk.assert(void 0!==e.blendMode),e.blendMode!==Sk.BlendMode.kSrcOver&&c(e)}function h(){Sk.assert(r),Sk.assert(n),P.setTransform(1,0,0,1,0,0),
P.scale(r,r),(n.x||n.y)&&O.translate(-n.x,-n.y)}function m(e,t,n,r,i,o,a){var s=.707106781,c=[t,n,r,i,o,a,s],l=[];l=Sk.Conic.convertConicToQuads(c,1),Sk.assert(10===l.length),Sk.assert(l[0]===t),Sk.assert(l[1]===n),Sk.assert(l[8]===o),Sk.assert(l[9]===a),e.quadraticCurveTo(l[2],l[3],l[4],l[5]),e.quadraticCurveTo(l[6],l[7],l[8],l[9])}function v(e,t){var n,r,i,o,a,s,c,l,d,u,f,p=Sk.Rect.getX(e.rect),_=Sk.Rect.getY(e.rect),g=Sk.Rect.getRight(e.rect),h=Sk.Rect.getBottom(e.rect),v=[];if(Sk.Radii.isValid(e.radii)){for(n=Sk.Radii.getUpperLeftX(e.radii),r=Sk.Radii.getUpperLeftY(e.radii),i=Sk.Radii.getUpperRightX(e.radii),o=Sk.Radii.getUpperRightY(e.radii),a=Sk.Radii.getLowerRightX(e.radii),s=Sk.Radii.getLowerRightY(e.radii),c=Sk.Radii.getLowerLeftX(e.radii),l=Sk.Radii.getLowerLeftY(e.radii),v=[p,_+r,p,_,p+n,_,g-i,_,g,_,g,_+o,g,h-s,g,h,g-a,h,p+c,h,p,h,p,h-l],t===!0?(u=v.length-2,f=-2):(u=0,f=2),P.moveTo(v[u],v[u+1]),d=u;m(P,v[d],v[d+1],v[d+f],v[d+f+1],v[d+2*f],v[d+2*f+1]),d+=3*f,!(0>d||d>=v.length);)P.lineTo(v[d],v[d+1]);P.lineTo(v[u],v[u+1])}else t===!0?(P.moveTo(p,_),P.lineTo(p,h),P.lineTo(g,h),P.lineTo(g,_),P.lineTo(p,_)):P.rect.apply(P,Sk.Rect.toXYWH(e.rect))}function y(e){P.beginPath(),P.save(),P.setTransform(1,0,0,1,0,0),P.rect.apply(P,O.getSizeRect()),P.restore(),v(e,!0),P.closePath(),P.clip()}function w(e,t){var n,r,i=e.length;for(Sk.assert(i>0),P.moveTo(e[0][0],e[0][1]),n=1;i>n;n+=1)r=t?e[i-n]:e[n],P.lineTo(r[0],r[1])}function b(e,t){var n;switch(Sk.assert(e),void 0===t&&(t=Sk.FillRule.kWinding),n=Sk.Paint.skFillRuleToCanvasFillRule(t),e.shader&&e.shader.image&&(Sk.assert(e.shader.image.matrix),P.save(),P.transform.apply(P,e.shader.image.matrix)),e.style){case Sk.Paint.Style.kFill_Style:P.fill(n);break;case Sk.Paint.Style.kStroke_Style:P.stroke();break;case Sk.Paint.Style.kStrokeAndFill_Style:P.stroke(),P.fill(n);break;default:i({event:"unknown-paint-style",style:e.style})}e.shader&&e.shader.image&&P.restore()}function k(e,t,n,r,i){var o=0;switch(e){case Sk.PathVerb.kLine:o=1,P.lineTo(t[r],t[r+1]),n[0]=t[r],n[1]=t[r+1];break;case Sk.PathVerb.kQuad:o=2,P.quadraticCurveTo(t[r],t[r+1],t[r+i],t[r+i+1]),n[0]=t[r+i],n[1]=t[r+i+1];break;case Sk.PathVerb.kConic:o=2,m(P,n[0],n[1],t[r],t[r+1],t[r+i],t[r+i+1]),n[0]=t[r+i],n[1]=t[r+i+1];break;case Sk.PathVerb.kCubic:o=3,P.bezierCurveTo(t[r],t[r+1],t[r+i],t[r+i+1],t[r+2*i],t[r+2*i+1]),n[0]=t[r+2*i],n[1]=t[r+2*i+1];break;default:Sk.assert(0)}return o}function S(e){var t,n,r=e.points_f32a,i=e.verbs_u8a,o=0,a=[],s=[];for(Sk.assert(i&&i.length),Sk.assert(r),t=i.length-1;t>=0;t-=1){switch(i[t]){case Sk.PathVerb.kMove:n=1,P.moveTo(r[o],r[o+1]),a[0]=s[0]=r[o],a[1]=s[1]=r[o+1];break;case Sk.PathVerb.kClose:n=0,P.closePath(),a[0]=s[0],a[1]=s[1];break;default:n=k(i[t],r,a,o,2)}o+=2*n}}function C(e){var t,n,r,i=e.points_f32a,o=e.verbs_u8a,a=[],s=[],c=!1,l=!0;for(Sk.assert(o&&o.length),Sk.assert(i&&i.length>=2),r=i.length-2,t=0;t<o.length;t+=1){switch(l&&(P.moveTo(i[r],i[r+1]),a[0]=s[0]=i[r],a[1]=s[1]=i[r+1],l=!1),o[t]){case Sk.PathVerb.kMove:n=1,c&&(P.closePath(),c=!1),l=!0;break;case Sk.PathVerb.kClose:n=0,c=!0;break;default:n=k(o[t],i,a,r-2,-2)}r-=2*n}}function E(e,t,n,r){var i,o,a=e.getGlyphBitmap(t,n-Math.floor(n),r-Math.floor(r));if(!a)return!1;i=Math.floor(n)+Sk.Rect.getX(a.r_scaled_bounds),o=Math.floor(r)+Sk.Rect.getY(a.r_scaled_bounds),Sk.assert(Sk.Rect.isIntRect(a.src_rect));try{P.drawImage(a.device.getNode(),Sk.Rect.getX(a.src_rect),Sk.Rect.getY(a.src_rect),Sk.Rect.getWidth(a.src_rect),Sk.Rect.getHeight(a.src_rect),Sk.Rect.getX(a.dst_rect)+i,Sk.Rect.getY(a.dst_rect)+o,Sk.Rect.getWidth(a.dst_rect),Sk.Rect.getHeight(a.dst_rect))}catch(s){B.error({event:"draw-one-glyph-error",e:s})}return!0}function x(e){return e!==Sk.BlendMode.kClear&&e!==Sk.BlendMode.kSrc&&e!==Sk.BlendMode.kSrcIn&&e!==Sk.BlendMode.kDstIn&&e!==Sk.BlendMode.kSrcOut&&e!==Sk.BlendMode.kDstATop}function A(e,t){var n,r={};Sk.assert(t),x(t.blendMode)||(P.beginPath(),void 0===t.style||t.style===Sk.Paint.Style.kFill_Style||t.strokeWidth<=1?v(e):(n=t.strokeWidth/2,r.rect=Sk.Rect.resize(e.rect,n),e.radii&&(r.radii=Sk.Radii.resize(e.radii,n)),v(r)),P.closePath(),P.clip())}function T(e){var t=document.createElement("canvas");return Sk.assert(Sk.Rect.isValid(e)),t.width=Sk.Rect.getWidth(e),t.height=Sk.Rect.getHeight(e),t}function R(){var t=Sk.canvasMemoryUsage[e],n=Sk.canvasMemoryLimit[e],r=O.getMemoryUsage();return Sk.assert("number"==typeof t),Sk.assert("number"==typeof n),Sk.assert("number"==typeof r),n>=t+r}function D(){Sk.assert(Sk.Rect.isIntRect(t)),Sk.assert("string"==typeof e),I=Sk.nextHTMLCanvasDeviceId,Sk.nextHTMLCanvasDeviceId+=1}var L,P,U,I,O=this,B=new Sk.Logger("sk-canvas-device",{level:"info"}),M=0,N=!0,F=new Sk.TextBlobIterator;O.setCanvas=function(e){U=e},O.getSizeRect=function(){return L},O.getNode=function(){return Sk.assert(P.canvas),P.canvas},O.save=function(){M+=1,P.save()},O.restoreToCount=function(e){for(Sk.assert(void 0!==e&&e>=0);M>e;)P.restore(),M-=1},O.restore=function(){Sk.assert(M>=0),0!==M&&O.restoreToCount(M-1)},O.concat=function(e){Sk.assert(6===e.length),P.transform.apply(P,e)},O.translate=function(e,t){P.translate(e,t)},O.scale=function(e,t){P.scale(e,t)},O.skew=function(e,t){P.transform(1,e,t,1,0,0)},O.playbackMatrixAndClipOps=function(e){var t,n;for(Sk.assert(e),t=0;t<e.length;t+=1)n=e[t],n.concat_mat?O.concat(n.concat_mat):n.set_mat?O.setMatrix(n.set_mat):n.clip_rrect?O.clipRRect(n.clip_rrect,n.clip_op):n.clip_path?O.clipPath(n.clip_path,n.clip_op):n.clip_quad&&O.clipQuad(n.clip_quad,n.clip_op)},O.setMatrix=function(e,t){Sk.assert(6===e.length),h(),t&&P.transform.apply(P,Sk.Matrix.toMat2D(t)),P.transform.apply(P,e)},O.clipRRect=function(e,t){return t===Sk.ClipOp.kDifference?void y(e):(P.beginPath(),v(e),P.closePath(),void P.clip())},O.clipRect=function(e,t){Sk.assert(Sk.Rect.isValid(e)),O.clipRRect({rect:e},t)},O.clipQuad=function(e,t){return Sk.assert(t===Sk.ClipOp.kIntersect||t===Sk.ClipOp.kDifference),Sk.assert(4===e.length),Sk.Quad.isRect(e)?void O.clipRect(Sk.Rect.fromQuad(e),t):(P.beginPath(),t===Sk.ClipOp.kDifference&&(P.save(),P.setTransform(1,0,0,1,0,0),P.rect.apply(P,O.getSizeRect()),P.restore()),w(e,t===Sk.ClipOp.kDifference),P.closePath(),void P.clip())},O.clearRect=function(e){Sk.assert(Sk.Rect.isValid(e)),P.clearRect.apply(P,Sk.Rect.toXYWH(e))},O.drawPath=function(e,t,n,r,i){Sk.assert(e),Sk.assert(t),P.save(),void 0!==n&&P.translate(n.x,n.y),void 0!==r&&P.scale(r,r),g(t,Sk.PaintUsage.kGeometry|(i?Sk.PaintUsage.kText:0)),p(t,e.bounds),P.beginPath(),S(e),b(t,e.fill_rule),_(t),P.restore()},O.drawTextBlobAsBitmaps=function(e,t,n,i){F.forEachRun(e,i,function(e,i,o){var a,s,c=2;for(s=0;c>s;s+=1){a=Sk.StrikeAtlasCache.getOrCreate(Sk.Strike.make(o,U.getCTM(),r));try{return e.forEachGlyph(i,t,n,function(e,t,n){if(!E(a,e,t,n))throw"alloc failed"}),void Sk.StrikeAtlasCache.put(a)}catch(l){a.release(),a=null,Sk.StrikeAtlasCache.flush()}}B.error({event:"draw-text-blob-error",reason:"alloc failed"})})},O.drawTextBlobAsPaths=function(e,t,n,r){F.forEachRun(e,r,function(e,r,i){e.forEachGlyph(r,t,n,function(e,t,n){O.drawPath(e.path,i,{x:t,y:n},r.paint.textSize/Sk.Paint.kCanonicalTextSizeForPaths,!0)})})},O.clipPath=function(e,t){P.beginPath(),t===Sk.ClipOp.kDifference?(P.save(),P.setTransform(1,0,0,1,0,0),P.rect.apply(P,O.getSizeRect()),P.restore(),e.first_direction===Sk.PathDirection.kCCW_Direction?S(e):C(e)):(Sk.assert(t===Sk.ClipOp.kIntersect),S(e)),P.clip()},O.drawPaint=function(e){P.save(),g(e,Sk.PaintUsage.kPaint),P.setTransform(1,0,0,1,0,0),P.fillRect.apply(P,O.getSizeRect()),P.restore()},O.drawRRect=function(e,t){Sk.assert(e&&t),P.save(),A(e,t),g(t,Sk.PaintUsage.kGeometry),p(t,e.rect),P.beginPath(),v(e),P.closePath(),b(t),_(t),P.restore()},O.fillText=function(e,t,n,r){P.save(),P.font=r||"10px arial",P.fillText(e,t,n),P.restore()},O.fillRect=function(e,t){P.save(),P.fillStyle=t,P.globalAlpha=.3,P.fillRect.apply(P,Sk.Rect.toXYWH(e)),P.restore()},O.drawDebugRect=function(e,t){Sk.isDebugEnabled()&&O.fillRect(e,t||"green")},O.drawDebugDeviceRect=function(e){Sk.isDebugEnabled()&&(P.save(),h(),O.drawDebugRect(e),P.restore())},O.drawImageRect=function(e,t,n,r){if(Sk.assert(e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement),Sk.assert(Sk.Rect.isValid(t)&&!Sk.Rect.isEmpty(t),{src:t}),Sk.assert(Sk.Rect.isValid(n)&&!Sk.Rect.isEmpty(n),{dst:n}),Sk.assert(r),P.save(),g(r,Sk.PaintUsage.kImage),A({rect:n},r),r.blendMode===Sk.BlendMode.kClear)O.clearRect(n);else{p(r,n);try{P.drawImage(e,Sk.Rect.getX(t),Sk.Rect.getY(t),Sk.Rect.getWidth(t),Sk.Rect.getHeight(t),Sk.Rect.getX(n),Sk.Rect.getY(n),Sk.Rect.getWidth(n),Sk.Rect.getHeight(n))}catch(i){B.error({event:"draw-image-error",e:i})}_(r)}P.restore()},O.getDeviceBounds=function(){return t},O.createDevice=function(e,t,n){var i={x:Sk.Rect.getX(t)/r,y:Sk.Rect.getY(t)/r},o=new Sk.HTMLCanvasDevice(e,t,i,r);return Sk.assert(Sk.Rect.isIntRect(t)),o.tryAlloc()?(n&&o.playbackMatrixAndClipOps(n),o.setCanvas(U),o):(B.error({event:"create-device-alloc-failed",device_bounds:t,mem:Sk.canvasMemoryUsage}),null)},O.drawDevice=function(e,t,i,o){Sk.assert(Sk.Rect.isIntRect(t)),O.save(),P.setTransform(1,0,0,1,0,0),o&&P.scale(r,r),(n.x||n.y)&&(o?O.translate(-n.x,-n.y):O.translate(-n.x*r,-n.y*r)),O.drawImageRect(e.getNode(),e.getSizeRect(),t,i),O.restore()},O.release=function(){Sk.assert(P&&P.canvas),P.canvas.width=P.canvas.height=0,P=null,U=null,Sk.htmlCanvasDeviceCount-=1,Sk.canvasMemoryUsage[e]-=O.getMemoryUsage(),Sk.assert(Sk.htmlCanvasDeviceById.hasOwnProperty(I)),delete Sk.htmlCanvasDeviceById[I]},O.reset=function(i,o,a,s){Sk.assert(P&&P.canvas),Sk.assert("string"==typeof i),N||(Sk.canvasMemoryUsage[e]-=O.getMemoryUsage()),t=o,L=Sk.Rect.fromWH(Sk.Rect.getWidth(t),Sk.Rect.getHeight(t)),n=a,r=s,e=i,Sk.assert("number"==typeof Sk.canvasMemoryUsage[e]),Sk.canvasMemoryUsage[e]+=O.getMemoryUsage(),N=!1,O.restoreToCount(0),Sk.assert("source-over"===P.globalCompositeOperation),Sk.assert(1===P.globalAlpha),P.canvas.width=Sk.Rect.getWidth(t),P.canvas.height=Sk.Rect.getHeight(t),Sk.assert(Sk.Rect.getArea(t)<=Sk.maxPlatformCanvasArea,{area:Sk.Rect.getArea(t),max:Sk.maxPlatformCanvasArea}),O.save(),h()},O.toDataURL=function(){return O.getNode().toDataURL()},O.getDeviceScaleFactor=function(){return r},O.getMemoryUsage=function(){return 4*Sk.Rect.getArea(t)},O.getId=function(){return I},O.tryAlloc=function(){return R()&&(P=T(t).getContext("2d"))?(O.reset(e,t,n,r),Sk.Util.setImageSmoothingEnabled(P,!1),Sk.htmlCanvasDeviceById[I]=O,!0):!1},D()},Sk.HitTestCanvas=function(){function e(){return d[d.length-1]}function t(){return e().ctm}function n(){return e().canvas_clip}function r(t){e().ctm=t}function i(t){e().canvas_clip=t}function o(e){return Sk.assert(Sk.Rect.isValid(e)),Sk.Rect.roundOut0(Sk.Matrix.mapRect(t(),e))}function a(){Sk.assert(d.length>=1),d.push({canvas_clip:Sk.Rect.makeCopy(n()),ctm:t().slice(0)})}function s(e,t){Sk.assert(e),Sk.assert(void 0!==t),t===Sk.ClipOp.kIntersect&&i(Sk.Rect.intersection(n(),o(e)))}function c(e){return Sk.Rect.intersects(e,n())}var l=this,d=(new Sk.Logger("sk-hit-canvas",{level:"info"}),[{canvas_clip:Sk.Rect.makeLargest(),ctm:Sk.Matrix.identity()}]),u=[];l.save=function(){var e=d.length;return a(),e},l.saveLayer=function(e,t){l.save()},l.restore=function(){return Sk.assert(d.length>1),d.pop(),d.length},l.concat=function(e){r(Sk.Matrix.multiply(t(),Sk.Matrix.fromMat2D(e)))},l.setMatrix=function(e,t){Sk.assert(6===e.length),r(t?Sk.Matrix.multiply(t,Sk.Matrix.fromMat2D(e)):Sk.Matrix.fromMat2D(e))},l.scale=function(e,t){l.concat([e,0,0,t,0,0])},l.translate=function(e,t){l.concat([1,0,0,1,e,t])},l.clipRRect=function(e,t){Sk.assert(Sk.Rect.isValid(e.rect)),void 0===t&&(t=Sk.ClipOp.kIntersect),s(e.rect,t)},l.clipRect=function(e){Sk.assert(Sk.Rect.isValid(e)),l.clipRRect({rect:e})},l.clearRect=function(e){},l.drawRRect=function(e,t){},l.fillText=function(e,t,n,r){},l.fillRect=function(e,t){},l.drawImageRect=function(e,t,n,r,i){},l.drawPicture=function(e,n,r){Sk.assertUnimplemented(!n),Sk.assertUnimplemented(!r);var i=o(e.cull_rect||e.skr.getCullRect());c(i)&&e.skr&&(l.save(),l.translate(e.skr.getCullRect()[0],e.skr.getCullRect()[1]),e.skr.playback(l,{original_ctm:t().slice(0)}),l.restore())},l.clipPath=function(e,t){s(e.bounds,t)},l.clipQuad=function(e,t){s(Sk.Rect.bboxRect(e),t)},l.drawPath=function(e,t){},l.drawTextBlob=function(e,t,n,r,i){u.push({type:"textblob"})},l.drawAnnotation=function(e,t){var n=o(e);c(n)&&u.push({rect:n,data:t})},l.drawPaint=function(e){},l.usesRasterCache=function(){return!1},l.getElements=function(){return u}},Sk.Canvas=function(e,t,n,r){function i(){return k[k.length-1]}function o(){return i().device}function a(){return i().matrix_clip_ops}function s(){return i().ctm}function c(){return i().canvas_clip}function l(e){i().ctm=e}function d(e){i().canvas_clip=e}function u(e){return Sk.assert(Sk.Rect.isValid(e)),Sk.Rect.roundOut0(Sk.Matrix.mapRect(s(),e))}function f(){Sk.assert(k.length>=1),k.push({matrix_clip_ops:a().slice(0),canvas_clip:Sk.Rect.makeCopy(c()),ctm:s().slice(0),device:o()})}function p(e,t){f(),Sk.assert(e),Sk.assert(t),i().device=o().createDevice("save-layer",e,a()),i().paint=t}function _(e){return!(e&Sk.SaveLayerMask.DontClipToLayer)}function g(e,t){Sk.assert(e),Sk.assert(void 0!==t),t===Sk.ClipOp.kIntersect&&d(Sk.Rect.intersection(c(),u(e)))}function h(e,n){Sk.assert(n&&n.isComplete()),t&&!Sk.Rect.isEmpty(e)&&t(e,"image-load-complete")}function m(){var e=Sk.Matrix.getDecomposedScale(w.getCTM());return 1===e[0]&&1===e[1]}function v(){Sk.assert("object"==typeof e),e.setCanvas(w),y=Sk.nextCanvasId,Sk.nextCanvasId+=1,n=n||{use_raster_cache:!1}}var y,w=this,b=new Sk.Logger("sk-canvas",{level:"info",debug:r}),k=[{matrix_clip_ops:[],canvas_clip:Sk.Rect.makeLargest(),ctm:Sk.Matrix.identity(),device:e}];w.getOptions=function(){return n},w.getActiveMatrixClipListRef=function(){return a()},w.getCTM=function(){return s()},w.toCanvasBounds=u,w.getNode=function(){return e.getNode()},w.release=function(){e.release(),e=null,t=null},w.save=function(){var e=k.length;return f(),o().save(),e},w.saveLayer=function(e,t){var n,r=c();e.local_bounds&&(r=Sk.Rect.intersection(r,w.toCanvasBounds(e.local_bounds))),n=w.rootToDeviceBounds(r),Sk.Rect.isEmpty(n)?w.save():p(n,e.paint||Sk.Paint.Default),e.local_bounds&&_(t)&&w.clipRRect({rect:e.local_bounds}),Sk.assertUnimplemented(!(t&Sk.SaveLayerMask.HasBackdrop),"Sk.SaveLayerMask.HasBackdrop"),Sk.assertUnimplemented(!(t&Sk.SaveLayerMask.HasClipMask),"Sk.SaveLayerMask.HasClipMask"),Sk.assertUnimplemented(!(t&Sk.SaveLayerMask.HasClipMatrix),"Sk.SaveLayerMask.HasClipMatrix")},w.restore=function(){var e=i(),t=o();return Sk.assert(k.length>1),k.pop(),o()===t?o().restore():(Sk.assert(e.paint),o().drawDevice(t,t.getDeviceBounds(),e.paint),t.release(),t=null),k.length},w.concat=function(e){a().push({concat_mat:e}),o().concat(e),l(Sk.Matrix.multiply(s(),Sk.Matrix.fromMat2D(e)))},w.setMatrix=function(e,t){Sk.assert(6===e.length),a().push({set_mat:e}),o().setMatrix(e,t),l(t?Sk.Matrix.multiply(t,Sk.Matrix.fromMat2D(e)):Sk.Matrix.fromMat2D(e))},w.scale=function(e,t){w.concat([e,0,0,t,0,0])},w.translate=function(e,t){w.concat([1,0,0,1,e,t])},w.clipRRect=function(e,t){Sk.assert(Sk.Rect.isValid(e.rect)),void 0===t&&(t=Sk.ClipOp.kIntersect),g(e.rect,t),a().push({clip_rrect:e,clip_op:t}),o().clipRRect(e,t)},w.clipRect=function(e){Sk.assert(Sk.Rect.isValid(e)),w.clipRRect({rect:e})},w.clearRect=function(e){Sk.assert(Sk.Rect.isValid(e)),o().clearRect(e)},w.drawRRect=function(e,t){o().drawRRect(e,t||Sk.Paint.Default)},w.fillText=function(e,t,n,r){o().fillText(e,t,n,r)},w.fillRect=function(e,t){o().fillRect(e,t)},w.setNeedsRedrawOnLoad=function(e,t){e.setCompletionCallback(y+":"+Sk.Rect.toString(t),h.curry(t))},w.drawImageRect=function(e,t,n,r,i){var a;if(Sk.assert(e instanceof Sk.Image||e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement),Sk.assert(Sk.Rect.isValid(n)||Sk.Point.isValid(n)),e instanceof Sk.Image){if(!e.isSuccess())return;if(e.isComplete()||(w.setNeedsRedrawOnLoad(e,Sk.Rect.isValid(n)?u(n):Sk.Rect.makeLargest()),i=0),a=e.getFrame(i),!a)return;if(Sk.assert(a instanceof HTMLImageElement,{image:e.asDict(),frame_idx:i}),!a.naturalWidth||!a.naturalHeight)return void b.error({event:"undefined-or-empty-image",naturalWidth:e.naturalWidth,naturalHeight:e.naturalHeight});t=t||Sk.Rect.fromXYWH(0,0,a.naturalWidth,a.naturalHeight),Sk.assert(!Sk.Rect.isEmpty(t),{src:t}),Sk.Rect.isValid(n)||(Sk.assert(Sk.Point.isValid(n)),n=Sk.Rect.fromXYWH(n[0],n[1],a.naturalWidth,a.naturalHeight))}Sk.assert(Sk.Rect.isValid(n)),Sk.Rect.isEmpty(t)||Sk.Rect.isEmpty(n)||o().drawImageRect(a||e,t,n,r||Sk.Paint.Default)},w.toDeviceBounds=function(e){var t=o().getDeviceScaleFactor();return Sk.Rect.roundOut0(Sk.Matrix.mapRect(Sk.Matrix.postScale(w.getCTM(),t,t),e))},w.rootToDeviceBounds=function(e){var t=o().getDeviceScaleFactor();return Sk.Rect.roundOut0(Sk.Matrix.mapRect(Sk.Matrix.makeScale(t,t),e))},w.getDeviceScaleFactor=function(){return o().getDeviceScaleFactor()},w.drawPicture=function(e,t,r){var i=u(e.cull_rect||e.skr.getCullRect());if(Sk.assertUnimplemented(!t),Sk.assertUnimplemented(!r),Sk.Rect.intersects(i,c())){if(e.img)return Sk.assert(Sk.Rect.isIntRect(e.cull_rect),{cull_rect:e.cull_rect}),w.drawImageRect(e.img,Sk.Rect.fromXYWH(0,0,e.img.naturalWidth,e.img.naturalHeight),e.cull_rect,Sk.Paint.Default),void o().drawDebugRect(e.cull_rect,"red");if(Sk.assert(e.skr),e.raster_device&&n.use_raster_cache)return Sk.assert(Sk.Paint.Default.filterQuality===Sk.FilterQuality.kNone),void o().drawDevice(e.raster_device,i,Sk.Paint.Default,!0);w.save(),w.translate(e.skr.getCullRect()[0],e.skr.getCullRect()[1]),e.skr.playback(w,{original_ctm:w.getCTM().slice(0)}),w.restore()}},w.drawAnnotation=function(e,t){t.formctrl&&o().drawDebugRect(e,"green")},w.clipPath=function(e,t){g(e.bounds,t),a().push({clip_path:e,clip_op:t}),o().clipPath(e,t)},w.clipQuad=function(e,t){g(Sk.Rect.bboxRect(e),t),a().push({clip_quad:e,clip_op:t}),o().clipQuad(e,t)},w.drawPath=function(e,t){o().drawPath(e,t)},w.drawTextBlob=function(e,t,n,r,i){return i||!m()?void o().drawTextBlobAsPaths(e,t,n,r):void o().drawTextBlobAsBitmaps(e,t,n,r)},w.drawPaint=function(e){o().drawPaint(e)},w.toDataURL=function(){return e.toDataURL()},w.usesRasterCache=function(){return n.use_raster_cache},w.getDevice=function(){return e},v()},Sk.BinaryReader=function(e,t){function n(e){Sk.fatal("SkBinaryReaderError",e)}function r(e){return e+3>>2<<2}function i(e){return 0==(3&e)}function o(){var e,t={};return e=c.readUint32(),t.colors=c.readUint32Array(),e&Sk.GradientShader.kHasPosition&&(Sk.assert(void 0!==t.colors),t.position=c.readScalarArray(),Sk.assert(t.position)),t}function a(e){var t,n,r,i,o;if(e.length<2)return Sk.Rect.makeEmpty();for(n=i=e[0],r=o=e[1],t=2;t<e.length;t++)e[t]<n?n=e[t]:e[t]>i&&(i=e[t]),t++,e[t]<r?r=e[t]:e[t]>o&&(o=e[t]);return Sk.Rect.fromLTRB(n,r,i,o)}var s=new window.DataView(e.buffer,e.byteOffset,e.byteLength),c=(new Sk.Logger("binary-reader",{level:"info"}),this),l=0,d=!0;c.readUint8=function(){var e=s.getUint8(l,d);return l+=1,e},c.readInt32=function(){var e=s.getInt32(l,d);return l+=4,e},c.readUint16=function(e){var t=s.getUint16(l,d);return e||(l+=2),t},c.readInt16=function(e){var t=s.getInt16(l,d);return e||(l+=2),t},c.readUint32=function(e){var t=s.getUint32(l,d);return e||(l+=4),t},c.readFloat16=function(){var e,t,n,r;return e=c.readUint16(),t=(32768&e)>>15,n=(31744&e)>>10,r=1023&e,0==n?(t?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):31==n?r?NaN:(t?-1:1)*(1/0):(t?-1:1)*Math.pow(2,n-15)*(1+r/Math.pow(2,10))},c.readFloat16Array=function(e){var t,n=[];for(t=0;e>t;t+=1)n.push(c.readFloat16());return e%2==1&&c.readFloat16(),n},c.readFloat32=function(){var e=s.getFloat32(l,d);return l+=4,e},c.readRect=function(){var e,t=[];for(e=0;4>e;e+=1)t.push(c.readFloat32());return t},c.readPoint=function(){return[c.readFloat32(),c.readFloat32()]},c.readBytes=function(t,n){var r=e.subarray(l,l+t);return Sk.assert(void 0!==r.length),Sk.assert(r.length===t),n||(l+=t),r},c.readUint16Array=function(e){var t,n=[];for(t=0;e>t;t+=1)n.push(c.readUint16());return n},c.readFloat32Array=function(e){var t,n=[];for(t=0;e>t;t+=1)n.push(c.readFloat32());return n},c.readString=function(){var e,t=c.readUint32(),n=c.readBytes(t,!0);return Sk.assert(n.length===t),e=Sk.decodeUTF8ByteArray(n),c.skip(r(t+1)),Sk.assert(i(c.offset())),e},c.skip=function(e){l+=e},c.eof=function(){return l>=e.length},c.offset=function(){return l},c.reset=function(){l=0},c.length=function(){return e.length},c.canRead=function(e){return l+e<=c.length()},c.bytesRead=function(e){var t,n=c.offset();return t=c[e](),{bytes_read:c.offset()-n,object:t}},c.readByteArray=function(){var e=c.readUint32(),t=c.readBytes(e,!0);return c.skip(r(e)),t},c.readUint32Array=function(){var e,t=c.readUint32(),n=[];for(e=0;t>e;e+=1)n.push(c.readUint32());return n},c.readScalarArray=function(){var e=c.readUint32();return c.readFloat32Array(e)},c.readLinearGradient=function(){var e=o();return e.start=c.readPoint(),e.end=c.readPoint(),{linear_gradient:e}},c.readRadialGradient=function(){var e=o();return e.center=c.readPoint(),e.radius=c.readFloat32(),{radial_gradient:e}},c.readImageShader=function(){var e=c.readUint32(),t=c.readUint32(),n=c.readMatrix(),r=c.readImage();return{image:{tile_mode_x:e,tile_mode_y:t,matrix:n,image:r}}},c.readDrawLooper=function(){var e,t,n,r=c.readUint32(),i=65535&r,o=r>>16>0,a=null;return i>0&&(e=c.readFloat32(),t=c.readPoint(),n=c.readUint32(),a={layer:{sigma:e,offset:t,color:n,post_translate:o,shadow_only:1===i}}),a},c.readFlattenable=function(){var e,t;return e=c.readString(),t=c.readUint32(),"SkLinearGradient"===e?c.readLinearGradient():"SkRadialGradient"===e?c.readRadialGradient():"SkImageShader"===e?c.readImageShader():"SkLayerDrawLooper"===e?c.readDrawLooper():(Sk.assertUnimplemented({event:"unhandled-flattenable",name:e}),c.skip(t),null)},c.readPaintDef=function(){function e(e){function t(e){return(1<<e)-1}var n=16,r=2,i=2,a=2,s=2,c=2,l=2,d=2;o.flags=e>>16&t(n),o.filterQuality=e>>14&t(r),o.style=e>>12&t(i),o.strokeCap=e>>10&t(a),o.strokeJoin=e>>8&t(s),o.hinting=e>>6&t(c),o.textAlign=e>>4&t(l),o.textEncoding=e>>2&t(d)}function t(e,t){return Sk.assert(e),i&e?c.readFloat32():t}function n(e){return i&e?c.readFlattenable():null}var r,i,o={};return e(c.readUint32()),r=c.readUint32(),i=r>>16&65535,o.blendMode=r>>8&255,o.textSize=t(Sk.NonDef.kTextSize,12),o.textScaleX=t(Sk.NonDef.kTextScaleX,1),o.textSkewX=t(Sk.NonDef.kTextSkewX,0),o.strokeWidth=t(Sk.NonDef.kStrokeWidth,0),o.strokeMiter=t(Sk.NonDef.kStrokeMiter,4),o.color=i&Sk.NonDef.kColor?c.readUint32():Sk.Color.BLACK,i&Sk.NonDef.kTypeface&&(o.typeface={},o.typeface.id=c.readUint32(),o.typeface.fontBounds=c.readRect()),n(Sk.NonDef.kPathEffect),o.shader=n(Sk.NonDef.kShader),n(Sk.NonDef.kMaskFilter),n(Sk.NonDef.kColorFilter),n(Sk.NonDef.kImageFilter),o.draw_looper=n(Sk.NonDef.kDrawLooper),o.typeface_desc=Sk.Paint.buildTypefaceDescriptor(o),Sk.assert(Sk.Paint.isValid(o),{paint:o}),Object.freeze(Sk.Paint.populatePaintStrings(o))},c.readPaint=function(){var e=c.readUint32(),r=t.get(Sk.Deduper.Type.kPaint,e);return r||n({event:"invalid-paint-index",index:e}),r},c.readTextBlobDef=function(){for(var e,n,r,i={runs:[]};;){if(e={},n=c.readUint32(),4294967295===n)break;e.positioning=3&n,r=e.positioning===Sk.GlyphPositioning.kFull?2:1,e.offset=c.readPoint(),e.paint=c.readPaint(),e.glyph_count=c.readUint32(),e.glyph_reader=new Sk.BinaryReader(c.readBytes(e.glyph_count*(4+4*r)),t),i.runs.push(e)}return Object.freeze(i)},c.readTextBlobByIndex=function(e){return Sk.assert(void 0!==e&&0!==e),t.get(Sk.Deduper.Type.kTextBlob,e)},c.readSparseMatrix=function(e){var t,n=[1,0,0,1,0,0];return e&(Sk.MatrixMask.Affine|Sk.MatrixMask.Perspective|Sk.MatrixMask.Scale)?n=e&Sk.TypeMask.Float16?c.readFloat16Array(6):c.readFloat32Array(6):e&Sk.MatrixMask.Translate&&(t=e&Sk.TypeMask.Float16?c.readFloat16Array(2):c.readFloat32Array(2),n[4]=t[0],n[5]=t[1]),n},c.readMatrix=function(){return c.readSparseMatrix(c.readUint32())},c.readRRect=function(e){var t,n,r,i;switch(Sk.assert(void 0!==e),Sk.assert(e>=0&&e<=Sk.RRectType.kLast),e){case Sk.RRectType.kRect:t=c.readRect();break;case Sk.RRectType.kSimple:for(t=c.readRect(),r=c.readFloat32Array(2),n=[],i=0;4>i;i+=1)n=n.concat(r);break;case Sk.RRectType.kEmpty:case Sk.RRectType.kOval:case Sk.RRectType.kNinePatch:case Sk.RRectType.kComplex:t=c.readRect(),n=c.readFloat32Array(8)}return{rect:t,radii:n}},c.readImage=function(){var e=c.readUint32(),r=t.get(Sk.Deduper.Type.kImage,e);return r||n({event:"invalid-image-index",index:e}),r},c.readPathDef=function(){var e=c.readUint32(),t=c.readByteArray(),n=c.readUint32(),r=c.readFloat32Array(2*n),i=a(r);return Object.freeze({fill_rule:e>>8&255,first_direction:e>>26&3,point_count:n,verbs_u8a:t,points_f32a:r,bounds:i})},c.readPathByIndex=function(e){return e=e||c.readUint32(),t.get(Sk.Deduper.Type.kPath,e)},c.readGlyphDef=function(){var e=c.readUint32(),t=c.readRect(),n=c.readPathDef();return Object.freeze({id:e,bounds:t,path:n})},c.readGlyphByIndex=function(e){return e=e||c.readUint32(),t.get(Sk.Deduper.Type.kGlyph,e)}},Sk.Deduper={Type:{kPicture:0,kImage:1,kPath:2,kGlyph:3,kPaint:4,kTextBlob:5},DrawingCache:function(){function e(){r.reset()}var t,n,r=this;r.add=function(e,r,i){Sk.assert(!t.hasOwnProperty(e),"duplicate?"),t[e]=r,n.size+=i,n.min_obj_size=n.count?Math.min(n.min_obj_size,i):i,n.max_obj_size=n.count?Math.max(n.max_obj_size,i):i,n.count+=1},r.get=function(e){return t.hasOwnProperty(e)?(n.hits+=1,t[e]):null},r.reset=function(){t={},n={},n.size=0,n.count=0,n.hits=0,n.min_obj_size=0,n.max_obj_size=0},r.getStats=function(){return{stats:n,avg_obj_size:n.count?n.size/n.count:0}},e()},Cache:function(){function e(){var e;for(e in Sk.Deduper.Type)Sk.Deduper.Type.hasOwnProperty(e)&&(n[Sk.Deduper.Type[e]]=new Sk.Deduper.DrawingCache)}var t=this,n=(new Sk.Logger("sk-cache-host",{level:"info"}),{});t.add=function(e,t,r,i){var o=n[e];Sk.assert("number"==typeof e&&"number"==typeof t,{type:e,index:t}),Sk.assert(o,"missing cache?"),Sk.assert(r,"undefined obj?"),o.add(t,r,i)},t.get=function(e,t){return Sk.assert("number"==typeof e&&"number"==typeof t),n[e].get(t)},t.getStats=function(e){return{draw_cache:n[e].getStats()}},t.reset=function(){var e;for(e in Sk.Deduper.Type)Sk.Deduper.Type.hasOwnProperty(e)&&n[Sk.Deduper.Type[e]].reset()},e()}},Sk.RasterCacheClass=function(){function e(e,t,n){var i={x:Sk.Rect.getX(e)/n,y:Sk.Rect.getY(e)/n},a=new Sk.HTMLCanvasDevice("rcache",e,i,n);Sk.assert(Sk.Rect.getArea(e)<=Sk.maxRasterArea);var s=o.reserve(a.getMemoryUsage());return Sk.assert(s),a.tryAlloc()?(Sk.assert(Sk.Rect.isIntRect(e)),Sk.assert(t),a.setMatrix(Sk.Matrix.toMat2D(t)),a):(r.error({mem_req:a.getMemoryUsage(),usage:Sk.canvasMemoryUsage,total_cost:o.cost()}),Sk.assert(0),null)}function t(t,n){var r,i,o,a=t.getCullRect(),s=n.getCTM(),c=n.toDeviceBounds(a);return r=e(c,s,n.getDeviceScaleFactor()),o=Sk.Util.copyDict(n.getOptions()),o.use_raster_cache=!1,i=new Sk.Canvas(r,null,o),i.clipRect(a),i.translate(Sk.Rect.getX(a),Sk.Rect.getY(a)),t.playback(i,{original_ctm:s}),Sk.getDebugFlags()&Sk.DebugFlags.kHighlightRasterCacheItems&&(i.fillRect(a,"rgba(0, 160, 200, 0.5)"),i.fillText(t.getId()+":"+r.getId(),Sk.Rect.getX(a),Sk.Rect.getY(a)+8)),r.setCanvas(null),r}var n=this,r=new Sk.Logger("sk-raster-cache",{level:"info"}),i=Sk.canvasMemoryLimit.rcache,o=new Sk.LRU(i,function(e){e.value.release()}),a={};n.getOrCreate=function(e,n,r){Sk.assert(e&&n&&r);var i,s=e+":"+Sk.Matrix.getScaleSkewKey(r.getCTM())+":"+r.getDeviceScaleFactor(),c=o.get(s);return c?(a.hit_count+=1,c.value):(a.miss_count+=1,n.isSuitableForRasterCaching(r)&&(i=t(n,r)),i&&(o.remove(s),o.add(s,i,i.getMemoryUsage())||(i=null)),i)},n.remove=function(e){o.remove(e)},n.getMemoryUsage=function(){return o.cost()},n.flush=function(){o.clear(),a={},a.hit_count=0,a.miss_count=0},n.getStats=function(){return a}},Sk.SafeviewRecording=function(e,t,n,r,i,o,a){function s(e){Sk.fatal("SkSafeviewRecordingError",e)}function c(){t&&(t(K),t=null)}function l(){c()}function d(e){z+=1,Y&&j===z&&l()}function u(e,t,a){var s=a.readUint32(),c=65535&s,l=s>>16,u=a.readByteArray(),f=e?r(u):window.URL.createObjectURL(new window.Blob([u],{type:"image/*"})),p=new Sk.Image(f,l,Sk.imageQuality[0],Sk.imageQuality[1],i);return n.add(Sk.Deduper.Type.kImage,t,p),!e||c&Sk.DefineImageExtra.kHintLoadSync||o?(j+=1,void p.startLoading(function(e){Sk.assert(e.isComplete()),d(e)})):void p.startLoading()}function f(e,t){var r=t.bytesRead("readPathDef");n.add(Sk.Deduper.Type.kPath,e,r.object,r.bytes_read)}function p(e,t){var r=t.bytesRead("readGlyphDef");n.add(Sk.Deduper.Type.kGlyph,e,r.object,r.bytes_read)}function _(e,t){var r=t.bytesRead("readTextBlobDef");n.add(Sk.Deduper.Type.kTextBlob,e,r.object,r.bytes_read)}function g(e,t){var r=t.bytesRead("readPaintDef");n.add(Sk.Deduper.Type.kPaint,e,r.object,r.bytes_read)}function h(e,t){var r=t.readRect(),i=t.readByteArray();j+=1,Sk.Util.getImageFromU8Array(i,function(t,o){n.add(Sk.Deduper.Type.kPicture,e,{img:t,cull_rect:r},i.length),d(t)})}function m(e,t){var a=t.readByteArray();j+=1,n.add(Sk.Deduper.Type.kPicture,e,{skr:new Sk.SafeviewRecording(a,d,n,r,i,o,e)},a.length)}function v(e){for(var t,r,i,o=!1;!o;)switch(t=e.readUint32(),r=t>>24&255,i=16777215&t,r){case Sk.Verb.DefineImage:case Sk.Verb.DefineImageURL:u(r===Sk.Verb.DefineImageURL,i,e);break;case Sk.Verb.DefinePath:f(i,e);break;case Sk.Verb.DefineGlyph:p(i,e);break;case Sk.Verb.DefineTextBlob:_(i,e);break;case Sk.Verb.DefinePaint:g(i,e);break;case Sk.Verb.DefinePicture:m(i,e);break;case Sk.Verb.DefineRasterPicture:h(i,e);break;case Sk.Verb.DefineDrawOps:F=i,V=new Sk.BinaryReader(e.readByteArray(),n);break;case Sk.Verb.EndDefinitions:o=!0;break;default:s({event:"unknown-definition-verb",verb:r})}Y=!0,j===z&&l()}function y(e,t,n){var r=n>>1&1,i=1&n,o=n>>2&15,a=t.readRRect(o);Sk.assertUnimplemented(!i,{edge_style:i}),e.clipRRect(a,r)}function w(e,t,n){var r=t.readRRect(n),i=t.readPaint();e.drawRRect(r,i)}function b(e,t,n){Sk.assertUnimplemented(0,"Sk.SafeviewRecording.onDrawArc")}function k(e,t,n){var r=t.readRect(),i={rect:r,radii:Sk.Rect.getOvalRadii(r)},o=t.readPaint();e.drawRRect(i,o)}function S(e,t,n){var r=null,i=t.readImage(),o=t.readFloat32(),a=t.readFloat32(),s=Sk.Point.fromXY(o,a),c=n>>1&65535;n&Sk.DrawImageMask.HasPaint&&(r=t.readPaint()),e.drawImageRect(i,null,s,r,c)}function C(e,t,n){var r,i=null,o=t.readImage(),a=null,s=n&Sk.DrawImageRectMask.Contraint,c=n>>3&65535;n&Sk.DrawImageRectMask.HasSrcRect&&(a=t.readRect()),r=t.readRect(),n&Sk.DrawImageRectMask.HasPaint&&(i=t.readPaint()),Sk.assertUnimplemented(s,"SrcRectConstraint unsupported"),Sk.assert(r),e.drawImageRect(o,a,r,i,c)}function E(e,t,n){var r={};n&Sk.SaveLayerMask.HasBounds&&(r.local_bounds=t.readRect()),n&Sk.SaveLayerMask.HasPaint&&(r.paint=t.readPaint()),n&Sk.SaveLayerMask.HasBackdrop&&(r.backdrop=t.readFlattenable()),n&Sk.SaveLayerMask.HasClipMask&&(r.clip_mask=t.readImage()),n&Sk.SaveLayerMask.HasClipMatrix&&(r.clip_matrix=t.readMatrix()),e.saveLayer(r,n)}function x(e,t,r){var i,o,a=r,c=n.get(Sk.Deduper.Type.kPicture,a);return a?(c||s({event:"draw-picture-error",reason:"pic not found",index:a}),c.use_count||(c.use_count=0),e.usesRasterCache()&&c.skr&&c.use_count>=Sk.rasterCacheUseThreshold&&(c.raster_device=Sk.RasterCache.getOrCreate(c.skr.getContentId(),c.skr,e)),c.use_count+=1,r&Sk.DrawPictureMask.HasMatrix&&(o=t.readMatrix(),Sk.assertUnimplemented(0,{event:"HasMatrix",matrix:o})),r&Sk.DrawPictureMask.HasPaint&&(i=t.readPaint(),Sk.assertUnimplemented(0,{event:"HasPaint",paint:i})),void e.drawPicture(c,o,i)):void W.error({event:"draw-picture-error",reason:"index is 0 -- server encode error?",index:a})}function A(e){var t,n,r,i=[],o=e.readUint32();for(t=0;o>t;t+=1)n={},r=e.readUint32(),n.type=15&r,n.flags=r>>4&4095,n.index=r>>16&65535,n.label=e.readString(),n.tool_tip=e.readString(),i.push(n);return{items:i}}function T(e){var t,n={};switch(t=e.readUint32(),
n.type=65535&t,n.flags=t>>16&65535,n.id_attr=e.readString(),n.name_attr=e.readString(),n.type){case Sk.HT.FormControlElement.Type.kInput:n.input={},t=e.readUint32(),n.input.type=65535&t,n.input.flags=t>>16&65535;break;case Sk.HT.FormControlElement.Type.kTextArea:n.textarea={};break;case Sk.HT.FormControlElement.Type.kContentEditable:n.contenteditable={};break;case Sk.HT.FormControlElement.Type.kSelect:n.select=A(e);break;default:Sk.assert(0)}return n}function R(e,t,n){var r=t.readRect(),i=t.readUint32(),o=t.readInt32(),a=(t.readInt32(),{type:i,node_id:o,rect:r});switch(i){case Sk.HT.ElementType.kFormControl:a.formctrl=T(t);break;default:Sk.assert(0,{type:i})}e.drawAnnotation(r,a)}function D(e,t,n){var r=t.readTextBlobByIndex(n),i=t.readFloat32(),o=t.readFloat32(),a=t.readPaint();Sk.assert(r&&a),e.drawTextBlob(r,i,o,a)}function L(e,t,n,r){var i=!!(n&Sk.TypeMask.SetMatrix),o=t.readSparseMatrix(n);i?e.setMatrix(o,r):e.concat(o)}function P(e,t,n){var r=t.readPathByIndex(n),i=t.readUint32(),o=i>>1&1,a=1&i;Sk.assertUnimplemented(!a,{edge_style:a}),e.clipPath(r,o)}function U(e,t,n){var r=t.readPathByIndex(n),i=t.readPaint();e.drawPath(r,i)}function I(e,t,n){e.drawPaint(t.readPaint())}function O(){return!!(F&(Sk.PictureFlags.kHasText|Sk.PictureFlags.kHasPaths))}function B(e){N=e.readRect()}function M(){var t=new Sk.BinaryReader(e,n);H=Sk.nextRecordingId,Sk.nextRecordingId+=1,Sk.assert(i),B(t),v(t)}var N,F,V,H,X,K=this,W=new Sk.Logger("skr",{level:"info"}),j=0,z=0,Y=!1;K.getCullRect=function(){return N},K.playback=function(e,t){var n,r,i,o=V;for(Sk.assert(j===z,{nr_assets_to_load:j,nr_assets_loaded:z}),X=t||{},o.reset();!o.eof();)switch(n=o.readUint32(),r=n>>24&255,i=16777215&n,r){case Sk.Verb.ClipRect:case Sk.Verb.ClipRRect:y(e,o,r===Sk.Verb.ClipRRect?i:i|Sk.RRectType.kRect<<2);break;case Sk.Verb.ClipPath:P(e,o,i);break;case Sk.Verb.Save:e.save();break;case Sk.Verb.SaveLayer:E(e,o,i);break;case Sk.Verb.Restore:e.restore();break;case Sk.Verb.Concat:L(e,o,i,t?t.original_ctm:null);break;case Sk.Verb.DrawRect:case Sk.Verb.DrawRRect:w(e,o,r===Sk.Verb.DrawRRect?i:Sk.RRectType.kRect);break;case Sk.Verb.DrawArc:b(e,o,i);break;case Sk.Verb.DrawOval:k(e,o,i);break;case Sk.Verb.DrawImage:S(e,o,i);break;case Sk.Verb.DrawImageRect:C(e,o,i);break;case Sk.Verb.DrawTextBlob:D(e,o,i);break;case Sk.Verb.DrawPath:U(e,o,i);break;case Sk.Verb.DrawPaint:I(e,o,i);break;case Sk.Verb.DrawPicture:x(e,o,i);break;case Sk.Verb.DrawAnnotation:R(e,o,i);break;default:s({event:"unknown-draw-op",op:r})}X=null},K.isSuitableForRasterCaching=function(e){return F&Sk.PictureFlags.kHasPictures?!1:F&Sk.PictureFlags.kHintDoNotCache?!1:F&Sk.PictureFlags.kHintDoNotRasterCache?!1:Sk.Rect.getArea(e.toDeviceBounds(N))>Sk.maxRasterArea?!1:F&Sk.PictureFlags.kHasImages?!1:O()},K.getProperties=function(){return F},K.getId=function(){return H},K.getMemoryUsage=function(){return e.length},K.getContentId=function(){return a},K.getCullRect=function(){return N},Sk.assert(e),Sk.assert(n),M()};var Compositor={};window.mat3=glMatrix.mat3,window.mat4=glMatrix.mat4,window.vec2=glMatrix.vec2,window.vec3=glMatrix.vec3,Compositor.Options=Object.freeze({kDefault:0,kDisableVideo:1,kEnableDebug:2,kEnableBBoxView:4,kSyncImageLoad:8,kDisableNativeVideo:16,kEnableHUD:32,kEnableDebugAnnotation:64}),Compositor.ZIndexRange=Object.freeze({kVideoElement:[0,99999],kLayer:[1e5,1e5],kSearchInput:[100002,100002],kSelectionOverlay:[100003,100003],kIMEOverlay:[100004,100004],kHitEmulation:[100005,100005],kHUD:[100006,100006]}),Compositor.HitTest=Object.freeze({kNonFastRegion:0,kLayer:1,kDrawing:2,kTouchActionRegion:3}),Compositor.CommitState=Object.freeze({kLoadNotStarted:0,kLoadStarted:1,kLoadComplete:2}),Compositor.DrawFrameReason=Object.freeze({kRecordingsLoaded:1,kLayerProjectionChanged:2,kTilesBecameDirty:4,kBecameVisible:8,kVideoSizeChanged:16}),Compositor.Stats=function(){var e=this,t={};e.inc=function(e,n){t.hasOwnProperty(e)||(t[e]=0),void 0===n&&(n=1),t[e]+=n},e.get=function(e){return t.hasOwnProperty(e)?t[e]:0},e.reset=function(){t={}}},Compositor.LayerTreeHost=function(e){function t(){return we.getLayerTree()?we.getLayerTree().getRoot():null}function n(e,t){var n,r=e.layer_updates;for(assert(t),n=0;n<r.length;n+=1)t(r[n].id,r[n])}function r(e){assert(e),Be|=e}function i(){return Be}function o(e){n(e.commit,function(t,n){var r=we.layer_tree.getLayer(t);assert(n),r?(r.isPictureLayer()&&(n.loaded_tile_updates=e.tile_updates_by_layer_id[t]),r.updateProperties(n)):Se.error({event:"tc-prop-for-unknown-layer",lid:t})})}function a(e){n(e.commit,function(t,n){var r=we.layer_tree.getLayer(t);r&&e.texture_update_by_layer_id.hasOwnProperty(t)&&r.updateTexture(e.texture_update_by_layer_id[t])})}function s(e){n(e,function(e,t){var n=we.layer_tree.getLayer(e);n?n.applyProperties():Se.error({event:"tc-prop-for-unknown-layer",lid:e})})}function c(e){(se!==e.wheel_event_listener||ce!==e.blocking_wheel_event_listener)&&(se=e.wheel_event_listener,ce=e.blocking_wheel_event_listener,we.callback.fire("wheel-event-listener-changed")),(le!==e.touch_event_listener||de!==e.blocking_touch_event_listener)&&(le=e.touch_event_listener,de=e.blocking_touch_event_listener,we.callback.fire("touch-event-listener-changed"))}function l(e){var t=e.commit;Re.inc("commit_activation_count"),assert(!Util.isDictEmpty(t)),t.reset_cache&&Sk.RasterCache.flush(),c(t),we.layer_tree.applyCommit(t),o(e),s(t),a(e),we.callback.fire("did-activate-tree")}function d(e){function t(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}assert(e.getLayer().isLive());var n=Sk.Rect.getCenter(e.vp_rect),r=Sk.Rect.getCenter(we.getViewportRect());return t(n,r)}function u(){if(Me){if(Me=!1,!we.layer_tree.getRoot())return;return void we.layer_tree.getRoot().withEachDrawableLayerInSubtree(function(e,t){t&&t.isLive()&&t.updateLocalDrawRect()})}Util.forEachItem(Pe,function(e,t){var n=we.layer_tree.getLayer(e);n&&n.isLive()&&n.updateLocalDrawRect()}),Pe={}}function f(e){function t(e){var t,r=Sk.Rect.makeCopy(e.vp_rect);for(t=0;t<n.length&&!Sk.Rect.isEmpty(r);t+=1)Sk.Rect.subtract(r,n[t]);return!Sk.Rect.isEmpty(r)}var n=[],r=[];return e.sort(function(e,t){return e.getLayer().paintsBefore(t.getLayer())?1:-1}),e.forEach(function(e){assert(!e.getLayer().isTransparent()),assert(!e.getLayer().shouldHideLayerAndSubtree()),(t(e)||e.getLayer().hasNoDrawRegions())&&(e.getLayer().occludesContentBelow()&&e.vp_rect.rect_stays_rect&&n.push(e.vp_rect),r.push(e))}),r}function p(){var e=[];return Util.forEachItem(Ue,function(t){var n=we.layer_tree.getLayer(t),r=!0;return n?(assert(!n.hasVideoContent()||n.isDrawable()),void(n.isLive()&&n.isDrawable()&&(n.isTransparent()||n.shouldHideLayerAndSubtree()||n.forEachTileInRect(n.getLocalDrawRect(),function(t){var i=n.getTileByKey(t);i&&i.isDirty()&&(assert(i.getLayer()===n),assert(i.getTileRect()),i.vp_rect=n.toViewportRect(i.getTileRect(),r),!Sk.Rect.isEmpty(i.vp_rect)&&Sk.Rect.intersects(we.getDrawRect(),i.vp_rect)&&e.push(i))})))):void assert(0)}),e}function _(e){var t=0,n=0,r=0;e.forEach(function(e){var i=e.getDisplayList();return i?void(void 0!==i.solid_color?t+=1:n+=1):void(r+=1)}),Se.info({nr_visible_tiles:e.length,visible_tiles:e,nr_solid_color:t,nr_non_solid_color:n,nr_missing:r})}function g(){var e,t=!1;return u(),e=f(p()),t&&e.length&&_(e),e}function h(){var e={now:[],soon:[]},t=g();return t.sort(function(e,t){return d(e)<d(t)?-1:1}),t.forEach(function(t){Sk.Rect.intersects(we.getViewportRect(),t.vp_rect)?e.now.push(t):e.soon.push(t)}),we.isDebugEnabled()&&e.now.length>8,e}function m(e,t){for(var n,i,o=!0;e.length&&t>0;){if(i=Date.now(),n=e.shift(),!n.getLayer().drawTile(n)){o=!1;break}n.draw_time_ms=Date.now()-i,t-=n.draw_time_ms}return e.length&&r(Compositor.DrawFrameReason.kTilesBecameDirty),{time_remaining_ms:Math.max(0,t),all_tiles_drawn:o}}function v(){for(var e;Ce.length&&(e=Ce[0],e.state===Compositor.CommitState.kLoadComplete);)Ce.shift(),l(e)}function y(){var e,t,n,r,i=Ve,o=0;do o+=1,e=h(),n=m(e.now,i),n.all_tiles_drawn||(t=Math.max(Fe,Math.ceil(fe-1)),fe>t&&(r=Util.copyDict(Sk.canvasMemoryUsage),we.setDeviceScaleFactorOverride(t)));while(10>=o&&!n.all_tiles_drawn);(n.all_tiles_drawn&&!r||(window.reportClientEvent(n.all_tiles_drawn?"tc-compositor-dsf-fallback":"tc-compositor-draw-retry-fail",{final_dsf:fe,try_count:o,mem_usage:r,mem_limit:Sk.canvasMemoryLimit}),n.all_tiles_drawn))&&m(e.soon,Math.min(He,n.time_remaining_ms))}function w(){Ne=!0,be+=1,Oe.push(Date.now()),Oe.length>Ie&&Oe.shift(),we.callback.fire("begin-animation-frame"),i()&&(Be=0,v(),we.callback.fire("will-draw",Pe),y()),Ne=!1}function b(t,n,r){return new Sk.SafeviewRecording(n,r,t.asset_cache,e.url_builder.buildImageURLFromU8Array,oe,Ae&Compositor.Options.kSyncImageLoad)}function k(e,t){function r(){o+=1,a&&i===o&&t()}var i=0,o=0,a=!1;e.tile_updates_by_layer_id={},e.texture_update_by_layer_id={},n(e.commit,function(t,n){var o,a;if(n.layer_type===Compositor.LayerType.PictureLayer&&n.tile_updates)for(e.tile_updates_by_layer_id[t]=[],o=0;o<n.tile_updates.length;o+=1)i+=1,a=n.tile_updates[o],e.tile_updates_by_layer_id[t].push({index_x:a.index_x,index_y:a.index_y,invalidation_region:a.invalidation_region,solid_color:a.solid_color,skr:b(e,a.skr_u8a,r)});else n.layer_type===Compositor.LayerType.TextureLayer&&n.skr_u8a&&(i+=1,e.texture_update_by_layer_id[t]=b(e,n.skr_u8a,r))}),a=!0,i===o&&t()}function S(e){assert(e.state===Compositor.CommitState.kLoadNotStarted),e.state=Compositor.CommitState.kLoadStarted,k(e,function(){e.state=Compositor.CommitState.kLoadComplete,r(Compositor.DrawFrameReason.kRecordingsLoaded)})}function C(t){e.surrogate_channel&&e.surrogate_channel.send.apply(e.surrogate_channel,t)}function E(e){C(["CM",Util.Uint8ArrayToBase64(e)])}function x(e){var t=Compositor.MessageFlags.kPixelDistance,n=new Sk.BinaryWriter(8);n.writeUint32(t),n.writeUint32(e),E(n.getData())}function A(e,t){var n,r=new Compositor.BinaryReader,i=r.readCommit(t);if(!Ee&&!Util.isDictEmpty(i)){if(!i.full_tree)return!0;Ee=!0}return(!ge||i.reset_cache)&&(ge=new Sk.Deduper.Cache),n={state:Compositor.CommitState.kLoadNotStarted,seq_no:we.commit_count,commit:i,asset_cache:ge,reset_cache:i.reset_cache},Ce.push(n),S(n),i.flags&Compositor.CommitFlags.kHasDebugData&&De.push(i),we.commit_count+=1,we.commit_bytes+=t.length,Re.inc("commit_count"),Re.inc("commit_rx_bytes",t.length),i.full_tree&&(we.full_tree_commit_count+=1,Re.inc("full_tree_commit_count")),!0}function T(){var e=Compositor.MessageFlags.kInvalidateAllLayers,t=new Sk.BinaryWriter(4);t.writeUint32(e),E(t.getData())}function R(){var e=Compositor.MessageFlags.kInvalidateLayerTree,t=new Sk.BinaryWriter(4);t.writeUint32(e),E(t.getData())}function D(e,t){var n=Compositor.MessageFlags.kInvalidateLayerRect,r=24,i=new Sk.BinaryWriter(r);i.writeUint32(n),i.writeInt32(e),i.writeRect(t),E(i.getData())}function L(){re=null,Util.forEachItem(xe,function(e,t){t&&!Sk.Rect.isEmpty(t)&&D(e,t)}),xe={}}function P(e,t){var n=document.getElementById(e);return n?void n.parentNode.removeChild(n):(n=document.createElement("style"),n.id=e,n.appendChild(document.createTextNode(t)),void document.head.appendChild(n))}function U(){P("sv-tile-style",".sv-tile { outline: 1px solid green }"),P("sv-tile-label-style",".sv-tile-label { display: block !important; }"),P("sv-layer-style",".svl { outline: 1px solid orange; }")}function I(){we.setFlags(Ae^Compositor.Options.kDisableNativeVideo),we.layer_tree.getRoot().withEachDrawableLayerInSubtree(function(e,t){if(t.hasVideoContent()){var n=t.getVideoDelegate();n.requestDisplay()}})}function O(){var e;return Oe.length<Ie?60:(e=Oe[Oe.length-1]-Oe[0],0>=e?(assert(0===e),60):Oe.length/(e/1e3))}function B(e){function t(e){return e/(1<<20)}function n(e){var n=[],i=0;return Util.forEachItem(e,function(e,o){n.push([t(o),r[i%r.length]]),i+=1}),n}var r=["#EF476F","#FFD166","#06D6A0","#FFFCF9"];e.cps.update([[Re.get("commit_count")]]),e.crx.update([[Re.get("commit_rx_bytes")/1024]]),e.cql.update([[Ce.length]]),e.sfps.update([[1e3/_e.getSenderDelay()]]),e.fps.update([[O()]]),e.canvas.update(n(Sk.canvasMemoryUsage)),Re.reset()}function M(){t()&&t().hardInvalidateTilesInSubtree()}function N(e){return e.ctrlKey&&"keydown"===e.type?!0:!1}function F(e){var t=!0;if(he&&N(e)){switch(e.keyCode){case"F".charCodeAt(0):R();break;case"H".charCodeAt(0):we.setFlags(Ae^Compositor.Options.kEnableHUD),we.setHUDVisibility(we.isHUDEnabled());break;case"I".charCodeAt(0):Sk.setImageQuality(1),R();break;case"P".charCodeAt(0):Sk.setSubPixelPrecision(1/64),R();break;case"R".charCodeAt(0):T();break;case"D".charCodeAt(0):M();break;case"T".charCodeAt(0):U();break;case"V".charCodeAt(0):I();break;case"U".charCodeAt(0):we.setFlags(Ae^Compositor.Options.kEnableDebugAnnotation),R();break;default:t=!1}t&&(e.stopPropagation(),e.preventDefault())}}function V(){var e=["safeview-info","sv-template"];e.forEach(function(e){for(var t;;){if(t=document.getElementsByTagName(e),!t||!t.length)break;t[0].parentNode.removeChild(t[0])}})}function H(e,t){var n=(we.input||ye).getLastActivityTime(),r=Date.now()-n.input,i=Date.now()-n.key,o=Date.now()-n.click;return assert(2===e.length),assert(r>=0&&i>=0&&o>=0,{input_delta:r,key_delta:i,click_delta:o}),1e3>r?[1e3>i?0:25,0]:[25,3]}function X(){return BrowserDetect.isMobile()?3*Sk.Rect.getHeight(Ke):4096}function K(e){var n,r,i=e.visual_viewport,o=mat4.create();return mat4.translate(o,o,vec3.fromValues(-i.x,-i.y,0)),mat4.multiply(o,mat4.fromScaling(mat4.create(),vec3.fromValues(i.scale,i.scale,1)),o),n=MetricsUtils.getMinMaxVisualViewportHeight(),r=Sk.Rect.fromXYWH(0,0,i.width,n.max),mat4.equals(Xe,o)&&Sk.Rect.isEqual(r,Ke)?!1:(Xe=o,Ke=r,ue=Sk.Rect.resize(Ke,X()),t()&&t().invalidateSubtreeProjection(),!0)}function W(e,t){we.setDeviceScaleFactor(e.device_scale_factor),K(e)&&(BrowserDetect.isMobile()||C(["resize",Sk.Rect.getWidth(Ke),Sk.Rect.getHeight(Ke),e.device_scale_factor]))}function j(){we.getLayerTree()&&we.getLayerTree().freeTiles(),Sk.flushCaches()}function z(){Util.isTabVisible()||(Oe=[]),!Util.isTabVisible()&&BrowserDetect.isMobile()&&j(),Util.isTabVisible()&&r(Compositor.DrawFrameReason.kBecameVisible)}function Y(e,t,n){var r=document.createElement(e),i=document.createElement("div");return r.style.padding=r.style.margin="0px",i.style.display="none",i.style.padding=i.style.margin="0px",we.isDebugEnabled()&&(r.id="sv-video:"+t+":"+n,i.id="sv-video-clip-container:"+t+":"+n),i.appendChild(r),ie.appendChild(i),setNodeIds(r,n,t),we.callback.fire("media-node-inserted",n),r}function Q(e,t){var n,r=getNodeByUid(e,t);assert(r),r&&(n=r.parentNode,n.parentNode.removeChild(n),removeUidNodeEntry(e,t))}function G(){ie=document.createElement("div"),we.isDebugEnabled()&&(ie.id=Te),document.body.appendChild(ie),e.media_objects.setClient({new_media_node:Y,did_remove_media_node:Q})}function q(){var e=document.createElement("div");e.style.display="block",e.style.position="fixed",e.style.backgroundColor="blue",we.isDebugEnabled()||(e.style.opacity="0"),e.style.height="1px",e.style.width="100%",e.style.left="0px",e.style.top="0px",e.style.zIndex=Compositor.ZIndexRange.kHUD[0],document.body.appendChild(e),ve=e}function J(){Sk.fini()}function Z(){var t,n,r=e.getLayoutViewport();MetricsUtils.getVisualViewportScale();we.getLayerTree()&&we.getLayerTree().getOuterViewportScrollLayer()&&(t=we.getLayerTree().getOuterViewportScrollLayer().getParent(),assert(t&&t.isOuterViewportContainerLayer())),t&&(r.width=Sk.Rect.getWidth(t.getBoundsRect())),n=we.getLayerTree().getPageScaleFactorLimits(),We||(r.initial_scale=n.current,We=!0),r.minimum_scale=n.min,r.maximum_scale=n.max,e.setLayoutViewport(r)}function $(){BrowserDetect.isChrome()||BrowserDetect.isSafari()?P("sv-scroller-style",".hide-scrollbar::-webkit-scrollbar { width: 0px !important; }"):BrowserDetect.isFirefox()?P("sv-scroller-style",".hide-scrollbar { scrollbar-width: none; }"):(BrowserDetect.isIE()||BrowserDetect.isEdge())&&P("sv-scroller-style",".hide-scrollbar { -ms-overflow-style: none; }")}function ee(){var e=MetricsUtils.getAllMetrics();K(e),fe=e.device_scale_factor,assert("number"==typeof fe)}function te(){var e;return e=BrowserDetect.isDesktop()?1<<29:1<<27,{tile:e,"atlas-tex":1<<25,rcache:1<<25,"save-layer":1<<24}}function ne(){Sk.Logger=Logger,Sk.assert=assert,Sk.assertUnimplemented=assert_unimplemented,Sk.init(te()),window.DEBUG&&we.setFlags(Ae|Compositor.Options.kEnableDebug),V(),e.interp.registerBinaryHandler(A),we.commit_count=0,we.full_tree_commit_count=0,we.commit_bytes=0,ee(),EventListener.addListener(document,"keydown",F,!1),we.callback=new CallbackSupport,oe=new Sk.ImageLoader(H),BrowserDetect.isDesktop()?(we.input=new Compositor.Input(e,we),we.selection=new Compositor.Selection(e),we.ime=new Compositor.IME(e)):ye=new Compositor.InputDelegate(e,we),we.in_page_searcher=new Compositor.InPageSearcher(e),new Compositor.Extras(e).init(),new Compositor.ScrollContentPrefetcher(e,x).init(),_e=new Compositor.FlowController(e,we),G(),we.layer_tree=new Compositor.LayerTree(e,we,"sv-content"),we.isDebugEnabled()&&(we.debug=new Compositor.Debug(we)),ae=new Compositor.HUD(B),we.setHUDVisibility(we.isHUDEnabled()),we.setDebugKeysEnabled(we.isDebugEnabled()),document.body.appendChild(we.layer_tree.getDiv()),ye&&document.body.appendChild(ye.getDiv()),document.body.appendChild(ae.getDiv()),q(),we.in_page_searcher.insertInput(),me=new Compositor.RequestAnimationFrame(e,w),me.start(),we.set2DCanvasAccelerationEnabled(!1),e.callback.fire("remoting-v2-activated"),e.callback.register("metrics-changed",W),e.metrics_observer.checkForMetricsChange("init"),we.callback.register("needs-meta-viewport-update",Z),EventListener.addListener(document,"visibilitychange",z,!1),EventListener.addListener(window,"unload",J),$()}var re,ie,oe,ae,se,ce,le,de,ue,fe,pe,_e,ge,he,me,ve,ye,we=this,be=0,ke=function(){return{fc:be}},Se=new Logger("lth",{level:"info",header:ke}),Ce=[],Ee=!1,xe={},Ae=Compositor.Options.kDefault,Te="sv-media",Re=new Compositor.Stats,De=[],Le=[],Pe={},Ue={},Ie=60,Oe=[],Be=0,Me=!1,Ne=!1,Fe=1,Ve=1e3,He=100,Xe=mat4.create(),Ke=Sk.Rect.makeEmpty(),We=!1;we.setLayerProjectionChanged=function(e){assert("number"==typeof e),Pe[e]=!0,r(Compositor.DrawFrameReason.kLayerProjectionChanged)},we.setVideoSizeChanged=function(){r(Compositor.DrawFrameReason.kVideoSizeChanged)},we.setLayerContentsDirty=function(e,t){var n;return t?(n=we.layer_tree.getLayer(e),void(n&&(Ue[e]=!0,r(Compositor.DrawFrameReason.kTilesBecameDirty)))):void delete Ue[e]},we.isInAnimationFrame=function(){return Ne},we.sendCommand=C,we.sendScrollUpdate=function(e,t,n,r){var i,o,a,s=Compositor.MessageFlags.kScrollUpdates;for(assert(e&&e.length>0),o=8+20*e.length,i=new Sk.BinaryWriter(o),i.writeUint32(s),i.writeUint32(e.length),a=0;a<e.length;a+=1)i.writeInt32(Number(e[a])),i.writeInt32(t),i.writeInt32(n),i.writeUint32(r[0]),i.writeUint32(r[1]);E(i.getData())},we.setNeedsRepaint=function(e,t){var n=xe[e];n||(n=Sk.Rect.makeEmpty()),Sk.Rect.join(n,t),xe[e]=n,re||(re=setTimeout(L,10))},we.setDebugDataEnabled=function(e){var t=Compositor.MessageFlags.kSetDebugDataEnabled,n=new Sk.BinaryWriter(8);n.writeUint32(t),n.writeUint32(e),E(n.getData())},we.setHUDVisibility=function(e){assert(ae),e?(ae.start(),ae.show()):ae&&(ae.stop(),ae.hide())},we.setDebugKeysEnabled=function(e){return he=e},we.getHUD=function(){return ae},we.getInputDelegate=function(){return ye},we.sendCompositorMessage=E,we.toggleTileAndLayerBorders=U,we.redrawAllLayers=M,we.invalidateLayerTree=R,we.hitTest=function(e,t){return assert(void 0!==t.x&&void 0!==t.y),we.layer_tree.hitTest(e,t)},we.getLastMousePos=function(){return(we.input||ye).getLastMousePos()},we.setFlags=function(e){Sk.assert(void 0!==e),Ae=e,Sk.setDebugEnabled(Ae&Compositor.Options.kEnableDebug)},we.getFlags=function(){return Ae},we.isVideoEnabled=function(){return!(Ae&Compositor.Options.kDisableVideo)},we.isNativeVideoEnabled=function(){return!(Ae&Compositor.Options.kDisableNativeVideo)},we.isBBoxViewEnabled=function(){return!!(Ae&Compositor.Options.kEnableBBoxView)},we.isHUDEnabled=function(){return!!(Ae&Compositor.Options.kEnableHUD)},we.isDebugEnabled=function(){return!!(Ae&Compositor.Options.kEnableDebug)},we.isDebugAnnotationEnabled=function(){return!!(Ae&Compositor.Options.kEnableDebugAnnotation)},we.getLayerTree=function(){return we.layer_tree},we.startCommitRecording=function(){we.setDebugDataEnabled(!0)},we.stopCommitRecording=function(){we.setDebugDataEnabled(!1)},we.getCommitBuffer=function(){return De},we.clearCommitBuffer=function(){De=[]},we.hasWheelEventListener=function(){return se},we.hasBlockingWheelEventListener=function(){return ce},we.hasTouchEventListener=function(){return le},we.hasBlockingTouchEventListener=function(){return de},we.hasMainThreadScrollingReasons=function(){return we.layer_tree&&we.layer_tree.hasMainThreadScrollingReasons()},we.getFPS=function(){return O()},we.getFrameCount=function(){return be},we.getMinimumDistanceBeforeDrawRectUpdate=function(){return X()>512?512:0},we.getDeviceScaleFactor=function(){return we.getLayerTree()?Math.min(fe,we.getLayerTree().getMaxDeviceScaleFactor()):1},we.getViewportRect=function(){return Ke},we.getDrawRect=function(){return ue},we.setDeviceScaleFactor=function(e){pe||fe===e||(fe=e,we.callback.fire("device-scale-factor-changed"))},we.setDeviceScaleFactorOverride=function(e){pe!==e&&(pe=e,fe=e,we.callback.fire("device-scale-factor-changed"))},we.getVisualViewportTransform=function(){return Xe},we.getVisualViewportBounds=function(){return assert(Ke),Ke},we.getPageScaleFactor=function(){var e=[];return mat4.getScaling(e,Xe),assert(e[0]===e[1]),e[0]},we.set2DCanvasAccelerationEnabled=function(e){var t,n,r=BrowserDetect.isAndroidChrome()?25:100;if(BrowserDetect.isChrome()){if(e)return void(Le=[]);if(!Le.length)for(t=0;r>t;t+=1)n=document.createElement("canvas"),n.width=257,n.height=256,n.getContext("2d").clearRect(0,0,1,1),Le.push(n)}},we.getActiveVideoNode=function(){var e,t,n=null,r=Util.dictValues(we.getLayerTree().getRoot().getSubTreeLayersByKey("video"));for(r.sort(function(e,t){return e.isOccludedBy(t)?1:-1}),e=0;e<r.length&&(t=r[e].getVideoDelegate(),!(t&&(n=t.getVideoNode(),n&&n.videoWidth>0&&n.videoHeight>0)));e+=1);return n},we.isFullscreen=function(){return e.fullscreen.isFullscreen()},we.getLayoutViewportDiv=function(){return ve},ne()},Compositor.Colorizer=function(){function e(){var e,t=[];for(e=0;3>e;e+=1)t.push(Math.floor(255*Math.random()));return t}function t(){var t;for(t=0;1e3>t;t+=1)r.push(e())}var n={},r=[];return n.getRGB=function(e){return r[e%r.length]},t(),n}(),Compositor.VectorClock=function(e){var t=this,n=e.slice();t.tick=function(e){assert(e<n.length),n[e]+=1},t.isLessThan=function(e){var t,r=!1;for(assert(n.length===e.clock.length),t=0;t<n.length;t+=1){if(e.clock[t]<n[t])return!1;n[t]<e.clock[t]&&(r=!0)}return r},t.isConcurrentWith=function(e){return!t.isLessThan(e)&&!e.isLessThan(t)},t.isEqual=function(e){var t;for(assert(n.length===e.clock.length),t=0;t<n.length;t+=1)if(n[t]!==e.clock[t])return!1;return!0},t.update=function(e){var t;for(assert(n.length===e.clock.length),t=0;t<n.length;t+=1)n[t]=Math.max(n[t],e.clock[t])},t.clock=n};var bcstats={total_canvas_bytes:0,nr_solid_color_tiles:0,nr_canvas_tiles:0};Compositor.TileRasterFlags=Object.freeze({kLowRes:1,kDisableRasterCache:2,kTextBoxes:4}),Compositor.TileType=Object.freeze({kSolidColor:0,kCanvas:1}),Compositor.BigCanvas=function(e){function t(e){var t=4;return Math.ceil(Sk.Rect.getWidth(e.rect)*Sk.Rect.getHeight(e.rect)*t*e.rsf*e.rsf)}function n(e,t){return e|t<<16}function r(e,t){return assert("number"==typeof e&&"number"==typeof t),x[n(e,t)]}function i(t){var n,r,i=document.createElement("div");return i.style.display="none",i.style.position="absolute",i.style.left=Sk.Rect.getX(t.rect)+"px",i.style.top=Sk.Rect.getY(t.rect)+"px",i.style.backgroundColor="teal",i.style.color="white",i.style.whiteSpace="nowrap",i.style.pointerEvents="none",i.style.fontSize="12px",i.className="sv-tile-label",r="["+e.layer.getID()+"] X: "+t.index_x+", Y: "+t.index_y,r+=" "+C+"x"+E,r+=" T: ",r+=t.type===Compositor.TileType.kCanvas?"C":"S",r+=" RSF: "+t.rsf.toFixed(1),t.canvas&&t.canvas.getDevice()&&(n=(t.canvas.getDevice().getMemoryUsage()/1048576).toFixed(1),r+=" "+n+" MB"),i.textContent=r,i}function o(t){var n,r,i,o={};return n=new Sk.HTMLCanvasDevice("tile",Sk.Rect.roundOut0(Sk.Rect.scale(t.rect,t.rsf)),{x:Sk.Rect.getX(t.rect),y:Sk.Rect.getY(t.rect)},t.rsf),n.tryAlloc()?(o.use_raster_cache=!(T&Compositor.TileRasterFlags.kDisableRasterCache),o.text_boxes=!!(T&Compositor.TileRasterFlags.kTextBoxes),r=new Sk.Canvas(n,e.needs_redraw_fn,o,{lid:e.layer.getID()}),i=r.getNode(),i.style.position="absolute",i.style.left=Sk.Rect.getX(t.rect)+"px",i.style.top=Sk.Rect.getY(t.rect)+"px",i.style.width=Sk.Rect.getWidth(t.rect)+"px",i.style.height=Sk.Rect.getHeight(t.rect)+"px",i.className=e.class_name||"sv-tile",DEBUG&&i.setAttribute("rect",Sk.Rect.toString(t.rect)),r):null}function a(t){var n=document.createElement("div");return n.style.position="absolute",n.style.left=Sk.Rect.getX(t)+"px",n.style.top=Sk.Rect.getY(t)+"px",n.style.width=Sk.Rect.getWidth(t)+"px",n.style.height=Sk.Rect.getHeight(t)+"px",n.className=e.class_name||"sv-tile",n}function s(t){var n=!0;return e.disable_opt?!1:void 0===t.solid_color?!1:Sk.Color.isTransparent(t.solid_color)?!0:(Util.forEachItem(A,function(e,r){return Sk.Rect.intersects(Sk.Rect.bboxRect(r),t.rect)?(n=!1,!0):void 0}),n)}function c(){return T&Compositor.TileRasterFlags.kLowRes?1:Math.ceil(e.layer.getRasterScaleFactor())}function l(r,l){var d=Sk.Rect.fromXYWH(C*r,E*l,C,E),u=e.display_list.getSolidColorInRect(d),f={rect:d,solid_color:u,index_x:r,index_y:l,key:n(r,l),lid:e.layer.getID(),rsf:c(),raster_flags:T};if(s(f))f.type=Compositor.TileType.kSolidColor,f.div=a(d),f.div.style.backgroundColor=Sk.Paint.skColorToCSSColor(u),b.appendChild(f.div),bcstats.nr_solid_color_tiles+=1;else{if(f.type=Compositor.TileType.kCanvas,f.canvas=o(f),bcstats.nr_canvas_tiles+=1,!f.canvas)return null;b.appendChild(f.canvas.getNode()),bcstats.total_canvas_bytes+=t(f)}return DEBUG&&(f.label_div=i(f),b.appendChild(f.label_div)),f}function d(e){assert(x[e.key]),delete x[e.key],e.type===Compositor.TileType.kCanvas?(e.canvas&&(b.removeChild(e.canvas.getNode()),e.canvas.release(),e.canvas=null,bcstats.total_canvas_bytes-=t(e)),bcstats.nr_canvas_tiles-=1):(assert(e.type===Compositor.TileType.kSolidColor),b.removeChild(e.div),e.div=null,e.destroyed=!0,bcstats.nr_solid_color_tiles-=1),e.label_div&&e.label_div.parentNode&&e.label_div.parentNode.removeChild(e.label_div)}function u(e,t){var n,i,o,a,s,c,l=Sk.Rect.intersection(k,e);if(assert(e),assert(t),!Sk.Rect.isEmpty(l))for(o=Math.floor(Sk.Rect.getY(l)/E),a=Math.floor((Sk.Rect.getBottom(l)-1)/E),s=Math.floor(Sk.Rect.getX(l)/C),c=Math.floor((Sk.Rect.getRight(l)-1)/C),assert(a<Math.ceil(S.height()/E),{height:S.height(),tile_height:E,end_r:a,rect:l}),assert(c<Math.ceil(S.width()/C)),n=o;a>=n;n+=1)for(i=s;c>=i;i+=1)t(r(i,n),i,n)}function f(e){return void 0!==e}function p(e,t){e.save(),e.clipQuad(t,Sk.ClipOp.kIntersect),e.clearRect(Sk.Rect.bboxRect(t)),e.restore()}function _(e,t,n){assert(!Sk.Rect.isEmpty(n)),t.save(),t.clipRect(n),Util.forEachItem(A,function(e,n){p(t,n),t.clipQuad(n,Sk.ClipOp.kDifference)}),e(t,n),t.restore()}function g(){var t,n,r,i=0,o=0,a=e.layer.getViewportScaleFactor();return e.layer.isAttached()?(t=e.layer.getCompositor().getViewportRect(),n=Sk.Rect.fromWH(Sk.Rect.getWidth(t),Sk.Rect.getHeight(t)/L),r=Sk.Rect.roundOut0(Sk.Rect.scale(n,1/a)),i=Math.min(R,Sk.Rect.getWidth(r)),o=Math.min(D,Sk.Rect.getHeight(r)),assert(i>0&&o>0,{w:i,h:o,local_tile_size:r}),{width:i,height:o}):{width:0,height:0}}function h(){var e=g(),t=e.width,n=e.height;return t=Math.min(Sk.Rect.getWidth(k),t),n=Math.min(Sk.Rect.getHeight(k),n),t=Math.ceil(t),n=Math.ceil(n),t=Math.min(R,t),n=Math.min(D,n),assert("number"==typeof t),assert("number"==typeof n),{width:t,height:n}}function m(t,n,r,i,o){var a=t.getCullRect();i.save(),i.clipRect(a),e.delta_mode||n||i.clearRect(o),i.translate(Sk.Rect.getX(a),Sk.Rect.getY(a)),t.playback(i,r),i.restore()}function v(t,n,r,i){e.display_list.forEachTileInRect(i,function(i,o){var a=e.display_list.getTileByKey(i);a&&a.getRecording()&&m(a.getRecording(),t,n,r,o)})}function y(e){u(e,function(e){e&&e.type===Compositor.TileType.kSolidColor&&(assert(void 0!==e.key),assert("number"==typeof e.solid_color),d(e))})}function w(){b=document.createElement("div"),b.style.overflow="hidden",b.style.padding="0px",b.style.margin="0px",S.resize(0,0,"init"),assert(e.needs_redraw_fn)}var b,k,S=this,C=0,E=0,x={},A={},T=0,R=2048,D=512,L=2;S.getDomNode=function(){return assert(b),b},S.width=function(){return Sk.Rect.getWidth(k)},S.height=function(){return Sk.Rect.getHeight(k)},S.setRasterFlags=function(e){assert("number"==typeof e),T=e},S.freeAllTilesExcept=function(e,t){var n,r=0,i={},o=Date.now();e&&u(e,function(e){e&&(assert(void 0!==e.key),i[e.key]=e)}),Util.forEachItem(x,function(e,t){i.hasOwnProperty(e)||(d(t),r+=1)}),x=i,n=Date.now()-o},S.drawTilesInRect=function(t,n){assert(Sk.Rect.isValid(t)&&n);var r=Sk.Rect.intersection(k,t),i=!0;return Sk.Rect.isEmpty(r)?i:(u(r,function(o,a,s){var c,u,p=!1;if(assert(!o||void 0!==o.type),o&&o.type===Compositor.TileType.kSolidColor&&(assert(f(o.solid_color)),u=e.display_list.getSolidColorInRect(o.rect),f(u)?(assert(!o.destroyed),o.div.style.backgroundColor=Sk.Paint.skColorToCSSColor(u),o.solid_color=u):p=!0),o&&o.force_realloc&&(p=!0),p&&(d(o),o=null),!o){if(o=l(a,s),!o)return void(i=!1);x[o.key]=o,assert(!o.force_realloc)}return c=p?o.rect:Sk.Rect.intersection(r,o.rect),o.type===Compositor.TileType.kSolidColor?void e.display_list.clearDirtyRect(c):(assert(o.type===Compositor.TileType.kCanvas),void(o.canvas&&(e.display_list.clearDirtyRect(c),assert(!Sk.Rect.isEmpty(c),{index_x:a,index_y:s,clipped_rect:r,tile_rect:o.rect,rect:t,size_rect:k}),_(n,o.canvas,c))))}),i)},S.hardInvalidateTilesInRect=function(t,n){u(t,function(t){t&&(void 0===n||t.raster_flags&n)&&(t.force_realloc=!0,e.needs_redraw_fn(t.rect,"invalidate-tiles"))})},S.hardInvalidateWithTileRecalc=function(){var e;S.hardInvalidateTilesInRect(k),e=h(),C=e.width,E=e.height},S.resize=function(t,n,r){assert("number"==typeof t),assert("number"==typeof n);var i,o,a=k;a&&Sk.Rect.getWidth(a)===t&&Sk.Rect.getHeight(a)===n||(i=Sk.Rect.fromWH(t,n),S.freeAllTilesExcept(null,"resize"),k=i,Sk.Rect.isEmpty(i)||(o=h(),C=o.width,E=o.height,e.needs_redraw_fn(i,"resize"),b.style.width=t+"px",b.style.height=n+"px"))},S.drawRect=function(e,t,n){return S.drawTilesInRect(e,v.curry(t,n))},S.playback=function(e,t,n,r){return S.drawTilesInRect(t,m.curry(e,n,r))},S.hasNoDrawQuads=function(){return!Util.isDictEmpty(A)},S.registerNoDrawQuad=function(t,n){var r=Sk.Rect.bboxRect(n);assert(void 0!==t&&void 0!==n),A[t]=n,y(r),e.needs_redraw_fn(r,"register-no-draw-quad")},S.deregisterNoDrawQuad=function(t){var n=A[t];delete A[t],n&&e.needs_redraw_fn(Sk.Rect.bboxRect(n),"deregister-no-draw-quad")},S.release=function(){S.freeAllTilesExcept(null,"release"),k=Sk.Rect.makeEmpty(),b&&b.parentNode&&(b.parentNode.removeChild(b),b=null)},w()},Compositor.Input=function(e,t){function n(){return!!me}function r(){if(ae&&t.hasMainThreadScrollingReasons())return!0;if(pe)return!0;if(t.hasBlockingWheelEventListener()){if(ae)return!0;if(n())return!0}return!1}function i(t){e.surrogate_channel&&e.surrogate_channel.send.apply(e.surrogate_channel,t)}function o(e){document.documentElement.style.cursor=e}function a(e){var t,n="default";return e.url?n="pointer":(e.is_text||e.is_editable)&&(n="text"),t=e.cursor_name,"auto"!==t&&(n=t),n}function s(e){return!!Util.findPredicateOnBranch(e.target,function(e){return e.getAttribute&&!!e.getAttribute("sv-prevent-push")})}function c(e){if(e.button===ie||e.button===oe)return!0;if(BrowserDetect.isMac()&&e.button===re){if(e.ctrlKey)return!0;if(e.metaKey)return!0}return s(e)}function l(e){return c(e)?!1:"click"===e.type}function d(e){assert(void 0!==e.x&&void 0!==e.y);var n,r=t.hitTest(Compositor.HitTest.kLayer,e);return r?(n=r.getScrollContainer(),
!n||n.isRoot()||n.isOuterViewportContainerLayer()?null:n):null}function u(e){var t=d({x:e.clientX,y:e.clientY});return t?(assert(void 0!==e.deltaX&&void 0!==e.deltaY),t.simulateUserScrollBy(e.deltaX,e.deltaY),!0):!1}function f(e){return l(e)?void e.preventDefault():(c(e)&&e.stopPropagation(),void("wheel"!==e.type||r()||u(e)&&e.preventDefault()))}function p(e,t,n,r,i,o){var a=e?EventListener.addListener:EventListener.removeListener;assert(t),assert(r),n.forEach(function(e){a(t,e,r,!!i,!!o)})}function _(e){var t=e.target.value,n=e.target.node_id;assert(t),assert(n),i(["CM-select",String(n),Number(t)])}function g(e,t,n){var r,i,o;return r=document.createElement("select"),r.setAttribute("sv-prevent-push",!0),r.style.position="fixed",r.style.left=Sk.Rect.getLeft(n)+"px",r.style.top=Sk.Rect.getTop(n)+"px",r.style.width=Sk.Rect.getWidth(n)+"px",r.style.height=Sk.Rect.getHeight(n)+"px",r.style.opacity="0",r.style.zIndex=String(Compositor.ZIndexRange.kHitEmulation[0]),r.style.cursor="inherit",o=null,t.forEach(function(e){switch(e.type){case"separator":i=document.createElement("option"),i.textContent="-----",i.setAttribute("disabled",!0),r.appendChild(i),o=null;break;case"group":i=document.createElement("optgroup"),i.setAttribute("label",e.label),r.appendChild(i),o=i;break;case"option":i=document.createElement("option"),i.textContent=e.label,i.setAttribute("value",e.index),e.checked&&i.setAttribute("selected",!0),e.enabled||i.setAttribute("disabled",!0),e.in_group?o.appendChild(i):(o=null,r.appendChild(i));break;default:ee.error({event:"tc-unrecognized-select-item-type",type:e.type})}}),r.node_id=e,p(!0,r,["change"],_,!1),r}function h(t){var n=document.createElement("a"),r=document.createElement("div");return r.style.position="fixed",r.style.left=Sk.Rect.getLeft(t.viewport_bounds)+"px",r.style.top=Sk.Rect.getTop(t.viewport_bounds)+"px",r.style.width=Sk.Rect.getWidth(t.viewport_bounds)+"px",r.style.height=Sk.Rect.getHeight(t.viewport_bounds)+"px",r.style.zIndex=String(Compositor.ZIndexRange.kHitEmulation[0]),n.style.cursor="inherit",n.href=Util.rewriteRawHref(t.url),n.appendChild(r),t.link_target_blank&&n.addEventListener("click",function(n){e.tab.tabPreOpen(t.url)&&n.preventDefault()},!1),n}function m(e){return e.select_items&&e.select_items.length?g(e.node_id,e.select_items,e.viewport_bounds):e.url?h(e):null}function v(e){p(e,Q,["mousedown","mouseup","click"],f,!1),e&&($=!d(se)),p(e,Q,["wheel"],f,!1,$)}function y(){return Q?(Q.parentNode.removeChild(Q),v(!1),Q=null,!0):!1}function w(e,t){var n;assert(t),y(),de=t,n=m(t),n&&(document.body.appendChild(n),Q=n,v(!0))}function b(e,t){assert(t),o(a(t)),w(e,t)}function k(e){var n=pe;pe=t.hitTest(Compositor.HitTest.kNonFastRegion,e),pe!==n&&X()}function S(){q&&(assert(z),clearTimeout(q),q=null,i(z),z=null,Y=null)}function C(e){return BrowserDetect.isIE()&&("mousedown"===e.type||"mouseup"===e.type||"mousemove"===e.type)&&e.detail>=4&&e.detail>_e?_e:e.detail}function E(e){!BrowserDetect.isIE()||"mousedown"!==e.type&&"mouseup"!==e.type&&"mousemove"!==e.type||("mousedown"===e.type?(_e+=1,J&&(clearTimeout(J),J=null)):"mouseup"===e.type&&(J=setTimeout(function(){_e=0},500)))}function x(e){return"mousedown"===e.type||"mouseup"===e.type}function A(e){var t,n=e.target?Util.get_node_tag(e.target):null;return document.documentElement?e.target&&"html"!==n?(assert(e.target&&n),"div"===n?(t=e.target.getBoundingClientRect(),e.clientX>t.left+e.target.clientWidth&&e.clientY>t.top+e.target.clientHeight?!1:e.clientX>t.left+e.target.clientWidth||e.clientY>t.top+e.target.clientHeight):!1):e.clientX>document.documentElement.clientWidth||e.clientY>document.documentElement.clientHeight:!1}function T(n){var r,o,a;return E(n),r=["CM-mouse",n.type,n.clientX,n.clientY,n.button,Util.getMouseAndKeyboardModifiers(n,ee),C(n)],ge.last_mouse_time=Date.now(),e.detached?(e.detached=!1,void window.location.reload()):t.in_page_searcher.mouse_event_search_input(n)||s(n)||A(n)?void 0:"contextmenu"===n.type?void(e.ctx_menu_mode&&e.ctx_menu_mode.backend_driven&&n.preventDefault()):void(("mousemove"!==n.type||"mousemove"!==se.type||n.clientX!==se.x||n.clientY!==se.y)&&(se.x=n.clientX,se.y=n.clientY,se.type=n.type,"mousemove"===n.type&&(o=Util.calculateMouseMovement(n),Y&&(o.x+=Y.x,o.y+=Y.y),r.push(o.x),r.push(o.y)),"mousemove"!==n.type||n.buttons?(S(),i(r)):(q||(q=setTimeout(function(){S()},ne)),z=r,Y=o),k(se),x(n)&&("mousedown"===n.type?he[n.button]=!0:he[n.button]=!1,ge.last_click_time=Date.now(),n.preventDefault(),BrowserDetect.isIE()&&"mousedown"===n.type&&(a=document.activeElement,document.body.focus(),a&&a.focus()))))}function R(t){"html"===Util.get_node_tag(t.target)&&delete e.last_mouse_pos}function D(t,n,r,i,o,a,s,c){i.relative_to_target=!1,e.surrogate_channel.send("drag",t,{t:n,y:r,p:i,m:o,d:a,f:s,i:c})}function L(){ue&&(D(ue.frame,ue.node,"dragleave",{x:0,y:0},{x:0,y:0},0,[{type:"text/plain"}],{0:{}}),ue=null,fe=null)}function P(t){var n,r,o,a,s,c,l,d;return e.allow_backend_dragdrop?de?(s=de.frame_id,c=de.node_id,a=t.type,t.preventDefault(),"drop"===a&&e.upload.setupDroppedUpload(t.dataTransfer.files),n={x:t.clientX,y:t.clientY},r=Util.calculateDragMovement(t),o=Util.getMouseAndKeyboardModifiers(t,ee),l=Util.gen_dragdrop_file_list(t.dataTransfer),d=t.dataTransfer.items,ue&&c===ue.node||(D(s,c,"dragenter",n,{x:0,y:0},o,l,d),ue&&D(ue.frame,ue.node,"dragleave",n,{x:0,y:0},o,l,d)),D(s,c,a,n,r,o,l,d),"drop"===a?void(ue=null):(ue={frame:s,node:c},fe&&clearTimeout(fe),void(fe=setTimeout(L,550)))):(console.debug("No hit test results yet"),void i(["CM-mouse","mousemove",t.clientX,t.clientY,t.button,Util.getMouseAndKeyboardModifiers(t,ee),t.detail])):void console.debug("No Backend drop Handlers")}function U(e,t,n){return t||n||"keydown"===e.type&&!ce.SPECIAL_KEYS.hasOwnProperty(e.keyCode)}function I(n){var r=0,o=ce.getKeyCode(n),a=n.ctrlKey,c=n.metaKey,l=!1,d=["#","@","/","\\","$","Â£","â¬","{","[","}","]","Âµ","|"];return ge.last_key_time=Date.now(),e.detached?(e.detached=!1,void window.location.reload()):(e.callback.fire("key-event",n.target,n),void(e.print_handler.handlePrintKeyEventIfNeeded(n,le.get_operation(n))||("keypress"===n.type&&-1!==d.indexOf(n.key)&&(a=!1,c=!1,l=!0),("keyup"===n.type||l||!le.tryProcess(n))&&(t.in_page_searcher.is_key_event_search_input(n)||s(n)||(i(["keyboard",e.fid||0,r,n.type,n.keyCode,n.charCode,o,n.shiftKey,a,c]),(!U(n,c,a)||t.in_page_searcher.is_search_operation(n))&&n.preventDefault())))))}function O(e){y(),Z&&clearTimeout(Z),Z=setTimeout(function(){var t=["CM-mouse","mousemove",e.clientX,e.clientY,0,0,0,0,0];i(t),Z=null},100)}function B(e){t.isDebugEnabled()&&(we||(we=t.getHUD().addWidget("sv-wheel-handler-mode"),we.style.position="fixed",we.style.left="95%",we.style.top="70%",we.style.transform="translate(-50%, -50%)",we.style.padding="10px",we.style.color="yellow",we.style.backgroundColor="rgba(40, 40, 40, 0.9)",we.style.borderRadius="3px 3px 3px 3px"),t.getHUD().updateWidget(we,e))}function M(n){var o=Math.round(n.deltaX),a=Math.round(n.deltaY),c=void 0===n.wheelDeltaX?-3*o:n.wheelDeltaX,l=void 0===n.wheelDeltaY?-3*a:n.wheelDeltaY,d=e.xbrowser.getEventTarget(n);if(!d)return void ee.error({event:"tc-wheel-event-error",reason:"invalid target"});if(d.getAttribute&&(O(n),!s(n))){if(k({x:n.clientX,y:n.clientY}),r())return B("Main-thread scrolling"),i(["CM-wheel",n.clientX,n.clientY,o,a,c,l,!0]),void n.preventDefault();B(),t.hasWheelEventListener()&&i(["CM-wheel",n.clientX,n.clientY,o,a,c,l,!1])}}function N(e){var t=e?EventListener.addListener:EventListener.removeListener;t(document,"mousemove",T,!1),t(document,"mousedown",T,!1),t(document,"contextmenu",T,!1),t(document,"mouseup",T,!1),t(document,"mouseout",R,!1)}function F(e){var t=e?EventListener.addListener:EventListener.removeListener;t(document,"dragover",P,!1),t(document,"drop",P,!1)}function V(t){var n=t?EventListener.addListener:EventListener.removeListener;n(document,"keydown",I,!1),n(document,"keypress",I,!1),n(document,"keyup",I,!1),e.print_handler.attachKeyEventHandler(t)}function H(e,t){G&&(EventListener.removeListener.apply(Util,G),G=null),e&&(G=[document,"wheel",M,!1,t],EventListener.addListener.apply(Util,G))}function X(){H(!0,!r())}function K(e,t,n,r,i,o,a,s){var c=["CM-mouse",e,t,n,r||0,i||0,o||0];return void 0!==a&&c.push(a),void 0!==s&&c.push(s),c}function W(){Util.forEachItem(he,function(e,t){t&&(he[e]=!1,i(K("mouseup",se.x,se.y,e)))})}function j(){F(!0),V(!0),X(),t.callback.register("wheel-handler-state-changed",X),t.callback.register("wheel-event-listener-changed",X),t.callback.register("main-thread-scrolling-changed",X),t.callback.register("pre-scroll-update",function(){W()}),N(!0)}var z,Y,Q,G,q,J,Z,$,ee=new Logger("r2-input",{level:"info"}),te=this,ne=10,re=0,ie=1,oe=2,ae=!1,se={x:0,y:0,type:""},ce=new KeyMap,le=new ShortcutKeyHandler(e),de=null,ue=null,fe=null,pe=!1,_e=0,ge={last_click_time:0,last_mouse_time:0,last_key_time:0},he={},me=!1,ve=null,ye=5e3,we=null;te.handleHitElementMouseEvent=f,e.interp.registerOpcodeHandler("htr",function(e,n,r,i,o,a,s,c,l,d){var u={is_text:n,is_selected:r,is_editable:i,url:o,link_target_blank:a,cursor_name:s,frame_id:e,node_id:c,viewport_bounds:l,select_items:d};b(se,u),t.selection.onHitTestResult(u)}),e.interp.registerOpcodeHandler("did_wh_pd",function(){me=!0,t.callback.fire("wheel-handler-state-changed"),ve&&clearTimeout(ve),ve=setTimeout(function(){me=!1,t.callback.fire("wheel-handler-state-changed")},ye)}),te.getLastMousePos=function(){return{x:se.x,y:se.y}},te.getLastActivityTime=function(){return{key:ge.last_key_time,mouse:ge.last_mouse_time,click:ge.last_click_time,input:Math.max(ge.last_key_time,ge.last_mouse_time)}},j()},Compositor.IME=function(e){function t(e){switch(e){case"compositionstart":return T;case"compositionupdate":return R;case"compositionend":return D}}function n(){var e=p.value.substring(A);return e}function r(){var e,t,n=0;assert(p),y&&(n=15),e=_+n,use_old_ime||BrowserDetect.isIE()||BrowserDetect.isEdge()||(e-=E),t=g+n,use_old_ime?(p.style.top=t+"px",p.style.height=m+"px"):(p.style.top=t+m-C+"px",p.style.height=C+"px"),p.style.left=e+"px",use_old_ime?BrowserDetect.isIE10()?(p.style.top=t+m+"px",p.style.padding="0px",y||(p.style.height="0px")):(BrowserDetect.isIE()||BrowserDetect.isEdge())&&(p.style.left=e-x+"px",p.style.textIndent=x+"px"):(BrowserDetect.isIE()||BrowserDetect.isEdge())&&(p.style.padding="0px",y||(p.style.height="0px"))}function i(){w=!1,k=0,b&&(r(),b=!1)}function o(n){switch(n.type){case"compositionend":e.surrogate_channel.send("composition",D,n.data,n.data.length),v=null,use_old_ime?p.value="":A=p.value.length,i();break;case"compositionstart":case"compositionupdate":w=!0,v={},v.data=n.data,v.type=t(n.type);break;case"selectionchange":v&&(e.surrogate_channel.send("composition",v.type,v.data,p.selectionEnd-A),v=null);break;case"textInput":if(w)break;use_old_ime&&soft_assert(""===p.value),e.surrogate_channel.send("composition",T,n.data,0),e.surrogate_channel.send("composition",D,n.data,n.data.length),i(),n.preventDefault()}}function a(o){function a(){var e,t,r,i,a=o.data,s=n(),c=p.selectionEnd-A;if(DEBUG,!a)return{finalized_text:"",transient_text:n()};for(t=c-1,r=a.length-1;t>=k&&a[r]===s[t];)t-=1,r-=1;return e=k,k=t+1,i={finalized_text:s.substring(e,k),transient_text:s.substring(k,s.length)}}function s(){var t=n();t=t.substring(k,t.length),e.surrogate_channel.send("composition",D,t,t.length),use_old_ime?p.value="":A=p.value.length,i()}function c(t){e.surrogate_channel.send("composition",D,t,t.length),k+=1,setTimeout(function(){w||(use_old_ime?p.value="":A=p.value.length,i())},0)}var l,d,u;switch(o.type){case"compositionend":Util.is_korean_char(o.data)?c(o.data):s(),w=!1;break;case"compositionstart":case"compositionupdate":w=!0,l=a(),d=l.finalized_text,u=l.transient_text,d&&(e.surrogate_channel.send("composition",R,d,d.length),e.surrogate_channel.send("composition",D,d,d.length)),u&&e.surrogate_channel.send("composition",t(o.type),u,u.length),!use_old_ime&&d&&b&&(BrowserDetect.isIE()||BrowserDetect.isEdge())&&(r(),b=!1);break;case"selectionchange":w&&e.surrogate_channel.send("composition",R,n(),p.selectionEnd-A)}}function s(r){switch(r.type){case"compositionend":e.surrogate_channel.send("composition",D,r.data,r.data.length),v=null,use_old_ime?p.value="":A=p.value.length,i();break;case"compositionstart":case"compositionupdate":w=!0,v={},v.data=r.data,v.type=t(r.type);break;case"input":v?(e.surrogate_channel.send("composition",v.type,v.data,p.selectionEnd-A),v=null):w&&e.surrogate_channel.send("composition",R,n(),p.selectionEnd-A)}}function c(){var e,t,n,r={Chrome:["selectionchange","textInput"],Explorer:["selectionchange"],Firefox:["input"],Edge:[],Other:[]},i={Chrome:o,Explorer:a,Firefox:s,Edge:a,Other:o};for(e=r[browser.name]||r.Other,e=e.concat(["compositionstart","compositionupdate","compositionend"]),t=i[browser.name]||i.Other,n=0;n<e.length;n+=1)"selectionchange"===e[n]?EventListener.addListener(document,e[n],t,!0):EventListener.addListener(p,e[n],t,!0)}function l(){p||(p=document.createElement("input"),A=0,p.id="ime_overlay",p.setAttribute("type","text"),p.style.position="fixed",y||(p.style.opacity=0),p.style.backgroundColor="yellow",p.style.width=S+"px",p.style.borderWidth="0px",p.style.paddingLeft="0px",p.style.zIndex=String(Compositor.ZIndexRange.kIMEOverlay[0]),p.style.pointerEvents="none",p.disabled=!0,use_old_ime||(p.style.paddingLeft=E+"px",p.style.letterSpacing="-1em"),document.body.appendChild(p),c())}function d(e,t,n,i){var o=t===g;DEBUG,w&&o&&(b=!0),_=e,g=t,h=i,m=h-g,p||l(),b||(use_old_ime||o||w||(p.value="",A=0),r())}function u(e){if(p&&!w){if(!e)return void(p.disabled=!0);p.disabled=!1,document.activeElement!==p&&p.focus()}}function f(){e.interp.registerOpcodeHandler("caret_pos",d),e.interp.registerOpcodeHandler("ready_for_input",u)}var p,_,g,h,m,v,y=!1,w=!1,b=!1,k=0,S=100,C=12,E=20,x=-300,A=0,T=0,R=1,D=2;f()},Compositor.Selection=function(e){function t(){function t(){_=function(t){p.style.left=w.is_editable||w.is_selected?t.clientX-m/2+"px":t.clientX+m/2+"px",p.style.top=t.clientY-m/2+"px",e.compositor.input.handleHitElementMouseEvent(t)},EventListener.addListener(document,"mousemove",_,!1,!0),EventListener.addListener(document,"mousedown",_,!1),EventListener.addListener(document,"wheel",_,!1)}function n(){EventListener.removeListener(document,"mousemove",_,!1),EventListener.removeListener(document,"mousedown",_,!1),EventListener.removeListener(document,"wheel",_,!1),_=void 0}function r(){p||(p=document.createElement("div"),p.style.position="fixed",h||(p.style.opacity=0),p.style.backgroundColor="blue",p.style.height=m+"px",p.style.width=m+"px",p.style.borderWidth="0px",p.style.zIndex=String(Compositor.ZIndexRange.kSelectionOverlay[0]),document.body.appendChild(p),t()),C&&(p.style.display="none")}function i(){p&&(p.parentNode.removeChild(p),p=void 0,n())}return v||y?(r(),p.contentEditable=y,void(p.style.textIndent=v||!BrowserDetect.isIE()?"0px":"-99999px")):void i()}function n(e){var t=k||b;t&&(BrowserDetect.isEdge()?e.clipboardData.setData("text",t.text):e.clipboardData?(e.clipboardData.setData("text/plain",t.text),t.html&&e.clipboardData.setData("text/html",t.html)):window.clipboardData.setData("text",t.text),e.preventDefault())}function r(e){e!==v&&(v=e,t())}function i(){var e,t,n=k||b;p&&(n?(p.textContent=n.text,e=document.createRange(),e.selectNodeContents(p),t=window.getSelection(),t.removeAllRanges(),t.addRange(e)):p.textContent="")}function o(e,t){b=JSON.parse(t),b.text?(r(!0),i()):(r(!1),b=null)}function a(e,t,n,o){t?(k={text:n,html:o},r(!0)):(k=null,b||r(!1)),i()}function s(t){var n=Util.makePasteDataList(t,window);e.surrogate_channel.send("paste",1,1,n),t.preventDefault()}function c(e){e!==y&&(y=e,t())}function l(){i()}function d(e,t,n){n&&(S=!0,c(!0))}function u(e,t,n){n&&!w.is_editable&&(c(!1),S=!1)}function f(){h&&(m*=4),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_SET_SELECTIONS,o),e.interp.registerOpcodeHandler("copy_handler_content",a),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_FOCUS_ELEMENT,d),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_FOCUS_OUT,u),EventListener.addListener(document,"paste",s,!1),EventListener.addListener(document,"copy",n,!1),EventListener.addListener(document,"contextmenu",l,!1)}var p,_,g=this,h=!1,m=10,v=!1,y=!1,w={},b=null,k=null,S=!1,C=!1;g.onHitTestResult=function(e){p&&w.is_selected!==e.is_selected&&(e.is_selected?i():p.textContent=""),w=e,e.is_selected?r(!0):b||r(!1),e.is_editable?c(!0):S||c(!1)},g.disable=function(){C=!0,p&&(p.style.display="none")},g.enable=function(){C=!1,p&&(p.style.display="")},f()},Compositor.Extras=function(e){function t(e){document.title=e}function n(){e.stats.stop("time_tc_dom_load"),e.stats.stop("time_tc_nav_load"),e.callback.fire("dom-loaded",{mode:"r2"})}var r=this;r.init=function(){e.interp.registerOpcodeHandler("set_title",t),e.interp.registerOpcodeHandler("did_finish_load",n),e.interp.registerOpcodeHandler("did_fail_load",n)}},Compositor.ScrollContentPrefetcher=function(e,t){function n(e){d!==e&&(d=e,t(Math.round(e)))}function r(){m&&(clearTimeout(m),m=null)}function i(e,t){r(),n(f),m=setTimeout(function(){n(p),m=null,t&&t()},e)}function o(){i(_)}function a(){r(),n(p)}function s(){v+=1,v>h&&(a(),v=0)}function c(){e.active_tab.is_active?i(_):a()}function l(){setTimeout(function(){i(g)},1e3)}var d,u=this,f=1e5,p=4096,_=3e3,g=1e4,h=200,m=null,v=0;u.init=function(){EventListener.addListener(window,"scroll",o),EventListener.addListener(document,"mousemove",s,!1),EventListener.addListener(document,"mousedown",s,!1),EventListener.addListener(document,"mouseup",s,!1),e.interp.registerOpcodeHandler("dfvnep",l),e.callback.register("window-became-active",c),e.callback.register("window-became-passive",c)}},Compositor.FlowController=function(e,t){function n(e){var n,r=Compositor.MessageFlags.kFrameDelay;return e=Math.floor(e),e===c?!1:(c=e,n=new Sk.BinaryWriter(8),n.writeUint32(r),n.writeUint32(e),t.sendCompositorMessage(n.getData()),!0)}function r(e){var t;return t=Util.isTabVisible()?p:_,Math.min(Math.max(e,f),t)}function i(e){var n=t.getFPS()*g;return Util.isTabVisible()?r(e||1e3/n):_}function o(e,t){var r=i(e);n(r)}function a(){return Util.isTabVisible()?(o(l||f,"became-visible"),void(l=null)):void(l||(l=c,o(_,"became-invisible")))}function s(){setInterval(o,u),EventListener.addListener(window,"visibilitychange",a),a()}var c,l,d=this,u=1e3,f=Math.floor(1e3/30),p=1e3,_=3e3,g=.5;d.getSenderDelay=function(){return c},s()},Compositor.DisplayListTile=function(e,t,n){function r(){}var i,o=this,a=Sk.Region.makeRect(Sk.Rect.intersection(n,e.getBoundsRect()));o.addDirtyRegion=function(e){Sk.Region.addRegion(a,e)},o.clearDirtyRect=function(e){Sk.Region.subtractRect(a,e)},o.getDirtyRegion=function(){return a},o.setRecording=function(e){i=e},o.getRecording=function(){return i},o.isDirty=function(){return!Sk.Region.isEmpty(a)},o.getKey=function(){return t},o.getTileRect=function(){return n},o.getLayer=function(){return e},o.getHitTestItems=function(e){var t,n;return i?(t=new Sk.HitTestCanvas,n=i.getCullRect(),t.save(),e&&t.clipRect(e),t.translate(Sk.Rect.getX(n),Sk.Rect.getY(n)),i.playback(t),t.restore(),t.getElements()):[]},r()},Compositor.DisplayList=function(e,t,n){function r(e,t){return assert("number"==typeof e),assert("number"==typeof t),Sk.Rect.fromXYWH(e*n.width,t*n.height,n.width,n.height)}function i(e,t){return assert("number"==typeof e&&"number"==typeof t),assert((65535&e)===e,{index_x:e}),assert((65535&t)===t,{index_y:t}),e|t<<16}function o(e){return Sk.Rect.isEmpty(e)||!Sk.Rect.intersects(e,t.getBoundsRect())?null:{start_y:Math.floor(Sk.Rect.getY(e)/n.height),end_y:Math.floor((Sk.Rect.getBottom(e)-1)/n.height),start_x:Math.floor(Sk.Rect.getX(e)/n.width),end_x:Math.floor((Sk.Rect.getRight(e)-1)/n.width)}}function a(n,r){var i=_[n];assert("number"==typeof n),i&&i.isDirty()&&(assert(i.getKey()===n),i.clearDirtyRect(r),i.isDirty()||(p-=1,assert(p>=0)),p||e.setLayerContentsDirty(t.getID(),!1))}function s(e){return assert("number"==typeof e),{x:65535&e,y:e>>16&65535}}function c(n,i,o){var a,c=_[n],l=!1;assert(void 0!==i),c?l=c.isDirty():(a=s(n),c=new Compositor.DisplayListTile(t,n,r(a.x,a.y)),_[n]=c),h=!0,c.addDirtyRegion(i),void 0!==o&&c.setRecording(o),c.isDirty()&&!l&&(p+=1,assert(p,{dirty_tile_count:p})),p&&e.setLayerContentsDirty(t.getID(),!0)}function l(e){var t=o(Sk.Rect.fromXYWH(e.x,e.y,1,1));return t?(assert(t.start_x===t.end_x),assert(t.start_y===t.end_y),_[i(t.start_x,t.start_y)]):null}function d(){var e={};return f.forEachTileInRect(t.getBoundsRect(),function(n){var r,i=_[n];i&&(r=i.getHitTestItems(),r.forEach(function(n){n.data&&(assert(void 0!==n.data.node_id),e[n.data.node_id]={item:n,layer:t})}))}),e}function u(){}var f=this,p=0,_={},g={},h=!1;f.forEachTileInRect=function(e,n){var a,s,c,l,d=Sk.Rect.intersection(e,t.getBoundsRect());if(assert(_),!Sk.Rect.isEmpty(d)&&(c=o(d)))for(s=c.start_y;s<=c.end_y;s+=1)for(a=c.start_x;a<=c.end_x;a+=1)if(l=Sk.Rect.intersection(r(a,s),d),!Sk.Rect.isEmpty(l)&&n(i(a,s),l)===!1)return},f.getTileByKey=function(e){return _[e]},f.clearDirtyRect=function(e){f.forEachTileInRect(e,function(e,t){a(e,t)})},f.invalidateRect=function(n,r){return n=n||t.getBoundsRect(),Sk.Rect.isEmpty(n)?void 0:t.isTextureLayer()?void e.setNeedsRepaint(t.getID(),n):void f.forEachTileInRect(n,function(e,t){c(e,Sk.Region.makeRect(t))})},f.getSolidColorInRect=function(e){var n,r=0;return t.isPictureLayer()?(f.forEachTileInRect(e,function(e){var t,i=_[e];if(r+=1,!i)return n=void 0,!1;if(t=i.getRecording(),!t)return n=void 0,!1;if(1===r)n=t.solid_color;else if(n!==t.solid_color)return n=void 0,!1}),n):void 0},f.getHitItemsAtPoint=function(e){var t=l(e);return t?t.getHitTestItems(Sk.Rect.fromXYWH(e.x,e.y,1,1)):[]},f.getElements=function(){return(!g||h)&&(g=d(),h=!1),g},f.applyTileUpdates=function(e){var t,n,r;for(t=0;t<e.length;t+=1)n=e[t],r=i(n.index_x,n.index_y),n.skr.solid_color=n.solid_color,c(r,n.invalidation_region,n.skr)},u()},Compositor.ProjectionType={kViewport:0,kOVSL:1},Compositor.Projection=function(e,t,n,r){var i,o=this;o.getType=function(){return e},o.getMatrix=function(){return r},o.getInverseMatrix=function(){return void 0===i&&(i=mat4.invert(mat4.create(),r)),i},o.getProjectedClipRect=function(){return t},o.rectStaysRect=function(){return n},o.projectRect=function(e,i){var o=Compositor.Matrix3D.mapRect(r,e);return assert(o),i&&(o=Sk.Rect.intersection(o,t)),o.rect_stays_rect=n,o},o.getScaleFactor=function(){var e,t=[],n=Math.pow(2,-52);return mat4.getScaling(t,r),e=Math.max(n,Math.max(t[0],t[1])),assert("number"==typeof e&&!isNaN(e)),e},assert(e===Compositor.ProjectionType.kViewport||e===Compositor.ProjectionType.kOVSL),assert("object"==typeof t),assert("boolean"==typeof n),assert("object"==typeof r)},Compositor.Layer=function(e){function t(e){return assert(e,{f:e}),!!(He.flags&e)}function n(e){return assert(e,{f:e}),!!(He.dirty_props&e)}function r(){return Me.hasVideoContent()?Sk.Rect.getArea(Me.getBoundsRect())>4194304?{width:2048,height:2048}:Object.freeze(Me.getBounds()):Object.freeze(_e.getDisplayListTileSize())}function i(){return We}function o(){We=!0}function a(){We=!1}function s(){return t(Compositor.LayerFlags.kMasksToBounds)}function c(){return Sk.Rect.fromWH(Me.getBounds().width,Me.getBounds().height)}function l(e,t){var n,r;assert(t);for(n in e)e.hasOwnProperty(n)&&(r=_e.getLayer(n),r?t(r):delete e[n])}function d(){l(ze,function(e){assert(e),e.updatePosition()})}function u(){var e,t,n;return ve?BrowserDetect.isMobileSafari()?(e=ve.scrollLeft||ve.scrollX,t=ve.scrollTop||ve.scrollY,ve===window&&1!==MetricsUtils.getVisualViewportScale()&&(n=pe.getLayoutViewportDiv().getBoundingClientRect(),e+=n.x,t+=n.y),{x:e||0,y:t||0}):(void 0!==ve.pageYOffset?(e=ve.pageXOffset,t=ve.pageYOffset):(e=ve.scrollLeft||ve.scrollX,t=ve.scrollTop||ve.scrollY),{x:e||0,y:t||0}):{x:0,y:0}}function f(){var e,t=$e,n=Date.now()-Pe;tt>n||(e=Me.getBrowserScrollOffset(),Ie&&(Ze.x=(e.x-Ie.x)/n,Ze.y=(e.y-Ie.y)/n),Ie=e,Pe=Date.now(),$e=Math.abs(Ze.x)>et||Math.abs(Ze.y)>et?!0:!1,t!==$e&&pe.callback.fire("fling-change",$e))}function p(e){var t,n=[],r=Me.getBrowserScrollOffset(!0),i=Te;if(Te=r,we){if(r.x===we.x&&r.y===we.y)return void(we=null);we=null}if(!i||i.x!==r.x||i.y!==r.y){for(pe.callback.fire("scroll-container-scrolled"),assert(1===Ne.length),t=0;t<Ne.length;t+=1)Ne[t].invalidateSubtreeProjection(!Me.isOuterViewportContainerLayer());for(t=0;t<Ne.length;t+=1)n.push(Ne[t].id);n.length&&(be||setTimeout(function(){assert(be),pe.callback.fire("pre-scroll-update"),pe.sendScrollUpdate(n,be[0],be[1],Ke.clock),be=null},Xe),be=[r.x,r.y],Ke.tick(0),ke&&ke.hasStickyDescendants()&&ke.updateDescendantStickyPosition(r))}}function _(e,t){assert(t);for(var n=t.getParent();n;){if(e(n))return n;n=n.getParent()}return null}function g(e,t){var n,r,i;return assert(e),assert(t),e===t?{x:0,y:0}:(n=g(e.getParent(),t),r=e.getPosition(),i=e.getParent().getScrollOffset(),{x:n.x+r.x-i.x,y:n.y+r.y-i.y})}function h(e){return e.isOuterViewportScrollLayer()}function m(e){return e.isContainerForFixedPositionLayers()&&h(e)}function v(e){return _(m,e||Me)}function y(e){return m(e)&&!v(e)}function w(e){return _(function(e){var t=e.getScrollClipLayerId(),n=-1!==t;return e.isContainerForFixedPositionLayers()&&!n},e||Me)}function b(){var e=_(function(e){return e.isContainerForFixedPositionLayers()},Me);return assert(e),y(e)}function k(e,t){t=null===t?"":t,ge.style[e]!==t&&(ge.style[e]=t),pe.isDebugEnabled()&&(""===t?assert(!ge.style[e],{val:ge.style[e]}):assert(ge.style[e],{name:e,expected_value:t,actual_value:ge.style[e]}))}function S(){var e=w(),t=g(Me,e);return Me.isFixedToRightEdge()&&(t.x=Sk.Rect.getWidth(e.getBoundsRect())-t.x-Sk.Rect.getWidth(Me.getBoundsRect())),Me.isFixedToBottomEdge()&&(t.y=Sk.Rect.getHeight(e.getBoundsRect())-t.y-Sk.Rect.getHeight(Me.getBoundsRect())),t}function C(){return Me.isFixedPositioned()?b()?!0:(assert_unimplemented(0,{event:"incomplete",lid:Me.id,what:"fixed-position prediction",reason:"sub-frame support unimplemented"}),!1):!1}function E(e,t){we={x:e,y:t};var n=e-Te.x,r=t-Te.y;ve===window?window.scrollBy(n,r):(ve.scrollLeft=e,ve.scrollTop=t),assert(1===Me.getChildren().length),Me.getChildren()[0].invalidateSubtreeProjection(!Me.isOuterViewportContainerLayer()),Be=null}function x(){Me.hasFixedDescendants()&&d(),Me.hasStickyDescendants()&&Me.updateDescendantStickyPosition(Me.getScrollOffset()),Se&&Se.setScrollOffsetFromSurrogate(Me.getScrollOffset(),new Compositor.VectorClock(Me.getScrollClock()))}function A(e,t,n){assert(e),assert(t),n?e[t.id]=1:e.hasOwnProperty(t.id)&&delete e[t.id]}function T(e){var t;for(t in e)if(e.hasOwnProperty(t))return!0;return!1}function R(e,t){var n;return assert(t),n=w(),null===n?void Sk.assert(!e):void t(n,e)}function D(){var e=new Compositor.BigCanvas({delta_mode:Me.isCanvasBacking(),needs_redraw_fn:Re.invalidateRect,layer:Me,display_list:Re}),t=e.getDomNode();return pe.isDebugEnabled()&&t.setAttribute("id","canvas:"+Me.id),t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.padding="0px",t.style.margin="0px",e}function L(){return Me.isDrawable()?(Me.hasVideoContent()&&!Ae&&(Ae=new Compositor.VideoDelegate(pe,Me),Ae&&Ae.start("alloc changed")),void(ye||(Re=new Compositor.DisplayList(pe,Me,r()),ye=D(),assert(!Ce.childNodes.length),Ce.appendChild(ye.getDomNode())))):(ye&&(ye.release(),ye=null),Ae&&(Ae.stop("became undrawable"),Ae=null),void assert(!Ce.childNodes.length))}function P(){var e=Me.getBounds();Me.isOuterViewportContainerLayer()&&pe.callback.fire("needs-meta-viewport-update"),Me.isDrawable()&&(ye.resize(e.width,e.height,"bounds-change"),Ae&&Ae.updateSizeAndRedraw(e))}function U(e){var t=Sk.Rect.getY(e),n=t+Sk.Rect.getHeight(e),r=Sk.Rect.getX(e),i=r+Sk.Rect.getWidth(e);return"rect("+t+"px "+i+"px "+n+"px "+r+"px)"}function I(e){var t=e.toViewportRect(e.getBoundsRect());return Me.getParent().fromViewportRect(t)}function O(){return he?(assert(he&&me),me.updateClipChildTracking(!1,Me),me=null,he.parentNode.insertBefore(ge,he),he.parentNode.removeChild(he),he=null,pe.callback.deregister(qe.will_draw),void delete qe.will_draw):void assert(!me)}function B(){var e,t=Me.getScrollParent();if(_e){if(!Me.getParent())return void assert(!t);if(e=t?t.getParent():Me.getClipParent(),!e)return void O();me=e,he||(he=document.createElement("div"),he.id="clip:"+Me.id,he.style.position="absolute",ge.parentNode.insertBefore(he,ge),he.appendChild(ge),assert(!qe.will_draw),qe.will_draw=pe.callback.register("will-draw",function(){_e&&me&&B()})),he.style.clip=U(I(me)),me.updateClipChildTracking(!0,Me)}}function M(){var e=Util.getScrollbarThickness()[0],t=Util.getScrollbarThickness()[1],n=40;return Me.hasCustomScrollbar()&&!nt&&(e=Math.max(e,n),t=Math.max(t,n)),{width:e,height:t}}function N(e,t){assert(e);var n=t?EventListener.addListener:EventListener.removeListener;n(e,"scroll",p)}function F(){ke?(ve=Me.isOuterViewportContainerLayer()?window:ge,N(ve,!0)):ve&&(N(ve,!1),ve=null)}function V(){ke&&!Ue&&(Ue=Me.registerCallback("begin-animation-frame",f)),!ke&&Ue&&(Me.deregisterCallback(Ue),Ue=null)}function H(){var e,t,n=Me.getTransform();Me.isContainerForFixedPositionLayers()&&!Me.isSpecialLayer()||n?(t=n||mat4.create(),k("transform",Compositor.Matrix3D.asCSSTransformMatrix3D(t)),e=Me.getTransformOrigin(),k("transformOrigin",e.x+"px "+e.y+"px "+e.z+"px"),BrowserDetect.isIE()||k("transformStyle",Me.shouldFlattenTransform()?"flat":"preserve-3d")):(k("transform",null),k("transformOrigin",null),k("transformStyle",null)),Me.useParentBackfaceVisibility()?k("backfaceVisibility","inherit"):k("backfaceVisibility",Me.isDoubleSided()?null:"hidden")}function X(){k("opacity",1!==Me.getOpacity()?Me.getOpacity():null)}function K(e,t,n,r){var i,o,a,s,c,l;if(pe.isDebugEnabled()&&!BrowserDetect.isIE10()&&(a=Ye[e],a&&(a.parentNode.removeChild(a),delete Ye[e],a=null),t.length)){for(Ye[e]=a=document.createElement("div"),a.style.position="absolute",a.style.left="0px",a.style.top="0px",a.style.padding="0px",a.style.margin="0px",a.style.pointerEvents="none",i=0;i<t.length;i+=1)o=t[i],s=document.createElement("div"),s.style.position="absolute",s.style.left=Sk.Rect.getX(o)+"px",s.style.top=Sk.Rect.getY(o)+"px",s.style.width=Sk.Rect.getWidth(o)+"px",s.style.height=Sk.Rect.getHeight(o)+"px",s.style.padding="0px",s.style.margin="0px",s.style.opacity="0.1",s.style.backgroundColor=n,s.style.pointerEvents="none",c=document.createElement("div"),c.style.position="absolute",c.style.display="inline-block",c.style.backgroundColor=n,c.style.color="white",c.style.left=Sk.Rect.getX(o)+"px",c.style.top=Sk.Rect.getY(o)+"px",c.style.whiteSpace="nowrap",c.style.pointerEvents="none",l=e,r&&(l+=" ("+r+")"),c.textContent=l,a.appendChild(s),a.appendChild(c);Me.getHudDiv().appendChild(a)}}function W(){var e="";return n(Compositor.DirtyProps.kFlags)&&(e+="F"),n(Compositor.DirtyProps.kBounds)&&(e+="B"),n(Compositor.DirtyProps.kOpacity)&&(e+="Op"),n(Compositor.DirtyProps.kBlendMode)&&(e+="Bm"),n(Compositor.DirtyProps.kPosition)&&(e+="P"),n(Compositor.DirtyProps.kTransform)&&(e+="T"),n(Compositor.DirtyProps.kTransformOrigin)&&(e+="To"),n(Compositor.DirtyProps.kBackgroundColor)&&(e+="Bc"),n(Compositor.DirtyProps.kScrollOffset)&&(e+="So"),n(Compositor.DirtyProps.kPositionConstraint)&&(e+="Pc"),n(Compositor.DirtyProps.kStickyPositionConstraint)&&(e+="Sp"),e}function j(){return n(Compositor.DirtyProps.kFlags|Compositor.DirtyProps.kBounds|Compositor.DirtyProps.kPosition|Compositor.DirtyProps.kPositionConstraint|Compositor.DirtyProps.kTransform|Compositor.DirtyProps.kTransformOrigin)}function z(){n(Compositor.DirtyProps.kNonFastScrollableRegion)&&K("non-fast scrollable",Me.getNonFastScrollableRects(),"#0074D9"),n(Compositor.DirtyProps.kTouchActionRegion)&&K("touch-region",Me.getTouchActionRects(),"#602600")}function Y(){var e=Me.fromViewportRect(pe.getDrawRect());return e?Sk.Rect.intersection(e,Me.getBoundsRect()):Me.getBoundsRect()}function Q(e,t){var n,r=c();return Sk.Rect.isEmpty(e)&&Sk.Rect.isEmpty(t)?!1:Sk.Rect.isEmpty(e)?!0:(n=Sk.Rect.resize(e,pe.getMinimumDistanceBeforeDrawRectUpdate()),
Sk.Rect.contains(n,t)?0===Sk.Rect.getX(t)&&0!==Sk.Rect.getX(e)?!0:0===Sk.Rect.getY(t)&&0!==Sk.Rect.getY(e)?!0:Sk.Rect.getRight(t)===Sk.Rect.getWidth(r)&&Sk.Rect.getRight(e)!==Sk.Rect.getWidth(r)?!0:Sk.Rect.getBottom(t)===Sk.Rect.getHeight(r)&&Sk.Rect.getBottom(e)!==Sk.Rect.getHeight(r)?!0:!1:!0)}function G(e,t){var n=Y();return Sk.Rect.isEmpty(n)||t?n:e&&!Q(e,n)?e:n}function q(e,t){var n=t;return e&&(n=Sk.Rect.makeCopy(t),Sk.Rect.subtract(n,e)),n}function J(){return Me.isPictureLayer()?(assert(Sk.Rect.isValid(Je)),Je):Me.isTextureLayer()?Me.getBoundsRect():null}function Z(e){ye&&ye.hardInvalidateWithTileRecalc()}function $(e,t){var n;t.hasVideoContent()&&(n="video"),t.isPictureLayer()&&(n="picture"),t.isTextureLayer()&&(n="texture"),n&&t.withEachAncestorAndSelf(function(r){r.updateSubtreeLayerRegistration(e,n,t)})}function ee(e){var t,n,r=0===e?null:Ne[e-1],i=Ne[e+1],o=Ne[e];r&&i?(n=Math.floor((r.getSiblingRank()+i.getSiblingRank())/2),(n===r.getSiblingRank()||n===i.getSiblingRank())&&assert_unimplemented(0)):n=r?r.getSiblingRank()+1e5:i?i.getSiblingRank()-1e5:0,t=Ge.slice(0),t.push(n),o.setPositionVec(t)}function te(){ve&&(ve.scrollLeft=Te.x,ve.scrollTop=Te.y)}function ne(e){return e.getChildren().slice()}function re(e){var t=e.createElement("div");return t.style.zIndex=String(Compositor.ZIndexRange.kLayer[0]),t.className="svl",pe.isDebugEnabled()&&(t.id="layer:"+Me.id),Ce=e.createElement("div"),pe.isDebugEnabled()&&(Ce.id="content"),Ce.style.className="scd",Ce.style.position="absolute",Ce.style.top="0px",Ce.style.left="0px",Ee=e.createElement("div"),pe.isDebugEnabled()&&(Ee.id="children"),t.appendChild(Ce),t.appendChild(Ee),t}function ie(e,t,n,r,i){var o,a,s=t,c=r,l=n,d=i;for(assert(s),assert(l),assert(void 0!==d);s&&((s.masksToBounds()||s.isScrollContainerLayer()&&!s.isSpecialLayer())&&(c=Sk.Rect.intersection(s.getBoundsRect(),c)),e!==Compositor.ProjectionType.kOVSL||!s.isOuterViewportScrollLayer());)o=s.calcParentProjectionMatrix(),mat4.multiply(l,o,l),d&&(d=Compositor.Matrix3D.rectStaysRect(l)),assert_unimplemented(d,"not axis aligned"),c=Compositor.Matrix3D.mapRect(o,c),s=s.isFixedPositioned()?s.getContainerForFixedPositionLayers():s.getParent();return e===Compositor.ProjectionType.kViewport&&(a=pe.getVisualViewportTransform(),mat4.multiply(l,a,l),c=Compositor.Matrix3D.mapRect(a,c)),new Compositor.Projection(e,c,d,l)}function oe(e){var t,n,r,i,o,a=[_e.getOuterViewportScrollLayer(),_e.getInnerViewportScrollLayer()];for(i=0;i<a.length;i+=1)if(t=a[i],n=t.getNonFastScrollableRects(),r=t.fromViewportPoint(e))for(o=0;o<n.length;o+=1)if(Sk.Rect.containsPoint(n[o],r))return!0;return!1}function ae(){for(var e=Me;e;){if(e.isFixedPositioned()||Me.isStickyPositioned())return!0;e=e.getParent()}return!1}function se(e){var t=Compositor.TileRasterFlags.kLowRes|Compositor.TileRasterFlags.kDisableRasterCache;if(ye&&!ae()){if(e)return void ye.setRasterFlags(t);ye.setRasterFlags(0),ye.hardInvalidateTilesInRect(Me.getBoundsRect(),Compositor.TileRasterFlags.kLowRes)}}function ce(){Me.id=e.id,ue=e.type,fe=e.role,pe=e.compositor,Fe=e.is_mask_layer,ge=re(document),Me.registerCallback("fling-change",se),Util.getScrollbarThickness()[0]!==Util.getScrollbarThickness()[1]&&assert_unimplemented(0,{event:"unimplemented",what:"different vert. vs. horiz. values"}),Te=Me.getBrowserScrollOffset()}var le,de,ue,fe,pe,_e,ge,he,me,ve,ye,we,be,ke,Se,Ce,Ee,xe,Ae,Te,Re,De,Le,Pe,Ue,Ie,Oe,Be,Me=this,Ne=[],Fe=!1,Ve={},He={},Xe=16,Ke=new Compositor.VectorClock([0,0]),We=!1,je={},ze={},Ye={},Qe={video:{},picture:{},texture:{},"clip-parent":{}},Ge=[0],qe={},Je=Sk.Rect.makeEmpty(),Ze={x:0,y:0},$e=!1,et=4,tt=50,nt=BrowserDetect.isIE()||BrowserDetect.isEdge()||BrowserDetect.isSafari()||BrowserDetect.isChrome();Me.asDict=function(){return{id:Me.id,parent_id:le?le.id:null,type:ue,role:fe,props:He,label:Me.getLabels()}},Me.updateProperties=function(e){Sk.assert(e),Util.forEachItem(e,function(e,t){"skr_u8a"!==e&&"tile_updates"!==e&&(He[e]=t)})},Me.setTree=function(e){_e=e},Me.isAttached=function(){return!!_e},Me.getID=function(){return Me.id},Me.getType=function(){return ue},Me.isDrawable=function(){return t(Compositor.LayerFlags.kIsDrawable)},Me.isContentOpaque=function(){return t(Compositor.LayerFlags.kContentsOpaque)},Me.isUserScrollableHorizontal=function(){return t(Compositor.LayerFlags.kUserScrollableHorizontal)},Me.isUserScrollableVertical=function(){return t(Compositor.LayerFlags.kUserScrollableVertical)},Me.useParentBackfaceVisibility=function(){return t(Compositor.LayerFlags.kUseParentBackfaceVisibility)},Me.shouldFlattenTransform=function(){return t(Compositor.LayerFlags.kShouldFlattenTransform)},Me.isDoubleSided=function(){return t(Compositor.LayerFlags.kIsDoubleSided)},Me.shouldHideLayerAndSubtree=function(){return t(Compositor.LayerFlags.kHideLayerAndSubTree)},Me.isCanvasBacking=function(){return t(Compositor.LayerFlags.kIsCanvasBacking)},Me.isScrollbar=function(){return t(Compositor.LayerFlags.kIsScrollbar)},Me.hasCustomScrollbar=function(){return t(Compositor.LayerFlags.kHasCustomScrollbar)},Me.isHitTestable=function(){return t(Compositor.LayerFlags.kIsHitTestable)},Me.getBounds=function(){return assert(void 0!==He.bounds,{id:e.id}),He.bounds},Me.getTextureBounds=function(){return assert(Me.isTextureLayer()&&He.texture_bounds),He.texture_bounds},Me.getPosition=function(){return assert(void 0!==He.position),assert(void 0!==He.position.x,{id:e.id,props:He}),assert(void 0!==He.position.y,{id:e.id,props:He}),Object.freeze(He.position)},Me.getOpacity=function(){return assert(void 0!==He.opacity),He.opacity},Me.isTransparent=function(){return Me.getOpacity()<=.001},Me.occludesContentBelow=function(){return Me.isContentOpaque()&&1===Me.getOpacity()},Me.getBlendMode=function(){return assert(void 0!==He.blend_mode),He.blend_mode},Me.getScrollOffset=function(){return assert(void 0!==He.scroll_offset),He.scroll_offset},Me.getScrollClock=function(){return assert(void 0!==He.scroll_clock),He.scroll_clock},Me.getTransform=function(){return assert(void 0!==He.transform),He.transform},Me.getTransformOrigin=function(){return assert(void 0!==He.transform_origin),He.transform_origin},Me.isFixedPositioned=function(){return void 0!==He.is_fixed&&He.is_fixed},Me.isFixedToRightEdge=function(){return void 0!==He.is_fixed&&He.is_fixed_to_right_edge},Me.isFixedToBottomEdge=function(){return void 0!==He.is_fixed&&He.is_fixed_to_bottom_edge},Me.isStickyPositioned=function(){return void 0!==He.sticky_flags&&He.sticky_flags&Compositor.StickyPositionFlags.kIsSticky},Me.isStickyPositionAnchoredTop=function(){return assert(void 0!==He.sticky_flags),He.sticky_flags&Compositor.StickyPositionFlags.kIsAnchoredTop},Me.getStickyPositionTopOffset=function(){return assert(void 0!==He.sticky_position_top_offset),He.sticky_position_top_offset},Me.isStickyPositionAnchoredLeft=function(){return assert(void 0!==He.sticky_flags),He.sticky_flags&Compositor.StickyPositionFlags.kIsAnchoredLeft},Me.isStickyPositionAnchoredRight=function(){return assert(void 0!==He.sticky_flags),He.sticky_flags&Compositor.StickyPositionFlags.kIsAnchoredRight},Me.isStickyPositionAnchoredBottom=function(){return assert(void 0!==He.sticky_flags),He.sticky_flags&Compositor.StickyPositionFlags.kIsAnchoredBottom},Me.getStickyPositionBottomOffset=function(){return assert(void 0!==He.sticky_position_bottom_offset),He.sticky_position_bottom_offset},Me.getStickyPositionRelativeRect=function(){return assert(void 0!==He.scroll_container_relative_sticky_box_rect),He.scroll_container_relative_sticky_box_rect},Me.getStickyPositionRelativeContainerRect=function(){return assert(void 0!==He.scroll_container_relative_containing_block_rect),He.scroll_container_relative_containing_block_rect},Me.getScrollClipLayerId=function(){return He.scroll_clip_layer_id},Me.getScrollParentId=function(){return assert(void 0!==He.scroll_parent_id),-1!==He.scroll_parent_id?He.scroll_parent_id:null},Me.getClipParentId=function(){return assert(void 0!==He.clip_parent_id),-1!==He.clip_parent_id?He.clip_parent_id:null},Me.getDOMNodeId=function(){return assert(void 0!==He.node_id),He.node_id},Me.getNonFastScrollableRects=function(){return assert(void 0!==He.non_fast_scrollable_rects),He.non_fast_scrollable_rects},Me.getTouchActionRects=function(){return assert(void 0!==He.touch_action_rects),He.touch_action_rects},Me.hasMainThreadScrollingReasons=function(){return!!He.main_thread_scrolling_reasons},Me.getTree=function(){return _e},Me.getParent=function(){return le},Me.setParent=function(e){le=e},Me.setRole=function(e){fe=e,Me.applyProperties(!0)},Me.isRoot=function(){return!Me.getParent()},Me.getChildren=function(){return Ne},Me.getScrollParent=function(){var e=Me.getScrollParentId();return e?_e.getLayer(e):null},Me.getClipParent=function(){var e=Me.getClipParentId();return e?_e.getLayer(e):null},Me.getDisplayList=function(){return Re},Me.isMaskLayer=function(){return Fe},Me.setMaskLayer=function(e){assert(!e||e.isMaskLayer()),de=e},Me.getMaskLayer=function(){return de},Me.isPictureLayer=function(){return ue===Compositor.LayerType.PictureLayer},Me.isTextureLayer=function(){return ue===Compositor.LayerType.TextureLayer},Me.isVideoLayer=function(){return ue===Compositor.LayerType.VideoLayer},Me.isSurfaceLayer=function(){return ue===Compositor.LayerType.SurfaceLayer},Me.isSurfaceLayerWithVideo=function(){return Me.isSurfaceLayer()&&t(Compositor.LayerFlags.kIsSurfaceLayerWithVideo)},Me.hasVideoContent=function(){return Me.isVideoLayer()||Me.isSurfaceLayerWithVideo()},Me.isScrollContainerLayer=function(){return!!ke},Me.masksToBounds=s,Me.getBoundsRect=c,Me.hasNoDrawRegions=function(){return ye&&ye.hasNoDrawQuads()},Me.registerNoDrawRegion=function(e){var t=Me.getProjection(Compositor.ProjectionType.kViewport).getInverseMatrix();return assert(void 0!==t),t?BrowserDetect.isIE10()&&!Compositor.Matrix3D.rectStaysRect(t)?!1:(ye&&(assert(e.hasVideoContent()),ye.registerNoDrawQuad(e.getID(),Compositor.Matrix3D.mapRectToQuad(t,e.toViewportRect(e.getBoundsRect(),!0)))),!0):!1},Me.deregisterNoDrawRegion=function(e){ye&&ye.deregisterNoDrawQuad(e.getID())},Me.hasVisualIntersect=function(e){return Me.isDrawable()&&e.isDrawable()&&Sk.Rect.intersects(Me.toViewportRect(),e.toViewportRect())},Me.isOccludedBy=function(e){return Me.paintsBefore(e)&&Me.hasVisualIntersect(e)},Me.getHudDiv=function(){return ge?xe?(assert(ge.parentNode),xe):(xe=document.createElement("div"),xe.id="post",xe.style.position="absolute",xe.style.top="0px",xe.style.left="0px",xe.style.width="100%",xe.style.height="100%",xe.style.overflow="hidden",xe.style.pointerEvents="none",xe.style.zIndex=String(Compositor.ZIndexRange.kHUD[0]),ge.appendChild(xe),xe):null},Me.updateDescendantStickyPosition=function(e){l(je,function(t){assert(t),t.updateStickyLayerPosition(e)})},Me.getBrowserScrollOffset=function(e){return(!Be||e)&&(Be=u()),Be},Me.isSpecialLayer=function(){return Me.isOuterViewportScrollLayer()||Me.isOuterViewportContainerLayer()||Me.isBackgroundLayer()||Me.isInnerViewportScrollLayer()},Me.isContainerForFixedPositionLayers=function(){return t(Compositor.LayerFlags.kIsContainerForFixedPositionLayers)},Me.getContainerForFixedPositionLayers=w,Me.isBackgroundLayer=function(){return"background-layer"===fe},Me.isInnerViewportScrollLayer=function(){return"inner-viewport-scroll-layer"===fe},Me.isOuterViewportScrollLayer=function(){return"outer-viewport-scroll-layer"===fe},Me.isOuterViewportContainerLayer=function(){return"outer-viewport-container-layer"===fe},Me.updateStickyLayerPosition=function(e){var t,n,r,s,c,l,d,u=e.x,f=e.y,p=!1;return Me.isStickyPositionAnchoredTop()||Me.isStickyPositionAnchoredBottom()?(r=w(),s=r.isOuterViewportScrollLayer(),Me.isStickyPositionAnchoredTop()&&(t=f+Me.getStickyPositionTopOffset(),n=t+Sk.Rect.getHeight(Me.getStickyPositionRelativeRect()),t>=Sk.Rect.getY(Me.getStickyPositionRelativeRect())&&n<=Sk.Rect.getBottom(Me.getStickyPositionRelativeContainerRect())?(l=t,c=Me.getPosition().x,s&&(l-=f,c-=u),i()||(k("position","fixed"),o()),k("top",l+"px"),k("left",c+"px"),p=!0):i()&&(k("position","absolute"),a(),c=Me.getPosition().x,l=n>Sk.Rect.getBottom(Me.getStickyPositionRelativeContainerRect())?Sk.Rect.getBottom(Me.getStickyPositionRelativeContainerRect())-Sk.Rect.getHeight(Me.getStickyPositionRelativeRect()):Me.getPosition().y,k("top",l+"px"),k("left",c+"px"),p=!0)),!p&&Me.isStickyPositionAnchoredBottom()&&(s?d=Util.getWindowSize(window):(assert(r.getParent()),d=r.getParent().getBounds()),t=f+d.height-Me.getStickyPositionBottomOffset(),n=t-Sk.Rect.getHeight(Me.getStickyPositionRelativeRect()),t<=Sk.Rect.getBottom(Me.getStickyPositionRelativeRect())&&n>=Sk.Rect.getY(Me.getStickyPositionRelativeContainerRect())?(l=n,c=Me.getPosition().x,s&&(l-=f,c-=u),i()||(k("position","fixed"),o()),k("top",l+"px"),k("left",c+"px"),p=!0):i()&&(k("position","absolute"),a(),c=Me.getPosition().x,l=n<Sk.Rect.getY(Me.getStickyPositionRelativeContainerRect())?Sk.Rect.getY(Me.getStickyPositionRelativeContainerRect()):Me.getPosition().y,k("top",l+"px"),k("left",c+"px"),p=!0)),p):(assert_unimplemented(0,{event:"incomplete-support",what:"Right or left anchored sticky positioning"}),!1)},Me.setScrollOffsetFromSurrogate=function(e,t){return Ke||(Ke=new Compositor.VectorClock([0,0])),t.isLessThan(Ke)||t.isConcurrentWith(Ke)?void Ke.update(t):(Ke.update(t),void E(e.x,e.y))},Me.simulateUserScrollBy=function(e,t){return assert(Me.isScrollContainerLayer()),ve===window?void ve.scrollBy(e,t):(ve.scrollLeft+=e,void(ve.scrollTop+=t))},Me.updatePosition=function(){var e,t=Me.getPosition();if(!(Me.isStickyPositioned()&&(e=w(),assert(e),e&&Me.updateStickyLayerPosition(e.getScrollOffset())))){if(Me.isBackgroundLayer())ye&&(ye.getDomNode().style.position="fixed");else if(C())return k("position","fixed"),t=S(),k(Me.isFixedToRightEdge()?"right":"left",t.x+"px"),void k(Me.isFixedToBottomEdge()?"bottom":"top",t.y+"px");k("position","absolute"),k("left",t.x+"px"),k("top",t.y+"px")}},Me.registerStickyDescendant=function(e,t){A(je,e,t)},Me.hasStickyDescendants=function(){return T(je)},Me.updateStickyLayerRegistration=function(e){R(e,function(t){assert(t),t.registerStickyDescendant(Me,e)})},Me.registerFixedDescendant=function(e,t){A(ze,e,t)},Me.hasFixedDescendants=function(){return T(ze)},Me.updateFixedLayerRegistration=function(e){return e&&Me.isStickyPositioned()?void assert(!1,{layer_id:Me.id}):void R(e,function(t){assert(t),t.registerFixedDescendant(Me,e)})},Me.updateClipChildTracking=function(e,t){var n,r=Util.isDictEmpty(Ve);e?Ve[t.getID()]=!0:delete Ve[t.getID()],n=Util.isDictEmpty(Ve),n!==r&&Me.withEachAncestorAndSelf(function(e){e.updateSubtreeLayerRegistration(!n,"clip-parent",Me)}),pe.isDebugEnabled()&&ge&&ge.setAttribute("clip_children",JSON.stringify(Object.keys(Ve)))},Me.updateScrollAndClipHandling=function(){var e,t=null,n=Me.getBounds().width,r=Me.getBounds().height,i=M();e=Me.getScrollClipLayerId(),-1===e||Me.isInnerViewportScrollLayer()||(t=_e.getLayer(e),assert(t===le,{id:Me.id,parent_layer:le,scl_id:e})),t!==Se&&(Se&&Se.setScrollChildLayer(null),t&&t.setScrollChildLayer(Me)),Se=t,Se&&Se.updateScrollAndClipHandling(),ke&&!Me.isOuterViewportContainerLayer()?(k("overflowX",ke.isUserScrollableHorizontal()?"scroll":"hidden"),k("overflowY",ke.isUserScrollableVertical()?"scroll":"hidden"),BrowserDetect.isMobileSafari()&&k("-webkit-overflow-scrolling","touch"),ke.isUserScrollableHorizontal()&&(r+=i.height),ke.isUserScrollableVertical()&&(n+=i.width),k("pointerEvents","auto"),Me.hasCustomScrollbar()?nt?(ge.className="svl hide-scrollbar",k("clip",null)):k("clip",U(Me.getBoundsRect())):(ge.className="svl",k("clip",null))):(k("overflow",s()||Me.isOuterViewportScrollLayer()?"hidden":"visible"),k("clip",s()||Me.isOuterViewportScrollLayer()?"rect(auto auto auto auto)":null),Me.isSpecialLayer()||k("pointerEvents","none")),(Me.isInnerViewportScrollLayer()||Me.isBackgroundLayer())&&(n-=Util.getScrollbarThickness()[0],r-=Util.getScrollbarThickness()[1]),k("width",n+"px"),k("height",r+"px")},Me.setScrollChildLayer=function(e){ke!==e&&(pe.isDebugEnabled()&&ge.setAttribute("scroll_child_layer",e.id),ke=e,F(),V(),Me.updateScrollAndClipHandling())},Me.getLabels=function(){var e=[];return Me.isDrawable()&&e.push("kIsDrawable"),Me.isContentOpaque()&&e.push("kContentsOpaque"),Me.isCanvasBacking()&&e.push("kIsCanvasBacking"),Me.isUserScrollableHorizontal()&&e.push("kScrollableHorizontal"),Me.isUserScrollableVertical()&&e.push("kScrollableVertical"),Me.useParentBackfaceVisibility()&&e.push("kUseParentBackfaceVisibility"),Me.shouldFlattenTransform()&&e.push("kShouldFlattenTransform"),Me.isDoubleSided()&&e.push("kIsDoubleSided"),s()&&e.push("kMasksToBounds"),Me.shouldHideLayerAndSubtree()&&e.push("kHideLayerAndSubTree"),Me.isContainerForFixedPositionLayers()&&e.push("kContainerForFixedPositionLayers"),y(Me)&&e.push("kMainFrameLayer"),Me.isVideoLayer()&&e.push("kVideoLayer"),Me.isSurfaceLayer()&&(Me.isSurfaceLayerWithVideo()?e.push("kSurfaceLayerWithVideo"):e.push("kSurfaceLayer")),Me.isPictureLayer()&&e.push("kPictureLayer"),Me.isTextureLayer()&&e.push("kTextureLayer"),Me.isMaskLayer(Me)&&e.push("kMaskLayer"),Me.getScrollParentId()&&e.push("kHasScrollParent"),Me.getClipParentId()&&e.push("kHasClipParent"),Me.hasMainThreadScrollingReasons()&&e.push("kHasMainThreadScrollingReasons"),Me.isFixedPositioned()&&e.push("kFixedPositioned"),Me.isStickyPositioned()&&e.push("kStickyPositioned"),Me.isHitTestable()&&e.push("kIsHitTestable"),e},Me.invalidateProjection=function(e){e&&(De=null),Le=null,pe.setLayerProjectionChanged(Me.getID()),Ae&&Ae.setNeedsReproject()},Me.invalidateSubtreeProjection=function(e){Me.walkDepthFirstIterative(function(t){t.invalidateProjection(e)})},Me.applyProperties=function(e){var t;assert(_e),e&&(He.dirty_props=Compositor.DirtyProps.kAll),n(Compositor.DirtyProps.kFlags|Compositor.DirtyProps.kBounds)&&(L(),P()),n(Compositor.DirtyProps.kFlags|Compositor.DirtyProps.kPosition|Compositor.DirtyProps.kPositionConstraint)&&Me.updatePosition(),n(Compositor.DirtyProps.kFlags|Compositor.DirtyProps.kBounds|Compositor.DirtyProps.kScrollClipLayerId)&&Me.updateScrollAndClipHandling(),n(Compositor.DirtyProps.kScrollParentId|Compositor.DirtyProps.kClipParentId)&&Me.runOn("did-activate-tree",B),n(Compositor.DirtyProps.kPositionConstraint)&&Me.updateFixedLayerRegistration(Me.isFixedPositioned()),n(Compositor.DirtyProps.kStickyPositionConstraint)&&(Me.updateStickyLayerRegistration(Me.isStickyPositioned()),Me.isStickyPositioned()&&(t=w(),assert(t),t&&Me.updateStickyLayerPosition(t.getScrollOffset()))),n(Compositor.DirtyProps.kFlags|Compositor.DirtyProps.kScrollOffset)&&Me.runOn("did-activate-tree",x),n(Compositor.DirtyProps.kFlags|Compositor.DirtyProps.kTransform|Compositor.DirtyProps.kTransformOrigin)&&H(),n(Compositor.DirtyProps.kOpacity)&&X(),n(Compositor.DirtyProps.kMainThreadScrollingReasons)&&_e.trackMainThreadScrollingLayer(Me),n(Compositor.DirtyProps.kNodeId)&&Ae&&Ae.pairWithVideoElementIfNeeded(),He.loaded_tile_updates&&(assert(Re||!Me.isAttached()),Re&&Re.applyTileUpdates(He.loaded_tile_updates),He.loaded_tile_updates=null),j()&&Me.invalidateSubtreeProjection(!0),pe.isDebugEnabled()&&(z(),ge.setAttribute("type",ue),ge.setAttribute("layer_role",fe),ge.setAttribute("props",JSON.stringify(He)),ge.setAttribute("labels",Me.getLabels().join(",")),ge.setAttribute("flags",W()),ge.setAttribute("pos_vec",JSON.stringify(Ge))),He.dirty_props=0},Me.withEachLayerInSubtree=function(e,t){var n;for(n=0;n<e.length;n+=1)assert(Qe.hasOwnProperty(e[n])),Util.forEachItem(Qe[e[n]]||{},t)},Me.getSubTreeLayersByKey=function(e){return Qe[e]},Me.getLocalDrawRect=function(){return Je},Me.invalidateRect=function(e,t){Re&&Re.invalidateRect(e,t)},Me.updateLocalDrawRect=function(){var e,t=Je,n=Me.getViewportScaleFactor()!==Oe;Me.isDrawable()&&(Je=G(t,n),e=q(t,Je),Sk.Rect.isEmpty(e)||Re.invalidateRect(e,"newly-exposed"),n&&(Oe=Me.getViewportScaleFactor(),Z()),t&&!Sk.Rect.isEqual(t,Je)&&(pe.isDebugAnnotationEnabled()&&K("["+Me.getID()+"] DrawRect: ",[Je],"indigo",JSON.stringify(Je)),ye&&ye.freeAllTilesExcept(J(),"draw-rect-changed")),pe.isDebugEnabled()&&(ge.setAttribute("draw_rect",JSON.stringify(Je)),Le&&ge.setAttribute("cached_vp_proj",JSON.stringify(Le.getMatrix()))))},Me.getTileByKey=function(e){return Re?Re.getTileByKey(e):null},Me.forEachTileInRect=function(e,t){Re&&Re.forEachTileInRect(e,t)},Me.drawTile=function(e){var t;return assert(ye),Ae?Ae.drawFrame():(t=Sk.Region.getBoundingRect(e.getDirtyRegion()),ye.drawRect(t,Me.isContentOpaque())?!0:!1)},Me.updateTexture=function(e){assert(Me.isTextureLayer()),ye&&ye.playback(e,e.getCullRect(),Me.isContentOpaque())},Me.remove=function(){var e,t=Me.getContainer();return _e?(Ae&&Ae.stop("remove-layer"),Me.updateLayerRegistration(!1),$(!1,Me),Me.isMaskLayer()?(le.setMaskLayer(null),Me.setParent(null),void Me.setTree(null)):(t.parentNode&&(t.parentNode.removeChild(t),assert(!t.parentNode)),le?(e=le.getChildren().indexOf(Me),assert(e>=0),le.getChildren().splice(e,1)):assert(_e&&_e.getRoot()===Me),Me.setParent(null),void Me.setTree(null))):void assert(0,"detaching an unattached layer")},Me.getContainer=function(){return he||ge},Me.getChildrenDiv=function(){return Ee},Me.updateLayerRegistration=function(e){Me.isFixedPositioned()&&Me.updateFixedLayerRegistration(e),Me.isStickyPositioned()&&Me.updateStickyLayerRegistration(e)},Me.withEachAncestorAndSelf=function(e){for(var t=Me;t;)e(t),t=t.getParent()},Me.updateSubtreeLayerRegistration=function(e,t,n){var r=Qe[t];return assert(r),e?void(r[n.getID()]=n):void delete r[n.getID()]},Me.restartVideoDelegate=function(){Ae&&Ae.start("restart")},Me.insertChild=function(e,t,n){var r,i;return assert(Me.id&&e&&t),assert(t.getContainer(),"should be backed by a dom node"),assert(!t.getParent(),{id:t.id,detail:"should not already be attached"}),assert(n>=-1,{sib_idx:n}),assert(!t.isMaskLayer()||-1===n,"mask layers have no siblings and thus no sibling position"),assert(!Me.isMaskLayer(),"mask layers should not have children"),t.setTree(e),t.setParent(Me),t.updateLayerRegistration(!0),ke&&ve&&ve!==window&&Te&&Me.runOn("did-activate-tree",te),$(!0,t),pe.setLayerProjectionChanged(t.getID()),t.isMaskLayer()?(assert_unimplemented("mask layer inserted",{lid:Me.id}),void Me.setMaskLayer(t)):(t.restartVideoDelegate(),i=Ee.childNodes,assert(n>=0&&n<=i.length,{sib_idx:n,child_nodes_len:i.length}),r=i[n],r?Ee.insertBefore(t.getContainer(),r):(assert_unimplemented(n===i.length,{sib_idx:n,layer_id:Me.id,child_id:t.id,child_nodes_len:i.length}),Ee.appendChild(t.getContainer())),assert(n<=Ne.length),Ne.splice(n,0,t),ee(n),void assert(t.getContainer()&&t.getContainer().parentNode))},Me.setPositionVec=function(e){Ge=e},Me.getSiblingRank=function(){return Ge[Ge.length-1]},Me.getPositionVec=function(){return Ge},Me.paintsBefore=function(e){var t,n=Me.getPositionVec(),r=e.getPositionVec();for(t=0;t<Math.min(n.length,r.length);t+=1){if(n[t]<r[t])return!0;if(n[t]>r[t])return!1}return n.length<r.length},Me.walkDepthFirst=function(e,t,n){var r,i;if(n=n||Me,e&&e(n))return!0;for(i=ne(n),n.getMaskLayer()&&i.push(n.getMaskLayer()),r=0;r<i.length;r+=1)if(Me.walkDepthFirst(e,t,i[r]))return!0;t&&t(n)},Me.walkDepthFirstIterative=function(e){for(var t,n,r,i=[Me];i.length&&(t=i.pop(),!e(t));)for(t.getMaskLayer()&&i.push(t.getMaskLayer()),n=t.getChildren(),r=n.length-1;r>=0;r-=1)i.push(n[r])},Me.destroy=function(){assert(Me.getContainer()&&!Me.getContainer().parentNode),ve&&(N(ve,!1),ve=null),ge=null,assert(!_e&&!Me.getParent(),"destroy before tree detach?"),pe.setLayerContentsDirty(Me.getID(),!1),Re=null,Ae&&(Ae.stop("destroy"),Ae=null),ye&&(ye.release(),ye=null),me&&(me.updateClipChildTracking(!1,Me),me=null),Util.forEachItem(qe,function(e,t){Me.deregisterCallback(t)})},Me.isLive=function(){return ge&&ge.parentNode},Me.calcParentProjectionMatrix=function(){var e,t=mat4.create(),n=Me.getTransform(),r=Me.getTransformOrigin(),i=Se?Se.getBrowserScrollOffset():null;return assert(!Me.isFixedPositioned()||w(),{lid:Me.getID()}),Me.isFixedPositioned()&&w()?(e=g(Me,w()),i=null):e=Me.getPosition(),mat4.translate(t,t,vec3.fromValues(e.x,e.y,0)),i&&mat4.translate(t,t,vec3.fromValues(-i.x,-i.y,0)),n&&(mat4.translate(t,t,vec3.fromValues(r.x,r.y,r.z)),mat4.multiply(t,t,n),mat4.translate(t,t,vec3.fromValues(-r.x,-r.y,-r.z))),Me.shouldFlattenTransform()&&assert_unimplemented(0,"must account for shouldFlattenTransform"),t},Me.hitTestSubtree=function(e,t){var n,r,i,o=Me.getChildren(),a=c();for(assert(t),n=o.length-1;n>=0;n-=1)if(r=o[n].hitTestSubtree(e,t))return r;return Me.isHitTestable()&&(i=Me.fromViewportPoint(e))?(pe.isDebugEnabled(),Sk.Rect.containsPoint(a,i)?t(Me,i):null):null},Me.projectsToOVSL=function(){for(var e=Me;e;){if(e.isOuterViewportScrollLayer())return!0;e=e.isFixedPositioned()?e.getContainerForFixedPositionLayers():e.getParent()}return!1},Me.getProjection=function(e,t){assert(e===Compositor.ProjectionType.kViewport||e===Compositor.ProjectionType.kOVSL);var n=Me.projectsToOVSL();return t||!n?(assert(e!==Compositor.ProjectionType.kOVSL||n),ie(e,Me,mat4.create(),Me.getBoundsRect(),!0)):(De||(De=ie(Compositor.ProjectionType.kOVSL,Me,mat4.create(),Me.getBoundsRect(),!0)),e===Compositor.ProjectionType.kViewport?(Le||(Le=ie(e,_e.getOuterViewportScrollLayer(),mat4.clone(De.getMatrix()),De.getProjectedClipRect(),De.rectStaysRect())),Le):De)},Me.toViewportRect=function(e,t,n){return e=e||Me.getBoundsRect(),Me.getProjection(Compositor.ProjectionType.kViewport,n).projectRect(e,t)},Me.fromViewportRect=function(e){var t=Me.getProjection(Compositor.ProjectionType.kViewport);return t.getInverseMatrix()?Compositor.Matrix3D.mapRect(t.getInverseMatrix(),e):null},Me.fromViewportPoint=function(e){var t=Me.getProjection(Compositor.ProjectionType.kViewport),n=t.getInverseMatrix();return n?Compositor.Matrix3D.projectPoint(n,e):null},Me.hitTest=function(e,t){return e===Compositor.HitTest.kLayer?Me.hitTestSubtree(t,function(e,t){return e}):e===Compositor.HitTest.kDrawing?Me.hitTestSubtree(t,function(e,t){var n;return e.getDisplayList()?(n=e.getDisplayList().getHitItemsAtPoint(t),n.length?{layer:e,items:n}:null):null}):e===Compositor.HitTest.kTouchActionRegion?Me.hitTestSubtree(t,function(e,t){var n,r=e.getTouchActionRects();for(n=0;n<r.length;n+=1)if(Sk.Rect.containsPoint(r[n],t))return!0;return!1}):e===Compositor.HitTest.kNonFastRegion?oe(t):void assert(0)},Me.getScrollContainer=function(){for(var e=Me;e;){if(e.isScrollContainerLayer())return e;e=e.getScrollParent()||e.getParent()}return null},Me.getViewportScaleFactor=function(){return Me.getProjection(Compositor.ProjectionType.kViewport).getScaleFactor()},Me.getRasterScaleFactor=function(){return pe.getDeviceScaleFactor()*Me.getViewportScaleFactor()},Me.getCompositor=function(){return pe},Me.setBigCanvasVisible=function(e){ye&&(ye.getDomNode().style.display=e?"block":"none")},Me.getBigCanvas=function(){return ye},Me.shouldProjectToOVSL=function(){for(var e=Me;e&&e.getParent();){if(e.isBackgroundLayer()&&e.isDrawable()||e.isFixedPositioned()||e.isStickyPositioned())return!1;e=e.getParent()}return!0},Me.scrollsWith=function(e){return Me.shouldProjectToOVSL()===e.shouldProjectToOVSL()},Me.getVideoDelegate=function(){return Ae},Me.runOn=function(e,t){var n,r=function(){assert(void 0!==n),assert(qe.hasOwnProperty(n)),delete qe[n],t()};n=pe.callback.registerOneShot(e,0,{on_success:r}),assert("will-draw"===e||"did-activate-tree"===e),qe[n]=n},Me.registerCallback=function(e,t){var n=pe.callback.register(e,t);return qe[n]=n,n},Me.deregisterCallback=function(e){var t=pe.callback.deregister(e);assert(t),delete qe[e]},Me.withEachDrawableLayerInSubtree=function(e){Me.withEachLayerInSubtree(["picture","texture","video"],e)},Me.hardInvalidateTilesInSubtree=function(){Me.withEachDrawableLayerInSubtree(function(e,t){var n=t.getBigCanvas();n&&n.hardInvalidateTilesInRect(t.getBoundsRect())})},Me.freeTiles=function(){ye&&(ye.freeAllTilesExcept(),Re.invalidateRect(Me.getBoundsRect(),"free-tiles"))},ce()},Compositor.ShadowTextControl=function(e,t,n,r,i,o,a){function s(e){S.push(e)}function c(){for(var t,n=0;n<S.length;){switch(t=S[n],t[0]){case"input":e.surrogate_channel.send("input",k,r,t[1]);break;case"mi-editable":e.surrogate_channel.send("mi-editable",k,r,t[1],t[2]);break;case"mi-simpleinput":e.surrogate_channel.send("mi-simpleinput",k,r,t[1],t[2],t[3]);break;case"mi-register":e.surrogate_channel.send("mi-register",k,r)}S.splice(n,1)}}function l(e){assert(e),k=e,c()}function d(){var t,n;null===y.selectionStart?t=n=-1:(t=y.selectionStart,n=y.selectionEnd),null!==k?e.surrogate_channel.send("mi-simpleinput",k,r,y.value,t,n):s(["mi-simpleinput",y.value,t,n])}function u(){var t,n,i,o=0;if(t=y.value,t!==w){for(;o<t.length&&o<w.length&&t[o]===w[o];)o+=1;for(n=w.length-o,i=t.substring(o),o=0;n>o;o+=1)e.sendCommand(["keyboard",e.fid||0,0,"keydown",8,8,"Backspace",!1,!1,!1]),e.sendCommand(["keyboard",e.fid||0,0,"keyup",8,8,"Backspace",!1,!1,!1]);null!==k?e.surrogate_channel.send("mi-editable",k,r,n,i):s(["mi-editable",n,i])}}function f(e){y.value!==e&&(y.value=e)}function p(e){try{y.selectionStart=e.start,y.selectionEnd=e.end}catch(t){}}function _(){var e=i.getProjection(i.projectsToOVSL()?Compositor.ProjectionType.kOVSL:Compositor.ProjectionType.kViewport),t=e.projectRect(o.rect);Sk.Rect.toCSSStyle(t,y.style),y.style.position=i.projectsToOVSL()?"absolute":"fixed"}function g(e){y.style.width=y.style.height="0px",a&&(y.value="")}function h(){var e,t=o.data.formctrl.flags,n=!!(t&Sk.HT.FormControlElement.Flags.kDisabled),r=!!(t&Sk.HT.FormControlElement.Flags.kReadOnly),i=!!(t&Sk.HT.FormControlElement.Flags.kAutoCapitalize);if(o.data.formctrl.id_attr.length&&y.setAttribute("id",o.data.formctrl.id_attr),o.data.formctrl.name_attr&&y.setAttribute("name",o.data.formctrl.name_attr),n?y.setAttribute("disabled","1"):y.removeAttribute("disabled"),r?y.setAttribute("readonly","1"):y.removeAttribute("readonly"),i?y.setAttribute("autocapitalize","on"):y.removeAttribute("autocapitalize"),y.setAttribute("spellcheck","false"),y.setAttribute("custom_formctrl_flags",t),o.data.formctrl.input){switch(o.data.formctrl.input.type){case Sk.HT.InputElement.Type.kNumber:e="number";break;case Sk.HT.InputElement.Type.kEmail:e="email";break;case Sk.HT.InputElement.Type.kPassword:e="password";break;case Sk.HT.InputElement.Type.kSearch:e="search";break;case Sk.HT.InputElement.Type.kTel:e="tel";break;default:e="text"}y.setAttribute("type",e)}}function m(){o.data.formctrl.input?y=document.createElement("input"):o.data.formctrl.textarea?y=document.createElement("textarea"):o.data.formctrl.contenteditable?y=document.createElement("textarea"):assert(0),h(),y.setAttribute("nid",r),y.style.position="absolute",y.style.caretColor="transparent",y.style.left=y.style.top="0px",y.style.width=y.style.height="0px",y.style.fontSize="20px",y.style.margin=y.style.padding="0px"}function v(){m(),t.getDiv().appendChild(y),EventListener.setListenersEnabled(!0,y,["blur"],g),a||(null!==k?e.surrogate_channel.send("mi-register",k,r):s(["mi-register"]))}var y,w,b=this,k=n,S=[];b.processInputEvent=function(t){if(t.target===y)switch(t.type){case"selectionchange":break;case"beforeinput":w=y.value;break;case"input":a?u():d();break;case"keydown":case"keypress":case"keyup":"Enter"!==t.key||a||e.sendCommand(["keyboard",e.fid||0,0,t.type,13,13,t.key,!1,!1,!1]);break;case"touchstart":case"touchend":case"touchmove":case"touchcancel":t.preventDefault(),a&&(y.value="")}},b.doTapDown=function(){_()},b.focus=function(){y.focus()},b.blur=function(){y.blur()},b.updateInfo=function(t,n){assert(t&&n),i=t,o=n,h(),e.compositor.isDebugEnabled()&&y.setAttribute("lid",i.getID())},b.release=function(){assert(y),y.parentNode&&y.parentNode.removeChild(y),EventListener.setListenersEnabled(!1,y,["blur"],g),y=null,a||null===k||e.surrogate_channel.send("mi-unregister",k,r)},b.set_value=f,b.set_caret_pos=p,b.set_fid=l,v()},Compositor.ShadowSelect=function(e,t,n,r,i){function o(){var e=r.getProjection(r.projectsToOVSL()?Compositor.ProjectionType.kOVSL:Compositor.ProjectionType.kViewport);
Sk.Rect.toCSSStyle(e.projectRect(i.rect),u.style),u.style.position=r.projectsToOVSL()?"absolute":"fixed"}function a(t){var r=t.target.value;e.sendCommand(["CM-select",String(n),Number(r)])}function s(e){u.style.width=u.style.height="0px",u.style.left=u.style.top="-100px"}function c(e){var t,n,r;return t=document.createElement("select"),t.setAttribute("sv-prevent-push",!0),t.style.position="absolute",_||(t.style.opacity="0"),t.style.cursor="inherit",t.style.fontSize="20px",t.style.width=t.style.height="0px",r=null,e.forEach(function(e){switch(e.type){case Sk.HT.SelectItem.Type.kSeparator:n=document.createElement("option"),n.textContent="-----",n.setAttribute("disabled",!0),t.appendChild(n),r=null;break;case Sk.HT.SelectItem.Type.kGroup:n=document.createElement("optgroup"),n.setAttribute("label",e.label),t.appendChild(n),r=n;break;case Sk.HT.SelectItem.Type.kOption:n=document.createElement("option"),n.textContent=e.label,n.setAttribute("value",e.index),e.flags&Sk.HT.SelectItem.Flags.kChecked&&n.setAttribute("selected",!0),e.flags&Sk.HT.SelectItem.Flags.kEnabled||n.setAttribute("disabled",!0),e.flags&Sk.HT.SelectItem.Flags.kInGroup?r.appendChild(n):(r=null,t.appendChild(n));break;default:p.error({event:"tc-unrecognized-select-item-type",type:e.type})}}),EventListener.setListenersEnabled(!0,t,["change"],a),EventListener.setListenersEnabled(!0,t,["blur"],s),t}function l(){i.data.formctrl.id_attr.length&&u.setAttribute("id",i.data.formctrl.id_attr),i.data.formctrl.name_attr&&u.setAttribute("name",i.data.formctrl.name_attr)}function d(){u=c(i.data.formctrl.select.items),u.setAttribute("nid",n),l(),t.getDiv().appendChild(u)}var u,f=this,p=new Logger("shadow-select",{level:"info"}),_=!0;f.processInputEvent=function(e){},f.doTapDown=function(){o()},f.focus=function(){u.focus()},f.blur=function(){u.blur()},f.release=function(){assert(u),EventListener.setListenersEnabled(!1,u,["change"],a),EventListener.setListenersEnabled(!1,u,["blur"],s),u&&u.parentNode.removeChild(u),u=null},f.updateInfo=function(e,t){assert(e&&t),r=e,i=t,l()},d()},Compositor.ShadowElementManager=function(e,t,n){function r(){var e={},n=t.getLayerTree();return n&&n.getRoot()?(n.getRoot().walkDepthFirstIterative(function(t){var n=t.getDisplayList();n&&Util.forEachItem(n.getElements(),function(t,n){assert(!e[t]),e[t]=n})}),e):{}}function i(){var t=l,i=r();Util.forEachItem(t,function(e,t){var r;i.hasOwnProperty(e)?(r=i[e],r.shadow_element=t.shadow_element,r.shadow_element&&r.shadow_element.updateInfo(r.layer,r.item)):t.shadow_element&&(n&&n(t.shadow_element),t.shadow_element.release(),t.shadow_element=null)}),Util.forEachItem(i,function(t,n){var r,i,o=null;if(!n.shadow_element&&n.item.data.formctrl)switch(n.item.data.formctrl.type){case Sk.HT.FormControlElement.Type.kInput:case Sk.HT.FormControlElement.Type.kTextArea:case Sk.HT.FormControlElement.Type.kContentEditable:r=n.item.data.formctrl.type===Sk.HT.FormControlElement.Type.kContentEditable,i=n.item.data.node_id,d[i]&&(o=d[i].fid),n.shadow_element=new Compositor.ShadowTextControl(e,c,o,i,n.layer,n.item,r),d[i]&&(d[i].value&&n.shadow_element.set_value(d[i].value),d[i].caret_pos&&n.shadow_element.set_caret_pos(d[i].caret_pos));break;case Sk.HT.FormControlElement.Type.kSelect:n.shadow_element=new Compositor.ShadowSelect(e,c,n.item.data.node_id,n.layer,n.item)}}),l=i}function o(){var e=document.createElement("div");return t.isDebugEnabled()&&(e.id="sv-elements"),e.style.position="absolute",e.style.margin="0px",e.style.padding="0px",e.style.left="0px",e.style.top="0px",e.style.width="0px",e.style.height="0px",e.style.overflow="visible",e.style.zIndex=String(Compositor.ZIndexRange.kHitEmulation[0]),t.isDebugAnnotationEnabled()||(e.style.opacity="0"),e}function a(){s=o(),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_INPUT_VALUE,function(e,t,n){var r;d[t]||(d[t]={}),d[t].fid=e,d[t].value=n,r=l[t],r&&r.shadow_element&&r.shadow_element.set_value(n)}),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_CARET_POS,function(e,t,n){var r;d[t]||(d[t]={}),d[t].fid=e,d[t].caret_pos=n,r=l[t],r&&r.shadow_element&&r.shadow_element.set_caret_pos(n)}),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_INPUTS_UPDATE,function(e,t,n){var r;for(r=0;r<t.length;r+=1)delete d[t[r]];Util.forEachItem(n,function(t,n){var r;d[t]||(d[t]={}),d[t].value=n,d[t].fid=e,r=l[t],r&&r.shadow_element&&(r.shadow_element.set_fid(e),r.shadow_element.set_value(n))})})}var s,c=this,l={},d={};c.lookupElement=function(e){return i(),l[e]},c.getDiv=function(){return s},c.updateElements=i,a()},Compositor.GestureType={kUnknown:0,kTapDown:1,kTapUp:2,kScrollBegin:3,kScrollUpdate:4,kScrollEnd:5,kPinchBegin:6,kPinchUpdate:7,kPinchEnd:8},Compositor.TouchPhase={kBegin:0,kUpdate:1,kEnd:2},Compositor.GestureDetector=function(e){function t(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function n(e,n){return assert(e&&n),t(e,n)<=p}function r(){u={type:Compositor.GestureType.kUnknown,touch_by_id:{},active_touch_count:0,touches:[]}}function i(t,n,r){assert("number"==typeof t),assert("number"==typeof n),u.type=t,u.touch_event_id=n,r||e.on_gesture_fn(u)}function o(e){var t,r=u;switch(r.type){case Compositor.GestureType.kUnknown:switch(e){case Compositor.TouchPhase.kBegin:if(1===r.touches.length)return i(Compositor.GestureType.kTapDown,r.touches[0].touch_event_id);if(2===r.touches.length)return i(Compositor.GestureType.kPinchBegin,r.touches[0].touch_event_id)}break;case Compositor.GestureType.kTapDown:switch(e){case Compositor.TouchPhase.kBegin:if(2===r.touches.length)return i(Compositor.GestureType.kPinchBegin,r.touches[0].touch_event_id);break;case Compositor.TouchPhase.kUpdate:return 1===r.touches.length&&r.touches[0].move_count>_?(r.last_pos=r.touches[0].start_pos,i(Compositor.GestureType.kScrollBegin,r.touches[0].touch_event_id)):i(Compositor.GestureType.kTapDown,r.touches[0].touch_event_id,!0);case Compositor.TouchPhase.kEnd:if(1===r.touches.length&&r.touches[0].start_pos&&r.touches[0].end_pos&&n(r.touches[0].start_pos,r.touches[0].end_pos)&&r.touches[0].move_count<=_)return i(Compositor.GestureType.kTapUp,r.touches[0].touch_event_id);break;default:assert(0)}break;case Compositor.GestureType.kScrollBegin:case Compositor.GestureType.kScrollUpdate:switch(e){case Compositor.TouchPhase.kUpdate:return assert(1===r.touches.length),assert(r.touches[0].move_count>_),t=r.touches[0].pos,r.delta_x=t.x-r.last_pos.x,r.delta_y=t.y-r.last_pos.y,r.last_pos=t,i(Compositor.GestureType.kScrollUpdate,r.touches[0].touch_event_id);default:return i(Compositor.GestureType.kScrollEnd,r.touches[0].touch_event_id)}case Compositor.GestureType.kPinchBegin:case Compositor.GestureType.kPinchUpdate:switch(e){case Compositor.TouchPhase.kUpdate:return assert(2===r.touches.length),i(Compositor.GestureType.kPinchUpdate,r.touches[0].touch_event_id);default:return i(Compositor.GestureType.kPinchEnd,r.touches[0].touch_event_id)}}return i(Compositor.GestureType.kUnknown,0,!0)}function a(e){return MetricsUtils.clientToViewportCoords(e.clientX,e.clientY)}function s(e,t,n){var i;u&&(assert("number"==typeof n.identifier),i=u.touch_by_id[n.identifier],i&&(i.cancelled=t,t||(i.end_pos=a(n)),i.touch_event_id=e.event_id,delete u.touch_by_id[n.identifier],u.active_touch_count-=1,u.active_event=e,assert(u.active_touch_count>=0),o(Compositor.TouchPhase.kEnd),0===u.active_touch_count&&r()))}function c(e){e.touches&&u&&Util.forEachItem(u.touch_by_id,function(t,n){var r;for(r=0;r<e.touches.length;r+=1)if(t===String(e.touches[r].identifier))return;s(e,!0,n)})}function l(e,t){var n;switch(e.type){case"touchstart":u.touch_by_id.hasOwnProperty(t.identifier)&&s(e,!0,t),n={start_pos:a(t),pos:a(t),move_count:0,identifier:t.identifier,touch_event_id:e.event_id},assert(!u.touch_by_id[t.identifier]),u.touch_by_id[t.identifier]=n,u.touches.push(n),u.active_touch_count+=1,u.hits_non_fast_region=e.hits_non_fast_region,u.hits_touch_region=e.hits_touch_region,u.active_event=e,o(Compositor.TouchPhase.kBegin);break;case"touchmove":if(n=u.touch_by_id[t.identifier],!n)return;n.touch_event_id=e.event_id,n.move_count+=1,n.pos=a(t),u.active_event=e,o(Compositor.TouchPhase.kUpdate);break;case"touchend":case"touchcancel":s(e,"touchcancel"===e.type,t),assert(u.active_touch_count>=0);break;default:assert(0)}}function d(){r()}var u,f=this,p=2,_=0;f.processEvent=function(e){var t;for(t=0;t<e.changedTouches.length;t+=1)l(e,e.changedTouches[t]);c(e)},f.getPendingGesture=function(){return u},d()},Compositor.TouchTracker=function(e){function t(e){switch(e){case"touchstart":return _.kTouchStart;case"touchmove":return _.kTouchMove;case"touchend":return _.kTouchEnd;case"touchcancel":return _.kTouchCancel;default:assert(0)}return assert(0),-1}function n(e,t,n){var r=MetricsUtils.clientToViewportCoords(e.clientX,e.clientY);return assert("number"==typeof t),assert("number"==typeof n),{i:t,s:n,x:r.x,y:r.y,rx:void 0!==e.radiusX?e.radiusX:1,ry:void 0!==e.radiusY?e.radiusY:1,ra:void 0!==e.rotationAngle?e.rotationAngle:0,f:void 0!==e.force?e.force:1}}function r(){var e,t;for(t=0;f>t;t+=1)if(e=d[t],!e)return t;return-1}function i(e){return assert(void 0!==e),u[e]}function o(e,t){var o,a;switch(e){case"touchstart":case"touchmove":if("touchstart"===e){if(a=i(t.identifier))o=a.i;else if(o=r(),0>o)return}else{if(a=i(t.identifier),!a)return;o=a.i}a=n(t,o,"touchstart"===e?p.kPressed:p.kMoved),d[o]=a,u[t.identifier]=a;break;case"touchend":case"touchcancel":if(a=i(t.identifier),!a)return;a.s="touchend"===e?p.kReleased:p.kCancelled;break;default:assert(0,{type:e})}}function a(e){var t;for(t=0;t<e.changedTouches.length;t+=1)o(e.type,e.changedTouches[t])}function s(){var e,t,n=[];for(t=0;f>t&&(e=d[t],e);t+=1)assert(e.i===t),n.push(e);return n}function c(){}var l=this,d=[],u={},f=16,p={kPressed:0,kMoved:1,kReleased:2,kCancelled:3},_={kTouchStart:0,kTouchMove:1,kTouchEnd:2,kTouchCancel:3};l.processEvent=function(n){var r;a(n),r=s(),r.length&&e.sendCommand(["t",t(n.type),n.event_id,r]),n.touches.length||(u={},d=[])},c()},Compositor.InputDelegate=function(e,t){function n(e){return"keydown"===e.type||"keypress"===e.type||"keyup"===e.type||"compositionstart"===e.type||"compositionupdate"===e.type||"compositionend"===e.type||"input"===e.type||"beforeinput"===e.type||"textInput"===e.type||"selectionchange"===e.type}function r(e){return"touchstart"===e.type||"touchend"===e.type||"touchmove"===e.type||"touchcancel"===e.type}function i(e){t.sendCommand(["g",e])}function o(e,n,r){t.getLayerTree()&&t.getLayerTree().getRoot()&&!C.lookupElement(n)}function a(e,t,n){var r=C.lookupElement(t);r&&r.shadow_element&&r.shadow_element===E&&(r.shadow_element.blur(),E=null)}function s(e){var t,n;for(t=e.length-1;t>=0;t-=1)if(n=e[t],n.data&&n.data.formctrl)return n;return null}function c(e){var n,r=e.touches[0].start_pos,i=t.hitTest(Compositor.HitTest.kDrawing,r);i&&(n=s(i.items),n&&(e.hit_element=C.lookupElement(n.data.node_id).shadow_element,assert(e.hit_element,{e:"tap-down-failed",reason:"unknown element"}),e.hit_element&&e.hit_element.doTapDown()))}function l(e){var t=e.touches[0].start_pos;assert(t),E&&E!==e.hit_element&&E.blur(),E=e.hit_element,E&&E.focus()}function d(e){return e.hits_non_fast_region?!0:e.hits_touch_region&&U?!0:!1}function u(e){var t,n=e.touches[0].pos;if(e.hits_non_fast_region){switch(e.type){case Compositor.GestureType.kScrollBegin:t={t:"sb",x:n.x,y:n.y};break;case Compositor.GestureType.kScrollUpdate:t={t:"su",x:n.x,y:n.y,dx:e.delta_x,dy:e.delta_y};break;case Compositor.GestureType.kScrollEnd:t={t:"se",x:n.x,y:n.y};break;default:assert(0)}assert("number"==typeof e.touch_event_id),t.tid=e.touch_event_id,i(t),d(e)&&e.active_event.preventDefault()}}function f(e){e.hits_touch_region&&e.active_event.preventDefault()}function p(e){switch(e.type){case Compositor.GestureType.kUnknown:break;case Compositor.GestureType.kTapDown:c(e);break;case Compositor.GestureType.kTapUp:l(e);break;case Compositor.GestureType.kScrollBegin:case Compositor.GestureType.kScrollUpdate:case Compositor.GestureType.kScrollEnd:u(e);break;case Compositor.GestureType.kPinchBegin:case Compositor.GestureType.kPinchUpdate:case Compositor.GestureType.kPinchEnd:f(e);break;default:assert(0)}}function _(e){return n(e)?void(L.key=Date.now()):r(e)?void(L.touch=Date.now()):void assert(0)}function g(e){var n;e.hits_touch_region=e.hits_non_fast_region=!1,("touchstart"===e.type||"touchmove"===e.type)&&(n=MetricsUtils.clientToViewportCoords(e.touches[0].clientX,e.touches[0].clientY),e.hits_touch_region=!!t.hitTest(Compositor.HitTest.kTouchActionRegion,n),e.hits_non_fast_region=!!t.hitTest(Compositor.HitTest.kNonFastRegion,n))}function h(n){return _(n),("touchstart"===n.type||"touchmove"===n.type)&&(D={x:n.touches[0].clientX,y:n.touches[0].clientY}),e.detached?(e.detached=!1,void window.location.reload()):(E&&E.processInputEvent(n),r(n)?(O+=1,n.event_id=O,g(n),T.processEvent(n),x.processEvent(n),void(t.hasBlockingTouchEventListener()&&P&&n.preventDefault())):void 0)}function m(e){assert(e),E===e&&(E.blur(),E=null)}function v(){U=!0,A&&clearTimeout(A),A=setTimeout(function(){U=!1},I)}function y(e){1===e&&v()}function w(e){var t=e?EventListener.addListener:EventListener.removeListener;["keydown","keypress","keyup","compositionstart","compositionupdate","compositionend","input","beforeinput","textInput"].forEach(function(e){t(window,e,h,!1)}),["selectionchange"].forEach(function(e){t(document,e,h,!1)})}function b(e,t){var n=e?EventListener.addListener:EventListener.removeListener,r=["touchstart","touchmove","touchcancel","touchend"];r.forEach(function(e){n(window,e,h,!0,t)})}function k(){var e=!0,t=!1;b(e,t)}function S(){e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_FOCUS_ELEMENT,o),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_FOCUS_OUT,a),e.interp.registerOpcodeHandler("did_wh_pd",y),t.callback.register("touch-event-listener-changed",k),t.callback.register("main-thread-scrolling-changed",k),x=new Compositor.GestureDetector({on_gesture_fn:p}),C=new Compositor.ShadowElementManager(e,t,m),T=new Compositor.TouchTracker(t),w(!0),k()}var C,E,x,A,T,R=this,D={x:0,y:0},L={key:0,touch:0},P=!1,U=!1,I=500,O=1;R.getLastActivityTime=function(){return{key:L.key,mouse:L.touch,click:L.touch,input:Math.max(L.key,L.touch)}},R.getLastMousePos=function(){return D},R.getDiv=function(){return C.getDiv()},R.updateElements=function(){C.updateElements()},S()},Compositor.LayerTree=function(e,t,n){function r(e){return e===m.ivsl?"inner-viewport-scroll-layer":e===m.ovsl?"outer-viewport-scroll-layer":e===m.ovcl?"outer-viewport-container-layer":e===m.ohcl?"background-layer":"content-layer"}function i(e,t){assert(null!==e&&void 0!==e),assert(t),b[e]=t,t.isOuterViewportScrollLayer()?g=t:t.isInnerViewportScrollLayer()&&(h=t)}function o(e){var t;assert(null!==e&&void 0!==e),t=b[e],assert(t,{id:e}),t===g?g=null:t===h&&(h=null),t.destroy(),delete S[e],delete b[e]}function a(e){Util.forEachItem(e,function(e,t){var n=y.getLayer(t);n&&n.setRole(r(t))})}function s(e){var t=m;m=e,t&&a(t),a(e)}function c(e){return"number"==typeof e}function l(e){var n=m.ivsl,a={};assert(m),assert(c(n)&&n>=0),e.forEach(function(o){var s,l,d=o.type,u=o.layer_id,f=o.layer_parent_id,p=o.layer_sibling_index,g=u===n;assert(c(u)&&c(f),{layer_id:u,mutations:e,parent_layer_id:f}),d===Compositor.MutationType.kAddLayer?(s=y.getLayer(u),s||(s=new Compositor.Layer({id:u,role:r(u),type:o.layer_type,is_mask_layer:-1===p,compositor:t})),delete a[u],g?(assert(!_),y.setRoot(s)):(assert(f),l=y.getLayer(f),assert(l),l.insertChild(y,s,p)),i(u,s)):d===Compositor.MutationType.kRemoveLayer?(s=y.getLayer(u),assert(!a.hasOwnProperty(u)),s?(s.walkDepthFirst(null,function(e){e.remove(),_===e&&(_=null),a[e.id]=e}),assert(!s.getContainer().parentNode)):w.error({event:"tc-layer-not-found-on-removal",id:u})):w.error({event:"tc-unknown-mutation-type",type:d})}),Util.forEachItem(a,function(e,t){assert(String(t.id)===e,{removed_layer_id:t.id,id:e}),o(t.id)})}function d(){assert(_),_.walkDepthFirst(null,function(e){e.remove(),o(e.id)}),assert(!p.childNodes.length),assert(Util.isDictEmpty(b)),_=null,g=null,h=null,m=null}function u(e){k.current=e.page_scale_factor,k.min=e.min_page_scale_factor,k.max=e.max_page_scale_factor,t.isDebugEnabled()&&p.setAttribute("psf",JSON.stringify(k)),t.callback.fire("needs-meta-viewport-update")}function f(){p=document.createElement("div"),p.id=n}var p,_,g,h,m,v,y=this,w=new Logger("layer-tree",{level:"info"}),b={},k={},S={},C=1;y.walkDepthFirst=function(e,t){assert(_),_.walkDepthFirst(e,t)},y.hasMainThreadScrollingReasons=function(){return!Util.isDictEmpty(S)},y.trackMainThreadScrollingLayer=function(e){var n=y.hasMainThreadScrollingReasons();e.hasMainThreadScrollingReasons()?S[e.getID()]=!0:delete S[e.getID()],y.hasMainThreadScrollingReasons()!==n&&t.callback.fire("main-thread-scrolling-changed")},y.getLayer=function(e){return assert(null!==e&&void 0!==e),b.hasOwnProperty(e)?b[e]:null},y.withEachLayerDo=function(e){assert(e),Util.forEachItem(b,function(t,n){e(t,n)})},y.getOuterViewportScrollLayer=function(){return g},y.getInnerViewportScrollLayer=function(){return h},y.destroy=function(){d()},y.getPageScaleFactorLimits=function(){return k},y.applyCommit=function(e){assert(!e.full_tree||e.mutations),e.full_tree&&_&&d(),e.special_layer_ids&&s(e.special_layer_ids),void 0!==e.device_scale_factor&&(C=e.device_scale_factor,_&&_.hardInvalidateTilesInSubtree()),void 0!==e.page_scale_factor&&u(e),void 0!==e.display_list_tile_size&&(v=e.display_list_tile_size),e.mutations&&(assert(e.mutations.length),l(e.mutations)),assert(!e.full_tree||_)},y.getMaxDeviceScaleFactor=function(){return C},y.asDict=function(){var e={};return e.ids=[],Util.forEachItem(b,function(t,n){e.ids.push(t)}),e},y.getDisplayListTileSize=function(){return Object.freeze(v)},y.getRoot=function(){return _},y.setRoot=function(e){_=e,_.setTree(y),assert(0===p.childNodes.length),p.appendChild(e.getContainer())},y.hitTest=function(e,t){return _?_.hitTest(e,t):null},y.freeTiles=function(){_&&_.walkDepthFirstIterative(function(e){e.freeTiles()})},y.getDiv=function(){return p},f()},Compositor.Debug=function(e){function t(e){for(var t=e;t.getParent();)t=t.getParent();return t}function n(e){var n=[],r=e.getRoot();e.walkDepthFirst(function(e){t(e)!==r&&assert(0),e.getMaskLayer()&&assert(!e.getMaskLayer().getChildren().length),n.push(String(e.id))}),e.withEachLayerDo(function(e,t){-1===n.indexOf(e)&&(a.error({event:"unreachable-node",id:e,type:typeof e,reachable_ids:n}),assert(0))}),n.forEach(function(t){e.getLayer(t)||assert(0)})}function r(e){e.walkDepthFirst(function(e){var t,n;e.getChildren().length&&(t=e.getChildrenDiv().childNodes,n=t[0],e.getChildren().forEach(function(t){assert(t),assert(n),assert(n===t.getContainer(),{layer_id:e.id,child_id:t.id,child_node_id:t.getContainer().getAttribute("id"),node_ptr_id:n?n.getAttribute("id"):null}),n=n.nextSibling}))})}function i(){var t=e.getLayerTree();t.getRoot()&&(n(t),r(t))}function o(){s&&e.callback.register("activate-tree",i)}var a=new Logger("debug-helpers",{level:"info"}),s=!1;o()},Compositor.Matrix3D=function(){var e={};return e.projectPoint=function(e,t){var n=[],r=vec3.fromValues(t.x||0,t.y||0,t.z||0);return vec3.transformMat4(n,r,e),{x:n[0],y:n[1],z:n[2]}},e.mapPoints=function(e,t){var n,r,i,o,a=[];for(n=0;n<t.length;n+=1)r=t[n],i=vec2.fromValues(r[0],r[1]),o=vec2.create(),vec2.transformMat4(o,i,e),a.push(o);return a},e.rectStaysRect=e.is2DAxisPreserving=function(e){var t=0!==e[3]||0!==e[7],n=0,r=0,i=0,o=0;return Math.abs(e[0])>Number.EPSILON&&(n+=1,i+=1),Math.abs(e[4])>Number.EPSILON&&(n+=1,o+=1),Math.abs(e[1])>Number.EPSILON&&(r+=1,i+=1),Math.abs(e[5])>Number.EPSILON&&(r+=1,o+=1),1>=n&&1>=r&&1>=i&&1>=o&&!t},e.mapRectToQuad=function(t,n){return assert(t&&n),e.mapPoints(t,Sk.Rect.toQuad(n))},e.mapRect=function(t,n){return Sk.Rect.bboxRect(e.mapRectToQuad(t,n))},e.asCSSTransformMatrix3D=function(e){return"matrix3d("+e[0]+","+e[1]+","+e[2]+","+e[3]+","+e[4]+","+e[5]+","+e[6]+","+e[7]+","+e[8]+","+e[9]+","+e[10]+","+e[11]+","+e[12]+","+e[13]+","+e[14]+","+e[15]+")"},e.asCanvasTransformMatrix2D=function(e){return assert(16===e.length),[e[0],e[1],e[4],e[5],e[12],e[13]]},e.fromColumnMajorList=function(e){return mat4.fromValues.apply(mat4,e)},e.fromRowMajorList=function(t){var n=e.fromColumnMajorList(t);return mat4.transpose(n,n)},e}(),Compositor.InPageSearcher=function(e){function t(t,n){var r=f.value;e.surrogate_channel.send("in-page-search","query",r,t,n)}function n(){m||_.show_find(),t(!0,!1),v=!0}function r(t){v=!1,e.surrogate_channel.send("in-page-search","end",t),u&&(u.style.display="none",m=!1)}function i(){""===f.value?(p.innerHTML="",e.surrogate_channel.send("in-page-search","end","clear")):n()}function o(e,t){m&&v&&(p.innerHTML=t+"/"+e)}function a(e){switch(e){case"new":_.show_find();break;case"next":_.find_next();break;case"prev":_.find_prev();break;default:g.error("unexpected search type="+e)}}function s(e){"input"===e.type?i():13===e.keyCode?e.shiftKey?_.find_prev():e.ctrlKey?r("activate"):_.find_next():27===e.keyCode&&r("keep")}function c(e){return e.id===w}function l(t){var n=e.url_builder.buildAssetURL(t),r=document.createElement("link");return r.type="text/css",r.id=y,r.rel="stylesheet",r.href=n,r.media="all",r}function d(){BrowserDetect.isIE()?u.classList.add("safeview-in-page-search-div-ie"):BrowserDetect.isEdge()?u.classList.add("safeview-in-page-search-div-edge"):BrowserDetect.isFirefox()?u.classList.add("safeview-in-page-search-div-firefox"):BrowserDetect.isChrome()&&u.classList.add("safeview-in-page-search-div-chrome")}var u,f,p,_=this,g=new Logger("in-page-search",{level:"info"}),h=new ShortcutKeyHandler(e),m=!1,v=!1,y="safeview-in-page-search-css",w="safeview-in-page-search-div",b="safeview-in-page-search-input",k="safeview-in-page-search-count",S="safeview-in-page-search-close-button",C="safeview-in-page-search-next-button",E="safeview-in-page-search-prev-button";return _.insertInput=function(){u||(document.head.appendChild(l("/safeview-static/css/search.css")),document.body.insertAdjacentHTML("beforeend",e.template.get("search-template")),u=document.getElementById(w),p=document.getElementById(k),p.innerHTML="",f=document.getElementById(b),EventListener.addListener(f,"keydown",s,!0),EventListener.addListener(f,"input",s,!0),d(),u.style.display="none",u.style.zIndex=String(Compositor.ZIndexRange.kSearchInput[0]),m=!1)},_.find_next=function(){v?t(!0,!0):n()},_.find_prev=function(){v?t(!1,!0):n()},_.show_find=function(){m||(u||_.insertInput(),u.style.display="block",m=!0),f.focus(),f.select()},_.mouse_event_search_input=function(e){if(!m||!Util.findPredicateOnBranch(e.target,c))return!1;if("mouseup"===e.type)switch(e.target.id){case S:r("keep");break;case C:_.find_next(),f.focus();break;case E:_.find_prev(),f.focus();break;default:f.focus()}return!0},_.is_key_event_search_input=function(e){return m&&e.target.id===b&&!_.is_search_operation(e)},_.is_search_operation=function(e){var t=h.get_operation(e);return"inPageSearch"===t||"inPageSearchNext"===t||"inPageSearchPrev"===t},e.interp.registerOpcodeHandler("search_reply",o),e.interp.registerOpcodeHandler("search_start",a),_},Compositor.CommitFlags=Object.freeze({kFullTree:1,kResetCache:2,kWheelEventListener:4,kBlockingWheelEventListener:8,kDirtySpecialIds:16,kDirtyDSF:32,kHasMutations:64,kHasDebugData:128,kDirtyPageScaleFactorAndLimits:256,kDirtyDisplayListTileSize:512,kTouchEventListener:1024,kBlockingTouchEventListener:2048}),Compositor.DirtyProps=Object.freeze({kFlags:1,kBounds:2,kOpacity:4,kBlendMode:8,kPosition:16,kTransform:32,kTransformOrigin:64,kBackgroundColor:128,kScrollOffset:256,kScrollClipLayerId:512,kPositionConstraint:1024,kStickyPositionConstraint:2048,kScrollParentId:4096,kClipParentId:8192,kNodeId:16384,kNonFastScrollableRegion:32768,kRecordedViewport:65536,kDirtyTiles:1<<17,kTextureBounds:1<<18,kMainThreadScrollingReasons:1<<19,kTouchActionRegion:1<<20,kAll:4294967295}),Compositor.LayerFlags=Object.freeze({kMasksToBounds:1,kContentsOpaque:2,kIsDrawable:4,kIsDoubleSided:8,kShouldFlattenTransform:16,kUseParentBackfaceVisibility:32,kUserScrollableHorizontal:64,kUserScrollableVertical:128,kIsContainerForFixedPositionLayers:256,kHasWillChangeTransformHint:512,kHideLayerAndSubTree:1024,kIsCanvasBacking:2048,kIsScrollbar:4096,kHasCustomScrollbar:8192,kIsHitTestable:16384,kIsSurfaceLayerWithVideo:32768}),Compositor.StickyPositionFlags=Object.freeze({kIsSticky:1,kIsAnchoredLeft:2,kIsAnchoredRight:4,kIsAnchoredTop:8,kIsAnchoredBottom:16}),Compositor.LayerType=Object.freeze({Unknown:0,Layer:1,PictureLayer:2,SolidColorScrollbarLayer:3,VideoLayer:4,TextureLayer:5,SurfaceLayer:6}),Compositor.MutationType=Object.freeze({kAddLayer:0,kRemoveLayer:1}),Compositor.MessageFlags=Object.freeze({kFrameDelay:0,kScrollUpdates:1,kPixelDistance:2,kInvalidateAllLayers:3,kInvalidateLayerRect:4,kInvalidateLayerTree:5,kSetDebugDataEnabled:6}),Compositor.BinaryReader=function(){function e(e){var t={};return t.type=e.readUint32(),t.layer_id=e.readInt32(),t.layer_type=e.readUint32(),t.layer_parent_id=e.readInt32(),-1!==t.layer_parent_id?t.layer_sibling_index=e.readInt32():t.layer_sibling_index=-1,t}function t(t){var n,r=[],i=t.readUint32();for(n=0;i>n;n+=1)r.push(e(t));return r}function n(e,t){var n,r,i,o,a,s,c,l=e.readUint32();for(t.tile_updates=[],n=0;l>n;n+=1){for(s={},i=e.readUint32(),s.index_x=65535&i,s.index_y=i>>16&65535,o=e.readUint32(),a=o>>16&65535,c=!!(1&o),s.invalidation_region=[],r=0;a>r;r+=1)s.invalidation_region.push(e.readRect());c&&(s.solid_color=e.readUint32()),s.skr_u8a=e.readByteArray(),t.tile_updates.push(s)}}function r(e,t){var r,i,o,a,s,c,l={};if(i=e.readUint32(),l.dirty_props=16777215&i,l.layer_type=e.readUint32(),l.id=e.readInt32(),assert(l.layer_type===Compositor.LayerType.Layer||l.layer_type===Compositor.LayerType.PictureLayer||l.layer_type===Compositor.LayerType.SolidColorScrollbarLayer||l.layer_type===Compositor.LayerType.VideoLayer||l.layer_type===Compositor.LayerType.SurfaceLayer||l.layer_type===Compositor.LayerType.TextureLayer,{layer_type:l.layer_type}),l.dirty_props&Compositor.DirtyProps.kFlags&&(l.flags=e.readUint32()),l.dirty_props&Compositor.DirtyProps.kBounds&&(l.bounds={width:e.readUint32(),height:e.readUint32()}),l.dirty_props&Compositor.DirtyProps.kOpacity&&(l.opacity=e.readFloat32()),l.dirty_props&Compositor.DirtyProps.kBlendMode&&(l.blend_mode=e.readUint32()),l.dirty_props&Compositor.DirtyProps.kPosition&&(l.position={x:e.readFloat32(),y:e.readFloat32()}),l.dirty_props&Compositor.DirtyProps.kTransform&&(a=e.readUint32(),a&(Sk.MatrixMask.Scale|Sk.MatrixMask.Affine|Sk.MatrixMask.Perspective)?l.transform=Compositor.Matrix3D.fromRowMajorList(e.readFloat32Array(16)):a&Sk.MatrixMask.Translate?(s=e.readFloat32Array(3),l.transform=mat4.fromTranslation(mat4.create(),s)):l.transform=null),l.dirty_props&Compositor.DirtyProps.kTransformOrigin&&(l.transform_origin={x:e.readFloat32(),y:e.readFloat32(),z:e.readFloat32()}),l.dirty_props&Compositor.DirtyProps.kBackgroundColor&&(l.background_color=e.readUint32()),l.dirty_props&Compositor.DirtyProps.kScrollOffset&&(l.scroll_offset={x:e.readFloat32(),y:e.readFloat32()},l.scroll_clock=[e.readUint32(),e.readUint32()]),l.dirty_props&Compositor.DirtyProps.kScrollClipLayerId&&(l.scroll_clip_layer_id=e.readInt32()),l.dirty_props&Compositor.DirtyProps.kPositionConstraint&&(c=e.readUint32(),l.is_fixed=!!(1&c),l.is_fixed_to_right_edge=!!(2&c),l.is_fixed_to_bottom_edge=!!(4&c)),l.dirty_props&Compositor.DirtyProps.kStickyPositionConstraint&&(l.sticky_flags=e.readUint32(),l.sticky_flags&Compositor.StickyPositionFlags.kIsSticky&&(l.sticky_flags&Compositor.StickyPositionFlags.kIsAnchoredLeft&&(l.sticky_position_left_offset=e.readFloat32()),l.sticky_flags&Compositor.StickyPositionFlags.kIsAnchoredRight&&(l.sticky_position_right_offset=e.readFloat32()),l.sticky_flags&Compositor.StickyPositionFlags.kIsAnchoredTop&&(l.sticky_position_top_offset=e.readFloat32()),l.sticky_flags&Compositor.StickyPositionFlags.kIsAnchoredBottom&&(l.sticky_position_bottom_offset=e.readFloat32()),l.scroll_container_relative_sticky_box_rect=e.readRect(),l.scroll_container_relative_containing_block_rect=e.readRect())),l.dirty_props&Compositor.DirtyProps.kScrollParentId&&(l.scroll_parent_id=e.readInt32()),l.dirty_props&Compositor.DirtyProps.kClipParentId&&(l.clip_parent_id=e.readInt32()),l.dirty_props&Compositor.DirtyProps.kNodeId&&(l.node_id=e.readInt32()),l.dirty_props&Compositor.DirtyProps.kNonFastScrollableRegion)for(r=e.readUint32(),l.non_fast_scrollable_rects=[],o=0;r>o;o+=1)l.non_fast_scrollable_rects.push(e.readRect());if(l.dirty_props&Compositor.DirtyProps.kTouchActionRegion)for(r=e.readUint32(),l.touch_action_rects=[],o=0;r>o;o+=1)l.touch_action_rects.push(e.readRect());return l.dirty_props&Compositor.DirtyProps.kMainThreadScrollingReasons&&(l.main_thread_scrolling_reasons=e.readInt32()),l.layer_type===Compositor.LayerType.PictureLayer&&(l.dirty_props&Compositor.DirtyProps.kDirtyTiles&&n(e,l),t&Compositor.CommitFlags.kHasDebugData&&(l.skpic=e.readByteArray())),l.layer_type===Compositor.LayerType.TextureLayer&&(l.dirty_props&Compositor.DirtyProps.kTextureBounds&&(l.texture_bounds={width:e.readUint32(),height:e.readUint32()}),l.dirty_props&Compositor.DirtyProps.kDirtyTiles&&(l.skr_u8a=e.readByteArray())),l}function i(e,t,n){var i,o=[];for(i=0;t>i;i+=1)o.push(r(e,n));return o}var o=this;o.readCommit=function(e){var n,r,o,a,s,c=new Sk.BinaryReader(e),l={};return n=c.readUint32(),l.flags=r=65535&n,o=n>>16,l.full_tree=!!(r&Compositor.CommitFlags.kFullTree),l.reset_cache=!!(r&Compositor.CommitFlags.kResetCache),l.wheel_event_listener=!!(r&Compositor.CommitFlags.kWheelEventListener),l.blocking_wheel_event_listener=!!(r&Compositor.CommitFlags.kBlockingWheelEventListener),l.touch_event_listener=!!(r&Compositor.CommitFlags.kTouchEventListener),l.blocking_touch_event_listener=!!(r&Compositor.CommitFlags.kBlockingTouchEventListener),r&Compositor.CommitFlags.kDirtySpecialIds&&(l.special_layer_ids={},l.special_layer_ids.ivsl=c.readInt32(),l.special_layer_ids.ohcl=c.readInt32(),l.special_layer_ids.ovcl=c.readInt32(),l.special_layer_ids.ovsl=c.readInt32()),r&Compositor.CommitFlags.kDirtyDSF&&(l.device_scale_factor=c.readFloat32()),r&Compositor.CommitFlags.kDirtyPageScaleFactorAndLimits&&(l.page_scale_factor=c.readFloat32(),l.min_page_scale_factor=c.readFloat32(),l.max_page_scale_factor=c.readFloat32()),r&Compositor.CommitFlags.kDirtyDisplayListTileSize&&(a=c.readUint32(),s=c.readUint32(),l.display_list_tile_size=Object.freeze({width:a,height:s})),r&Compositor.CommitFlags.kHasMutations&&(l.mutations=t(c)),l.layer_updates=i(c,o,r),Object.freeze(l)}},Sk.BinaryWriter=function(e){function t(e){var t,n=new Uint8Array(e);for(t=0;c>t;t+=1)n[t]=o[t];o=n,i=new window.DataView(o.buffer,o.byteOffset,o.byteLength),s=e}function n(e){var n=c+e,r=c;return n>s&&t(n),c=n,r}function r(){assert(e>0),o=new Uint8Array(e),i=new window.DataView(o.buffer,o.byteOffset,o.byteLength)}var i,o,a=this,s=e,c=0,l=!0;a.writeUint32=function(e){i.setUint32(n(4),e,l)},a.writeInt32=function(e){i.setInt32(n(4),e,l)},a.writeFloat32=function(e){i.setFloat32(n(4),e,l)},a.writeRect=function(e){Sk.assert(4===e.length),a.writeFloat32(e[0]),a.writeFloat32(e[1]),a.writeFloat32(e[2]),a.writeFloat32(e[3])},a.getData=function(){return o},r()},Compositor.VideoMode={kCopy:0,kTunnel:1},Compositor.VideoDelegate=function(e,t){function n(){I&&(I.parentNode.style.display="none")}function r(e){var n=J[e];n&&(n.deregisterNoDrawRegion(t),delete J[e])}function i(e){return assert(!J.hasOwnProperty(e.getID())),e.registerNoDrawRegion(t)?(J[e.getID()]=e,!0):!1}function o(){Util.forEachItem(J,function(e,t){r(e)}),assert(Util.isDictEmpty(J))}function a(n){assert(n),e.getLayerTree().getRoot().walkDepthFirstIterative(function(e){return e===t?!0:(assert(e.paintsBefore(t),{a:e.getPositionVec(),a_id:e.getID(),b:t.getPositionVec(),b_id:t.getID()}),t.hasVisualIntersect(e)&&n(e)?!0:void 0)})}function s(n,s){var c=(Util.now(),!0);return assert("object"==typeof s),n?(o(),a(function(e){
return i(e)?void 0:(c=!1,!0)})):Util.forEachItem(s,function(e){var n=t.getTree().getLayer(e);return r(e),n&&n.isAttached()&&n.isOccludedBy(t)?i(n)?void 0:(c=!1,!0):void 0}),c||o(),e.isDebugEnabled()&&I&&I.setAttribute("tunnel_layers",Object.keys(J)),c}function c(){var n;e.isDebugEnabled()&&(O||(O=document.createElement("div"),O.style.position="absolute",O.style.left="0px",O.style.top="0px",O.style.backgroundColor="#FF851B",O.style.color="white",t.getHudDiv()&&t.getHudDiv().appendChild(O)),n=Y?Q/Y:0,O.textContent="Video: "+Y+" FPS, "+n.toFixed(2)+" ms/F")}function l(n,r){(BrowserDetect.isFirefox()||BrowserDetect.isChrome()&&BrowserDetect.isMac()&&BrowserDetect.getVersion()<71)&&n.drawImageRect(I,Sk.Rect.fromXYWH(0,0,1,1),Sk.Rect.fromXYWH(0,0,1,1)),e.isVideoEnabled()?n.drawImageRect(I,Sk.Rect.fromWH(I.videoWidth,I.videoHeight),t.getBoundsRect(),U):n.drawRRect({rect:Sk.Rect.fromWH(Sk.Rect.getWidth(r),Sk.Rect.getHeight(r))},U)}function d(){var n=Util.now();return assert(e.isInAnimationFrame()),assert(B===Compositor.VideoMode.kCopy),t.getBigCanvas().drawTilesInRect(t.getBoundsRect(),l)?(Util.now()-G>=W?(c(),Y=0,Q=0,G=Util.now()):(Y+=1,Q+=Util.now()-n),!0):!1}function u(t){return t===Compositor.VideoMode.kCopy?!0:(assert(t===Compositor.VideoMode.kTunnel),e.isNativeVideoEnabled()&&!Z)}function f(){M||(M=setTimeout(function(){return M=null,I&&B!==Compositor.VideoMode.kTunnel?Util.now()-N<j?void f():void t.runOn("will-draw",function(){k(Compositor.VideoMode.kTunnel)}):void 0},j))}function p(){M&&(clearTimeout(M),M=null),Y=0,Q=0,c()}function _(){var t=Compositor.ZIndexRange.kVideoElement[0],n=Util.dictValues(e.getLayerTree().getRoot().getSubTreeLayersByKey("video"));n.sort(function(e,t){return e.isOccludedBy(t)?-1:1}),n.forEach(function(e){var n,r=e.getVideoDelegate();r&&(n=r.getVideoNode(),n&&(assert(t<=Compositor.ZIndexRange.kVideoElement[1]),n.style.zIndex=n.parentNode.style.zIndex=String(t),t+=1))})}function g(t,n){I&&e.isDebugEnabled()&&I.setAttribute("debug_"+t,n)}function h(){var n,r,i,o,a,s,c,l=I.parentNode,d=t.getBoundsRect();return assert(e.isInAnimationFrame()),n=t.getProjection(t.shouldProjectToOVSL()?Compositor.ProjectionType.kOVSL:Compositor.ProjectionType.kViewport),n.rectStaysRect()?(i=n.projectRect(d),assert(i),r=mat4.clone(n.getMatrix()),assert(r),l.style.position=t.shouldProjectToOVSL()?"absolute":"fixed",l.style.display="block",l.style.left=Sk.Rect.getLeft(i)+"px",l.style.top=Sk.Rect.getTop(i)+"px",l.style.width=Sk.Rect.getWidth(i)+"px",l.style.height=Sk.Rect.getHeight(i)+"px",l.style.overflow="hidden",assert(void 0!==I.videoWidth&&void 0!==I.videoHeight),I.lastVideoWidth=I.videoWidth,I.lastVideoHeight=I.videoHeight,I.videoWidth>0&&I.videoHeight>0?(g("debug","got dims "+I.videoWidth+"x"+I.videoHeight),c=mat4.create(),o=Sk.Rect.getWidth(d)/I.videoWidth,a=Sk.Rect.getHeight(d)/I.videoHeight,e.isDebugEnabled()&&(I.setAttribute("sx",o),I.setAttribute("sy",a)),mat4.scale(c,c,vec3.fromValues(o,a,1)),mat4.multiply(r,r,c)):g("debug","awaiting dims"),s=mat4.create(),mat4.translate(s,s,vec3.fromValues(-Sk.Rect.getLeft(i),-Sk.Rect.getTop(i),0)),mat4.multiply(r,s,r),I.style.transform=Compositor.Matrix3D.asCSSTransformMatrix3D(r),I.style.transformOrigin="0px 0px 0px",_(),!0):!1}function m(n){var r=t.getBlendMode(),i=F;return assert(e.isInAnimationFrame()),F=!1,r!==Sk.BlendMode.kSrc&&r!==Sk.BlendMode.kSrcOver?!1:i&&!h()?!1:s(i,n)?!0:!1}function v(){return assert(e.isInAnimationFrame()),V.setNeedsReproject(),m({})?(p(),t.setBigCanvasVisible(!1),O&&(O.style.display="none"),!0):!1}function y(e){t.invalidateRect(t.getLocalDrawRect(),e)}function w(){return assert(e.isInAnimationFrame()),o(),n(),t.setBigCanvasVisible(!0),O&&(O.style.display="block"),y("video-switch-to-copy"),!0}function b(){p(),o(),n()}function k(t,n){if(assert(void 0!==t),assert(e.isInAnimationFrame()),I&&B!==t){if(!u(t))return B=Compositor.VideoMode.kCopy,void w();if(n&&(Z=!0),t===Compositor.VideoMode.kTunnel){if(v())return void(B=t);t=Compositor.VideoMode.kCopy,Z=!0}assert(t===Compositor.VideoMode.kCopy),B!==t&&(B=t,w())}}function S(){var n;assert(t.hasVideoContent()),I||(n=t.getDOMNodeId(),n&&(I=getNodeByUidOnly(n),I&&(e.isDebugEnabled()&&(I.setAttribute("video_layer",t.getID()),I.setAttribute("pos_code",t.getPositionVec())),L(I,!0),V.updateSizeAndRedraw(t.getBounds()),V.requestDisplay())))}function C(t){assert(e.isInAnimationFrame()),B===Compositor.VideoMode.kTunnel&&(m(t)||k(Compositor.VideoMode.kCopy,!0))}function E(){return B!==Compositor.VideoMode.kCopy?!1:I?Util.now()-q<1e3/K?!1:I.paused?!1:!0:!1}function x(){E()&&y("video-needs-redraw")}function A(e){("play"===e.type||"seeked"===e.type||"loadeddata"===e.type||"canplay"===e.type)&&y("video-copy-mode-event")}function T(n){return I?(g("state",n.type),g("src",I.src),g("currentSrc",I.currentSrc),B===Compositor.VideoMode.kCopy?void A(n):B===Compositor.VideoMode.kTunnel?void(("timeupdate"===n.type||"loadedmetadata"===n.type)&&(I.lastVideoWidth!==I.videoWidth||I.lastVideoHeight!==I.videoHeight)&&(e.setVideoSizeChanged(),t.runOn("will-draw",function(){I&&h()}))):void 0):void X.error({event:"tc-unexpected-video-event",reason:"not paired with video element"})}function R(e){e===t.getDOMNodeId()&&S()}function D(){e.isFullscreen()||(N=Util.now(),t.runOn("will-draw",function(){t.shouldProjectToOVSL()||k(Compositor.VideoMode.kCopy)}))}function L(e,t){assert(e);var n=t?EventListener.addListener:EventListener.removeListener;["play","pause","seeked","canplay","loadeddata","loadedmetadata","timeupdate"].forEach(function(t){n(e,t,T)})}function P(){U=Sk.Paint.makePaint({filterQuality:Sk.FilterQuality.kMedium})}var U,I,O,B,M,N,F,V=this,H=function(){return{lid:t.getID(),fc:e.getFrameCount()}},X=new Logger("video-del",{level:"info",header:H}),K=30,W=1e3,j=500,z={},Y=0,Q=0,G=0,q=0,J={},Z=!1,$=!1;V.drawFrame=function(){return assert(e.isInAnimationFrame()),B!==Compositor.VideoMode.kCopy?!0:(u(Compositor.VideoMode.kTunnel)&&f(),I&&I.parentNode?(q=Util.now(),d()):(X.error({event:"tc-video-draw-error",video:!!I,attached:I?!!I.parentNode:!1,reason:"video element is in unplayable state"}),!0))},V.requestDisplay=function(){t.runOn("will-draw",function(){k(e.isNativeVideoEnabled()?Compositor.VideoMode.kTunnel:Compositor.VideoMode.kCopy)})},V.beginDisplay=k,V.pairWithVideoElementIfNeeded=S,V.setNeedsReproject=function(){F=!0},V.updateSizeAndRedraw=function(e){I&&B===Compositor.VideoMode.kCopy&&d()},V.stop=function(t){$&&(b(),I&&(L(I,!1),I=null,B=null),Util.forEachItem(z,function(t,n){var r=e.callback.deregister(n);assert(r)}),z={},$=!1)},V.start=function(t){$=!0,z.media_node_insert=e.callback.register("media-node-inserted",R),z.scroll=e.callback.register("scroll-container-scrolled",D),z.will_commit_finalize=e.callback.register("will-draw",C),z.begin_animation_frame=e.callback.register("begin-animation-frame",x),S()},V.getVideoNode=function(){return I},P()},Compositor.GraphWidgetType=Object.freeze({kRateWidget:1,kValueWidget:2}),Compositor.GraphWidget=function(e,t,n,r,i){function o(e){e=Math.round(e),l.firstChild&&l.removeChild(l.firstChild),l.appendChild(document.createTextNode(e+" "+t))}function a(e){var t=f/n[1];return Math.min(f,Math.max(Math.round(t*e),1))}function s(){assert(e===Compositor.GraphWidgetType.kRateWidget||e===Compositor.GraphWidgetType.kValueWidget),l=document.createElement("div"),l.id="sv-text:"+t,l.style.color="rgb(0, 255, 0)",l.style.fontFamily="Arial",l.style.fontSize="9px",l.style.fontWeight="bold",l.style.lineHeight="15px",o(""),d=document.createElement("div"),d.id="sv-graph:"+t,d.style.position="relative",d.style.width="74px",d.style.height=f+"px",d.style.backgroundColor="rgb(0, 0, 0)",d.style.transform="rotateX(180deg)",d.style.overflow="hidden",c=document.createElement("div"),c.id="sv-widget:"+t,c.style.display="inline-block",c.style.textAlign="left",c.style.padding="0px 0px 3px 3px",c.style.margin="5px",c.style.backgroundColor="rgb(0, 0, 0)",c.style.borderRadius="3px 3px 3px 3px",c.style.overflow="visible",c.style.opacity="0.8",c.style.filter="drop-shadow(0 0 40px #333)",c.appendChild(l),c.appendChild(d)}var c,l,d,u=this,f=30,p=70,_=Date.now(),g=[],h=0;u.getDiv=function(){return c},u.getHelpMsg=function(){return i},u.update=function(t){var i,s,c,l,u,f,m,v=Math.max(1,Date.now()-_),y=0,w=0;if(t.length){if(d.childNodes.length>=p)i=d.firstChild,d.removeChild(i);else for(i=document.createElement("div"),i.style.width="1px",i.style["float"]="left",i.style.overflow="hidden",m=0;r>m;m+=1)s=document.createElement("div"),s.style.display="block",s.style.width="1px",s.style.padding="0px 0px 0px 0px",i.appendChild(s);for(m=0;m<t.length;m+=1)u=t[m][0],f=t[m][1]||"rgb(0, 255, 0)",void 0===g[m]&&(g[m]=0),g[m]+=u,w+=u,h+=w,e===Compositor.GraphWidgetType.kRateWidget?c=a(g[m]*(1e3/v)):e===Compositor.GraphWidgetType.kValueWidget&&(c=a(u)),l=i.childNodes[m],assert(l,{i:m}),l.style.top=y+"px",l.style.height=c+"px",l.style.backgroundColor=u>n[1]?"rgb(255, 0, 0)":f,y+=c;v>=1e3&&(e===Compositor.GraphWidgetType.kRateWidget?o(h/(v/1e3)):e===Compositor.GraphWidgetType.kValueWidget&&o(w),g=[],h=0,_=Date.now()),d.appendChild(i)}},s()},Compositor.HUD=function(e,t){function n(){s||(s=window.requestAnimationFrame(function(){s=null,Date.now()-d>=t&&(e(u),d=Date.now()),n()}))}function r(e){c.firstChild&&c.removeChild(c.firstChild),c.appendChild(document.createTextNode(e))}function i(){u.cps=new Compositor.GraphWidget(Compositor.GraphWidgetType.kRateWidget,"CPS",[0,30],1,"Commits Per Second"),u.fps=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"FPS",[0,70],1,"Frames Per Second"),u.sfps=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"SFPS",[0,70],1,"Surrogate FPS"),u.cql=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"CQL",[0,100],1,"Commit Queue Length"),u.crx=new Compositor.GraphWidget(Compositor.GraphWidgetType.kRateWidget,"CRX (KB)",[0,200],1,"Commit Receive Rate"),u.canvas=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"CANV (MB)",[0,600],4,"Canvas Memory Usage"),Util.forEachItem(u,function(e,t){a.appendChild(t.getDiv()),EventListener.addListener(t.getDiv(),"mouseover",function(e){c.style.display="block",r(t.getHelpMsg())}),EventListener.addListener(t.getDiv(),"mouseout",function(e){c.style.display="none"})})}function o(){assert(e),c=document.createElement("div"),c.id="sv-tooltip:"+name,c.style.display="none",c.style.position="fixed",c.style.left="50%",c.style.top="40%",c.style.transform="translate(-50%, -50%)",c.style.padding="10px",c.style.color="white",c.style.backgroundColor="rgba(40, 40, 40, 0.9)",c.style.borderRadius="3px 3px 3px 3px",a=document.createElement("div"),a.id="sv-hud",a.style.display="none",a.style.position="fixed",a.style.top="10%",a.style.right="15px",a.style.width="80px",a.style.zIndex=String(Compositor.ZIndexRange.kHUD[0]),a.appendChild(c),i()}var a,s,c,l=this,d=Date.now(),u={};void 0===t&&(t=100),l.getDiv=function(){return a},l.start=function(){n()},l.stop=function(){s&&(window.cancelAnimationFrame(s),s=null)},l.show=function(){a.style.display="block"},l.hide=function(){a.style.display="none"},l.addWidget=function(e){var t=document.createElement("div");return t.id=e,a.appendChild(t),t},l.updateWidget=function(e,t){e&&(e.firstChild&&e.removeChild(e.firstChild),t?(e.style.display="block",e.appendChild(document.createTextNode(t))):e.style.display="none")},o()},Compositor.RequestAnimationFrame=function(e,t){function n(){t(),o=window.requestAnimationFrame(n)}function r(){return o&&(window.cancelAnimationFrame(o),o=null),a&&(clearInterval(a),a=null),Util.isTabVisible()?(assert(!o),void(o=window.requestAnimationFrame(n))):void(a=window.setInterval(t,l))}function i(){assert(window.requestAnimationFrame&&window.cancelAnimationFrame)}var o,a,s=this,c="visibilitychange",l=3e3;s.start=function(){assert(t),EventListener.addListener(window,c,r),r()},s.stop=function(){EventListener.removeListener(window,c,r)},i()};var MSG_KIND_DATA=1,MSG_KIND_CONTROL=2,MSG_KIND_PB=3,MSG_KIND_CANVAS=4,mf=null,tc_kernel,safeview,use_old_ime=!1,local_echo_enabled=!1,local_echo_config={};start();